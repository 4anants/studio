{
  "entities": {
    "Employee": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Employee",
      "type": "object",
      "description": "Represents an employee within the company.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the employee."
        },
        "username": {
          "type": "string",
          "description": "Employee's username for login."
        },
        "firstName": {
          "type": "string",
          "description": "Employee's first name."
        },
        "lastName": {
          "type": "string",
          "description": "Employee's last name."
        },
        "email": {
          "type": "string",
          "description": "Employee's email address.",
          "format": "email"
        },
        "isAdmin": {
          "type": "boolean",
          "description": "Indicates if the employee has administrator privileges."
        }
      },
      "required": [
        "id",
        "username",
        "firstName",
        "lastName",
        "email",
        "isAdmin"
      ]
    },
    "Document": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Document",
      "type": "object",
      "description": "Represents a document stored in the system.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the document."
        },
        "employeeId": {
          "type": "string",
          "description": "Reference to the Employee who uploaded the document. (Relationship: Employee 1:N Document)"
        },
        "filename": {
          "type": "string",
          "description": "Original filename of the document."
        },
        "uploadDate": {
          "type": "string",
          "description": "Date and time when the document was uploaded.",
          "format": "date-time"
        },
        "fileType": {
          "type": "string",
          "description": "Type of the file (e.g., PDF, DOC)."
        },
        "documentCategory": {
          "type": "string",
          "description": "The category of the uploaded document. (e.g. Salary Slip, Medical Reports, Appraisal Letters, Personal Document)"
        },
        "url": {
          "type": "string",
          "description": "URL to where the document is stored."
        }
      },
      "required": [
        "id",
        "employeeId",
        "filename",
        "uploadDate",
        "fileType",
        "documentCategory",
        "url"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{employeeId}",
        "definition": {
          "entityName": "Employee",
          "schema": {
            "$ref": "#/backend/entities/Employee"
          },
          "description": "Stores employee profiles. Includes denormalized data for potential future access control needs based on user profiles.",
          "params": [
            {
              "name": "employeeId",
              "description": "The unique ID of the employee."
            }
          ]
        }
      },
      {
        "path": "/users/{employeeId}/documents/{documentId}",
        "definition": {
          "entityName": "Document",
          "schema": {
            "$ref": "#/backend/entities/Document"
          },
          "description": "Stores documents uploaded by employees. Access is controlled by the employeeId in the path. This enforces ownership and simplifies security rules.",
          "params": [
            {
              "name": "employeeId",
              "description": "The unique ID of the employee who owns the document."
            },
            {
              "name": "documentId",
              "description": "The unique ID of the document."
            }
          ]
        }
      },
      {
        "path": "/roles_admin/{employeeId}",
        "definition": {
          "entityName": "Employee",
          "schema": {
            "$ref": "#/backend/entities/Employee"
          },
          "description": "Indicates admin role for an employee. The existence of a document at this path grants admin privileges. This is an existence check for roles.",
          "params": [
            {
              "name": "employeeId",
              "description": "The unique ID of the employee who has admin privileges."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to securely manage employee documents, separating admin-related data and user-specific content. It leverages path-based ownership for user documents and a dedicated collection for admin users. This design promotes authorization independence, simplifies security rules, and enhances list operation security.\n\nAuthorization Independence:\n\n*   Employee Documents: Documents related to an employee are stored under the `/users/{employeeId}/documents/{documentId}` path. This path ensures that access to a document is solely based on the employee's ID, eliminating the need to fetch parent document data for authorization.\n\nQAPs (Rules are not Filters):\n\n*   Secure List Operations: By segregating user-specific documents under `/users/{employeeId}/documents/{documentId}` and using existence checks for admin roles in `/roles_admin/{employeeId}`, we can create security rules that do not require filtering data based on document content. List operations can be securely performed knowing that the rules will only allow access to authorized documents.\n\n*   Path-Based Ownership: Documents are stored under `/users/{employeeId}/documents/{documentId}`, making it straightforward to implement security rules based on the `employeeId`.\n\nIn summary, this structure ensures a secure, scalable, and maintainable Firestore database for the FileSafe application."
  }
}