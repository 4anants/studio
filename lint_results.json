[{"filePath":"D:\\GitHub\\FileSafe\\studio\\src\\app\\api\\announcements\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":9,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":25,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":25,"endColumn":19}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\r\nimport pool from '@/lib/db';\r\nimport { RowDataPacket } from 'mysql2';\r\n\r\nexport async function GET() {\r\n    try {\r\n        const [rows] = await pool.query<RowDataPacket[]>('SELECT * FROM announcements ORDER BY date DESC');\r\n        return NextResponse.json(rows);\r\n    } catch (error) {\r\n        return NextResponse.json({ error: 'Database error' }, { status: 500 });\r\n    }\r\n}\r\n\r\nexport async function POST(request: NextRequest) {\r\n    try {\r\n        const body = await request.json();\r\n        const { id, title, message, date, author, event_date } = body;\r\n\r\n        await pool.execute(\r\n            'INSERT INTO announcements (id, title, message, date, author, event_date) VALUES (?, ?, ?, ?, ?, ?)',\r\n            [id, title, message, date, author, event_date]\r\n        );\r\n\r\n        return NextResponse.json({ success: true });\r\n    } catch (error) {\r\n        return NextResponse.json({ error: 'Failed' }, { status: 500 });\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\FileSafe\\studio\\src\\app\\api\\companies\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":9,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":25,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":25,"endColumn":19}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\r\nimport pool from '@/lib/db';\r\nimport { RowDataPacket } from 'mysql2';\r\n\r\nexport async function GET() {\r\n    try {\r\n        const [rows] = await pool.query<RowDataPacket[]>('SELECT * FROM companies ORDER BY name ASC');\r\n        return NextResponse.json(rows);\r\n    } catch (error) {\r\n        return NextResponse.json({ error: 'Database error' }, { status: 500 });\r\n    }\r\n}\r\n\r\nexport async function POST(request: NextRequest) {\r\n    try {\r\n        const body = await request.json();\r\n        const { id, name, short_name, address, phone, email } = body;\r\n\r\n        await pool.execute(\r\n            'INSERT INTO companies (id, name, short_name, address, phone, email) VALUES (?, ?, ?, ?, ?, ?)',\r\n            [id, name, short_name, address, phone, email]\r\n        );\r\n\r\n        return NextResponse.json({ success: true });\r\n    } catch (error) {\r\n        return NextResponse.json({ error: 'Failed' }, { status: 500 });\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\FileSafe\\studio\\src\\app\\api\\documents\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'request' is defined but never used.","line":7,"column":27,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":34},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":15,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":15,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[546,549],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[546,549],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":59,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":59,"endColumn":19}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\r\nimport pool from '@/lib/db';\r\nimport { RowDataPacket } from 'mysql2';\r\nimport { getServerSession } from \"next-auth/next\";\r\nimport { authOptions } from \"@/lib/auth\";\r\n\r\nexport async function GET(request: NextRequest) {\r\n    const session = await getServerSession(authOptions);\r\n\r\n    // Admin sees all? Or filtered?\r\n    // Current mock data: Admin sees all. Employees see theirs.\r\n\r\n    try {\r\n        let query = 'SELECT * FROM documents ORDER BY upload_date DESC';\r\n        let params: any[] = [];\r\n\r\n        if (session?.user?.role !== 'admin') {\r\n            const userId = session?.user?.id;\r\n            if (!userId) return NextResponse.json([]); // No session?\r\n\r\n            query = 'SELECT * FROM documents WHERE employee_id = ? ORDER BY upload_date DESC';\r\n            params = [userId];\r\n        }\r\n\r\n        const [rows] = await pool.execute<RowDataPacket[]>(query, params);\r\n        return NextResponse.json(rows);\r\n    } catch (error) {\r\n        console.error(error);\r\n        return NextResponse.json({ error: 'Database error' }, { status: 500 });\r\n    }\r\n}\r\n\r\nexport async function DELETE(request: NextRequest) {\r\n    try {\r\n        const { searchParams } = new URL(request.url);\r\n        const id = searchParams.get('id');\r\n\r\n        if (!id) {\r\n            return NextResponse.json({ error: 'ID is required' }, { status: 400 });\r\n        }\r\n\r\n        // Check ownership if not admin? \r\n        // For simplicity, let's allow it for now or rely on frontend to hide button.\r\n        // Ideally check session here.\r\n        const session = await getServerSession(authOptions);\r\n        if (!session) return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\r\n\r\n        if (session.user.role !== 'admin') {\r\n            // Check if document belongs to user\r\n            const [rows] = await pool.execute<RowDataPacket[]>('SELECT employee_id FROM documents WHERE id = ?', [id]);\r\n            if (rows.length === 0 || rows[0].employee_id !== session.user.id) {\r\n                return NextResponse.json({ error: 'Forbidden' }, { status: 403 });\r\n            }\r\n        }\r\n\r\n        await pool.execute('DELETE FROM documents WHERE id = ?', [id]);\r\n\r\n        return NextResponse.json({ success: true });\r\n    } catch (error) {\r\n        return NextResponse.json({ error: 'Failed' }, { status: 500 });\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\FileSafe\\studio\\src\\app\\api\\holidays\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":9,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":25,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":25,"endColumn":19}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\r\nimport pool from '@/lib/db';\r\nimport { RowDataPacket } from 'mysql2';\r\n\r\nexport async function GET() {\r\n    try {\r\n        const [rows] = await pool.query<RowDataPacket[]>('SELECT * FROM holidays ORDER BY date ASC');\r\n        return NextResponse.json(rows);\r\n    } catch (error) {\r\n        return NextResponse.json({ error: 'Database error' }, { status: 500 });\r\n    }\r\n}\r\n\r\nexport async function POST(request: NextRequest) {\r\n    try {\r\n        const body = await request.json();\r\n        const { id, name, date, location } = body;\r\n\r\n        await pool.execute(\r\n            'INSERT INTO holidays (id, name, date, location) VALUES (?, ?, ?, ?)',\r\n            [id, name, date, location]\r\n        );\r\n\r\n        return NextResponse.json({ success: true });\r\n    } catch (error) {\r\n        return NextResponse.json({ error: 'Failed' }, { status: 500 });\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\FileSafe\\studio\\src\\app\\api\\users\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'ResultSetHeader' is defined but never used.","line":3,"column":25,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":40},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'request' is defined but never used.","line":6,"column":27,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":34},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'password_hash' is assigned a value but never used.","line":11,"column":15,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":28},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":15,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":15,"endColumn":17}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\r\nimport pool from '@/lib/db';\r\nimport { RowDataPacket, ResultSetHeader } from 'mysql2';\r\nimport bcrypt from 'bcryptjs';\r\n\r\nexport async function GET(request: NextRequest) {\r\n  try {\r\n    const [rows] = await pool.query<RowDataPacket[]>('SELECT * FROM users ORDER BY created_at DESC');\r\n    // Remove password_hash from response\r\n    const users = rows.map(u => {\r\n      const { password_hash, ...rest } = u;\r\n      return rest;\r\n    });\r\n    return NextResponse.json(users);\r\n  } catch (error) {\r\n    return NextResponse.json({ error: 'Database error' }, { status: 500 });\r\n  }\r\n}\r\n\r\nexport async function POST(request: NextRequest) {\r\n  try {\r\n    const body = await request.json();\r\n    const {\r\n      id, email, password, first_name, last_name, role, designation, department,\r\n      mobile, emergency_contact, date_of_birth, joining_date, blood_group, company_id, location, status\r\n    } = body;\r\n\r\n    // TODO: Validation\r\n\r\n    // Check if update or create\r\n    // If ID exists and we are updating? Usually PUT. But let's support UPSERT or just Create for now.\r\n    // The AdminView uses \"Save\" which could be either.\r\n\r\n    // For simplicity, let's assume this is separate Create/Update logic or just Create.\r\n    // Let's implement CREATE for now.\r\n\r\n    const passwordHash = await bcrypt.hash(password || 'default123', 10);\r\n    const username = email.split('@')[0];\r\n\r\n    await pool.execute(\r\n      `INSERT INTO users (\r\n            id, username, first_name, last_name, email, password_hash, is_admin, \r\n            designation, department, mobile, emergency_contact, date_of_birth, joining_date, \r\n            blood_group, company_id, location, status\r\n        ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)\r\n        ON DUPLICATE KEY UPDATE\r\n            first_name = VALUES(first_name),\r\n            last_name = VALUES(last_name),\r\n            designation = VALUES(designation),\r\n            department = VALUES(department),\r\n            mobile = VALUES(mobile),\r\n            status = VALUES(status)\r\n        `,\r\n      [\r\n        id, username, first_name, last_name, email, passwordHash, role === 'admin',\r\n        designation, department, mobile, emergency_contact, date_of_birth, joining_date,\r\n        blood_group, company_id, location, status || 'active'\r\n      ]\r\n    );\r\n\r\n    return NextResponse.json({ success: true });\r\n  } catch (error) {\r\n    console.error(error);\r\n    return NextResponse.json({ error: 'Failed to save user' }, { status: 500 });\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\FileSafe\\studio\\src\\app\\dashboard\\admin-view.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Settings' is defined but never used.","line":16,"column":109,"nodeType":null,"messageId":"unusedVar","endLine":16,"endColumn":117},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Wifi' is defined but never used.","line":16,"column":238,"nodeType":null,"messageId":"unusedVar","endLine":16,"endColumn":242},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'ToastAction' is defined but never used.","line":79,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":79,"endColumn":21},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":120,"column":79,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":120,"endColumn":82,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5461,5464],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5461,5464],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":261,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":261,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":533,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":533,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":546,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":546,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":574,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":574,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":604,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":604,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":623,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":623,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":671,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":671,"endColumn":19},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"The 'filteredUsersForSelection' conditional could make the dependencies of useCallback Hook (at line 796) change on every render. To fix this, wrap the initialization of 'filteredUsersForSelection' in its own useMemo() Hook.","line":788,"column":11,"nodeType":"VariableDeclarator","endLine":788,"endColumn":130},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'getUserFromId' is assigned a value but never used.","line":931,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":931,"endColumn":24},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1032,"column":105,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1032,"endColumn":108,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[47195,47198],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[47195,47198],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":1062,"column":67,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[48959,48975],"text":"Employees with &quot;"},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[48959,48975],"text":"Employees with &ldquo;"},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[48959,48975],"text":"Employees with &#34;"},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[48959,48975],"text":"Employees with &rdquo;"},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":1062,"column":91,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[48998,48999],"text":"&quot;"},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[48998,48999],"text":"&ldquo;"},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[48998,48999],"text":"&#34;"},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[48998,48999],"text":"&rdquo;"},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1382,"column":135,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1382,"endColumn":138,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[74710,74713],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[74710,74713],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":16,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\r\n'use client'\r\nimport { useState, useCallback, useMemo, useEffect } from 'react'\r\nimport { useRouter } from 'next/navigation'\r\nimport {\r\n    Card,\r\n    CardContent,\r\n    CardDescription,\r\n    CardHeader,\r\n    CardTitle,\r\n} from '@/components/ui/card'\r\nimport { Input } from '@/components/ui/input'\r\n\r\nimport { users as initialUsers, documents as allDocuments, documentTypesList, User, Document, departments as initialDepartments, holidays as initialHolidays, Holiday, HolidayLocation, holidayLocations, announcements as initialAnnouncements, Announcement, CompanyName, companies as initialCompanies, Company } from '@/lib/mock-data'\r\nimport { useData } from '@/hooks/use-data'\r\nimport { Search, MoreVertical, Edit, Trash2, KeyRound, Undo, FolderPlus, Tag, Building, CalendarPlus, Bell, Settings, UploadCloud, X, FileLock2, Users, Upload, Download, ArchiveRestore, Folder, Save, Eye, Home, Trash, ArrowLeft, Shield, Wifi } from 'lucide-react'\r\nimport {\r\n    Tabs,\r\n    TabsContent,\r\n    TabsList,\r\n    TabsTrigger,\r\n} from \"@/components/ui/tabs\"\r\nimport Image from 'next/image'\r\nimport { BulkUploadDialog } from '@/components/dashboard/bulk-upload/bulk-upload-dialog'\r\nimport { Button } from '@/components/ui/button'\r\nimport { EmployeeManagementDialog } from '@/components/dashboard/employee-management-dialog'\r\nimport { DeleteEmployeeDialog } from '@/components/dashboard/delete-employee-dialog'\r\nimport {\r\n    DropdownMenu,\r\n    DropdownMenuContent,\r\n    DropdownMenuItem,\r\n    DropdownMenuSeparator,\r\n    DropdownMenuTrigger,\r\n} from '@/components/ui/dropdown-menu'\r\nimport {\r\n    Table,\r\n    TableBody,\r\n    TableCell,\r\n    TableHead,\r\n    TableHeader,\r\n    TableRow,\r\n} from '@/components/ui/table'\r\nimport { Checkbox } from '@/components/ui/checkbox'\r\nimport { useToast } from '@/hooks/use-toast'\r\nimport {\r\n    AlertDialog,\r\n    AlertDialogAction,\r\n    AlertDialogCancel,\r\n    AlertDialogContent,\r\n    AlertDialogDescription,\r\n    AlertDialogFooter,\r\n    AlertDialogHeader,\r\n    AlertDialogTitle,\r\n} from '@/components/ui/alert-dialog';\r\nimport { cn, getAvatarSrc } from '@/lib/utils'\r\nimport { AddDocumentTypeDialog } from '@/components/dashboard/add-document-type-dialog'\r\nimport { AddDepartmentDialog } from '@/components/dashboard/add-department-dialog'\r\nimport { DeleteDepartmentDialog } from '@/components/dashboard/delete-department-dialog'\r\nimport { AddHolidayDialog } from '@/components/dashboard/add-holiday-dialog'\r\nimport { AddAnnouncementDialog } from '@/components/dashboard/add-announcement-dialog'\r\nimport { DeleteAnnouncementDialog } from '@/components/dashboard/delete-announcement-dialog'\r\nimport { Label } from '@/components/ui/label'\r\nimport {\r\n    Select,\r\n    SelectContent,\r\n    SelectItem,\r\n    SelectTrigger,\r\n    SelectValue,\r\n} from '@/components/ui/select';\r\nimport { BulkRoleChangeDialog } from '@/components/dashboard/bulk-role-change-dialog'\r\nimport { BulkUserImportDialog } from '@/components/dashboard/bulk-user-import-dialog'\r\nimport Papa from 'papaparse'\r\nimport { DocumentList } from '@/components/dashboard/document-list'\r\nimport { CompanyManagementDialog } from '@/components/dashboard/company-management-dialog'\r\nimport { DeleteCompanyDialog } from '@/components/dashboard/delete-company-dialog'\r\nimport { PermanentDeleteDialog } from '@/components/dashboard/permanent-delete-dialog'\r\nimport { EditDocumentTypeDialog } from '@/components/dashboard/edit-document-type-dialog'\r\nimport { DeleteDocumentTypeDialog } from '@/components/dashboard/delete-document-type-dialog'\r\nimport { ToastAction } from '@/components/ui/toast'\r\nimport { IntegrationsSettings } from '@/components/dashboard/integrations-settings'\r\n\r\ntype ExplorerState = { view: 'docTypes' } | { view: 'usersInDocType', docType: string }\r\n\r\nexport function AdminView() {\r\n    const {\r\n        users: serverUsers,\r\n        documents: serverDocs,\r\n        holidays: serverHolidays,\r\n        announcements: serverAnnouncements,\r\n        companies: serverCompanies,\r\n        mutateUsers, mutateDocuments, mutateHolidays, mutateAnnouncements, mutateCompanies\r\n    } = useData();\r\n\r\n    const [docs, setDocs] = useState<Document[]>(allDocuments)\r\n    const [deletedDocs, setDeletedDocs] = useState<Document[]>([]);\r\n    const [users, setUsers] = useState<User[]>(initialUsers)\r\n    const [documentTypes, setDocumentTypes] = useState(documentTypesList);\r\n    const [deletedDocumentTypes, setDeletedDocumentTypes] = useState<string[]>([]);\r\n    const [departments, setDepartments] = useState(initialDepartments);\r\n    const [deletedDepartments, setDeletedDepartments] = useState<string[]>([]);\r\n    const [companies, setCompanies] = useState<Company[]>(initialCompanies);\r\n    const [deletedCompanies, setDeletedCompanies] = useState<Company[]>([]);\r\n    const [holidays, setHolidays] = useState<Holiday[]>(initialHolidays);\r\n    const [announcements, setAnnouncements] = useState<Announcement[]>(initialAnnouncements.map(a => ({ ...a, isRead: true, status: a.status || 'published' })));\r\n\r\n    // Sync with server data\r\n    useEffect(() => {\r\n        if (serverUsers) setUsers(serverUsers as User[]);\r\n    }, [serverUsers]);\r\n\r\n    useEffect(() => {\r\n        if (serverDocs) setDocs(serverDocs as Document[]);\r\n    }, [serverDocs]);\r\n\r\n    useEffect(() => {\r\n        if (serverHolidays) setHolidays(serverHolidays as Holiday[]);\r\n    }, [serverHolidays]);\r\n\r\n    useEffect(() => {\r\n        if (serverAnnouncements) setAnnouncements(serverAnnouncements.map((a: any) => ({ ...a, isRead: true, status: a.status || 'published' })));\r\n    }, [serverAnnouncements]);\r\n\r\n    useEffect(() => {\r\n        if (serverCompanies) setCompanies(serverCompanies as Company[]);\r\n    }, [serverCompanies]);\r\n    const [searchTerm, setSearchTerm] = useState('')\r\n    const [selectedUserIds, setSelectedUserIds] = useState<string[]>([])\r\n    const [isBulkDeleteDialogOpen, setIsBulkDeleteDialogOpen] = useState(false)\r\n    const [isBulkResetDialogOpen, setIsBulkResetDialogOpen] = useState(false)\r\n    const [lastBulkUploadInfo, setLastBulkUploadInfo] = useState<{ ids: string[], timestamp: number } | null>(null);\r\n    const [isUndoDialogOpen, setIsUndoDialogOpen] = useState(false);\r\n    const [activeTab, setActiveTab] = useState('file-explorer');\r\n    const [activeSubTab, setActiveSubTab] = useState('overview');\r\n    const [departmentFilter, setDepartmentFilter] = useState<string>('all');\r\n    const [roleFilter, setRoleFilter] = useState<'all' | 'admin' | 'employee'>('all');\r\n    const [holidayLocationFilter, setHolidayLocationFilter] = useState<HolidayLocation | 'all'>('all');\r\n    const [logoSrc, setLogoSrc] = useState<string | null>(null);\r\n    const [siteName, setSiteName] = useState(CompanyName);\r\n    const [tempSiteName, setTempSiteName] = useState(CompanyName);\r\n    const [explorerState, setExplorerState] = useState<ExplorerState>({ view: 'docTypes' });\r\n    const [allowedDomains, setAllowedDomains] = useState<string[]>([]);\r\n    const [newDomain, setNewDomain] = useState('');\r\n    const { toast } = useToast();\r\n    const router = useRouter();\r\n\r\n\r\n    useEffect(() => {\r\n        const handleViewAnnouncements = () => {\r\n            setActiveTab('announcements');\r\n        };\r\n        window.addEventListener('view-announcements', handleViewAnnouncements);\r\n\r\n        const storedLogo = localStorage.getItem('companyLogo');\r\n        if (storedLogo) setLogoSrc(storedLogo);\r\n\r\n        const storedSiteName = localStorage.getItem('siteName');\r\n        if (storedSiteName) {\r\n            setSiteName(storedSiteName);\r\n            setTempSiteName(storedSiteName);\r\n        }\r\n\r\n        const storedDomains = localStorage.getItem('allowedDomains');\r\n        if (storedDomains) {\r\n            setAllowedDomains(JSON.parse(storedDomains));\r\n        } else {\r\n            // Fallback for initial setup\r\n            setAllowedDomains(['yourdomain.com']);\r\n        }\r\n\r\n        return () => {\r\n            window.removeEventListener('view-announcements', handleViewAnnouncements);\r\n        };\r\n    }, []);\r\n\r\n    const handleLogoChange = (event: React.ChangeEvent<HTMLInputElement>) => {\r\n        if (event.target.files && event.target.files[0]) {\r\n            const file = event.target.files[0];\r\n            const reader = new FileReader();\r\n            reader.onload = (e) => {\r\n                const newLogo = e.target?.result as string;\r\n                setLogoSrc(newLogo);\r\n                localStorage.setItem('companyLogo', newLogo);\r\n                toast({\r\n                    title: 'Logo Updated',\r\n                    description: 'The company logo has been changed successfully.',\r\n                });\r\n            };\r\n            reader.readAsDataURL(file);\r\n        }\r\n    };\r\n\r\n    const handleResetLogo = () => {\r\n        setLogoSrc(null);\r\n        localStorage.removeItem('companyLogo');\r\n        toast({\r\n            title: 'Logo Reset',\r\n            description: 'The company logo has been reset to the default.',\r\n        });\r\n    };\r\n\r\n    const handleSiteNameSave = () => {\r\n        setSiteName(tempSiteName);\r\n        localStorage.setItem('siteName', tempSiteName);\r\n        window.dispatchEvent(new Event('storage')); // Notify other tabs/components\r\n        toast({\r\n            title: 'Site Name Updated',\r\n            description: 'The site name has been changed successfully.',\r\n        });\r\n    };\r\n\r\n    const handleAddDomain = () => {\r\n        if (newDomain && !allowedDomains.includes(newDomain)) {\r\n            const newDomains = [...allowedDomains, newDomain];\r\n            setAllowedDomains(newDomains);\r\n            localStorage.setItem('allowedDomains', JSON.stringify(newDomains));\r\n            setNewDomain('');\r\n            toast({ title: 'Domain Added', description: `Domain \"${newDomain}\" has been added.` });\r\n        } else {\r\n            toast({ variant: 'destructive', title: 'Invalid Domain', description: 'Domain is either empty or already exists.' });\r\n        }\r\n    };\r\n\r\n    const handleRemoveDomain = (domainToRemove: string) => {\r\n        const newDomains = allowedDomains.filter(d => d !== domainToRemove);\r\n        setAllowedDomains(newDomains);\r\n        localStorage.setItem('allowedDomains', JSON.stringify(newDomains));\r\n        toast({ title: 'Domain Removed', description: `Domain \"${domainToRemove}\" has been removed.` });\r\n    };\r\n\r\n    const handleUndoLastBulkUpload = () => {\r\n        if (lastBulkUploadInfo && lastBulkUploadInfo.ids.length > 0) {\r\n            setDocs(prev => prev.filter(d => !lastBulkUploadInfo.ids.includes(d.id)));\r\n            toast({\r\n                title: 'Upload Undone',\r\n                description: `${lastBulkUploadInfo.ids.length} document(s) have been removed.`,\r\n            });\r\n            setLastBulkUploadInfo(null);\r\n        }\r\n        setIsUndoDialogOpen(false);\r\n    };\r\n\r\n    const handleBulkUploadComplete = useCallback((count: number) => {\r\n        mutateDocuments();\r\n        toast({\r\n            title: 'Upload Successful!',\r\n            description: `${count} documents have been added.`,\r\n        });\r\n    }, [toast, mutateDocuments]);\r\n\r\n    const handleEmployeeSave = useCallback(async (employee: Partial<User> & { originalId?: string }) => {\r\n        try {\r\n            const res = await fetch('/api/users', {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify(employee),\r\n            });\r\n            if (!res.ok) throw new Error('Failed to save');\r\n\r\n            await mutateUsers();\r\n            toast({ title: \"User Saved\", description: \"User details updated successfully.\" });\r\n        } catch (e) {\r\n            toast({ variant: 'destructive', title: \"Error\", description: \"Failed to save user.\" });\r\n        }\r\n    }, [toast, mutateUsers]);\r\n\r\n    const handleBulkUserImport = useCallback((newUsers: User[]) => {\r\n        setUsers(prevUsers => {\r\n            const existingIds = new Set(prevUsers.map(u => u.id));\r\n            const nonDuplicateUsers = newUsers.filter(u => !existingIds.has(u.id));\r\n            const duplicateCount = newUsers.length - nonDuplicateUsers.length;\r\n\r\n            toast({\r\n                title: 'Import Complete',\r\n                description: `${nonDuplicateUsers.length} user(s) imported successfully. ${duplicateCount > 0 ? `${duplicateCount} duplicate(s) were skipped.` : ''}`,\r\n            });\r\n\r\n            return [...prevUsers, ...nonDuplicateUsers];\r\n        });\r\n    }, [toast]);\r\n\r\n    const handleExportUsers = () => {\r\n        const usersToExport = numSelected > 0 ? users.filter(u => selectedUserIds.includes(u.id)) : users;\r\n\r\n        if (usersToExport.length === 0) {\r\n            toast({\r\n                variant: 'destructive',\r\n                title: 'No Users to Export',\r\n                description: 'There are no users to export.',\r\n            });\r\n            return;\r\n        }\r\n\r\n        // We only export a subset of fields for simplicity, can be expanded\r\n        const dataToExport = usersToExport.map(user => ({\r\n            id: user.id,\r\n            name: user.name,\r\n            email: user.email,\r\n            personalEmail: user.personalEmail,\r\n            mobile: user.mobile,\r\n            dateOfBirth: user.dateOfBirth,\r\n            joiningDate: user.joiningDate,\r\n            resignationDate: user.resignationDate,\r\n            designation: user.designation,\r\n            status: user.status,\r\n            department: user.department,\r\n            bloodGroup: user.bloodGroup,\r\n            company: user.company,\r\n            location: user.location,\r\n            role: user.role,\r\n            // We don't export password for security reasons\r\n        }));\r\n\r\n        const csv = Papa.unparse(dataToExport);\r\n        const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });\r\n        const link = document.createElement('a');\r\n        const url = URL.createObjectURL(blob);\r\n        link.setAttribute('href', url);\r\n        link.setAttribute('download', `users_export_${new Date().toISOString().split('T')[0]}.csv`);\r\n        document.body.appendChild(link);\r\n        link.click();\r\n        document.body.removeChild(link);\r\n\r\n        toast({\r\n            title: 'Export Started',\r\n            description: `Exporting ${usersToExport.length} user(s).`,\r\n        });\r\n    };\r\n\r\n\r\n    const handleEmployeeDelete = useCallback((employeeId: string) => {\r\n        if (employeeId === 'sadmin') {\r\n            toast({ variant: 'destructive', title: 'Action Forbidden', description: 'The Super Admin account cannot be deleted.' });\r\n            return;\r\n        }\r\n        setUsers(prevUsers => prevUsers.map(u =>\r\n            u.id === employeeId ? { ...u, status: 'deleted' } : u\r\n        ));\r\n        setSelectedUserIds(prev => prev.filter(id => id !== employeeId));\r\n        toast({\r\n            title: \"Employee Deleted\",\r\n            description: `The employee has been moved to the deleted users list.`\r\n        });\r\n    }, [toast]);\r\n\r\n    const handleRestoreUser = useCallback((employeeId: string) => {\r\n        setUsers(prevUsers => prevUsers.map(u =>\r\n            u.id === employeeId ? { ...u, status: 'active' } : u\r\n        ));\r\n        toast({\r\n            title: \"Employee Restored\",\r\n            description: `The employee has been restored to the active list.`\r\n        });\r\n    }, [toast]);\r\n\r\n    const handlePermanentDeleteUser = useCallback((employeeId: string) => {\r\n        if (employeeId === 'sadmin') {\r\n            toast({ variant: 'destructive', title: 'Action Forbidden', description: 'The Super Admin account cannot be permanently deleted.' });\r\n            return;\r\n        }\r\n        setUsers(prevUsers => prevUsers.filter(u => u.id !== employeeId));\r\n        toast({\r\n            variant: 'destructive',\r\n            title: 'User Permanently Deleted',\r\n            description: 'The user has been permanently removed from the system.',\r\n        });\r\n    }, [toast]);\r\n\r\n    const handleResetPassword = useCallback((employeeId: string) => {\r\n        if (employeeId === 'sadmin') {\r\n            toast({ variant: 'destructive', title: 'Action Forbidden', description: 'Password for the Super Admin must be changed via the edit profile screen.' });\r\n            return;\r\n        }\r\n        const user = users.find(u => u.id === employeeId);\r\n        if (user && user.email) {\r\n            toast({\r\n                title: \"Password Reset Link Sent\",\r\n                description: `An email has been sent to ${user.name} with password reset instructions.`\r\n            });\r\n        }\r\n    }, [toast, users]);\r\n\r\n    const handleAddDocumentType = useCallback((newType: string) => {\r\n        setDocumentTypes(prev => {\r\n            if (!prev.find(dt => dt.toLowerCase() === newType.toLowerCase())) {\r\n                toast({\r\n                    title: 'Document Type Added',\r\n                    description: `\"${newType.trim()}\" has been added to the list of document types.`,\r\n                });\r\n                return [...prev, newType];\r\n            } else {\r\n                toast({\r\n                    variant: 'destructive',\r\n                    title: 'Duplicate Type',\r\n                    description: `\"${newType.trim()}\" already exists.`,\r\n                });\r\n                return prev;\r\n            }\r\n        });\r\n    }, [toast]);\r\n\r\n    const handleEditDocumentType = useCallback((oldType: string, newType: string) => {\r\n        if (oldType.toLowerCase() === newType.toLowerCase()) return;\r\n\r\n        if (documentTypes.find(dt => dt.toLowerCase() === newType.toLowerCase())) {\r\n            toast({\r\n                variant: 'destructive',\r\n                title: 'Duplicate Type',\r\n                description: `\"${newType.trim()}\" already exists.`,\r\n            });\r\n            return;\r\n        }\r\n\r\n        setDocumentTypes(prev => prev.map(dt => dt === oldType ? newType : dt));\r\n        setDocs(prevDocs => prevDocs.map(doc => doc.type === oldType ? { ...doc, type: newType } : doc));\r\n        toast({\r\n            title: 'Document Type Updated',\r\n            description: `\"${oldType}\" has been renamed to \"${newType}\" and all associated documents have been updated.`,\r\n        });\r\n    }, [documentTypes, toast]);\r\n\r\n\r\n    const handleDeleteDocumentType = useCallback((typeToDelete: string) => {\r\n        const isTypeInUse = docs.some(d => d.type === typeToDelete);\r\n        if (isTypeInUse) {\r\n            toast({\r\n                variant: 'destructive',\r\n                title: 'Cannot Delete Document Type',\r\n                description: `\"${typeToDelete}\" is currently in use by one or more documents. Please re-assign them before deleting.`,\r\n            });\r\n            return;\r\n        }\r\n        setDocumentTypes(prev => prev.filter(dt => dt !== typeToDelete));\r\n        setDeletedDocumentTypes(prev => [...prev, typeToDelete]);\r\n        toast({\r\n            title: 'Document Type Deleted',\r\n            description: `\"${typeToDelete}\" has been moved to the deleted items list.`,\r\n        });\r\n    }, [docs, toast]);\r\n\r\n    const handleRestoreDocumentType = useCallback((typeToRestore: string) => {\r\n        setDeletedDocumentTypes(prev => prev.filter(d => d !== typeToRestore));\r\n        setDocumentTypes(prev => [...prev, typeToRestore]);\r\n        toast({\r\n            title: 'Document Type Restored',\r\n            description: `\"${typeToRestore}\" has been restored.`,\r\n        });\r\n    }, [toast]);\r\n\r\n    const handlePermanentDeleteDocumentType = useCallback((typeToDelete: string) => {\r\n        setDeletedDocumentTypes(prev => prev.filter(d => d !== typeToDelete));\r\n        toast({\r\n            variant: 'destructive',\r\n            title: 'Document Type Permanently Deleted',\r\n            description: `\"${typeToDelete}\" has been permanently removed.`,\r\n        });\r\n    }, [toast]);\r\n\r\n    const handleAddDepartment = useCallback((newDepartment: string) => {\r\n        setDepartments(prev => {\r\n            if (!prev.find(d => d.toLowerCase() === newDepartment.toLowerCase())) {\r\n                toast({\r\n                    title: 'Department Added',\r\n                    description: `\"${newDepartment.trim()}\" has been added to the list of departments.`,\r\n                });\r\n                return [...prev, newDepartment];\r\n            } else {\r\n                toast({\r\n                    variant: 'destructive',\r\n                    title: 'Duplicate Department',\r\n                    description: `\"${newDepartment.trim()}\" already exists.`,\r\n                });\r\n                return prev;\r\n            }\r\n        });\r\n    }, [toast]);\r\n\r\n    const handleDeleteDepartment = useCallback((departmentToDelete: string) => {\r\n        setDepartments(prev => prev.filter(d => d !== departmentToDelete));\r\n        setDeletedDepartments(prev => [...prev, departmentToDelete]);\r\n        toast({\r\n            title: 'Department Deleted',\r\n            description: `\"${departmentToDelete}\" has been moved to the deleted items list.`,\r\n        });\r\n    }, [toast]);\r\n\r\n    const handleRestoreDepartment = useCallback((departmentToRestore: string) => {\r\n        setDeletedDepartments(prev => prev.filter(d => d !== departmentToRestore));\r\n        setDepartments(prev => [...prev, departmentToRestore]);\r\n        toast({\r\n            title: 'Department Restored',\r\n            description: `\"${departmentToRestore}\" has been restored.`,\r\n        });\r\n    }, [toast]);\r\n\r\n    const handlePermanentDeleteDepartment = useCallback((departmentToDelete: string) => {\r\n        const isDeptInUse = users.some(u => u.department === departmentToDelete);\r\n        if (isDeptInUse) {\r\n            toast({\r\n                variant: 'destructive',\r\n                title: 'Cannot Delete Department',\r\n                description: `\"${departmentToDelete}\" is currently assigned to one or more employees. Please reassign them before permanently deleting.`,\r\n            });\r\n            return;\r\n        }\r\n        setDeletedDepartments(prev => prev.filter(d => d !== departmentToDelete));\r\n        toast({\r\n            variant: 'destructive',\r\n            title: 'Department Permanently Deleted',\r\n            description: `\"${departmentToDelete}\" has been permanently removed.`,\r\n        });\r\n    }, [toast, users]);\r\n\r\n\r\n    const handleAddHoliday = useCallback(async (newHoliday: { name: string, date: Date, location: HolidayLocation }) => {\r\n        const newHolidayItem = {\r\n            id: `h-${Date.now()}`,\r\n            name: newHoliday.name,\r\n            date: newHoliday.date.toISOString().split('T')[0],\r\n            location: newHoliday.location,\r\n        };\r\n\r\n        try {\r\n            await fetch('/api/holidays', {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify(newHolidayItem)\r\n            });\r\n            await mutateHolidays();\r\n            toast({\r\n                title: 'Holiday Added',\r\n                description: `\"${newHoliday.name}\" has been added to the holiday list.`,\r\n            });\r\n        } catch (e) {\r\n            toast({ variant: 'destructive', title: 'Error', description: 'Failed to add holiday' });\r\n        }\r\n    }, [toast, mutateHolidays]);\r\n\r\n    const handleDeleteHoliday = useCallback(async (holidayId: string) => {\r\n        try {\r\n            await fetch(`/api/holidays?id=${holidayId}`, { method: 'DELETE' });\r\n            await mutateHolidays();\r\n            toast({\r\n                title: 'Holiday Deleted',\r\n                description: 'The holiday has been removed from the list.',\r\n            });\r\n        } catch (e) {\r\n            toast({ variant: 'destructive', title: 'Error', description: 'Failed to delete holiday' });\r\n        }\r\n    }, [toast, mutateHolidays]);\r\n\r\n    const handleAddAnnouncement = useCallback(async (announcement: { title: string, message: string, eventDate?: string }) => {\r\n        const newAnnouncement = {\r\n            id: `anno-${Date.now()}`,\r\n            title: announcement.title,\r\n            message: announcement.message,\r\n            date: new Date().toISOString(),\r\n            author: 'Admin',\r\n            isRead: true,\r\n            status: 'published',\r\n            eventDate: announcement.eventDate\r\n        };\r\n\r\n        try {\r\n            await fetch('/api/announcements', {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify(newAnnouncement)\r\n            });\r\n            await mutateAnnouncements();\r\n            toast({\r\n                title: 'Announcement Published',\r\n                description: 'A notification has been sent to all employees.',\r\n            });\r\n        } catch (e) {\r\n            toast({ variant: 'destructive', title: 'Error', description: 'Failed to add announcement' });\r\n        }\r\n    }, [toast, mutateAnnouncements]);\r\n\r\n    const handleDeleteAnnouncement = useCallback((announcementId: string) => {\r\n        setAnnouncements(prev => prev.map(a => a.id === announcementId ? { ...a, status: 'deleted' } : a));\r\n        toast({\r\n            title: 'Announcement Deleted',\r\n            description: 'The announcement has been moved to the deleted list.',\r\n        });\r\n    }, [toast]);\r\n\r\n    const handleRestoreAnnouncement = useCallback((announcementId: string) => {\r\n        setAnnouncements(prev => prev.map(a => a.id === announcementId ? { ...a, status: 'published' } : a));\r\n        toast({\r\n            title: 'Announcement Restored',\r\n            description: 'The announcement has been restored and is now visible to employees.',\r\n        });\r\n    }, [toast]);\r\n\r\n    const handlePermanentDeleteAnnouncement = useCallback(async (announcementId: string) => {\r\n        try {\r\n            await fetch(`/api/announcements?id=${announcementId}`, { method: 'DELETE' });\r\n            await mutateAnnouncements();\r\n            toast({\r\n                variant: 'destructive',\r\n                title: 'Announcement Permanently Deleted',\r\n                description: 'The announcement has been permanently removed from the system.',\r\n            });\r\n        } catch (e) {\r\n            toast({ variant: 'destructive', title: 'Error', description: 'Failed to delete announcement' });\r\n        }\r\n    }, [toast, mutateAnnouncements]);\r\n\r\n    const handleSaveCompany = useCallback(async (companyToSave: Company) => {\r\n        const company = { ...companyToSave, id: companyToSave.id || `comp-${Date.now()}` };\r\n        try {\r\n            await fetch('/api/companies', {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify(company)\r\n            });\r\n            await mutateCompanies();\r\n            if (companyToSave.id) {\r\n                toast({ title: 'Company Updated', description: `Details for ${companyToSave.name} have been updated.` });\r\n            } else {\r\n                toast({ title: 'Company Added', description: `${companyToSave.name} has been added.` });\r\n            }\r\n        } catch (e) {\r\n            toast({ variant: 'destructive', title: 'Error', description: 'Failed to save company' });\r\n        }\r\n    }, [toast, mutateCompanies]);\r\n\r\n    const handleDeleteCompany = useCallback((companyId: string) => {\r\n        const companyToDelete = companies.find(c => c.id === companyId);\r\n        if (!companyToDelete) return;\r\n\r\n        const isCompanyInUse = users.some(u => u.company === companyToDelete.name);\r\n        if (isCompanyInUse) {\r\n            toast({\r\n                variant: 'destructive',\r\n                title: 'Cannot Delete Company',\r\n                description: `\"${companyToDelete.name}\" is currently assigned to one or more employees. Please reassign them before deleting.`,\r\n            });\r\n            return;\r\n        }\r\n\r\n        setCompanies(prev => prev.filter(c => c.id !== companyId));\r\n        setDeletedCompanies(prev => [...prev, companyToDelete]);\r\n        toast({\r\n            title: 'Company Deleted',\r\n            description: `\"${companyToDelete.name}\" has been moved to the deleted items list.`,\r\n        });\r\n    }, [companies, users, toast]);\r\n\r\n    const handleRestoreCompany = useCallback((companyId: string) => {\r\n        const companyToRestore = deletedCompanies.find(c => c.id === companyId);\r\n        if (companyToRestore) {\r\n            setDeletedCompanies(prev => prev.filter(c => c.id !== companyId));\r\n            setCompanies(prev => [...prev, companyToRestore]);\r\n            toast({\r\n                title: 'Company Restored',\r\n                description: `\"${companyToRestore.name}\" has been restored.`\r\n            });\r\n        }\r\n    }, [deletedCompanies, toast]);\r\n\r\n    const handlePermanentDeleteCompany = useCallback(async (companyId: string) => {\r\n        try {\r\n            await fetch(`/api/companies?id=${companyId}`, { method: 'DELETE' });\r\n            await mutateCompanies();\r\n            toast({\r\n                variant: 'destructive',\r\n                title: 'Company Permanently Deleted',\r\n                description: 'The company has been permanently removed from the system.',\r\n            });\r\n        } catch (e) {\r\n            toast({ variant: 'destructive', title: 'Error', description: 'Failed to delete company' });\r\n        }\r\n    }, [toast, mutateCompanies]);\r\n\r\n\r\n    const activeUsers = useMemo(() => users.filter(user => (user.status === 'active' || user.status === 'inactive' || user.status === 'pending') && user.id !== 'sadmin'), [users]);\r\n    const deletedUsers = useMemo(() => users.filter(user => user.status === 'deleted'), [users]);\r\n\r\n    const publishedAnnouncements = useMemo(() => announcements.filter(a => a.status === 'published'), [announcements]);\r\n    const deletedAnnouncements = useMemo(() => announcements.filter(a => a.status === 'deleted'), [announcements]);\r\n\r\n\r\n    const filteredByDept = useMemo(() => {\r\n        if (departmentFilter === 'all') {\r\n            return activeUsers;\r\n        }\r\n        if (departmentFilter === 'unassigned') {\r\n            return []; // Return empty for user grid if unassigned is selected\r\n        }\r\n        return activeUsers.filter(user => user.department && departmentFilter === user.department);\r\n    }, [activeUsers, departmentFilter]);\r\n\r\n    const filteredByRole = useMemo(() => filteredByDept.filter(user =>\r\n        roleFilter === 'all' || user.role === roleFilter\r\n    ), [filteredByDept, roleFilter]);\r\n\r\n    const filteredActiveUsersForGrid = useMemo(() => filteredByRole.filter(user =>\r\n        (user.name || '').toLowerCase().includes(searchTerm.toLowerCase())\r\n    ), [filteredByRole, searchTerm]);\r\n\r\n    const filteredActiveUsersForTable = useMemo(() => filteredByRole.filter(user =>\r\n        (user.name || '').toLowerCase().includes(searchTerm.toLowerCase()) ||\r\n        (user.email || '').toLowerCase().includes(searchTerm.toLowerCase())\r\n    ), [filteredByRole, searchTerm]);\r\n\r\n    const filteredDeletedUsers = useMemo(() => deletedUsers.filter(user =>\r\n        (user.name || '').toLowerCase().includes(searchTerm.toLowerCase()) ||\r\n        (user.email || '').toLowerCase().includes(searchTerm.toLowerCase())\r\n    ), [deletedUsers, searchTerm]);\r\n\r\n    const filteredDocTypes = useMemo(() => documentTypes.filter(type =>\r\n        (type || '').toLowerCase().includes(searchTerm.toLowerCase())\r\n    ), [documentTypes, searchTerm]);\r\n\r\n    const filteredDeletedDocTypes = useMemo(() => deletedDocumentTypes.filter(type =>\r\n        (type || '').toLowerCase().includes(searchTerm.toLowerCase())\r\n    ), [deletedDocumentTypes, searchTerm]);\r\n\r\n    const filteredDepartments = useMemo(() => departments.filter(dept =>\r\n        (dept || '').toLowerCase().includes(searchTerm.toLowerCase())\r\n    ), [departments, searchTerm]);\r\n\r\n    const filteredDeletedDepartments = useMemo(() => deletedDepartments.filter(dept =>\r\n        (dept || '').toLowerCase().includes(searchTerm.toLowerCase())\r\n    ), [deletedDepartments, searchTerm]);\r\n\r\n    const filteredCompanies = useMemo(() => companies.filter(comp =>\r\n        (comp.name || '').toLowerCase().includes(searchTerm.toLowerCase()) || (comp.shortName && comp.shortName.toLowerCase().includes(searchTerm.toLowerCase()))\r\n    ), [companies, searchTerm]);\r\n\r\n    const filteredDeletedCompanies = useMemo(() => deletedCompanies.filter(comp =>\r\n        (comp.name || '').toLowerCase().includes(searchTerm.toLowerCase())\r\n    ), [deletedCompanies, searchTerm]);\r\n\r\n\r\n    const filteredHolidays = useMemo(() => {\r\n        return holidays.filter(holiday =>\r\n            (holiday.name || '').toLowerCase().includes(searchTerm.toLowerCase()) &&\r\n            (holidayLocationFilter === 'all' || holiday.location === holidayLocationFilter)\r\n        ).sort((a, b) => new Date(a.date).getTime() - new Date(b.date).getTime())\r\n    }, [holidays, searchTerm, holidayLocationFilter]);\r\n\r\n    const filteredAnnouncements = useMemo(() => {\r\n        return publishedAnnouncements.filter(announcement =>\r\n            (announcement.title || '').toLowerCase().includes(searchTerm.toLowerCase()) ||\r\n            (announcement.message || '').toLowerCase().includes(searchTerm.toLowerCase())\r\n        ).sort((a, b) => new Date(b.date).getTime() - new Date(a.date).getTime());\r\n    }, [publishedAnnouncements, searchTerm]);\r\n\r\n    const filteredDeletedAnnouncements = useMemo(() => {\r\n        return deletedAnnouncements.filter(announcement =>\r\n            (announcement.title || '').toLowerCase().includes(searchTerm.toLowerCase()) ||\r\n            (announcement.message || '').toLowerCase().includes(searchTerm.toLowerCase())\r\n        ).sort((a, b) => new Date(b.date).getTime() - new Date(a.date).getTime());\r\n    }, [deletedAnnouncements, searchTerm]);\r\n\r\n    const filteredDeletedDocs = useMemo(() => {\r\n        return deletedDocs.filter(doc =>\r\n            (doc.name || '').toLowerCase().includes(searchTerm.toLowerCase()) ||\r\n            (doc.type || '').toLowerCase().includes(searchTerm.toLowerCase())\r\n        ).sort((a, b) => new Date(b.uploadDate).getTime() - new Date(a.uploadDate).getTime());\r\n    }, [deletedDocs, searchTerm]);\r\n\r\n\r\n    const { unassignedDocuments, docsByType } = useMemo(() => {\r\n        const userMap = new Map(users.map(u => [u.id, u]));\r\n        const unassigned: Document[] = [];\r\n        const byType: Record<string, Record<string, Document[]>> = {};\r\n\r\n        docs.forEach(doc => {\r\n            if (doc.ownerId && userMap.has(doc.ownerId)) {\r\n                if (!byType[doc.type]) {\r\n                    byType[doc.type] = {};\r\n                }\r\n                if (!byType[doc.type][doc.ownerId]) {\r\n                    byType[doc.type][doc.ownerId] = [];\r\n                }\r\n                byType[doc.type][doc.ownerId].push(doc);\r\n            } else {\r\n                unassigned.push(doc);\r\n            }\r\n        });\r\n\r\n        return { unassignedDocuments: unassigned, docsByType: byType };\r\n    }, [docs, users]);\r\n\r\n    const filteredUsersForSelection = activeSubTab === 'manage' ? filteredActiveUsersForTable.filter(u => u.id !== 'sadmin') : [];\r\n\r\n    const handleSelectAll = useCallback((checked: boolean | 'indeterminate') => {\r\n        if (checked === true) {\r\n            setSelectedUserIds(filteredUsersForSelection.map(u => u.id));\r\n        } else {\r\n            setSelectedUserIds([]);\r\n        }\r\n    }, [filteredUsersForSelection]);\r\n\r\n    const handleSelectUser = useCallback((userId: string, checked: boolean) => {\r\n        if (userId === 'sadmin') return;\r\n        if (checked) {\r\n            setSelectedUserIds(prev => [...prev, userId]);\r\n        } else {\r\n            setSelectedUserIds(prev => prev.filter(id => id !== userId));\r\n        }\r\n    }, []);\r\n\r\n    const handleBulkDelete = useCallback(() => {\r\n        setUsers(prevUsers => prevUsers.map(u =>\r\n            selectedUserIds.includes(u.id) ? { ...u, status: 'deleted' } : u\r\n        ));\r\n        toast({\r\n            title: \"Bulk Delete Successful\",\r\n            description: `${selectedUserIds.length} employee(s) have been moved to the deleted users list.`\r\n        });\r\n        setSelectedUserIds([]);\r\n        setIsBulkDeleteDialogOpen(false);\r\n    }, [selectedUserIds, toast]);\r\n\r\n    const handleBulkResetPassword = useCallback(() => {\r\n        const selectedUsers = users.filter(u => selectedUserIds.includes(u.id));\r\n        selectedUsers.forEach(user => handleResetPassword(user.id));\r\n        toast({\r\n            title: \"Bulk Password Reset\",\r\n            description: `Password reset links have been sent to ${selectedUserIds.length} employee(s).`\r\n        });\r\n        setSelectedUserIds([]);\r\n        setIsBulkResetDialogOpen(false);\r\n    }, [users, selectedUserIds, handleResetPassword, toast]);\r\n\r\n    const handleBulkRoleChange = useCallback((newRole: 'admin' | 'employee') => {\r\n        setUsers(prevUsers => prevUsers.map(u =>\r\n            selectedUserIds.includes(u.id) ? { ...u, role: newRole } : u\r\n        ));\r\n        toast({\r\n            title: \"Bulk Role Change Successful\",\r\n            description: `The role for ${selectedUserIds.length} employee(s) has been changed to ${newRole}.`\r\n        });\r\n        setSelectedUserIds([]);\r\n    }, [selectedUserIds, toast]);\r\n\r\n    const handleReassignDocument = useCallback((docId: string, newOwnerId: string) => {\r\n        setDocs(prevDocs => {\r\n            return prevDocs.map(doc => {\r\n                if (doc.id === docId) {\r\n                    return { ...doc, ownerId: newOwnerId };\r\n                }\r\n                return doc;\r\n            });\r\n        });\r\n        const user = users.find(u => u.id === newOwnerId);\r\n        const doc = docs.find(d => d.id === docId);\r\n        toast({\r\n            title: \"Document Reassigned\",\r\n            description: `Document \"${doc?.name}\" has been assigned to ${user?.name}.`\r\n        });\r\n    }, [users, docs, toast]);\r\n\r\n    const handleDeleteDocument = useCallback((docId: string) => {\r\n        const docToDelete = docs.find(d => d.id === docId);\r\n        if (docToDelete) {\r\n            setDocs(prev => prev.filter(d => d.id !== docId));\r\n            setDeletedDocs(prev => [...prev, docToDelete]);\r\n            toast({\r\n                title: \"Document Deleted\",\r\n                description: `\"${docToDelete.name}\" has been moved to deleted items.`\r\n            });\r\n        }\r\n    }, [docs, toast]);\r\n\r\n    const handleBulkDeleteDocuments = useCallback((docIds: string[]) => {\r\n        const docsToDelete = docs.filter(d => docIds.includes(d.id));\r\n        if (docsToDelete.length > 0) {\r\n            setDocs(prev => prev.filter(d => !docIds.includes(d.id)));\r\n            setDeletedDocs(prev => [...prev, ...docsToDelete]);\r\n            toast({\r\n                title: \"Documents Deleted\",\r\n                description: `${docsToDelete.length} document(s) have been moved to deleted items.`\r\n            });\r\n        }\r\n    }, [docs, toast]);\r\n\r\n    const handleRestoreDocument = useCallback((docId: string) => {\r\n        const docToRestore = deletedDocs.find(d => d.id === docId);\r\n        if (docToRestore) {\r\n            setDeletedDocs(prev => prev.filter(d => d.id !== docId));\r\n            setDocs(prev => [...prev, docToRestore]);\r\n            toast({\r\n                title: \"Document Restored\",\r\n                description: `\"${docToRestore.name}\" has been restored.`\r\n            });\r\n        }\r\n    }, [deletedDocs, toast]);\r\n\r\n    const handlePermanentDeleteDocument = useCallback((docId: string) => {\r\n        const docToDelete = deletedDocs.find(d => d.id === docId);\r\n        if (docToDelete) {\r\n            setDeletedDocs(prev => prev.filter(d => d.id !== docId));\r\n            toast({\r\n                variant: \"destructive\",\r\n                title: \"Document Permanently Deleted\",\r\n                description: `\"${docToDelete.name}\" has been permanently removed.`\r\n            });\r\n        }\r\n    }, [deletedDocs, toast]);\r\n\r\n    const onTabChange = useCallback((value: string) => {\r\n        setActiveTab(value);\r\n        setSelectedUserIds([]);\r\n        setSearchTerm('');\r\n        setDepartmentFilter('all');\r\n        setRoleFilter('all');\r\n        setHolidayLocationFilter('all');\r\n        setExplorerState({ view: 'docTypes' });\r\n        if (value === 'employee-management') {\r\n            setActiveSubTab('overview');\r\n        }\r\n    }, []);\r\n\r\n    const numSelected = selectedUserIds.length;\r\n    const numFiltered = filteredUsersForSelection.length;\r\n\r\n    const isEventUpcoming = (eventDate?: string) => {\r\n        if (!eventDate) return false;\r\n        const today = new Date();\r\n        today.setHours(0, 0, 0, 0);\r\n        const eDate = new Date(eventDate);\r\n        eDate.setTime(eDate.getTime() + eDate.getTimezoneOffset() * 60 * 1000); // Adjust for timezone\r\n        return eDate >= today;\r\n    }\r\n\r\n    const getUserFromId = (id: string) => users.find(u => u.id === id);\r\n\r\n    const usersByDocType = useMemo(() => {\r\n        if (explorerState.view !== 'usersInDocType') return [];\r\n\r\n        const userIdsWithDocType = new Set(\r\n            Object.keys(docsByType[explorerState.docType] || {})\r\n        );\r\n\r\n        return filteredActiveUsersForGrid.filter(u => userIdsWithDocType.has(u.id));\r\n    }, [explorerState, docsByType, filteredActiveUsersForGrid]);\r\n\r\n    return (\r\n        <>\r\n            <div className=\"flex flex-col md:flex-row items-start md:items-center justify-between gap-4\">\r\n                <div className=\"grid gap-2\">\r\n                    <h1 className=\"text-3xl font-bold tracking-tight\">{siteName}</h1>\r\n                    <p className=\"text-muted-foreground\">Manage all employee documents and profiles.</p>\r\n                </div>\r\n                <div className=\"flex items-center gap-2 w-full md:w-auto\">\r\n                    {numSelected > 0 && activeTab === 'employee-management' && activeSubTab === 'manage' ? (\r\n                        <>\r\n                            <span className=\"text-sm text-muted-foreground\">{numSelected} selected</span>\r\n                            <BulkRoleChangeDialog onSave={handleBulkRoleChange}>\r\n                                <Button variant=\"outline\">\r\n                                    <Users className=\"mr-2 h-4 w-4\" /> Change Roles\r\n                                </Button>\r\n                            </BulkRoleChangeDialog>\r\n                            <Button variant=\"outline\" onClick={() => setIsBulkResetDialogOpen(true)}>\r\n                                <KeyRound className=\"mr-2 h-4 w-4\" /> Reset Passwords\r\n                            </Button>\r\n                            <Button variant=\"destructive\" onClick={() => setIsBulkDeleteDialogOpen(true)}>\r\n                                <Trash2 className=\"mr-2 h-4 w-4\" /> Delete Selected\r\n                            </Button>\r\n                        </>\r\n                    ) : (\r\n                        <div className=\"flex items-center gap-2 w-full\">\r\n                            <EmployeeManagementDialog onSave={handleEmployeeSave} departments={departments} companies={companies}>\r\n                                <Button className=\"w-full sm:w-auto\">Add Employee</Button>\r\n                            </EmployeeManagementDialog>\r\n                            <BulkUploadDialog onBulkUploadComplete={handleBulkUploadComplete} users={activeUsers} />\r\n                        </div>\r\n                    )}\r\n                </div>\r\n            </div>\r\n\r\n            <Tabs value={activeTab} onValueChange={onTabChange} className=\"mt-4\">\r\n                <div className=\"flex flex-col md:flex-row items-start md:items-center mb-4 gap-4\">\r\n                    <div className=\"overflow-x-auto w-full pb-2\">\r\n                        <TabsList className=\"w-max\">\r\n                            <TabsTrigger value=\"file-explorer\">File Explorer</TabsTrigger>\r\n                            <TabsTrigger value=\"employee-management\">Employee Management</TabsTrigger>\r\n                            <TabsTrigger value=\"announcements\">Announcements</TabsTrigger>\r\n                            <TabsTrigger value=\"holidays\">Holidays</TabsTrigger>\r\n                            <TabsTrigger value=\"settings\">Settings</TabsTrigger>\r\n                            <TabsTrigger value=\"deleted-items\">Deleted Items</TabsTrigger>\r\n                        </TabsList>\r\n                    </div>\r\n                    <div className=\"flex items-center gap-2 w-full md:w-auto md:ml-auto\">\r\n                        <div className=\"relative flex-1\">\r\n                            <Search className=\"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground\" />\r\n                            <Input\r\n                                type=\"search\"\r\n                                placeholder={\r\n                                    activeTab === 'file-explorer' ? 'Search document types or employees...'\r\n                                        : activeTab === 'employee-management' ? 'Search employees...'\r\n                                            : activeTab === 'holidays' ? 'Search holidays...'\r\n                                                : activeTab === 'announcements' ? 'Search announcements...'\r\n                                                    : activeTab === 'settings' ? 'Search settings...'\r\n                                                        : activeTab === 'deleted-items' ? 'Search deleted items...'\r\n                                                            : 'Search...'\r\n                                }\r\n                                className=\"w-full pl-8\"\r\n                                value={searchTerm}\r\n                                onChange={(e) => setSearchTerm(e.target.value)}\r\n                            />\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                {(activeTab === 'employee-management' || (activeTab === 'file-explorer' && explorerState.view !== 'docTypes')) && (\r\n                    <div className=\"mb-4 flex flex-col sm:flex-row items-center gap-4\">\r\n                        <div className=\"flex items-center gap-2\">\r\n                            <Label className=\"text-sm font-medium\">Department</Label>\r\n                            <Select value={departmentFilter} onValueChange={setDepartmentFilter}>\r\n                                <SelectTrigger className=\"w-full sm:w-[220px]\">\r\n                                    <SelectValue placeholder=\"Select Department\" />\r\n                                </SelectTrigger>\r\n                                <SelectContent>\r\n                                    <SelectItem value=\"all\">All Departments</SelectItem>\r\n                                    {departments.map(dept => (\r\n                                        <SelectItem key={dept} value={dept}>\r\n                                            {dept}\r\n                                        </SelectItem>\r\n                                    ))}\r\n                                    {activeTab === 'file-explorer' && <SelectItem value=\"unassigned\">Unassigned Documents</SelectItem>}\r\n                                </SelectContent>\r\n                            </Select>\r\n                        </div>\r\n                        <div className=\"flex items-center gap-2\">\r\n                            <Label className=\"text-sm font-medium\">Role</Label>\r\n                            <Select value={roleFilter} onValueChange={(value) => setRoleFilter(value as any)}>\r\n                                <SelectTrigger className=\"w-full sm:w-[180px]\">\r\n                                    <SelectValue placeholder=\"Select Role\" />\r\n                                </SelectTrigger>\r\n                                <SelectContent>\r\n                                    <SelectItem value=\"all\">All Roles</SelectItem>\r\n                                    <SelectItem value=\"admin\">Admin</SelectItem>\r\n                                    <SelectItem value=\"employee\">Employee</SelectItem>\r\n                                </SelectContent>\r\n                            </Select>\r\n                        </div>\r\n                    </div>\r\n                )}\r\n\r\n                <TabsContent value=\"file-explorer\">\r\n                    <Card>\r\n                        {departmentFilter === 'unassigned' ? (\r\n                            <CardHeader>\r\n                                <CardTitle>Unassigned Documents</CardTitle>\r\n                                <CardDescription>\r\n                                    These documents could not be automatically assigned. Please assign them to an employee.\r\n                                </CardDescription>\r\n                            </CardHeader>\r\n                        ) : explorerState.view === 'usersInDocType' ? (\r\n                            <CardHeader>\r\n                                <div className=\"flex items-center gap-4\">\r\n                                    <Button variant=\"outline\" size=\"icon\" onClick={() => setExplorerState({ view: 'docTypes' })}>\r\n                                        <ArrowLeft className=\"h-4 w-4\" />\r\n                                    </Button>\r\n                                    <div>\r\n                                        <CardTitle>Employees with \"{explorerState.docType}\"</CardTitle>\r\n                                        <CardDescription>Select an employee to view their documents of this type.</CardDescription>\r\n                                    </div>\r\n                                </div>\r\n                            </CardHeader>\r\n                        ) : null}\r\n\r\n                        <CardContent>\r\n                            {explorerState.view === 'docTypes' && departmentFilter !== 'unassigned' && (\r\n                                <CardHeader>\r\n                                    <CardTitle>Browse Documents</CardTitle>\r\n                                    <CardDescription>Select a document type to see all related employees.</CardDescription>\r\n                                </CardHeader>\r\n                            )}\r\n                            {departmentFilter === 'unassigned' ? (\r\n                                unassignedDocuments.length > 0 ? (\r\n                                    <div className=\"p-4 bg-red-50 dark:bg-red-900/20 rounded-lg\">\r\n                                        <h3 className=\"flex items-center gap-2 font-semibold text-red-800 dark:text-red-300\">\r\n                                            <FileLock2 className=\"h-5 w-5\" />\r\n                                            Action Required\r\n                                        </h3>\r\n                                        <p className=\"text-sm text-red-700 dark:text-red-400 mt-1 mb-4\">\r\n                                            These documents could not be automatically assigned. Please select them and assign them to an employee.\r\n                                        </p>\r\n                                        <DocumentList\r\n                                            documents={unassignedDocuments}\r\n                                            users={users}\r\n                                            onSort={() => { }}\r\n                                            sortConfig={null}\r\n                                            showOwner={true}\r\n                                            onReassign={handleReassignDocument}\r\n                                            onDelete={handleDeleteDocument}\r\n                                            onBulkDelete={handleBulkDeleteDocuments}\r\n                                        />\r\n                                    </div>\r\n                                ) : (\r\n                                    <div className=\"text-center text-muted-foreground py-8\">\r\n                                        <p>No unassigned documents found.</p>\r\n                                    </div>\r\n                                )\r\n                            ) : explorerState.view === 'docTypes' ? (\r\n                                <div className=\"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-4\">\r\n                                    {documentTypes.filter(dt => dt.toLowerCase().includes(searchTerm.toLowerCase())).map(docType => (\r\n                                        <Card\r\n                                            key={docType}\r\n                                            className=\"cursor-pointer hover:border-primary transition-all group\"\r\n                                            onClick={() => setExplorerState({ view: 'usersInDocType', docType })}\r\n                                        >\r\n                                            <CardContent className=\"flex flex-col items-center justify-center p-4 gap-2\">\r\n                                                <Folder className=\"h-16 w-16 text-primary group-hover:scale-105 transition-transform\" />\r\n                                                <p className=\"text-sm font-medium text-center truncate w-full\">{docType}</p>\r\n                                            </CardContent>\r\n                                        </Card>\r\n                                    ))}\r\n                                </div>\r\n                            ) : (\r\n                                <div>\r\n                                    <div className=\"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-4 mb-6\">\r\n                                        {usersByDocType.map(user => (\r\n                                            <Card\r\n                                                key={user.id}\r\n                                                className=\"cursor-pointer hover:border-primary transition-all\"\r\n                                                onClick={() => router.push(`/dashboard/employee/${user.id}?role=admin`)}\r\n                                            >\r\n                                                <CardContent className=\"flex flex-col items-center justify-center p-4 gap-2\">\r\n                                                    <Image src={getAvatarSrc(user)} width={64} height={64} className=\"rounded-full object-cover\" alt={user.name ? user.name : 'Employee'} data-ai-hint=\"person portrait\" />\r\n                                                    <p className=\"text-sm font-medium text-center truncate w-full\">{user.name}</p>\r\n                                                </CardContent>\r\n                                            </Card>\r\n                                        ))}\r\n                                    </div>\r\n                                    {usersByDocType.length === 0 && (\r\n                                        <div className=\"text-center text-muted-foreground py-8\">\r\n                                            <p>No employees found with this document type.</p>\r\n                                        </div>\r\n                                    )}\r\n                                </div>\r\n                            )}\r\n                        </CardContent>\r\n                    </Card>\r\n                </TabsContent>\r\n\r\n                <TabsContent value=\"employee-management\">\r\n                    <Tabs defaultValue=\"overview\" value={activeSubTab} onValueChange={setActiveSubTab}>\r\n                        <TabsList>\r\n                            <TabsTrigger value=\"overview\">Employee Overview</TabsTrigger>\r\n                            <TabsTrigger value=\"manage\">Manage Employees</TabsTrigger>\r\n                        </TabsList>\r\n                        <TabsContent value=\"overview\" className=\"mt-4\">\r\n                            <Card>\r\n                                <CardHeader>\r\n                                    <CardTitle>Employee Overview</CardTitle>\r\n                                    <CardDescription>Select an employee to view their detailed profile and documents.</CardDescription>\r\n                                </CardHeader>\r\n                                <CardContent>\r\n                                    <div className=\"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-4 mb-6\">\r\n                                        {filteredActiveUsersForGrid.map(user => (\r\n                                            <Card\r\n                                                key={user.id}\r\n                                                className=\"cursor-pointer hover:border-primary transition-all\"\r\n                                                onClick={() => router.push(`/dashboard/employee/${user.id}?role=admin`)}\r\n                                            >\r\n                                                <CardContent className=\"flex flex-col items-center justify-center p-4 gap-2\">\r\n                                                    <Image src={getAvatarSrc(user)} width={64} height={64} className=\"rounded-full object-cover\" alt={user.name} data-ai-hint=\"person portrait\" />\r\n                                                    <p className=\"text-sm font-medium text-center truncate w-full\">{user.name}</p>\r\n                                                </CardContent>\r\n                                            </Card>\r\n                                        ))}\r\n                                    </div>\r\n                                    {filteredActiveUsersForGrid.length === 0 && (\r\n                                        <div className=\"text-center text-muted-foreground py-8\">\r\n                                            <p>No employees found.</p>\r\n                                        </div>\r\n                                    )}\r\n                                </CardContent>\r\n                            </Card>\r\n                        </TabsContent>\r\n                        <TabsContent value=\"manage\" className=\"mt-4\">\r\n                            <Card>\r\n                                <CardHeader>\r\n                                    <div className=\"flex flex-col md:flex-row items-start md:items-center justify-between gap-4\">\r\n                                        <div>\r\n                                            <CardTitle>Manage Employees</CardTitle>\r\n                                            <CardDescription>A list of all active employees in the system.</CardDescription>\r\n                                        </div>\r\n                                        <div className=\"flex items-center gap-2 w-full md:w-auto\">\r\n                                            <Button onClick={handleExportUsers} variant=\"outline\" className=\"w-full sm:w-auto\">\r\n                                                <Download className=\"mr-2 h-4 w-4\" />\r\n                                                {numSelected > 0 ? `Export Selected (${numSelected})` : 'Export All Users'}\r\n                                            </Button>\r\n                                            <BulkUserImportDialog onImport={handleBulkUserImport}>\r\n                                                <Button variant=\"outline\" className=\"w-full sm:w-auto\">\r\n                                                    <Upload className=\"mr-2 h-4 w-4\" /> Import Users\r\n                                                </Button>\r\n                                            </BulkUserImportDialog>\r\n                                        </div>\r\n                                    </div>\r\n                                </CardHeader>\r\n                                <CardContent>\r\n                                    <Table>\r\n                                        <TableHeader>\r\n                                            <TableRow>\r\n                                                <TableHead className=\"w-[40px]\">\r\n                                                    <Checkbox\r\n                                                        checked={numSelected === numFiltered && numFiltered > 0 ? true : numSelected > 0 ? 'indeterminate' : false}\r\n                                                        onCheckedChange={handleSelectAll}\r\n                                                        aria-label=\"Select all\"\r\n                                                        disabled={filteredUsersForSelection.length === 0}\r\n                                                    />\r\n                                                </TableHead>\r\n                                                <TableHead className=\"w-[80px] hidden sm:table-cell\"></TableHead>\r\n                                                <TableHead>Name</TableHead>\r\n                                                <TableHead>Email</TableHead>\r\n                                                <TableHead className=\"hidden lg:table-cell\">Department</TableHead>\r\n                                                <TableHead className=\"hidden md:table-cell\">Role</TableHead>\r\n                                                <TableHead>Status</TableHead>\r\n                                                <TableHead className=\"text-right\">Actions</TableHead>\r\n                                            </TableRow>\r\n                                        </TableHeader>\r\n                                        <TableBody>\r\n                                            {filteredActiveUsersForTable.length > 0 ? filteredActiveUsersForTable.map(user => (\r\n                                                <TableRow key={user.id} data-state={selectedUserIds.includes(user.id) && \"selected\"}>\r\n                                                    <TableCell>\r\n                                                        <Checkbox\r\n                                                            checked={selectedUserIds.includes(user.id)}\r\n                                                            onCheckedChange={(checked) => handleSelectUser(user.id, !!checked)}\r\n                                                            aria-label={`Select ${user.name}`}\r\n                                                            disabled={user.id === 'sadmin'}\r\n                                                        />\r\n                                                    </TableCell>\r\n                                                    <TableCell className=\"hidden sm:table-cell\">\r\n                                                        <Image src={getAvatarSrc(user)} width={40} height={40} className=\"rounded-full object-cover\" alt={user.name ? user.name : 'User'} data-ai-hint=\"person portrait\" />\r\n                                                    </TableCell>\r\n                                                    <TableCell className=\"font-medium\">{user.name}</TableCell>\r\n                                                    <TableCell>{user.email}</TableCell>\r\n                                                    <TableCell className=\"hidden lg:table-cell\">{user.department || 'N/A'}</TableCell>\r\n                                                    <TableCell className=\"hidden md:table-cell\">\r\n                                                        <span className={cn('px-2 py-1 rounded-full text-xs font-medium',\r\n                                                            user.role === 'admin' ? 'bg-blue-100 text-blue-800' : 'bg-gray-100 text-gray-800'\r\n                                                        )}>\r\n                                                            {(user.role || 'employee').charAt(0).toUpperCase() + (user.role || 'employee').slice(1)}\r\n                                                        </span>\r\n                                                    </TableCell>\r\n                                                    <TableCell>\r\n                                                        <span className={cn('px-2 py-1 rounded-full text-xs font-medium',\r\n                                                            user.status === 'active' ? 'bg-green-100 text-green-800' :\r\n                                                                user.status === 'inactive' ? 'bg-red-100 text-red-800' :\r\n                                                                    'bg-yellow-100 text-yellow-800'\r\n                                                        )}>\r\n                                                            {(user.status || 'active').charAt(0).toUpperCase() + (user.status || 'active').slice(1)}\r\n                                                        </span>\r\n                                                    </TableCell>\r\n                                                    <TableCell className=\"text-right\">\r\n                                                        {user.id === 'sadmin' ? (\r\n                                                            <div className=\"flex items-center justify-end\">\r\n                                                                <EmployeeManagementDialog employee={user} onSave={handleEmployeeSave} departments={departments} companies={companies}>\r\n                                                                    <Button variant=\"ghost\" size=\"sm\">\r\n                                                                        <Edit className=\"mr-2 h-4 w-4\" /> Edit\r\n                                                                    </Button>\r\n                                                                </EmployeeManagementDialog>\r\n                                                            </div>\r\n                                                        ) : (\r\n                                                            <DropdownMenu>\r\n                                                                <DropdownMenuTrigger asChild>\r\n                                                                    <Button variant=\"ghost\" size=\"icon\">\r\n                                                                        <MoreVertical className=\"h-5 w-5\" />\r\n                                                                    </Button>\r\n                                                                </DropdownMenuTrigger>\r\n                                                                <DropdownMenuContent align=\"end\">\r\n                                                                    <EmployeeManagementDialog employee={user} onSave={handleEmployeeSave} departments={departments} companies={companies}>\r\n                                                                        <DropdownMenuItem onSelect={(e) => e.preventDefault()}>\r\n                                                                            <Edit className=\"mr-2 h-4 w-4\" />\r\n                                                                            Edit Employee\r\n                                                                        </DropdownMenuItem>\r\n                                                                    </EmployeeManagementDialog>\r\n                                                                    <DropdownMenuItem onClick={() => handleResetPassword(user.id)}>\r\n                                                                        <KeyRound className=\"mr-2 h-4 w-4\" />\r\n                                                                        Reset Password\r\n                                                                    </DropdownMenuItem>\r\n                                                                    <DropdownMenuSeparator />\r\n                                                                    <DeleteEmployeeDialog employee={user} onDelete={() => handleEmployeeDelete(user.id)}>\r\n                                                                        <DropdownMenuItem onSelect={(e) => e.preventDefault()} className=\"text-destructive focus:text-destructive\">\r\n                                                                            <Trash2 className=\"mr-2 h-4 w-4\" />\r\n                                                                            Delete Employee\r\n                                                                        </DropdownMenuItem>\r\n                                                                    </DeleteEmployeeDialog>\r\n                                                                </DropdownMenuContent>\r\n                                                            </DropdownMenu>\r\n                                                        )}\r\n                                                    </TableCell>\r\n                                                </TableRow>\r\n                                            )) : (\r\n                                                <TableRow>\r\n                                                    <TableCell colSpan={8} className=\"text-center text-muted-foreground\">No active users found.</TableCell>\r\n                                                </TableRow>\r\n                                            )}\r\n                                        </TableBody>\r\n                                    </Table>\r\n                                </CardContent>\r\n                            </Card>\r\n                        </TabsContent>\r\n                    </Tabs>\r\n                </TabsContent>\r\n\r\n                <TabsContent value=\"announcements\">\r\n                    <Card>\r\n                        <CardHeader className=\"flex flex-col md:flex-row items-start md:items-center justify-between gap-4\">\r\n                            <div>\r\n                                <CardTitle>Manage Announcements</CardTitle>\r\n                                <CardDescription>Create and publish announcements for all employees.</CardDescription>\r\n                            </div>\r\n                            <AddAnnouncementDialog onAdd={handleAddAnnouncement}>\r\n                                <Button variant=\"outline\">\r\n                                    <Bell className=\"mr-2 h-4 w-4\" /> New Announcement\r\n                                </Button>\r\n                            </AddAnnouncementDialog>\r\n                        </CardHeader>\r\n                        <CardContent>\r\n                            <Table>\r\n                                <TableHeader>\r\n                                    <TableRow>\r\n                                        <TableHead className=\"hidden sm:table-cell\">Date</TableHead>\r\n                                        <TableHead>Title</TableHead>\r\n                                        <TableHead className=\"hidden md:table-cell\">Message</TableHead>\r\n                                        <TableHead>Event Date</TableHead>\r\n                                        <TableHead className=\"text-right\">Actions</TableHead>\r\n                                    </TableRow>\r\n                                </TableHeader>\r\n                                <TableBody>\r\n                                    {filteredAnnouncements.length > 0 ? filteredAnnouncements.map(announcement => {\r\n                                        const isUpcoming = isEventUpcoming(announcement.eventDate);\r\n                                        return (\r\n                                            <TableRow key={announcement.id} className={cn(isUpcoming && \"bg-blue-500/10 ring-2 ring-destructive animate-pulse\")}>\r\n                                                <TableCell className=\"font-medium hidden sm:table-cell\">\r\n                                                    {new Date(announcement.date).toLocaleDateString(undefined, { year: 'numeric', month: 'long', day: 'numeric' })}\r\n                                                </TableCell>\r\n                                                <TableCell>{announcement.title}</TableCell>\r\n                                                <TableCell className=\"hidden md:table-cell max-w-sm truncate\">{announcement.message}</TableCell>\r\n                                                <TableCell>\r\n                                                    {announcement.eventDate ? (\r\n                                                        <div className=\"flex items-center gap-2\">\r\n                                                            <span className={cn(\r\n                                                                'px-2 py-1 rounded-full text-xs font-medium',\r\n                                                                (typeof window !== 'undefined' && new Date(announcement.eventDate) > new Date()) ? 'bg-blue-100 text-blue-800' : 'bg-gray-100 text-gray-800'\r\n                                                            )}>\r\n                                                                {new Date(announcement.eventDate).toLocaleDateString(undefined, { year: 'numeric', month: 'short', day: 'numeric', timeZone: 'UTC' })}\r\n                                                            </span>\r\n                                                        </div>\r\n                                                    ) : <span className=\"text-muted-foreground\">-</span>}\r\n                                                </TableCell>\r\n                                                <TableCell className=\"text-right\">\r\n                                                    <DeleteAnnouncementDialog announcement={announcement} onDelete={() => handleDeleteAnnouncement(announcement.id)} isPermanent={false}>\r\n                                                        <Button variant=\"ghost\" size=\"icon\" className=\"text-destructive hover:text-destructive\">\r\n                                                            <Trash2 className=\"h-4 w-4\" />\r\n                                                        </Button>\r\n                                                    </DeleteAnnouncementDialog>\r\n                                                </TableCell>\r\n                                            </TableRow>\r\n                                        )\r\n                                    }) : (\r\n                                        <TableRow>\r\n                                            <TableCell colSpan={5} className=\"text-center text-muted-foreground\">No announcements found.</TableCell>\r\n                                        </TableRow>\r\n                                    )}\r\n                                </TableBody>\r\n                            </Table>\r\n                        </CardContent>\r\n                    </Card>\r\n                </TabsContent>\r\n\r\n                <TabsContent value=\"holidays\">\r\n                    <Card>\r\n                        <CardHeader className=\"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4\">\r\n                            <div>\r\n                                <CardTitle>Manage Holidays</CardTitle>\r\n                                <CardDescription>Add or remove holidays for the organization.</CardDescription>\r\n                            </div>\r\n                            <div className=\"flex w-full flex-col sm:flex-row sm:w-auto items-center gap-4\">\r\n                                <div className=\"flex items-center gap-2 w-full\">\r\n                                    <Label className=\"text-sm font-medium\">Location</Label>\r\n                                    <Select value={holidayLocationFilter} onValueChange={(value) => setHolidayLocationFilter(value as any)}>\r\n                                        <SelectTrigger className=\"w-full sm:w-[180px]\">\r\n                                            <SelectValue placeholder=\"Select Location\" />\r\n                                        </SelectTrigger>\r\n                                        <SelectContent>\r\n                                            <SelectItem value=\"all\">All Locations</SelectItem>\r\n                                            {holidayLocations.map(loc => (\r\n                                                <SelectItem key={loc} value={loc}>\r\n                                                    {loc}\r\n                                                </SelectItem>\r\n                                            ))}\r\n                                        </SelectContent>\r\n                                    </Select>\r\n                                </div>\r\n                                <AddHolidayDialog onAdd={handleAddHoliday}>\r\n                                    <Button variant=\"outline\" className=\"w-full sm:w-auto\">\r\n                                        <CalendarPlus className=\"mr-2 h-4 w-4\" /> Add Holiday\r\n                                    </Button>\r\n                                </AddHolidayDialog>\r\n                            </div>\r\n                        </CardHeader>\r\n                        <CardContent>\r\n                            <Table>\r\n                                <TableHeader>\r\n                                    <TableRow>\r\n                                        <TableHead>Date</TableHead>\r\n                                        <TableHead>Name</TableHead>\r\n                                        <TableHead>Location</TableHead>\r\n                                        <TableHead className=\"text-right\">Actions</TableHead>\r\n                                    </TableRow>\r\n                                </TableHeader>\r\n                                <TableBody>\r\n                                    {filteredHolidays.length > 0 ? filteredHolidays.map(holiday => (\r\n                                        <TableRow key={holiday.id}>\r\n                                            <TableCell className=\"font-medium\">{new Date(holiday.date).toLocaleDateString(undefined, { year: 'numeric', month: 'long', day: 'numeric', timeZone: 'UTC' })}</TableCell>\r\n                                            <TableCell>{holiday.name}</TableCell>\r\n                                            <TableCell>\r\n                                                <span className=\"px-2 py-1 rounded-full text-xs font-medium bg-secondary text-secondary-foreground\">\r\n                                                    {holiday.location}\r\n                                                </span>\r\n                                            </TableCell>\r\n                                            <TableCell className=\"text-right\">\r\n                                                <Button variant=\"ghost\" size=\"icon\" className=\"text-destructive hover:text-destructive\" onClick={() => handleDeleteHoliday(holiday.id)}>\r\n                                                    <Trash2 className=\"h-4 w-4\" />\r\n                                                </Button>\r\n                                            </TableCell>\r\n                                        </TableRow>\r\n                                    )) : (\r\n                                        <TableRow>\r\n                                            <TableCell colSpan={4} className=\"text-center text-muted-foreground\">No holidays found.</TableCell>\r\n                                        </TableRow>\r\n                                    )}\r\n                                </TableBody>\r\n                            </Table>\r\n                        </CardContent>\r\n                    </Card>\r\n                </TabsContent>\r\n\r\n                <TabsContent value=\"settings\">\r\n                    <Card>\r\n                        <CardHeader>\r\n                            <CardTitle>Settings</CardTitle>\r\n                            <CardDescription>Manage global application settings and configurations.</CardDescription>\r\n                        </CardHeader>\r\n                        <CardContent>\r\n                            <Tabs defaultValue=\"companies\" className=\"w-full\">\r\n                                <div className=\"overflow-x-auto w-full pb-2\">\r\n                                    <TabsList className=\"w-max\">\r\n                                        <TabsTrigger value=\"companies\">Companies</TabsTrigger>\r\n                                        <TabsTrigger value=\"branding\">Branding</TabsTrigger>\r\n                                        <TabsTrigger value=\"doc-types\">Document Types</TabsTrigger>\r\n                                        <TabsTrigger value=\"departments\">Departments</TabsTrigger>\r\n                                        <TabsTrigger value=\"security\">Security</TabsTrigger>\r\n                                        <TabsTrigger value=\"data-management\">Data Management</TabsTrigger>\r\n                                        <TabsTrigger value=\"integrations\">Integrations</TabsTrigger>\r\n                                    </TabsList>\r\n                                </div>\r\n                                <TabsContent value=\"companies\" className=\"pt-6\">\r\n                                    <Card>\r\n                                        <CardHeader className=\"flex flex-col md:flex-row items-start md:items-center justify-between gap-4\">\r\n                                            <div>\r\n                                                <CardTitle>Manage Companies</CardTitle>\r\n                                                <CardDescription>Add, edit, or delete companies from the organization.</CardDescription>\r\n                                            </div>\r\n                                            <CompanyManagementDialog onSave={handleSaveCompany}>\r\n                                                <Button variant=\"outline\">\r\n                                                    <Home className=\"mr-2 h-4 w-4\" /> Add Company\r\n                                                </Button>\r\n                                            </CompanyManagementDialog>\r\n                                        </CardHeader>\r\n                                        <CardContent>\r\n                                            <Table>\r\n                                                <TableHeader>\r\n                                                    <TableRow>\r\n                                                        <TableHead>Logo</TableHead>\r\n                                                        <TableHead>Name</TableHead>\r\n                                                        <TableHead>Short Name</TableHead>\r\n                                                        <TableHead className=\"hidden sm:table-cell\">Email</TableHead>\r\n                                                        <TableHead className=\"hidden sm:table-cell\">Phone</TableHead>\r\n                                                        <TableHead className=\"text-right\">Actions</TableHead>\r\n                                                    </TableRow>\r\n                                                </TableHeader>\r\n                                                <TableBody>\r\n                                                    {filteredCompanies.length > 0 ? filteredCompanies.map(company => (\r\n                                                        <TableRow key={company.id}>\r\n                                                            <TableCell>\r\n                                                                {company.logo ? (\r\n                                                                    <Image src={company.logo} alt={company.name ? company.name : 'Company Logo'} width={40} height={40} className=\"rounded-md object-cover\" />\r\n                                                                ) : (\r\n                                                                    <div className=\"h-10 w-10 rounded-md bg-muted flex items-center justify-center text-muted-foreground text-xs\">\r\n                                                                        No Logo\r\n                                                                    </div>\r\n                                                                )}\r\n                                                            </TableCell>\r\n                                                            <TableCell className=\"font-medium\">{company.name}</TableCell>\r\n                                                            <TableCell>{company.shortName}</TableCell>\r\n                                                            <TableCell className=\"hidden sm:table-cell\">{company.email}</TableCell>\r\n                                                            <TableCell className=\"hidden sm:table-cell\">{company.phone}</TableCell>\r\n                                                            <TableCell className=\"text-right\">\r\n                                                                <DropdownMenu>\r\n                                                                    <DropdownMenuTrigger asChild>\r\n                                                                        <Button variant=\"ghost\" size=\"icon\">\r\n                                                                            <MoreVertical className=\"h-5 w-5\" />\r\n                                                                        </Button>\r\n                                                                    </DropdownMenuTrigger>\r\n                                                                    <DropdownMenuContent align=\"end\">\r\n                                                                        <CompanyManagementDialog company={company} onSave={handleSaveCompany}>\r\n                                                                            <DropdownMenuItem onSelect={(e) => e.preventDefault()}>\r\n                                                                                <Edit className=\"mr-2 h-4 w-4\" /> Edit\r\n                                                                            </DropdownMenuItem>\r\n                                                                        </CompanyManagementDialog>\r\n                                                                        <DeleteCompanyDialog company={company} onDelete={() => handleDeleteCompany(company.id)}>\r\n                                                                            <DropdownMenuItem onSelect={(e) => e.preventDefault()} className=\"text-destructive focus:text-destructive\">\r\n                                                                                <Trash2 className=\"mr-2 h-4 w-4\" /> Delete\r\n                                                                            </DropdownMenuItem>\r\n                                                                        </DeleteCompanyDialog>\r\n                                                                    </DropdownMenuContent>\r\n                                                                </DropdownMenu>\r\n                                                            </TableCell>\r\n                                                        </TableRow>\r\n                                                    )) : (\r\n                                                        <TableRow>\r\n                                                            <TableCell colSpan={6} className=\"text-center text-muted-foreground\">No companies found.</TableCell>\r\n                                                        </TableRow>\r\n                                                    )}\r\n                                                </TableBody>\r\n                                            </Table>\r\n                                        </CardContent>\r\n                                    </Card>\r\n                                </TabsContent>\r\n                                <TabsContent value=\"branding\" className=\"pt-6\">\r\n                                    <Card>\r\n                                        <CardHeader>\r\n                                            <CardTitle>Application Branding</CardTitle>\r\n                                            <CardDescription>Manage the look and feel of the application.</CardDescription>\r\n                                        </CardHeader>\r\n                                        <CardContent className=\"space-y-8\">\r\n                                            <div className=\"space-y-2\">\r\n                                                <Label>Company Logo</Label>\r\n                                                <div className=\"flex items-center gap-4\">\r\n                                                    <div className=\"w-20 h-20 rounded-full bg-muted flex items-center justify-center\">\r\n                                                        {logoSrc ? (\r\n                                                            <Image src={logoSrc} alt=\"Current Logo\" width={80} height={80} className=\"rounded-full object-cover\" />\r\n                                                        ) : (\r\n                                                            <svg\r\n                                                                width=\"64\"\r\n                                                                height=\"64\"\r\n                                                                viewBox=\"0 0 100 100\"\r\n                                                                fill=\"none\"\r\n                                                                xmlns=\"http://www.w3.org/2000/svg\"\r\n                                                            >\r\n                                                                <path\r\n                                                                    d=\"M50 0L95.5 25.5V74.5L50 100L4.5 74.5V25.5L50 0Z\"\r\n                                                                    fill=\"#004a99\"\r\n                                                                />\r\n                                                                <path\r\n                                                                    d=\"M26 63.5L50 50L74 63.5M50 75V50\"\r\n                                                                    stroke=\"#fecb00\"\r\n                                                                    strokeWidth=\"5\"\r\n                                                                    strokeLinecap=\"round\"\r\n                                                                    strokeLinejoin=\"round\"\r\n                                                                />\r\n                                                                <path\r\n                                                                    d=\"M26 36.5L50 25L74 36.5\"\r\n                                                                    stroke=\"#ffffff\"\r\n                                                                    strokeWidth=\"5\"\r\n                                                                    strokeLinecap=\"round\"\r\n                                                                    strokeLinejoin=\"round\"\r\n                                                                />\r\n                                                            </svg>\r\n                                                        )}\r\n                                                    </div>\r\n                                                    <div className=\"flex items-center gap-2\">\r\n                                                        <Button asChild variant=\"outline\">\r\n                                                            <label htmlFor=\"logo-upload\">\r\n                                                                <UploadCloud className=\"mr-2 h-4 w-4\" />\r\n                                                                Change Logo\r\n                                                                <input\r\n                                                                    type=\"file\"\r\n                                                                    id=\"logo-upload\"\r\n                                                                    className=\"sr-only\"\r\n                                                                    accept=\"image/*\"\r\n                                                                    onChange={handleLogoChange}\r\n                                                                />\r\n                                                            </label>\r\n                                                        </Button>\r\n                                                        {logoSrc && (\r\n                                                            <Button variant=\"ghost\" className=\"text-destructive\" onClick={handleResetLogo}>\r\n                                                                <X className=\"mr-2 h-4 w-4\" />\r\n                                                                Reset\r\n                                                            </Button>\r\n                                                        )}\r\n                                                    </div>\r\n                                                </div>\r\n                                                <p className=\"text-sm text-muted-foreground\">Upload a new logo for the login screen.</p>\r\n                                            </div>\r\n                                            <div className=\"space-y-2\">\r\n                                                <Label htmlFor=\"site-name\">Site Name</Label>\r\n                                                <div className=\"flex items-center gap-2\">\r\n                                                    <Input\r\n                                                        id=\"site-name\"\r\n                                                        value={tempSiteName}\r\n                                                        onChange={(e) => setTempSiteName(e.target.value)}\r\n                                                        className=\"max-w-xs\"\r\n                                                    />\r\n                                                    <Button onClick={handleSiteNameSave}>\r\n                                                        <Save className=\"mr-2 h-4 w-4\" />\r\n                                                        Save Name\r\n                                                    </Button>\r\n                                                </div>\r\n                                                <p className=\"text-sm text-muted-foreground\">This name will appear on the login page and in the header.</p>\r\n                                            </div>\r\n                                        </CardContent>\r\n                                    </Card>\r\n                                </TabsContent>\r\n                                <TabsContent value=\"doc-types\" className=\"pt-6\">\r\n                                    <Card>\r\n                                        <CardHeader className=\"flex flex-col md:flex-row items-start md:items-center justify-between gap-4\">\r\n                                            <div>\r\n                                                <CardTitle>Manage Document Types</CardTitle>\r\n                                                <CardDescription>Add or edit document categories for the whole organization.</CardDescription>\r\n                                            </div>\r\n                                            <AddDocumentTypeDialog onAdd={handleAddDocumentType}>\r\n                                                <Button variant=\"outline\">\r\n                                                    <FolderPlus className=\"mr-2 h-4 w-4\" /> Add Doc Type\r\n                                                </Button>\r\n                                            </AddDocumentTypeDialog>\r\n                                        </CardHeader>\r\n                                        <CardContent>\r\n                                            <Table>\r\n                                                <TableHeader>\r\n                                                    <TableRow>\r\n                                                        <TableHead>Type Name</TableHead>\r\n                                                        <TableHead className=\"text-right\">Actions</TableHead>\r\n                                                    </TableRow>\r\n                                                </TableHeader>\r\n                                                <TableBody>\r\n                                                    {filteredDocTypes.length > 0 ? filteredDocTypes.map(type => (\r\n                                                        <TableRow key={type}>\r\n                                                            <TableCell className=\"font-medium\">\r\n                                                                <div className=\"flex items-center gap-2\">\r\n                                                                    <Tag className=\"h-4 w-4 text-muted-foreground\" />\r\n                                                                    {type}\r\n                                                                </div>\r\n                                                            </TableCell>\r\n                                                            <TableCell className=\"text-right\">\r\n                                                                <EditDocumentTypeDialog\r\n                                                                    documentType={type}\r\n                                                                    onEdit={handleEditDocumentType}\r\n                                                                >\r\n                                                                    <Button variant=\"ghost\" size=\"sm\">\r\n                                                                        <Edit className=\"mr-2 h-4 w-4\" /> Edit\r\n                                                                    </Button>\r\n                                                                </EditDocumentTypeDialog>\r\n                                                                <DeleteDocumentTypeDialog\r\n                                                                    documentType={type}\r\n                                                                    onDelete={() => handleDeleteDocumentType(type)}\r\n                                                                    isTypeInUse={docs.some(d => d.type === type)}\r\n                                                                >\r\n                                                                    <Button variant=\"ghost\" size=\"sm\" className=\"text-destructive hover:text-destructive\">\r\n                                                                        <Trash2 className=\"mr-2 h-4 w-4\" /> Delete\r\n                                                                    </Button>\r\n                                                                </DeleteDocumentTypeDialog>\r\n                                                            </TableCell>\r\n                                                        </TableRow>\r\n                                                    )) : (\r\n                                                        <TableRow>\r\n                                                            <TableCell colSpan={2} className=\"text-center text-muted-foreground\">No document types found.</TableCell>\r\n                                                        </TableRow>\r\n                                                    )}\r\n                                                </TableBody>\r\n                                            </Table>\r\n                                        </CardContent>\r\n                                    </Card>\r\n                                </TabsContent>\r\n                                <TabsContent value=\"departments\" className=\"pt-6\">\r\n                                    <Card>\r\n                                        <CardHeader className=\"flex flex-col md:flex-row items-start md:items-center justify-between gap-4\">\r\n                                            <div>\r\n                                                <CardTitle>Manage Departments</CardTitle>\r\n                                                <CardDescription>Add, edit, or delete departments for the organization.</CardDescription>\r\n                                            </div>\r\n                                            <AddDepartmentDialog onAdd={handleAddDepartment}>\r\n                                                <Button variant=\"outline\">\r\n                                                    <Building className=\"mr-2 h-4 w-4\" /> Add Department\r\n                                                </Button>\r\n                                            </AddDepartmentDialog>\r\n                                        </CardHeader>\r\n                                        <CardContent>\r\n                                            <Table>\r\n                                                <TableHeader>\r\n                                                    <TableRow>\r\n                                                        <TableHead>Department Name</TableHead>\r\n                                                        <TableHead className=\"text-right\">Actions</TableHead>\r\n                                                    </TableRow>\r\n                                                </TableHeader>\r\n                                                <TableBody>\r\n                                                    {filteredDepartments.length > 0 ? filteredDepartments.map(dept => (\r\n                                                        <TableRow key={dept}>\r\n                                                            <TableCell className=\"font-medium\">\r\n                                                                <div className=\"flex items-center gap-2\">\r\n                                                                    <Building className=\"h-4 w-4 text-muted-foreground\" />\r\n                                                                    {dept}\r\n                                                                </div>\r\n                                                            </TableCell>\r\n                                                            <TableCell className=\"text-right\">\r\n                                                                <Button variant=\"ghost\" size=\"sm\" disabled>\r\n                                                                    <Edit className=\"mr-2 h-4 w-4\" /> Edit\r\n                                                                </Button>\r\n                                                                <DeleteDepartmentDialog departmentName={dept} onDelete={() => handleDeleteDepartment(dept)}>\r\n                                                                    <Button variant=\"ghost\" size=\"sm\" className=\"text-destructive hover:text-destructive\">\r\n                                                                        <Trash2 className=\"mr-2 h-4 w-4\" /> Delete\r\n                                                                    </Button>\r\n                                                                </DeleteDepartmentDialog>\r\n                                                            </TableCell>\r\n                                                        </TableRow>\r\n                                                    )) : (\r\n                                                        <TableRow>\r\n                                                            <TableCell colSpan={2} className=\"text-center text-muted-foreground\">No departments found.</TableCell>\r\n                                                        </TableRow>\r\n                                                    )}\r\n                                                </TableBody>\r\n                                            </Table>\r\n                                        </CardContent>\r\n                                    </Card>\r\n                                </TabsContent>\r\n                                <TabsContent value=\"security\" className=\"pt-6\">\r\n                                    <Card>\r\n                                        <CardHeader>\r\n                                            <CardTitle>Authentication Security</CardTitle>\r\n                                            <CardDescription>Manage which email domains are allowed to sign in.</CardDescription>\r\n                                        </CardHeader>\r\n                                        <CardContent className=\"space-y-6\">\r\n                                            <div className=\"space-y-2\">\r\n                                                <Label htmlFor=\"new-domain\">Add New Domain</Label>\r\n                                                <div className=\"flex items-center gap-2\">\r\n                                                    <Input\r\n                                                        id=\"new-domain\"\r\n                                                        value={newDomain}\r\n                                                        onChange={(e) => setNewDomain(e.target.value)}\r\n                                                        placeholder=\"e.g., example.com\"\r\n                                                        className=\"max-w-xs\"\r\n                                                        onKeyDown={(e) => { if (e.key === 'Enter') handleAddDomain(); }}\r\n                                                    />\r\n                                                    <Button onClick={handleAddDomain}>Add Domain</Button>\r\n                                                </div>\r\n                                                <p className=\"text-sm text-muted-foreground\">Enter a domain that is allowed to sign in.</p>\r\n                                            </div>\r\n                                            <div className=\"space-y-2\">\r\n                                                <Label>Allowed Domains</Label>\r\n                                                {allowedDomains.length > 0 ? (\r\n                                                    <div className=\"border rounded-md p-4 space-y-2 max-w-md\">\r\n                                                        {allowedDomains.map(domain => (\r\n                                                            <div key={domain} className=\"flex items-center justify-between\">\r\n                                                                <span className=\"flex items-center gap-2 text-sm\">\r\n                                                                    <Shield className=\"h-4 w-4 text-green-500\" /> {domain}\r\n                                                                </span>\r\n                                                                <Button variant=\"ghost\" size=\"sm\" className=\"text-destructive hover:text-destructive\" onClick={() => handleRemoveDomain(domain)}>\r\n                                                                    <X className=\"mr-2 h-4 w-4\" /> Remove\r\n                                                                </Button>\r\n                                                            </div>\r\n                                                        ))}\r\n                                                    </div>\r\n                                                ) : (\r\n                                                    <p className=\"text-sm text-muted-foreground max-w-md\">\r\n                                                        No domains have been added. The default fallback domain will be used for authentication.\r\n                                                    </p>\r\n                                                )}\r\n                                            </div>\r\n                                        </CardContent>\r\n                                    </Card>\r\n                                </TabsContent>\r\n                                <TabsContent value=\"data-management\" className=\"pt-6\">\r\n                                    <Card>\r\n                                        <CardHeader>\r\n                                            <CardTitle>Data Management</CardTitle>\r\n                                            <CardDescription>Perform sensitive actions like undoing bulk uploads.</CardDescription>\r\n                                        </CardHeader>\r\n                                        <CardContent className=\"space-y-6\">\r\n                                            <div className=\"p-4 border border-destructive/50 bg-destructive/10 rounded-lg\">\r\n                                                <div className=\"flex flex-col md:flex-row items-start md:items-center justify-between gap-4\">\r\n                                                    <div>\r\n                                                        <h3 className=\"font-semibold\">Undo Last Bulk Upload</h3>\r\n                                                        <p className=\"text-sm text-destructive/80\">This will permanently delete the last batch of {lastBulkUploadInfo?.ids.length || 0} uploaded document(s). This action cannot be undone.</p>\r\n                                                    </div>\r\n                                                    <Button\r\n                                                        variant=\"destructive\"\r\n                                                        onClick={() => setIsUndoDialogOpen(true)}\r\n                                                        disabled={!lastBulkUploadInfo || lastBulkUploadInfo.ids.length === 0}\r\n                                                    >\r\n                                                        <Undo className=\"mr-2 h-4 w-4\" />\r\n                                                        Undo Last Upload ({lastBulkUploadInfo?.ids.length || 0})\r\n                                                    </Button>\r\n                                                </div>\r\n                                            </div>\r\n                                        </CardContent>\r\n                                    </Card>\r\n                                </TabsContent>\r\n                                <TabsContent value=\"integrations\" className=\"pt-6\">\r\n                                    <IntegrationsSettings />\r\n                                </TabsContent>\r\n                            </Tabs>\r\n                        </CardContent>\r\n                    </Card>\r\n                </TabsContent>\r\n                <TabsContent value=\"deleted-items\">\r\n                    <Card>\r\n                        <CardHeader>\r\n                            <CardTitle>Deleted Items</CardTitle>\r\n                            <CardDescription>Manage, restore, or permanently delete items.</CardDescription>\r\n                        </CardHeader>\r\n                        <CardContent>\r\n                            <Tabs defaultValue=\"companies\" className=\"w-full\">\r\n                                <div className=\"overflow-x-auto w-full pb-2\">\r\n                                    <TabsList className=\"w-max\">\r\n                                        <TabsTrigger value=\"companies\">Companies</TabsTrigger>\r\n                                        <TabsTrigger value=\"departments\">Departments</TabsTrigger>\r\n                                        <TabsTrigger value=\"doc-types\">Document Types</TabsTrigger>\r\n                                        <TabsTrigger value=\"documents\">Documents</TabsTrigger>\r\n                                        <TabsTrigger value=\"users\">Users</TabsTrigger>\r\n                                        <TabsTrigger value=\"announcements\">Announcements</TabsTrigger>\r\n                                    </TabsList>\r\n                                </div>\r\n                                <TabsContent value=\"companies\" className=\"pt-6\">\r\n                                    <Card>\r\n                                        <CardHeader>\r\n                                            <CardTitle>Deleted Companies</CardTitle>\r\n                                            <CardDescription>A list of all deleted companies. You can restore or permanently delete them.</CardDescription>\r\n                                        </CardHeader>\r\n                                        <CardContent>\r\n                                            <Table>\r\n                                                <TableHeader>\r\n                                                    <TableRow>\r\n                                                        <TableHead>Name</TableHead>\r\n                                                        <TableHead>Email</TableHead>\r\n                                                        <TableHead className=\"text-right\">Actions</TableHead>\r\n                                                    </TableRow>\r\n                                                </TableHeader>\r\n                                                <TableBody>\r\n                                                    {filteredDeletedCompanies.length > 0 ? filteredDeletedCompanies.map(company => (\r\n                                                        <TableRow key={company.id}>\r\n                                                            <TableCell className=\"font-medium\">{company.name}</TableCell>\r\n                                                            <TableCell>{company.email}</TableCell>\r\n                                                            <TableCell className=\"text-right space-x-2\">\r\n                                                                <Button variant=\"outline\" size=\"sm\" onClick={() => handleRestoreCompany(company.id)}>\r\n                                                                    <Undo className=\"mr-2 h-4 w-4\" /> Restore\r\n                                                                </Button>\r\n                                                                <PermanentDeleteDialog\r\n                                                                    itemName={company.name}\r\n                                                                    itemType=\"company\"\r\n                                                                    onDelete={() => handlePermanentDeleteCompany(company.id)}\r\n                                                                >\r\n                                                                    <Button variant=\"destructive\" size=\"sm\">\r\n                                                                        <Trash className=\"mr-2 h-4 w-4\" /> Permanent Delete\r\n                                                                    </Button>\r\n                                                                </PermanentDeleteDialog>\r\n                                                            </TableCell>\r\n                                                        </TableRow>\r\n                                                    )) : (\r\n                                                        <TableRow>\r\n                                                            <TableCell colSpan={3} className=\"text-center text-muted-foreground\">No deleted companies found.</TableCell>\r\n                                                        </TableRow>\r\n                                                    )}\r\n                                                </TableBody>\r\n                                            </Table>\r\n                                        </CardContent>\r\n                                    </Card>\r\n                                </TabsContent>\r\n                                <TabsContent value=\"departments\" className=\"pt-6\">\r\n                                    <Card>\r\n                                        <CardHeader>\r\n                                            <CardTitle>Deleted Departments</CardTitle>\r\n                                            <CardDescription>A list of all deleted departments. You can restore or permanently delete them.</CardDescription>\r\n                                        </CardHeader>\r\n                                        <CardContent>\r\n                                            <Table>\r\n                                                <TableHeader>\r\n                                                    <TableRow>\r\n                                                        <TableHead>Department Name</TableHead>\r\n                                                        <TableHead className=\"text-right\">Actions</TableHead>\r\n                                                    </TableRow>\r\n                                                </TableHeader>\r\n                                                <TableBody>\r\n                                                    {filteredDeletedDepartments.length > 0 ? filteredDeletedDepartments.map(dept => (\r\n                                                        <TableRow key={dept}>\r\n                                                            <TableCell className=\"font-medium\">\r\n                                                                <div className=\"flex items-center gap-2\">\r\n                                                                    <Building className=\"h-4 w-4 text-muted-foreground\" />\r\n                                                                    {dept}\r\n                                                                </div>\r\n                                                            </TableCell>\r\n                                                            <TableCell className=\"text-right space-x-2\">\r\n                                                                <Button variant=\"outline\" size=\"sm\" onClick={() => handleRestoreDepartment(dept)}>\r\n                                                                    <Undo className=\"mr-2 h-4 w-4\" /> Restore\r\n                                                                </Button>\r\n                                                                <PermanentDeleteDialog\r\n                                                                    itemName={dept}\r\n                                                                    itemType=\"department\"\r\n                                                                    onDelete={() => handlePermanentDeleteDepartment(dept)}\r\n                                                                >\r\n                                                                    <Button variant=\"destructive\" size=\"sm\">\r\n                                                                        <Trash className=\"mr-2 h-4 w-4\" /> Permanent Delete\r\n                                                                    </Button>\r\n                                                                </PermanentDeleteDialog>\r\n                                                            </TableCell>\r\n                                                        </TableRow>\r\n                                                    )) : (\r\n                                                        <TableRow>\r\n                                                            <TableCell colSpan={2} className=\"text-center text-muted-foreground\">No deleted departments found.</TableCell>\r\n                                                        </TableRow>\r\n                                                    )}\r\n                                                </TableBody>\r\n                                            </Table>\r\n                                        </CardContent>\r\n                                    </Card>\r\n                                </TabsContent>\r\n                                <TabsContent value=\"doc-types\" className=\"pt-6\">\r\n                                    <Card>\r\n                                        <CardHeader>\r\n                                            <CardTitle>Deleted Document Types</CardTitle>\r\n                                            <CardDescription>A list of all deleted document types. You can restore or permanently delete them.</CardDescription>\r\n                                        </CardHeader>\r\n                                        <CardContent>\r\n                                            <Table>\r\n                                                <TableHeader>\r\n                                                    <TableRow>\r\n                                                        <TableHead>Type Name</TableHead>\r\n                                                        <TableHead className=\"text-right\">Actions</TableHead>\r\n                                                    </TableRow>\r\n                                                </TableHeader>\r\n                                                <TableBody>\r\n                                                    {filteredDeletedDocTypes.length > 0 ? filteredDeletedDocTypes.map(type => (\r\n                                                        <TableRow key={type}>\r\n                                                            <TableCell className=\"font-medium\">\r\n                                                                <div className=\"flex items-center gap-2\">\r\n                                                                    <Tag className=\"h-4 w-4 text-muted-foreground\" />\r\n                                                                    {type}\r\n                                                                </div>\r\n                                                            </TableCell>\r\n                                                            <TableCell className=\"text-right space-x-2\">\r\n                                                                <Button variant=\"outline\" size=\"sm\" onClick={() => handleRestoreDocumentType(type)}>\r\n                                                                    <Undo className=\"mr-2 h-4 w-4\" /> Restore\r\n                                                                </Button>\r\n                                                                <PermanentDeleteDialog\r\n                                                                    itemName={type}\r\n                                                                    itemType=\"document type\"\r\n                                                                    onDelete={() => handlePermanentDeleteDocumentType(type)}\r\n                                                                >\r\n                                                                    <Button variant=\"destructive\" size=\"sm\">\r\n                                                                        <Trash className=\"mr-2 h-4 w-4\" /> Permanent Delete\r\n                                                                    </Button>\r\n                                                                </PermanentDeleteDialog>\r\n                                                            </TableCell>\r\n                                                        </TableRow>\r\n                                                    )) : (\r\n                                                        <TableRow>\r\n                                                            <TableCell colSpan={2} className=\"text-center text-muted-foreground\">No deleted document types found.</TableCell>\r\n                                                        </TableRow>\r\n                                                    )}\r\n                                                </TableBody>\r\n                                            </Table>\r\n                                        </CardContent>\r\n                                    </Card>\r\n                                </TabsContent>\r\n                                <TabsContent value=\"documents\" className=\"pt-6\">\r\n                                    <Card>\r\n                                        <CardHeader>\r\n                                            <CardTitle>Deleted Documents</CardTitle>\r\n                                            <CardDescription>A list of all deleted documents. You can restore or permanently delete them.</CardDescription>\r\n                                        </CardHeader>\r\n                                        <CardContent>\r\n                                            <DocumentList\r\n                                                documents={filteredDeletedDocs}\r\n                                                users={users}\r\n                                                showOwner\r\n                                                onSort={() => { }}\r\n                                                sortConfig={null}\r\n                                                isDeletedList\r\n                                                onRestore={handleRestoreDocument}\r\n                                                onPermanentDelete={handlePermanentDeleteDocument}\r\n                                            />\r\n                                        </CardContent>\r\n                                    </Card>\r\n                                </TabsContent>\r\n                                <TabsContent value=\"users\" className=\"pt-6\">\r\n                                    <Card>\r\n                                        <CardHeader>\r\n                                            <CardTitle>Deleted Users</CardTitle>\r\n                                            <CardDescription>A list of all deleted employees. You can restore or permanently delete them.</CardDescription>\r\n                                        </CardHeader>\r\n                                        <CardContent>\r\n                                            <Table>\r\n                                                <TableHeader>\r\n                                                    <TableRow>\r\n                                                        <TableHead className=\"w-[80px] hidden sm:table-cell\"></TableHead>\r\n                                                        <TableHead>Name</TableHead>\r\n                                                        <TableHead>Email</TableHead>\r\n                                                        <TableHead className=\"text-right\">Actions</TableHead>\r\n                                                    </TableRow>\r\n                                                </TableHeader>\r\n                                                <TableBody>\r\n                                                    {filteredDeletedUsers.length > 0 ? filteredDeletedUsers.map(user => (\r\n                                                        <TableRow key={user.id}>\r\n                                                            <TableCell className=\"hidden sm:table-cell\">\r\n                                                                <Image src={getAvatarSrc(user)} width={40} height={40} className=\"rounded-full object-cover\" alt={user.name ? user.name : 'User'} data-ai-hint=\"person portrait\" />\r\n                                                            </TableCell>\r\n                                                            <TableCell className=\"font-medium\">{user.name}</TableCell>\r\n                                                            <TableCell>{user.email}</TableCell>\r\n                                                            <TableCell className=\"text-right space-x-2\">\r\n                                                                <Button variant=\"outline\" size=\"sm\" onClick={() => router.push(`/dashboard/employee/${user.id}?role=admin`)}>\r\n                                                                    <Eye className=\"mr-2 h-4 w-4\" /> View\r\n                                                                </Button>\r\n                                                                <Button variant=\"outline\" size=\"sm\" onClick={() => handleRestoreUser(user.id)}>\r\n                                                                    <Undo className=\"mr-2 h-4 w-4\" /> Restore\r\n                                                                </Button>\r\n                                                                <PermanentDeleteDialog\r\n                                                                    itemName={user.name}\r\n                                                                    itemType=\"user\"\r\n                                                                    onDelete={() => handlePermanentDeleteUser(user.id)}\r\n                                                                >\r\n                                                                    <Button variant=\"destructive\" size=\"sm\">\r\n                                                                        <Trash className=\"mr-2 h-4 w-4\" /> Permanent Delete\r\n                                                                    </Button>\r\n                                                                </PermanentDeleteDialog>\r\n                                                            </TableCell>\r\n                                                        </TableRow>\r\n                                                    )) : (\r\n                                                        <TableRow>\r\n                                                            <TableCell colSpan={4} className=\"text-center text-muted-foreground\">No deleted users found.</TableCell>\r\n                                                        </TableRow>\r\n                                                    )}\r\n                                                </TableBody>\r\n                                            </Table>\r\n                                        </CardContent>\r\n                                    </Card>\r\n                                </TabsContent>\r\n                                <TabsContent value=\"announcements\" className=\"pt-6\">\r\n                                    <Card>\r\n                                        <CardHeader>\r\n                                            <CardTitle>Deleted Announcements</CardTitle>\r\n                                            <CardDescription>A list of all deleted announcements. You can restore or permanently delete them here.</CardDescription>\r\n                                        </CardHeader>\r\n                                        <CardContent>\r\n                                            <Table>\r\n                                                <TableHeader>\r\n                                                    <TableRow>\r\n                                                        <TableHead>Date</TableHead>\r\n                                                        <TableHead>Title</TableHead>\r\n                                                        <TableHead className=\"hidden md:table-cell\">Message</TableHead>\r\n                                                        <TableHead className=\"text-right\">Actions</TableHead>\r\n                                                    </TableRow>\r\n                                                </TableHeader>\r\n                                                <TableBody>\r\n                                                    {filteredDeletedAnnouncements.length > 0 ? filteredDeletedAnnouncements.map(announcement => (\r\n                                                        <TableRow key={announcement.id}>\r\n                                                            <TableCell className=\"font-medium hidden sm:table-cell\">{new Date(announcement.date).toLocaleDateString(undefined, { year: 'numeric', month: 'long', day: 'numeric' })}</TableCell>\r\n                                                            <TableCell>{announcement.title}</TableCell>\r\n                                                            <TableCell className=\"hidden md:table-cell max-w-sm truncate\">{announcement.message}</TableCell>\r\n                                                            <TableCell className=\"text-right\">\r\n                                                                <div className=\"flex items-center justify-end gap-2\">\r\n                                                                    <Button variant=\"outline\" size=\"sm\" onClick={() => handleRestoreAnnouncement(announcement.id)}>\r\n                                                                        <ArchiveRestore className=\"mr-2 h-4 w-4\" /> Restore\r\n                                                                    </Button>\r\n                                                                    <PermanentDeleteDialog\r\n                                                                        itemName={announcement.title}\r\n                                                                        itemType='announcement'\r\n                                                                        onDelete={() => handlePermanentDeleteAnnouncement(announcement.id)}\r\n                                                                    >\r\n                                                                        <Button variant=\"destructive\" size=\"sm\">\r\n                                                                            <Trash className=\"mr-2 h-4 w-4\" /> Delete Permanently\r\n                                                                        </Button>\r\n                                                                    </PermanentDeleteDialog>\r\n                                                                </div>\r\n                                                            </TableCell>\r\n                                                        </TableRow>\r\n                                                    )) : (\r\n                                                        <TableRow>\r\n                                                            <TableCell colSpan={4} className=\"text-center text-muted-foreground\">No deleted announcements found.</TableCell>\r\n                                                        </TableRow>\r\n                                                    )}\r\n                                                </TableBody>\r\n                                            </Table>\r\n                                        </CardContent>\r\n                                    </Card>\r\n                                </TabsContent>\r\n                            </Tabs>\r\n                        </CardContent>\r\n                    </Card>\r\n                </TabsContent>\r\n            </Tabs>\r\n\r\n            {/* Bulk Delete Confirmation Dialog */}\r\n            <AlertDialog open={isBulkDeleteDialogOpen} onOpenChange={setIsBulkDeleteDialogOpen}>\r\n                <AlertDialogContent>\r\n                    <AlertDialogHeader>\r\n                        <AlertDialogTitle>Are you absolutely sure?</AlertDialogTitle>\r\n                        <AlertDialogDescription>\r\n                            This will move the selected {numSelected} employee(s) to the deleted users list. You can restore them later.\r\n                        </AlertDialogDescription>\r\n                    </AlertDialogHeader>\r\n                    <AlertDialogFooter>\r\n                        <AlertDialogCancel>Cancel</AlertDialogCancel>\r\n                        <AlertDialogAction onClick={handleBulkDelete} className=\"bg-destructive hover:bg-destructive/90\">\r\n                            Delete {numSelected} Employee(s)\r\n                        </AlertDialogAction>\r\n                    </AlertDialogFooter>\r\n                </AlertDialogContent>\r\n            </AlertDialog>\r\n\r\n            {/* Bulk Reset Password Confirmation Dialog */}\r\n            <AlertDialog open={isBulkResetDialogOpen} onOpenChange={setIsBulkResetDialogOpen}>\r\n                <AlertDialogContent>\r\n                    <AlertDialogHeader>\r\n                        <AlertDialogTitle>Confirm Password Reset</AlertDialogTitle>\r\n                        <AlertDialogDescription>\r\n                            Are you sure you want to send password reset links to the {numSelected} selected employee(s)?\r\n                        </AlertDialogDescription>\r\n                    </AlertDialogHeader>\r\n                    <AlertDialogFooter>\r\n                        <AlertDialogCancel>Cancel</AlertDialogCancel>\r\n                        <AlertDialogAction onClick={handleBulkResetPassword}>\r\n                            Send Reset Links\r\n                        </AlertDialogAction>\r\n                    </AlertDialogFooter>\r\n                </AlertDialogContent>\r\n            </AlertDialog>\r\n\r\n            {/* Undo Last Bulk Upload Confirmation Dialog */}\r\n            <AlertDialog open={isUndoDialogOpen} onOpenChange={setIsUndoDialogOpen}>\r\n                <AlertDialogContent>\r\n                    <AlertDialogHeader>\r\n                        <AlertDialogTitle>Undo Last Bulk Upload?</AlertDialogTitle>\r\n                        <AlertDialogDescription>\r\n                            This will permanently delete the last batch of {lastBulkUploadInfo?.ids.length || 0} uploaded document(s). This action cannot be undone.\r\n                        </AlertDialogDescription>\r\n                    </AlertDialogHeader>\r\n                    <AlertDialogFooter>\r\n                        <AlertDialogCancel>Cancel</AlertDialogCancel>\r\n                        <AlertDialogAction onClick={handleUndoLastBulkUpload} className=\"bg-destructive hover:bg-destructive/90\">\r\n                            Yes, Undo Upload\r\n                        </AlertDialogAction>\r\n                    </AlertDialogFooter>\r\n                </AlertDialogContent>\r\n            </AlertDialog>\r\n        </>\r\n    )\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\FileSafe\\studio\\src\\app\\dashboard\\employee\\[id]\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'setCompanies' is assigned a value but never used.","line":39,"column":23,"nodeType":null,"messageId":"unusedVar","endLine":39,"endColumn":35},{"ruleId":"prefer-const","severity":2,"message":"'sortableItems' is never reassigned. Use 'const' instead.","line":145,"column":13,"nodeType":"Identifier","messageId":"useConst","endLine":145,"endColumn":26,"fix":{"range":[7390,7429],"text":"const sortableItems = [...userDocuments];"}}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":1,"fixableWarningCount":0,"source":"\r\n'use client';\r\nimport { useRouter, useSearchParams, useParams } from 'next/navigation';\r\nimport { users as initialUsers, departments, Company, companies as initialCompanies, documents as allDocuments } from '@/lib/mock-data';\r\nimport type { User as UserType } from '@/lib/mock-data';\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\r\nimport { Button } from '@/components/ui/button';\r\nimport { ArrowLeft, Mail, Phone, Calendar, Briefcase, Award, User, Edit, Building, LogOut, Droplet, MapPin, Shield, BadgeCheck, ShieldAlert } from 'lucide-react';\r\nimport Image from 'next/image';\r\nimport { useState, useEffect, useCallback, useMemo } from 'react';\r\nimport type { Document } from '@/lib/mock-data';\r\nimport { EmployeeManagementDialog } from '@/components/dashboard/employee-management-dialog';\r\nimport { EmployeeSelfEditDialog } from '@/components/dashboard/employee-self-edit-dialog';\r\nimport { cn, getAvatarSrc } from '@/lib/utils';\r\nimport { DocumentList } from '@/components/dashboard/document-list';\r\nimport { IdCardDialog } from '@/components/dashboard/id-card-dialog';\r\nimport {\r\n    AlertDialog,\r\n    AlertDialogAction,\r\n    AlertDialogCancel,\r\n    AlertDialogContent,\r\n    AlertDialogDescription,\r\n    AlertDialogFooter,\r\n    AlertDialogHeader,\r\n    AlertDialogTitle,\r\n    AlertDialogTrigger,\r\n} from \"@/components/ui/alert-dialog\"\r\nimport { Input } from \"@/components/ui/input\"\r\n\r\ntype SortKey = keyof Document;\r\ntype SortDirection = 'ascending' | 'descending';\r\n\r\nexport default function EmployeeProfilePage() {\r\n    const router = useRouter();\r\n    const searchParams = useSearchParams();\r\n    const params = useParams<{ id: string }>();\r\n\r\n    const [users, setUsers] = useState<UserType[]>(initialUsers);\r\n    const [companies, setCompanies] = useState<Company[]>(initialCompanies);\r\n    const [docs, setDocs] = useState<Document[]>(allDocuments);\r\n\r\n    const id = params?.id;\r\n\r\n    const [user, setUser] = useState<UserType | undefined>(undefined);\r\n    const [sortConfig, setSortConfig] = useState<{ key: SortKey; direction: SortDirection } | null>({ key: 'uploadDate', direction: 'descending' });\r\n\r\n    const [isMounted, setIsMounted] = useState(false);\r\n    const [isUnlocked, setIsUnlocked] = useState(false);\r\n\r\n    useEffect(() => {\r\n        setIsMounted(true);\r\n        if (id) {\r\n            console.log('Page useEffect: Searching for user with id:', id);\r\n            const foundUser = users.find(u => u.id === id);\r\n            console.log('Page useEffect: Found user:', foundUser);\r\n            setUser(foundUser);\r\n        } else {\r\n            console.log('Page useEffect: No id param');\r\n        }\r\n    }, [id, users]);\r\n\r\n\r\n\r\n    const role = searchParams.get('role');\r\n    const isSelfView = role !== 'admin';\r\n    const isSadmin = user?.id === 'sadmin';\r\n\r\n    const handleEmployeeSave = useCallback((employee: Partial<UserType> & { originalId?: string }) => {\r\n        setUsers(currentUsers => {\r\n            console.log('handleEmployeeSave: Updating users list. originalId:', employee.originalId, 'currentId:', id);\r\n            const userIndex = currentUsers.findIndex(u => u.id === (employee.originalId || id));\r\n            if (userIndex > -1) {\r\n                const updatedUsers = [...currentUsers];\r\n                const existingUser = updatedUsers[userIndex];\r\n                console.log('handleEmployeeSave: Existing user found:', existingUser);\r\n\r\n                const updatedUser = {\r\n                    ...existingUser,\r\n                    ...employee,\r\n                };\r\n                console.log('handleEmployeeSave: New updated user object:', updatedUser);\r\n\r\n                updatedUsers[userIndex] = updatedUser as UserType;\r\n\r\n                // Side effects like router.replace and setUser should technically be outside this setter if they depend on the result.\r\n                // However, for this fix, we will move them out of the return path or perform them after the state update is scheduled.\r\n                // Actually, the best way for this specific pattern without completely changing the structure:\r\n                // We'll trust that we can run the side effect *after* this callback runs, but we can't easily trigger it from here.\r\n                // Better approach: Calculate new state outside setUsers if possible, OR just trigger the side effect asynchronously.\r\n                // Given the constraints and the simple error, wrapping the side effect in a setTimeout or moving it out is standard.\r\n                // Let's move the logic OUT of setUsers since we have 'users' in the dependency (via 'users' state or just functional update).\r\n                // Wait, 'users' might be stale in the callback if we don't use functional update.\r\n                // But we can just use the state setter for the update, and separate the router logic.\r\n\r\n                return updatedUsers;\r\n            }\r\n            return currentUsers;\r\n        });\r\n\r\n        // Perform side effects outside the state setter\r\n        if (employee.originalId && employee.id && employee.id !== employee.originalId) {\r\n            // This is a rough approximation since we can't guarantee the previous state update succeeded perfectly in sync, \r\n            // but for a mocked local app this is fine and fixing the immediate React warning.\r\n            // We need to know if the user was found and updated to be 100% correct, but assuming success for now to fix the crash.\r\n            router.replace(`/dashboard/employee/${employee.id}?role=admin`);\r\n        } else {\r\n            // We also need to update the local 'user' state if we're not navigating away\r\n            // But 'setUser' is also a state update. Calling it here is fine (event handler flow), calling it inside setUsers (render phase of that update?) is bad.\r\n            // Actually, calling setUsers(func) puts us in a \"render phase\" for that function? No, it's just the updater.\r\n            // BUT, doing another setState inside an updater is definitely weird.\r\n\r\n            // We need the merged user data to update 'setUser'.\r\n            // Let's just do a functional update for setUser too, or fetch it from the new users list in a useEffect.\r\n            // For simplicity in this mock:\r\n            setUser(prev => {\r\n                if (!prev) return prev;\r\n                return { ...prev, ...employee } as UserType;\r\n            });\r\n        }\r\n\r\n    }, [router, id]);\r\n\r\n    const handleDeleteDocument = useCallback((docId: string) => {\r\n        setDocs(prev => prev.filter(d => d.id !== docId));\r\n        // In a real app, you'd probably also call an API to delete it from the server\r\n        // and maybe move it to a 'deletedDocs' state if you have a trash feature.\r\n    }, []);\r\n\r\n    const userDocuments = useMemo(() => {\r\n        if (!id) return [];\r\n        return docs.filter(doc => doc.ownerId === id);\r\n    }, [id, docs]);\r\n\r\n    const requestSort = useCallback((key: SortKey) => {\r\n        setSortConfig(currentSortConfig => {\r\n            let direction: SortDirection = 'ascending';\r\n            if (currentSortConfig && currentSortConfig.key === key && currentSortConfig.direction === 'ascending') {\r\n                direction = 'descending';\r\n            }\r\n            return { key, direction };\r\n        });\r\n    }, []);\r\n\r\n    const sortedDocuments = useMemo(() => {\r\n        let sortableItems = [...userDocuments];\r\n        if (sortConfig !== null) {\r\n            sortableItems.sort((a, b) => {\r\n                const aValue = a[sortConfig.key];\r\n                const bValue = b[sortConfig.key];\r\n\r\n                if (aValue < bValue) {\r\n                    return sortConfig.direction === 'ascending' ? -1 : 1;\r\n                }\r\n                if (aValue > bValue) {\r\n                    return sortConfig.direction === 'ascending' ? 1 : -1;\r\n                }\r\n                return 0;\r\n            });\r\n        }\r\n        return sortableItems;\r\n    }, [userDocuments, sortConfig]);\r\n\r\n    if (!user) {\r\n        return (\r\n            <div className=\"flex min-h-screen w-full flex-col bg-muted/40 items-center justify-center\">\r\n                <p>Loading user or user not found...</p>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    const userDetails = [\r\n        { icon: Mail, label: 'Official Email', value: user.email },\r\n        { icon: Mail, label: 'Personal Email', value: user.personalEmail || 'N/A' },\r\n        { icon: Phone, label: 'Mobile', value: user.mobile ? `+91 ${user.mobile}` : 'N/A' },\r\n        { icon: ShieldAlert, label: 'Emergency Contact', value: user.emergencyContact ? `+91 ${user.emergencyContact}` : 'N/A' },\r\n        { icon: Calendar, label: 'Date of Birth', value: user.dateOfBirth ? new Date(user.dateOfBirth).toLocaleDateString() : 'N/A' },\r\n        { icon: Droplet, label: 'Blood Group', value: user.bloodGroup || 'N/A' },\r\n        { icon: Shield, label: 'Role', value: (user.role || 'employee').charAt(0).toUpperCase() + (user.role || 'employee').slice(1) },\r\n        { icon: Briefcase, label: 'Company', value: user.company || 'N/A' },\r\n        { icon: MapPin, label: 'Location', value: user.location || 'N/A' },\r\n        { icon: Building, label: 'Department', value: user.department || 'N/A' },\r\n        { icon: Award, label: 'Designation', value: user.designation || 'N/A' },\r\n        { icon: Briefcase, label: 'Joining Date', value: user.joiningDate ? new Date(user.joiningDate).toLocaleDateString() : 'N/A' },\r\n        { icon: LogOut, label: 'Resignation Date', value: user.resignationDate ? new Date(user.resignationDate).toLocaleDateString() : 'N/A' },\r\n        { icon: User, label: 'Status', value: (user.status || 'active').charAt(0).toUpperCase() + (user.status || 'active').slice(1) },\r\n    ].filter(detail => !(detail.label.includes('Emergency Contact') && detail.value === 'N/A'));\r\n\r\n    const col1Details = userDetails.slice(0, Math.ceil(userDetails.length / 2));\r\n    const col2Details = userDetails.slice(Math.ceil(userDetails.length / 2));\r\n\r\n    const canEdit = !isSadmin || isSelfView || (user?.id === 'sadmin');\r\n\r\n    if (!isMounted) return null;\r\n\r\n\r\n\r\n    return (\r\n        <div className=\"flex min-h-screen w-full flex-col bg-muted/40\">\r\n            <main className=\"flex flex-1 flex-col gap-4 p-4 md:gap-8 md:p-6\">\r\n                <div className=\"flex items-center gap-4\">\r\n                    <Button variant=\"outline\" size=\"icon\" onClick={() => router.back()}>\r\n                        <ArrowLeft className=\"h-4 w-4\" />\r\n                    </Button>\r\n                    <h1 className=\"text-xl font-semibold tracking-tight\">Employee Profile</h1>\r\n                </div>\r\n                <div className=\"grid gap-6\">\r\n                    <div className=\"grid md:grid-cols-3 lg:grid-cols-4 gap-6\">\r\n                        <div className=\"md:col-span-1 lg:col-span-1\">\r\n                            <Card>\r\n                                <CardHeader className=\"flex flex-row items-start justify-between\">\r\n                                    <div className=\"flex flex-col items-center text-center w-full\">\r\n                                        <Image\r\n                                            src={getAvatarSrc(user)}\r\n                                            width={128}\r\n                                            height={128}\r\n                                            className=\"rounded-full mb-4 object-cover\"\r\n                                            alt={user.name ? user.name : 'Profile'}\r\n                                            data-ai-hint=\"person portrait\"\r\n                                        />\r\n                                        <CardTitle className=\"text-2xl\">{user.name}</CardTitle>\r\n                                        <CardDescription>Employee ID: {user.id}</CardDescription>\r\n                                    </div>\r\n\r\n                                </CardHeader>\r\n                                <CardContent className=\"flex flex-col gap-2\">\r\n                                    <IdCardDialog employee={user}>\r\n                                        <Button variant=\"default\" className=\"w-full\">\r\n                                            <BadgeCheck className=\"mr-2 h-4 w-4\" /> ID Card\r\n                                        </Button>\r\n                                    </IdCardDialog>\r\n                                    {canEdit && (\r\n                                        isSadmin ? (\r\n                                            !isUnlocked ? (\r\n                                                <AlertDialog>\r\n                                                    <AlertDialogTrigger asChild>\r\n                                                        <Button variant=\"outline\" className=\"w-full\">\r\n                                                            <Shield className=\"mr-2 h-4 w-4\" /> Unlock to Edit\r\n                                                        </Button>\r\n                                                    </AlertDialogTrigger>\r\n                                                    <AlertDialogContent>\r\n                                                        <AlertDialogHeader>\r\n                                                            <AlertDialogTitle>Security Check</AlertDialogTitle>\r\n                                                            <AlertDialogDescription>\r\n                                                                Please enter the security code to edit the Super Admin profile.\r\n                                                            </AlertDialogDescription>\r\n                                                        </AlertDialogHeader>\r\n                                                        <div className=\"py-4\">\r\n                                                            <Input\r\n                                                                type=\"password\"\r\n                                                                placeholder=\"Enter Security Code\"\r\n                                                                id=\"sadmin-security-code\"\r\n                                                            />\r\n                                                        </div>\r\n                                                        <AlertDialogFooter>\r\n                                                            <AlertDialogCancel>Cancel</AlertDialogCancel>\r\n                                                            <AlertDialogAction onClick={(e) => {\r\n                                                                const input = document.getElementById('sadmin-security-code') as HTMLInputElement;\r\n                                                                if (input.value === '9638777739') {\r\n                                                                    setIsUnlocked(true);\r\n                                                                } else {\r\n                                                                    e.preventDefault();\r\n                                                                    alert('Invalid Security Code');\r\n                                                                }\r\n                                                            }}>\r\n                                                                Verify\r\n                                                            </AlertDialogAction>\r\n                                                        </AlertDialogFooter>\r\n                                                    </AlertDialogContent>\r\n                                                </AlertDialog>\r\n                                            ) : (\r\n                                                <EmployeeSelfEditDialog employee={user} onSave={handleEmployeeSave}>\r\n                                                    <Button variant=\"outline\" className=\"w-full\">\r\n                                                        <Edit className=\"mr-2 h-4 w-4\" /> Edit Profile\r\n                                                    </Button>\r\n                                                </EmployeeSelfEditDialog>\r\n                                            )\r\n                                        ) : isSelfView ? (\r\n                                            <EmployeeSelfEditDialog employee={user} onSave={handleEmployeeSave}>\r\n                                                <Button variant=\"outline\" className=\"w-full\">\r\n                                                    <Edit className=\"mr-2 h-4 w-4\" /> Edit Profile\r\n                                                </Button>\r\n                                            </EmployeeSelfEditDialog>\r\n                                        ) : (\r\n                                            <EmployeeManagementDialog employee={user} onSave={handleEmployeeSave} departments={departments} companies={companies}>\r\n                                                <Button variant=\"outline\" className=\"w-full\">\r\n                                                    <Edit className=\"mr-2 h-4 w-4\" /> Edit Profile\r\n                                                </Button>\r\n                                            </EmployeeManagementDialog>\r\n                                        )\r\n                                    )}\r\n                                </CardContent>\r\n                            </Card>\r\n                        </div>\r\n\r\n                        <div className=\"md:col-span-2 lg:col-span-3\">\r\n                            <Card>\r\n                                <CardHeader>\r\n                                    <CardTitle>Personal & Employment Details</CardTitle>\r\n                                    <CardDescription>All information related to {user.name}.</CardDescription>\r\n                                </CardHeader>\r\n                                <CardContent>\r\n                                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-6\">\r\n                                        <div>\r\n                                            <ul className=\"space-y-4 text-sm text-muted-foreground\">\r\n                                                {col1Details.map((detail, index) => (\r\n                                                    <li key={index} className=\"flex items-start gap-4\">\r\n                                                        <detail.icon className=\"h-5 w-5 text-primary mt-1 flex-shrink-0\" />\r\n                                                        <div className=\"flex-1\">\r\n                                                            <p className=\"font-medium text-foreground\">{detail.label}</p>\r\n                                                            <p className={cn(\r\n                                                                'break-words',\r\n                                                                detail.label === 'Status' && (\r\n                                                                    detail.value === 'Active' ? 'text-green-600' :\r\n                                                                        detail.value === 'Inactive' ? 'text-red-600' :\r\n                                                                            'text-yellow-600'\r\n                                                                ),\r\n                                                                detail.label === 'Role' && (\r\n                                                                    detail.value === 'Admin' ? 'text-blue-600' : 'text-gray-600'\r\n                                                                )\r\n                                                            )}>{detail.value}</p>\r\n                                                        </div>\r\n                                                    </li>\r\n                                                ))}\r\n                                            </ul>\r\n                                        </div>\r\n                                        <div>\r\n                                            <ul className=\"space-y-4 text-sm text-muted-foreground\">\r\n                                                {col2Details.map((detail, index) => (\r\n                                                    <li key={index} className=\"flex items-start gap-4\">\r\n                                                        <detail.icon className=\"h-5 w-5 text-primary mt-1 flex-shrink-0\" />\r\n                                                        <div className=\"flex-1\">\r\n                                                            <p className=\"font-medium text-foreground\">{detail.label}</p>\r\n                                                            <p className={cn(\r\n                                                                'break-words',\r\n                                                                detail.label === 'Status' && (\r\n                                                                    detail.value === 'Active' ? 'text-green-600' :\r\n                                                                        detail.value === 'Inactive' ? 'text-red-600' :\r\n                                                                            'text-yellow-600'\r\n                                                                ),\r\n                                                                detail.label === 'Role' && (\r\n                                                                    detail.value === 'Admin' ? 'text-blue-600' : 'text-gray-600'\r\n                                                                )\r\n                                                            )}>{detail.value}</p>\r\n                                                        </div>\r\n                                                    </li>\r\n                                                ))}\r\n                                            </ul>\r\n                                        </div>\r\n                                    </div>\r\n                                </CardContent>\r\n                            </Card>\r\n                        </div>\r\n                    </div>\r\n                    {!isSelfView && (\r\n                        <Card>\r\n                            <CardHeader>\r\n                                <CardTitle>Documents</CardTitle>\r\n                                <CardDescription>All documents uploaded for {user.name}.</CardDescription>\r\n                            </CardHeader>\r\n                            <CardContent>\r\n                                <DocumentList documents={sortedDocuments} users={initialUsers} onSort={requestSort} sortConfig={sortConfig} onDelete={handleDeleteDocument} />\r\n                            </CardContent>\r\n                        </Card>\r\n                    )}\r\n                </div>\r\n            </main>\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\FileSafe\\studio\\src\\app\\dashboard\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Metadata' is defined but never used.","line":4,"column":15,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":23}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\r\n'use client';\r\n\r\nimport type { Metadata } from 'next'\r\nimport { AdminView } from '@/app/dashboard/admin-view'\r\nimport { EmployeeView } from '@/components/dashboard/employee-view'\r\nimport { Suspense } from 'react'\r\nimport { Skeleton } from '@/components/ui/skeleton'\r\nimport { Card, CardContent, CardHeader } from '@/components/ui/card'\r\nimport { useSearchParams } from 'next/navigation';\r\n\r\nfunction DashboardContent({ role }: { role: string | null }) {\r\n  if (role === 'admin') {\r\n    return <AdminView />\r\n  }\r\n  return <EmployeeView />\r\n}\r\n\r\nfunction DashboardSkeleton() {\r\n    return (\r\n        <div className=\"space-y-8\">\r\n            <div className=\"flex items-center justify-between\">\r\n                <div className=\"space-y-2\">\r\n                    <Skeleton className=\"h-8 w-64\" />\r\n                    <Skeleton className=\"h-4 w-96\" />\r\n                </div>\r\n                <Skeleton className=\"h-10 w-36\" />\r\n            </div>\r\n            <Card>\r\n                <CardHeader>\r\n                    <Skeleton className=\"h-6 w-48\" />\r\n                    <Skeleton className=\"h-4 w-80\" />\r\n                </CardHeader>\r\n                <CardContent>\r\n                    <Skeleton className=\"h-40 w-full\" />\r\n                </CardContent>\r\n            </Card>\r\n        </div>\r\n    )\r\n}\r\n\r\nfunction DashboardPageContent() {\r\n  const searchParams = useSearchParams();\r\n  const role = searchParams.get('role');\r\n\r\n  return (\r\n    <main className=\"flex flex-1 flex-col gap-4 p-4 md:gap-8 md:p-6\">\r\n      <Suspense fallback={<DashboardSkeleton />}>\r\n        <DashboardContent role={role} />\r\n      </Suspense>\r\n    </main>\r\n  );\r\n}\r\n\r\n\r\nexport default function DashboardPage() {\r\n    return (\r\n        <Suspense fallback={<DashboardSkeleton />}>\r\n            <DashboardPageContent />\r\n        </Suspense>\r\n    )\r\n}\r\n\r\n    ","usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\FileSafe\\studio\\src\\app\\layout.tsx","messages":[{"ruleId":"@next/next/no-page-custom-font","severity":1,"message":"Custom fonts not added in `pages/_document.js` will only load for a single page. This is discouraged. See: https://nextjs.org/docs/messages/no-page-custom-font","line":25,"column":9,"nodeType":"JSXOpeningElement","endLine":25,"endColumn":122}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\r\nimport type { Metadata } from 'next';\r\nimport './globals.css';\r\nimport { Toaster } from \"@/components/ui/toaster\"\r\nimport { ThemeProvider } from '@/components/theme-provider';\r\nimport { CompanyName } from '@/lib/mock-data';\r\nimport './print.css';\r\nimport { SessionProvider } from '@/components/session-provider';\r\n\r\nexport const metadata: Metadata = {\r\n  title: CompanyName,\r\n  description: 'Your secure internal document repository.',\r\n};\r\n\r\nexport default function RootLayout({\r\n  children,\r\n}: Readonly<{\r\n  children: React.ReactNode;\r\n}>) {\r\n  return (\r\n    <html lang=\"en\" suppressHydrationWarning>\r\n      <head>\r\n        <link rel=\"preconnect\" href=\"https://fonts.googleapis.com\" />\r\n        <link rel=\"preconnect\" href=\"https://fonts.gstatic.com\" crossOrigin=\"anonymous\" />\r\n        <link href=\"https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap\" rel=\"stylesheet\" />\r\n      </head>\r\n      <body className=\"font-body antialiased\" suppressHydrationWarning>\r\n        <SessionProvider>\r\n          <ThemeProvider\r\n            attribute=\"class\"\r\n            defaultTheme=\"system\"\r\n            enableSystem\r\n            disableTransitionOnChange\r\n          >\r\n            {children}\r\n            <Toaster />\r\n          </ThemeProvider>\r\n        </SessionProvider>\r\n      </body>\r\n    </html>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\FileSafe\\studio\\src\\components\\dashboard\\admin-view.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Settings' is defined but never used.","line":14,"column":109,"nodeType":null,"messageId":"unusedVar","endLine":14,"endColumn":117},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"The 'filteredUsersForSelection' conditional could make the dependencies of useCallback Hook (at line 819) change on every render. To fix this, wrap the initialization of 'filteredUsersForSelection' in its own useMemo() Hook.","line":811,"column":11,"nodeType":"VariableDeclarator","endLine":811,"endColumn":130},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'getUserFromId' is assigned a value but never used.","line":954,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":954,"endColumn":24},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1055,"column":105,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1055,"endColumn":108,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[48546,48549],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[48546,48549],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":1085,"column":67,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[50310,50326],"text":"Employees with &quot;"},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[50310,50326],"text":"Employees with &ldquo;"},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[50310,50326],"text":"Employees with &#34;"},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[50310,50326],"text":"Employees with &rdquo;"},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":1085,"column":91,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[50349,50350],"text":"&quot;"},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[50349,50350],"text":"&ldquo;"},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[50349,50350],"text":"&#34;"},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[50349,50350],"text":"&rdquo;"},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1405,"column":135,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1405,"endColumn":138,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[75966,75969],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[75966,75969],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\r\n'use client'\r\nimport { useState, useCallback, useMemo, useEffect } from 'react'\r\nimport { useRouter } from 'next/navigation'\r\nimport {\r\n    Card,\r\n    CardContent,\r\n    CardDescription,\r\n    CardHeader,\r\n    CardTitle,\r\n} from '@/components/ui/card'\r\nimport { Input } from '@/components/ui/input'\r\nimport { users as initialUsers, documents as allDocuments, documentTypesList, User, Document, departments as initialDepartments, holidays as initialHolidays, Holiday, HolidayLocation, holidayLocations, announcements as initialAnnouncements, Announcement, CompanyName, companies as initialCompanies, Company } from '@/lib/mock-data'\r\nimport { Search, MoreVertical, Edit, Trash2, KeyRound, Undo, FolderPlus, Tag, Building, CalendarPlus, Bell, Settings, UploadCloud, X, FileLock2, Users, Upload, Download, ArchiveRestore, Folder, Save, Eye, Home, Trash, ArrowLeft, Shield } from 'lucide-react'\r\nimport {\r\n    Tabs,\r\n    TabsContent,\r\n    TabsList,\r\n    TabsTrigger,\r\n} from \"@/components/ui/tabs\"\r\nimport Image from 'next/image'\r\nimport { BulkUploadDialog } from '@/components/dashboard/bulk-upload-dialog'\r\nimport { Button } from '@/components/ui/button'\r\nimport { EmployeeManagementDialog } from '@/components/dashboard/employee-management-dialog'\r\nimport { DeleteEmployeeDialog } from '@/components/dashboard/delete-employee-dialog'\r\nimport {\r\n    DropdownMenu,\r\n    DropdownMenuContent,\r\n    DropdownMenuItem,\r\n    DropdownMenuSeparator,\r\n    DropdownMenuTrigger,\r\n} from '@/components/ui/dropdown-menu'\r\nimport {\r\n    Table,\r\n    TableBody,\r\n    TableCell,\r\n    TableHead,\r\n    TableHeader,\r\n    TableRow,\r\n} from '@/components/ui/table'\r\nimport { Checkbox } from '@/components/ui/checkbox'\r\nimport { useToast } from '@/hooks/use-toast'\r\nimport {\r\n    AlertDialog,\r\n    AlertDialogAction,\r\n    AlertDialogCancel,\r\n    AlertDialogContent,\r\n    AlertDialogDescription,\r\n    AlertDialogFooter,\r\n    AlertDialogHeader,\r\n    AlertDialogTitle,\r\n} from '@/components/ui/alert-dialog';\r\nimport { cn, getAvatarSrc } from '@/lib/utils'\r\nimport { AddDocumentTypeDialog } from '@/components/dashboard/add-document-type-dialog'\r\nimport { AddDepartmentDialog } from '@/components/dashboard/add-department-dialog'\r\nimport { DeleteDepartmentDialog } from '@/components/dashboard/delete-department-dialog'\r\nimport { AddHolidayDialog } from '@/components/dashboard/add-holiday-dialog'\r\nimport { AddAnnouncementDialog } from '@/components/dashboard/add-announcement-dialog'\r\nimport { DeleteAnnouncementDialog } from '@/components/dashboard/delete-announcement-dialog'\r\nimport { Label } from '@/components/ui/label'\r\nimport {\r\n    Select,\r\n    SelectContent,\r\n    SelectItem,\r\n    SelectTrigger,\r\n    SelectValue,\r\n} from '@/components/ui/select';\r\nimport { BulkRoleChangeDialog } from '@/components/dashboard/bulk-role-change-dialog'\r\nimport { BulkUserImportDialog } from '@/components/dashboard/bulk-user-import-dialog'\r\nimport Papa from 'papaparse'\r\nimport { DocumentList } from '@/components/dashboard/document-list'\r\nimport { CompanyManagementDialog } from '@/components/dashboard/company-management-dialog'\r\nimport { DeleteCompanyDialog } from '@/components/dashboard/delete-company-dialog'\r\nimport { PermanentDeleteDialog } from '@/components/dashboard/permanent-delete-dialog'\r\nimport { EditDocumentTypeDialog } from '@/components/dashboard/edit-document-type-dialog'\r\nimport { DeleteDocumentTypeDialog } from '@/components/dashboard/delete-document-type-dialog'\r\nimport { ToastAction } from '@/components/ui/toast'\r\nimport { IntegrationsSettings } from '@/components/dashboard/integrations-settings'\r\n\r\ntype ExplorerState = { view: 'docTypes' } | { view: 'usersInDocType', docType: string }\r\n\r\nexport function AdminView() {\r\n    const [docs, setDocs] = useState(allDocuments)\r\n    const [deletedDocs, setDeletedDocs] = useState<Document[]>([]);\r\n    const [users, setUsers] = useState<User[]>(initialUsers)\r\n    const [documentTypes, setDocumentTypes] = useState(documentTypesList);\r\n    const [deletedDocumentTypes, setDeletedDocumentTypes] = useState<string[]>([]);\r\n    const [departments, setDepartments] = useState(initialDepartments);\r\n    const [deletedDepartments, setDeletedDepartments] = useState<string[]>([]);\r\n    const [companies, setCompanies] = useState(initialCompanies);\r\n    const [deletedCompanies, setDeletedCompanies] = useState<Company[]>([]);\r\n    const [holidays, setHolidays] = useState(initialHolidays);\r\n    const [announcements, setAnnouncements] = useState(initialAnnouncements.map(a => ({ ...a, isRead: true, status: a.status || 'published' }))); // Admins see all as read initially\r\n    const [searchTerm, setSearchTerm] = useState('')\r\n    const [selectedUserIds, setSelectedUserIds] = useState<string[]>([])\r\n    const [isBulkDeleteDialogOpen, setIsBulkDeleteDialogOpen] = useState(false)\r\n    const [isBulkResetDialogOpen, setIsBulkResetDialogOpen] = useState(false)\r\n    const [lastBulkUploadInfo, setLastBulkUploadInfo] = useState<{ ids: string[], timestamp: number } | null>(null);\r\n    const [isUndoDialogOpen, setIsUndoDialogOpen] = useState(false);\r\n    const [activeTab, setActiveTab] = useState('file-explorer');\r\n    const [activeSubTab, setActiveSubTab] = useState('overview');\r\n    const [departmentFilter, setDepartmentFilter] = useState<string>('all');\r\n    const [roleFilter, setRoleFilter] = useState<'all' | 'admin' | 'employee'>('all');\r\n    const [holidayLocationFilter, setHolidayLocationFilter] = useState<HolidayLocation | 'all'>('all');\r\n    const [logoSrc, setLogoSrc] = useState<string | null>(null);\r\n    const [siteName, setSiteName] = useState(CompanyName);\r\n    const [tempSiteName, setTempSiteName] = useState(CompanyName);\r\n    const [explorerState, setExplorerState] = useState<ExplorerState>({ view: 'docTypes' });\r\n    const [allowedDomains, setAllowedDomains] = useState<string[]>([]);\r\n    const [newDomain, setNewDomain] = useState('');\r\n    const { toast } = useToast();\r\n    const router = useRouter();\r\n\r\n\r\n    useEffect(() => {\r\n        // Fetch users from the API endpoint\r\n        const fetchUsers = async () => {\r\n            try {\r\n                const response = await fetch('/api/users');\r\n                if (!response.ok) {\r\n                    throw new Error('Failed to fetch users');\r\n                }\r\n                const data = await response.json();\r\n                setUsers(data);\r\n            } catch (error) {\r\n                console.error(error);\r\n                toast({\r\n                    variant: 'destructive',\r\n                    title: 'Failed to Load Users',\r\n                    description: 'Could not fetch user data from the database. Falling back to mock data.',\r\n                });\r\n                setUsers(initialUsers); // Fallback to mock data on error\r\n            }\r\n        };\r\n\r\n        fetchUsers();\r\n\r\n        const handleViewAnnouncements = () => {\r\n            setActiveTab('announcements');\r\n        };\r\n        window.addEventListener('view-announcements', handleViewAnnouncements);\r\n\r\n        const storedLogo = localStorage.getItem('companyLogo');\r\n        if (storedLogo) setLogoSrc(storedLogo);\r\n\r\n        const storedSiteName = localStorage.getItem('siteName');\r\n        if (storedSiteName) {\r\n            setSiteName(storedSiteName);\r\n            setTempSiteName(storedSiteName);\r\n        }\r\n\r\n        const storedDomains = localStorage.getItem('allowedDomains');\r\n        if (storedDomains) {\r\n            setAllowedDomains(JSON.parse(storedDomains));\r\n        } else {\r\n            // Fallback for initial setup\r\n            setAllowedDomains(['yourdomain.com']);\r\n        }\r\n\r\n        return () => {\r\n            window.removeEventListener('view-announcements', handleViewAnnouncements);\r\n        };\r\n    }, [toast]);\r\n\r\n    const handleLogoChange = (event: React.ChangeEvent<HTMLInputElement>) => {\r\n        if (event.target.files && event.target.files[0]) {\r\n            const file = event.target.files[0];\r\n            const reader = new FileReader();\r\n            reader.onload = (e) => {\r\n                const newLogo = e.target?.result as string;\r\n                setLogoSrc(newLogo);\r\n                localStorage.setItem('companyLogo', newLogo);\r\n                toast({\r\n                    title: 'Logo Updated',\r\n                    description: 'The company logo has been changed successfully.',\r\n                });\r\n            };\r\n            reader.readAsDataURL(file);\r\n        }\r\n    };\r\n\r\n    const handleResetLogo = () => {\r\n        setLogoSrc(null);\r\n        localStorage.removeItem('companyLogo');\r\n        toast({\r\n            title: 'Logo Reset',\r\n            description: 'The company logo has been reset to the default.',\r\n        });\r\n    };\r\n\r\n    const handleSiteNameSave = () => {\r\n        setSiteName(tempSiteName);\r\n        localStorage.setItem('siteName', tempSiteName);\r\n        window.dispatchEvent(new Event('storage')); // Notify other tabs/components\r\n        toast({\r\n            title: 'Site Name Updated',\r\n            description: 'The site name has been changed successfully.',\r\n        });\r\n    };\r\n\r\n    const handleAddDomain = () => {\r\n        if (newDomain && !allowedDomains.includes(newDomain)) {\r\n            const newDomains = [...allowedDomains, newDomain];\r\n            setAllowedDomains(newDomains);\r\n            localStorage.setItem('allowedDomains', JSON.stringify(newDomains));\r\n            setNewDomain('');\r\n            toast({ title: 'Domain Added', description: `Domain \"${newDomain}\" has been added.` });\r\n        } else {\r\n            toast({ variant: 'destructive', title: 'Invalid Domain', description: 'Domain is either empty or already exists.' });\r\n        }\r\n    };\r\n\r\n    const handleRemoveDomain = (domainToRemove: string) => {\r\n        const newDomains = allowedDomains.filter(d => d !== domainToRemove);\r\n        setAllowedDomains(newDomains);\r\n        localStorage.setItem('allowedDomains', JSON.stringify(newDomains));\r\n        toast({ title: 'Domain Removed', description: `Domain \"${domainToRemove}\" has been removed.` });\r\n    };\r\n\r\n    const handleUndoLastBulkUpload = () => {\r\n        if (lastBulkUploadInfo && lastBulkUploadInfo.ids.length > 0) {\r\n            setDocs(prev => prev.filter(d => !lastBulkUploadInfo.ids.includes(d.id)));\r\n            toast({\r\n                title: 'Upload Undone',\r\n                description: `${lastBulkUploadInfo.ids.length} document(s) have been removed.`,\r\n            });\r\n            setLastBulkUploadInfo(null);\r\n        }\r\n        setIsUndoDialogOpen(false);\r\n    };\r\n\r\n    const handleBulkUploadComplete = useCallback((newDocs: Omit<Document, 'id' | 'size' | 'uploadDate' | 'fileType'>[], originalFiles: File[]) => {\r\n        const docIds: string[] = [];\r\n        const fullNewDocs: Document[] = newDocs.map((d, i) => {\r\n            const id = `doc-${Date.now()}-${i}`;\r\n            docIds.push(id);\r\n            return {\r\n                ...d,\r\n                id: id,\r\n                size: `${(originalFiles[i].size / 1024).toFixed(0)} KB`,\r\n                uploadDate: new Date().toISOString().split('T')[0],\r\n                fileType: d.name.endsWith('.pdf') ? 'pdf' : d.name.endsWith('.doc') || d.name.endsWith('.docx') ? 'doc' : 'image',\r\n            };\r\n        });\r\n        setDocs(prev => [...fullNewDocs, ...prev]);\r\n        setLastBulkUploadInfo({ ids: docIds, timestamp: Date.now() });\r\n\r\n        toast({\r\n            title: 'Upload Successful!',\r\n            description: `${newDocs.length} documents have been added.`,\r\n            action: (\r\n                <ToastAction altText=\"Undo\" onClick={() => setIsUndoDialogOpen(true)}>\r\n                    Undo\r\n                </ToastAction>\r\n            ),\r\n        });\r\n\r\n    }, [toast]);\r\n\r\n    const handleEmployeeSave = useCallback((employee: Partial<User> & { originalId?: string }) => {\r\n        const isSadmin = employee.originalId === 'sadmin' || employee.id === 'sadmin';\r\n\r\n        if (isSadmin && (employee.id !== 'sadmin' || employee.email !== 'sadmin@internal.local' || employee.role !== 'admin')) {\r\n            toast({\r\n                variant: 'destructive',\r\n                title: 'Permission Denied',\r\n                description: 'You cannot modify the Super Admin ID, email, or role.',\r\n            });\r\n            return;\r\n        }\r\n\r\n        setUsers(prevUsers => {\r\n            const userIndex = prevUsers.findIndex(u => u.id === (employee.originalId || employee.id));\r\n            if (userIndex > -1) {\r\n                // Update existing user\r\n                const updatedUsers = [...prevUsers];\r\n                const existingUser = updatedUsers[userIndex];\r\n                const updatedUser = {\r\n                    ...existingUser,\r\n                    ...employee,\r\n                };\r\n                updatedUsers[userIndex] = updatedUser as User;\r\n\r\n                if (updatedUser.id === 'user-1' && employee.originalId === 'user-1') {\r\n                    toast({\r\n                        title: \"Profile Updated\",\r\n                        description: `Your profile has been successfully updated.`,\r\n                    });\r\n                } else if ('id' in employee && employee.id !== employee.originalId) {\r\n                    toast({\r\n                        title: \"Profile Updated\",\r\n                        description: `An email notification has been sent to the admins regarding the update of ${updatedUser.name}'s profile.`,\r\n                    });\r\n                } else if (isSadmin) {\r\n                    toast({\r\n                        title: 'Super Admin Updated',\r\n                        description: 'Super Admin profile has been updated.',\r\n                    });\r\n                }\r\n                return updatedUsers;\r\n            } else {\r\n                // Add new user\r\n                const newUser: User = {\r\n                    id: employee.id || `user-${Date.now()}`,\r\n                    name: employee.name || 'New User',\r\n                    email: employee.email || 'new@user.com',\r\n                    personalEmail: employee.personalEmail,\r\n                    avatar: employee.avatar || String(Date.now()),\r\n                    mobile: employee.mobile,\r\n                    // password: employee.password, // Password is not stored in state\r\n                    dateOfBirth: employee.dateOfBirth,\r\n                    joiningDate: employee.joiningDate,\r\n                    resignationDate: employee.resignationDate,\r\n                    designation: employee.designation,\r\n                    status: employee.status || 'pending',\r\n                    department: employee.department,\r\n                    role: employee.role || 'employee',\r\n                };\r\n                return [...prevUsers, newUser];\r\n            }\r\n        });\r\n    }, [toast]);\r\n\r\n    const handleBulkUserImport = useCallback((newUsers: User[]) => {\r\n        setUsers(prevUsers => {\r\n            const existingIds = new Set(prevUsers.map(u => u.id));\r\n            const nonDuplicateUsers = newUsers.filter(u => !existingIds.has(u.id));\r\n            const duplicateCount = newUsers.length - nonDuplicateUsers.length;\r\n\r\n            toast({\r\n                title: 'Import Complete',\r\n                description: `${nonDuplicateUsers.length} user(s) imported successfully. ${duplicateCount > 0 ? `${duplicateCount} duplicate(s) were skipped.` : ''}`,\r\n            });\r\n\r\n            return [...prevUsers, ...nonDuplicateUsers];\r\n        });\r\n    }, [toast]);\r\n\r\n    const handleExportUsers = () => {\r\n        const usersToExport = numSelected > 0 ? users.filter(u => selectedUserIds.includes(u.id)) : users;\r\n\r\n        if (usersToExport.length === 0) {\r\n            toast({\r\n                variant: 'destructive',\r\n                title: 'No Users to Export',\r\n                description: 'There are no users to export.',\r\n            });\r\n            return;\r\n        }\r\n\r\n        // We only export a subset of fields for simplicity, can be expanded\r\n        const dataToExport = usersToExport.map(user => ({\r\n            id: user.id,\r\n            name: user.name,\r\n            email: user.email,\r\n            personalEmail: user.personalEmail,\r\n            mobile: user.mobile,\r\n            dateOfBirth: user.dateOfBirth,\r\n            joiningDate: user.joiningDate,\r\n            resignationDate: user.resignationDate,\r\n            designation: user.designation,\r\n            status: user.status,\r\n            department: user.department,\r\n            bloodGroup: user.bloodGroup,\r\n            company: user.company,\r\n            location: user.location,\r\n            role: user.role,\r\n            // We don't export password for security reasons\r\n        }));\r\n\r\n        const csv = Papa.unparse(dataToExport);\r\n        const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });\r\n        const link = document.createElement('a');\r\n        const url = URL.createObjectURL(blob);\r\n        link.setAttribute('href', url);\r\n        link.setAttribute('download', `users_export_${new Date().toISOString().split('T')[0]}.csv`);\r\n        document.body.appendChild(link);\r\n        link.click();\r\n        document.body.removeChild(link);\r\n\r\n        toast({\r\n            title: 'Export Started',\r\n            description: `Exporting ${usersToExport.length} user(s).`,\r\n        });\r\n    };\r\n\r\n\r\n    const handleEmployeeDelete = useCallback((employeeId: string) => {\r\n        if (employeeId === 'sadmin') {\r\n            toast({ variant: 'destructive', title: 'Action Forbidden', description: 'The Super Admin account cannot be deleted.' });\r\n            return;\r\n        }\r\n        setUsers(prevUsers => prevUsers.map(u =>\r\n            u.id === employeeId ? { ...u, status: 'deleted' } : u\r\n        ));\r\n        setSelectedUserIds(prev => prev.filter(id => id !== employeeId));\r\n        toast({\r\n            title: \"Employee Deleted\",\r\n            description: `The employee has been moved to the deleted users list.`\r\n        });\r\n    }, [toast]);\r\n\r\n    const handleRestoreUser = useCallback((employeeId: string) => {\r\n        setUsers(prevUsers => prevUsers.map(u =>\r\n            u.id === employeeId ? { ...u, status: 'active' } : u\r\n        ));\r\n        toast({\r\n            title: \"Employee Restored\",\r\n            description: `The employee has been restored to the active list.`\r\n        });\r\n    }, [toast]);\r\n\r\n    const handlePermanentDeleteUser = useCallback((employeeId: string) => {\r\n        if (employeeId === 'sadmin') {\r\n            toast({ variant: 'destructive', title: 'Action Forbidden', description: 'The Super Admin account cannot be permanently deleted.' });\r\n            return;\r\n        }\r\n        setUsers(prevUsers => prevUsers.filter(u => u.id !== employeeId));\r\n        toast({\r\n            variant: 'destructive',\r\n            title: 'User Permanently Deleted',\r\n            description: 'The user has been permanently removed from the system.',\r\n        });\r\n    }, [toast]);\r\n\r\n    const handleResetPassword = useCallback((employeeId: string) => {\r\n        if (employeeId === 'sadmin') {\r\n            toast({ variant: 'destructive', title: 'Action Forbidden', description: 'Password for the Super Admin must be changed via the edit profile screen.' });\r\n            return;\r\n        }\r\n        const user = users.find(u => u.id === employeeId);\r\n        if (user && user.email) {\r\n            toast({\r\n                title: \"Password Reset Link Sent\",\r\n                description: `An email has been sent to ${user.name} with password reset instructions.`\r\n            });\r\n        }\r\n    }, [toast, users]);\r\n\r\n    const handleAddDocumentType = useCallback((newType: string) => {\r\n        setDocumentTypes(prev => {\r\n            if (!prev.find(dt => dt.toLowerCase() === newType.toLowerCase())) {\r\n                toast({\r\n                    title: 'Document Type Added',\r\n                    description: `\"${newType.trim()}\" has been added to the list of document types.`,\r\n                });\r\n                return [...prev, newType];\r\n            } else {\r\n                toast({\r\n                    variant: 'destructive',\r\n                    title: 'Duplicate Type',\r\n                    description: `\"${newType.trim()}\" already exists.`,\r\n                });\r\n                return prev;\r\n            }\r\n        });\r\n    }, [toast]);\r\n\r\n    const handleEditDocumentType = useCallback((oldType: string, newType: string) => {\r\n        if (oldType.toLowerCase() === newType.toLowerCase()) return;\r\n\r\n        if (documentTypes.find(dt => dt.toLowerCase() === newType.toLowerCase())) {\r\n            toast({\r\n                variant: 'destructive',\r\n                title: 'Duplicate Type',\r\n                description: `\"${newType.trim()}\" already exists.`,\r\n            });\r\n            return;\r\n        }\r\n\r\n        setDocumentTypes(prev => prev.map(dt => dt === oldType ? newType : dt));\r\n        setDocs(prevDocs => prevDocs.map(doc => doc.type === oldType ? { ...doc, type: newType } : doc));\r\n        toast({\r\n            title: 'Document Type Updated',\r\n            description: `\"${oldType}\" has been renamed to \"${newType}\" and all associated documents have been updated.`,\r\n        });\r\n    }, [documentTypes, toast]);\r\n\r\n\r\n    const handleDeleteDocumentType = useCallback((typeToDelete: string) => {\r\n        const isTypeInUse = docs.some(d => d.type === typeToDelete);\r\n        if (isTypeInUse) {\r\n            toast({\r\n                variant: 'destructive',\r\n                title: 'Cannot Delete Document Type',\r\n                description: `\"${typeToDelete}\" is currently in use by one or more documents. Please re-assign them before deleting.`,\r\n            });\r\n            return;\r\n        }\r\n        setDocumentTypes(prev => prev.filter(dt => dt !== typeToDelete));\r\n        setDeletedDocumentTypes(prev => [...prev, typeToDelete]);\r\n        toast({\r\n            title: 'Document Type Deleted',\r\n            description: `\"${typeToDelete}\" has been moved to the deleted items list.`,\r\n        });\r\n    }, [docs, toast]);\r\n\r\n    const handleRestoreDocumentType = useCallback((typeToRestore: string) => {\r\n        setDeletedDocumentTypes(prev => prev.filter(d => d !== typeToRestore));\r\n        setDocumentTypes(prev => [...prev, typeToRestore]);\r\n        toast({\r\n            title: 'Document Type Restored',\r\n            description: `\"${typeToRestore}\" has been restored.`,\r\n        });\r\n    }, [toast]);\r\n\r\n    const handlePermanentDeleteDocumentType = useCallback((typeToDelete: string) => {\r\n        setDeletedDocumentTypes(prev => prev.filter(d => d !== typeToDelete));\r\n        toast({\r\n            variant: 'destructive',\r\n            title: 'Document Type Permanently Deleted',\r\n            description: `\"${typeToDelete}\" has been permanently removed.`,\r\n        });\r\n    }, [toast]);\r\n\r\n    const handleAddDepartment = useCallback((newDepartment: string) => {\r\n        setDepartments(prev => {\r\n            if (!prev.find(d => d.toLowerCase() === newDepartment.toLowerCase())) {\r\n                toast({\r\n                    title: 'Department Added',\r\n                    description: `\"${newDepartment.trim()}\" has been added to the list of departments.`,\r\n                });\r\n                return [...prev, newDepartment];\r\n            } else {\r\n                toast({\r\n                    variant: 'destructive',\r\n                    title: 'Duplicate Department',\r\n                    description: `\"${newDepartment.trim()}\" already exists.`,\r\n                });\r\n                return prev;\r\n            }\r\n        });\r\n    }, [toast]);\r\n\r\n    const handleDeleteDepartment = useCallback((departmentToDelete: string) => {\r\n        setDepartments(prev => prev.filter(d => d !== departmentToDelete));\r\n        setDeletedDepartments(prev => [...prev, departmentToDelete]);\r\n        toast({\r\n            title: 'Department Deleted',\r\n            description: `\"${departmentToDelete}\" has been moved to the deleted items list.`,\r\n        });\r\n    }, [toast]);\r\n\r\n    const handleRestoreDepartment = useCallback((departmentToRestore: string) => {\r\n        setDeletedDepartments(prev => prev.filter(d => d !== departmentToRestore));\r\n        setDepartments(prev => [...prev, departmentToRestore]);\r\n        toast({\r\n            title: 'Department Restored',\r\n            description: `\"${departmentToRestore}\" has been restored.`,\r\n        });\r\n    }, [toast]);\r\n\r\n    const handlePermanentDeleteDepartment = useCallback((departmentToDelete: string) => {\r\n        const isDeptInUse = users.some(u => u.department === departmentToDelete);\r\n        if (isDeptInUse) {\r\n            toast({\r\n                variant: 'destructive',\r\n                title: 'Cannot Delete Department',\r\n                description: `\"${departmentToDelete}\" is currently assigned to one or more employees. Please reassign them before permanently deleting.`,\r\n            });\r\n            return;\r\n        }\r\n        setDeletedDepartments(prev => prev.filter(d => d !== departmentToDelete));\r\n        toast({\r\n            variant: 'destructive',\r\n            title: 'Department Permanently Deleted',\r\n            description: `\"${departmentToDelete}\" has been permanently removed.`,\r\n        });\r\n    }, [toast, users]);\r\n\r\n\r\n    const handleAddHoliday = useCallback((newHoliday: { name: string, date: Date, location: HolidayLocation }) => {\r\n        const newHolidayItem: Holiday = {\r\n            id: `h-${Date.now()}`,\r\n            name: newHoliday.name,\r\n            date: newHoliday.date.toISOString().split('T')[0],\r\n            location: newHoliday.location,\r\n        };\r\n        setHolidays(prev => [...prev, newHolidayItem].sort((a, b) => new Date(a.date).getTime() - new Date(b.date).getTime()));\r\n        toast({\r\n            title: 'Holiday Added',\r\n            description: `\"${newHoliday.name}\" has been added to the holiday list.`,\r\n        });\r\n    }, [toast]);\r\n\r\n    const handleDeleteHoliday = useCallback((holidayId: string) => {\r\n        setHolidays(prev => prev.filter(h => h.id !== holidayId));\r\n        toast({\r\n            title: 'Holiday Deleted',\r\n            description: 'The holiday has been removed from the list.',\r\n        });\r\n    }, [toast]);\r\n\r\n    const handleAddAnnouncement = useCallback((announcement: { title: string, message: string, eventDate?: string }) => {\r\n        const newAnnouncement: Announcement = {\r\n            id: `anno-${Date.now()}`,\r\n            title: announcement.title,\r\n            message: announcement.message,\r\n            date: new Date().toISOString(),\r\n            author: 'Admin',\r\n            isRead: true, // New announcements by admin are 'read' for them\r\n            status: 'published',\r\n            eventDate: announcement.eventDate\r\n        };\r\n        setAnnouncements(prev => [newAnnouncement, ...prev]);\r\n        toast({\r\n            title: 'Announcement Published',\r\n            description: 'A notification has been sent to all employees.',\r\n        });\r\n    }, [toast]);\r\n\r\n    const handleDeleteAnnouncement = useCallback((announcementId: string) => {\r\n        setAnnouncements(prev => prev.map(a => a.id === announcementId ? { ...a, status: 'deleted' } : a));\r\n        toast({\r\n            title: 'Announcement Deleted',\r\n            description: 'The announcement has been moved to the deleted list.',\r\n        });\r\n    }, [toast]);\r\n\r\n    const handleRestoreAnnouncement = useCallback((announcementId: string) => {\r\n        setAnnouncements(prev => prev.map(a => a.id === announcementId ? { ...a, status: 'published' } : a));\r\n        toast({\r\n            title: 'Announcement Restored',\r\n            description: 'The announcement has been restored and is now visible to employees.',\r\n        });\r\n    }, [toast]);\r\n\r\n    const handlePermanentDeleteAnnouncement = useCallback((announcementId: string) => {\r\n        setAnnouncements(prev => prev.filter(a => a.id !== announcementId));\r\n        toast({\r\n            variant: 'destructive',\r\n            title: 'Announcement Permanently Deleted',\r\n            description: 'The announcement has been permanently removed from the system.',\r\n        });\r\n    }, [toast]);\r\n\r\n    const handleSaveCompany = useCallback((companyToSave: Company) => {\r\n        const isEditing = companies.some(c => c.id === companyToSave.id && companyToSave.id);\r\n\r\n        setCompanies(prev => {\r\n            if (isEditing) {\r\n                return prev.map(c => c.id === companyToSave.id ? companyToSave : c);\r\n            } else {\r\n                const newCompany = { ...companyToSave, id: `comp-${Date.now()}` };\r\n                return [...prev, newCompany];\r\n            }\r\n        });\r\n\r\n        if (isEditing) {\r\n            toast({ title: 'Company Updated', description: `Details for ${companyToSave.name} have been updated.` });\r\n        } else {\r\n            toast({ title: 'Company Added', description: `${companyToSave.name} has been added.` });\r\n        }\r\n    }, [toast, companies]);\r\n\r\n    const handleDeleteCompany = useCallback((companyId: string) => {\r\n        const companyToDelete = companies.find(c => c.id === companyId);\r\n        if (!companyToDelete) return;\r\n\r\n        const isCompanyInUse = users.some(u => u.company === companyToDelete.name);\r\n        if (isCompanyInUse) {\r\n            toast({\r\n                variant: 'destructive',\r\n                title: 'Cannot Delete Company',\r\n                description: `\"${companyToDelete.name}\" is currently assigned to one or more employees. Please reassign them before deleting.`,\r\n            });\r\n            return;\r\n        }\r\n\r\n        setCompanies(prev => prev.filter(c => c.id !== companyId));\r\n        setDeletedCompanies(prev => [...prev, companyToDelete]);\r\n        toast({\r\n            title: 'Company Deleted',\r\n            description: `\"${companyToDelete.name}\" has been moved to the deleted items list.`,\r\n        });\r\n    }, [companies, users, toast]);\r\n\r\n    const handleRestoreCompany = useCallback((companyId: string) => {\r\n        const companyToRestore = deletedCompanies.find(c => c.id === companyId);\r\n        if (companyToRestore) {\r\n            setDeletedCompanies(prev => prev.filter(c => c.id !== companyId));\r\n            setCompanies(prev => [...prev, companyToRestore]);\r\n            toast({\r\n                title: 'Company Restored',\r\n                description: `\"${companyToRestore.name}\" has been restored.`\r\n            });\r\n        }\r\n    }, [deletedCompanies, toast]);\r\n\r\n    const handlePermanentDeleteCompany = useCallback((companyId: string) => {\r\n        setDeletedCompanies(prev => prev.filter(c => c.id !== companyId));\r\n        toast({\r\n            variant: 'destructive',\r\n            title: 'Company Permanently Deleted',\r\n            description: 'The company has been permanently removed from the system.',\r\n        });\r\n    }, [toast]);\r\n\r\n\r\n    const activeUsers = useMemo(() => users.filter(user => user.status === 'active' || user.status === 'inactive' || user.status === 'pending'), [users]);\r\n    const deletedUsers = useMemo(() => users.filter(user => user.status === 'deleted'), [users]);\r\n\r\n    const publishedAnnouncements = useMemo(() => announcements.filter(a => a.status === 'published'), [announcements]);\r\n    const deletedAnnouncements = useMemo(() => announcements.filter(a => a.status === 'deleted'), [announcements]);\r\n\r\n\r\n    const filteredByDept = useMemo(() => {\r\n        if (departmentFilter === 'all') {\r\n            return activeUsers;\r\n        }\r\n        if (departmentFilter === 'unassigned') {\r\n            return []; // Return empty for user grid if unassigned is selected\r\n        }\r\n        return activeUsers.filter(user => user.department && departmentFilter === user.department);\r\n    }, [activeUsers, departmentFilter]);\r\n\r\n    const filteredByRole = useMemo(() => filteredByDept.filter(user =>\r\n        roleFilter === 'all' || user.role === roleFilter\r\n    ), [filteredByDept, roleFilter]);\r\n\r\n    const filteredActiveUsersForGrid = useMemo(() => filteredByRole.filter(user =>\r\n        user.name.toLowerCase().includes(searchTerm.toLowerCase())\r\n    ), [filteredByRole, searchTerm]);\r\n\r\n    const filteredActiveUsersForTable = useMemo(() => filteredByRole.filter(user =>\r\n        user.name.toLowerCase().includes(searchTerm.toLowerCase()) ||\r\n        user.email.toLowerCase().includes(searchTerm.toLowerCase())\r\n    ), [filteredByRole, searchTerm]);\r\n\r\n    const filteredDeletedUsers = useMemo(() => deletedUsers.filter(user =>\r\n        user.name.toLowerCase().includes(searchTerm.toLowerCase()) ||\r\n        user.email.toLowerCase().includes(searchTerm.toLowerCase())\r\n    ), [deletedUsers, searchTerm]);\r\n\r\n    const filteredDocTypes = useMemo(() => documentTypes.filter(type =>\r\n        type.toLowerCase().includes(searchTerm.toLowerCase())\r\n    ), [documentTypes, searchTerm]);\r\n\r\n    const filteredDeletedDocTypes = useMemo(() => deletedDocumentTypes.filter(type =>\r\n        type.toLowerCase().includes(searchTerm.toLowerCase())\r\n    ), [deletedDocumentTypes, searchTerm]);\r\n\r\n    const filteredDepartments = useMemo(() => departments.filter(dept =>\r\n        dept.toLowerCase().includes(searchTerm.toLowerCase())\r\n    ), [departments, searchTerm]);\r\n\r\n    const filteredDeletedDepartments = useMemo(() => deletedDepartments.filter(dept =>\r\n        dept.toLowerCase().includes(searchTerm.toLowerCase())\r\n    ), [deletedDepartments, searchTerm]);\r\n\r\n    const filteredCompanies = useMemo(() => companies.filter(comp =>\r\n        comp.name.toLowerCase().includes(searchTerm.toLowerCase()) || (comp.shortName && comp.shortName.toLowerCase().includes(searchTerm.toLowerCase()))\r\n    ), [companies, searchTerm]);\r\n\r\n    const filteredDeletedCompanies = useMemo(() => deletedCompanies.filter(comp =>\r\n        comp.name.toLowerCase().includes(searchTerm.toLowerCase())\r\n    ), [deletedCompanies, searchTerm]);\r\n\r\n\r\n    const filteredHolidays = useMemo(() => {\r\n        return holidays.filter(holiday =>\r\n            holiday.name.toLowerCase().includes(searchTerm.toLowerCase()) &&\r\n            (holidayLocationFilter === 'all' || holiday.location === holidayLocationFilter)\r\n        ).sort((a, b) => new Date(a.date).getTime() - new Date(b.date).getTime())\r\n    }, [holidays, searchTerm, holidayLocationFilter]);\r\n\r\n    const filteredAnnouncements = useMemo(() => {\r\n        return publishedAnnouncements.filter(announcement =>\r\n            announcement.title.toLowerCase().includes(searchTerm.toLowerCase()) ||\r\n            announcement.message.toLowerCase().includes(searchTerm.toLowerCase())\r\n        ).sort((a, b) => new Date(b.date).getTime() - new Date(a.date).getTime());\r\n    }, [publishedAnnouncements, searchTerm]);\r\n\r\n    const filteredDeletedAnnouncements = useMemo(() => {\r\n        return deletedAnnouncements.filter(announcement =>\r\n            announcement.title.toLowerCase().includes(searchTerm.toLowerCase()) ||\r\n            announcement.message.toLowerCase().includes(searchTerm.toLowerCase())\r\n        ).sort((a, b) => new Date(b.date).getTime() - new Date(a.date).getTime());\r\n    }, [deletedAnnouncements, searchTerm]);\r\n\r\n    const filteredDeletedDocs = useMemo(() => {\r\n        return deletedDocs.filter(doc =>\r\n            doc.name.toLowerCase().includes(searchTerm.toLowerCase()) ||\r\n            doc.type.toLowerCase().includes(searchTerm.toLowerCase())\r\n        ).sort((a, b) => new Date(b.uploadDate).getTime() - new Date(a.uploadDate).getTime());\r\n    }, [deletedDocs, searchTerm]);\r\n\r\n\r\n    const { unassignedDocuments, docsByType } = useMemo(() => {\r\n        const userMap = new Map(users.map(u => [u.id, u]));\r\n        const unassigned: Document[] = [];\r\n        const byType: Record<string, Record<string, Document[]>> = {};\r\n\r\n        docs.forEach(doc => {\r\n            if (doc.ownerId && userMap.has(doc.ownerId)) {\r\n                if (!byType[doc.type]) {\r\n                    byType[doc.type] = {};\r\n                }\r\n                if (!byType[doc.type][doc.ownerId]) {\r\n                    byType[doc.type][doc.ownerId] = [];\r\n                }\r\n                byType[doc.type][doc.ownerId].push(doc);\r\n            } else {\r\n                unassigned.push(doc);\r\n            }\r\n        });\r\n\r\n        return { unassignedDocuments: unassigned, docsByType: byType };\r\n    }, [docs, users]);\r\n\r\n    const filteredUsersForSelection = activeSubTab === 'manage' ? filteredActiveUsersForTable.filter(u => u.id !== 'sadmin') : [];\r\n\r\n    const handleSelectAll = useCallback((checked: boolean | 'indeterminate') => {\r\n        if (checked === true) {\r\n            setSelectedUserIds(filteredUsersForSelection.map(u => u.id));\r\n        } else {\r\n            setSelectedUserIds([]);\r\n        }\r\n    }, [filteredUsersForSelection]);\r\n\r\n    const handleSelectUser = useCallback((userId: string, checked: boolean) => {\r\n        if (userId === 'sadmin') return;\r\n        if (checked) {\r\n            setSelectedUserIds(prev => [...prev, userId]);\r\n        } else {\r\n            setSelectedUserIds(prev => prev.filter(id => id !== userId));\r\n        }\r\n    }, []);\r\n\r\n    const handleBulkDelete = useCallback(() => {\r\n        setUsers(prevUsers => prevUsers.map(u =>\r\n            selectedUserIds.includes(u.id) ? { ...u, status: 'deleted' } : u\r\n        ));\r\n        toast({\r\n            title: \"Bulk Delete Successful\",\r\n            description: `${selectedUserIds.length} employee(s) have been moved to the deleted users list.`\r\n        });\r\n        setSelectedUserIds([]);\r\n        setIsBulkDeleteDialogOpen(false);\r\n    }, [selectedUserIds, toast]);\r\n\r\n    const handleBulkResetPassword = useCallback(() => {\r\n        const selectedUsers = users.filter(u => selectedUserIds.includes(u.id));\r\n        selectedUsers.forEach(user => handleResetPassword(user.id));\r\n        toast({\r\n            title: \"Bulk Password Reset\",\r\n            description: `Password reset links have been sent to ${selectedUserIds.length} employee(s).`\r\n        });\r\n        setSelectedUserIds([]);\r\n        setIsBulkResetDialogOpen(false);\r\n    }, [users, selectedUserIds, handleResetPassword, toast]);\r\n\r\n    const handleBulkRoleChange = useCallback((newRole: 'admin' | 'employee') => {\r\n        setUsers(prevUsers => prevUsers.map(u =>\r\n            selectedUserIds.includes(u.id) ? { ...u, role: newRole } : u\r\n        ));\r\n        toast({\r\n            title: \"Bulk Role Change Successful\",\r\n            description: `The role for ${selectedUserIds.length} employee(s) has been changed to ${newRole}.`\r\n        });\r\n        setSelectedUserIds([]);\r\n    }, [selectedUserIds, toast]);\r\n\r\n    const handleReassignDocument = useCallback((docId: string, newOwnerId: string) => {\r\n        setDocs(prevDocs => {\r\n            return prevDocs.map(doc => {\r\n                if (doc.id === docId) {\r\n                    return { ...doc, ownerId: newOwnerId };\r\n                }\r\n                return doc;\r\n            });\r\n        });\r\n        const user = users.find(u => u.id === newOwnerId);\r\n        const doc = docs.find(d => d.id === docId);\r\n        toast({\r\n            title: \"Document Reassigned\",\r\n            description: `Document \"${doc?.name}\" has been assigned to ${user?.name}.`\r\n        });\r\n    }, [users, docs, toast]);\r\n\r\n    const handleDeleteDocument = useCallback((docId: string) => {\r\n        const docToDelete = docs.find(d => d.id === docId);\r\n        if (docToDelete) {\r\n            setDocs(prev => prev.filter(d => d.id !== docId));\r\n            setDeletedDocs(prev => [...prev, docToDelete]);\r\n            toast({\r\n                title: \"Document Deleted\",\r\n                description: `\"${docToDelete.name}\" has been moved to deleted items.`\r\n            });\r\n        }\r\n    }, [docs, toast]);\r\n\r\n    const handleBulkDeleteDocuments = useCallback((docIds: string[]) => {\r\n        const docsToDelete = docs.filter(d => docIds.includes(d.id));\r\n        if (docsToDelete.length > 0) {\r\n            setDocs(prev => prev.filter(d => !docIds.includes(d.id)));\r\n            setDeletedDocs(prev => [...prev, ...docsToDelete]);\r\n            toast({\r\n                title: \"Documents Deleted\",\r\n                description: `${docsToDelete.length} document(s) have been moved to deleted items.`\r\n            });\r\n        }\r\n    }, [docs, toast]);\r\n\r\n    const handleRestoreDocument = useCallback((docId: string) => {\r\n        const docToRestore = deletedDocs.find(d => d.id === docId);\r\n        if (docToRestore) {\r\n            setDeletedDocs(prev => prev.filter(d => d.id !== docId));\r\n            setDocs(prev => [...prev, docToRestore]);\r\n            toast({\r\n                title: \"Document Restored\",\r\n                description: `\"${docToRestore.name}\" has been restored.`\r\n            });\r\n        }\r\n    }, [deletedDocs, toast]);\r\n\r\n    const handlePermanentDeleteDocument = useCallback((docId: string) => {\r\n        const docToDelete = deletedDocs.find(d => d.id === docId);\r\n        if (docToDelete) {\r\n            setDeletedDocs(prev => prev.filter(d => d.id !== docId));\r\n            toast({\r\n                variant: \"destructive\",\r\n                title: \"Document Permanently Deleted\",\r\n                description: `\"${docToDelete.name}\" has been permanently removed.`\r\n            });\r\n        }\r\n    }, [deletedDocs, toast]);\r\n\r\n    const onTabChange = useCallback((value: string) => {\r\n        setActiveTab(value);\r\n        setSelectedUserIds([]);\r\n        setSearchTerm('');\r\n        setDepartmentFilter('all');\r\n        setRoleFilter('all');\r\n        setHolidayLocationFilter('all');\r\n        setExplorerState({ view: 'docTypes' });\r\n        if (value === 'employee-management') {\r\n            setActiveSubTab('overview');\r\n        }\r\n    }, []);\r\n\r\n    const numSelected = selectedUserIds.length;\r\n    const numFiltered = filteredUsersForSelection.length;\r\n\r\n    const isEventUpcoming = (eventDate?: string) => {\r\n        if (!eventDate) return false;\r\n        const today = new Date();\r\n        today.setHours(0, 0, 0, 0);\r\n        const eDate = new Date(eventDate);\r\n        eDate.setTime(eDate.getTime() + eDate.getTimezoneOffset() * 60 * 1000); // Adjust for timezone\r\n        return eDate >= today;\r\n    }\r\n\r\n    const getUserFromId = (id: string) => users.find(u => u.id === id);\r\n\r\n    const usersByDocType = useMemo(() => {\r\n        if (explorerState.view !== 'usersInDocType') return [];\r\n\r\n        const userIdsWithDocType = new Set(\r\n            Object.keys(docsByType[explorerState.docType] || {})\r\n        );\r\n\r\n        return filteredActiveUsersForGrid.filter(u => userIdsWithDocType.has(u.id));\r\n    }, [explorerState, docsByType, filteredActiveUsersForGrid]);\r\n\r\n    return (\r\n        <>\r\n            <div className=\"flex flex-col md:flex-row items-start md:items-center justify-between gap-4\">\r\n                <div className=\"grid gap-2\">\r\n                    <h1 className=\"text-3xl font-bold tracking-tight\">{siteName}</h1>\r\n                    <p className=\"text-muted-foreground\">Manage all employee documents and profiles.</p>\r\n                </div>\r\n                <div className=\"flex items-center gap-2 w-full md:w-auto\">\r\n                    {numSelected > 0 && activeTab === 'employee-management' && activeSubTab === 'manage' ? (\r\n                        <>\r\n                            <span className=\"text-sm text-muted-foreground\">{numSelected} selected</span>\r\n                            <BulkRoleChangeDialog onSave={handleBulkRoleChange}>\r\n                                <Button variant=\"outline\">\r\n                                    <Users className=\"mr-2 h-4 w-4\" /> Change Roles\r\n                                </Button>\r\n                            </BulkRoleChangeDialog>\r\n                            <Button variant=\"outline\" onClick={() => setIsBulkResetDialogOpen(true)}>\r\n                                <KeyRound className=\"mr-2 h-4 w-4\" /> Reset Passwords\r\n                            </Button>\r\n                            <Button variant=\"destructive\" onClick={() => setIsBulkDeleteDialogOpen(true)}>\r\n                                <Trash2 className=\"mr-2 h-4 w-4\" /> Delete Selected\r\n                            </Button>\r\n                        </>\r\n                    ) : (\r\n                        <div className=\"flex items-center gap-2 w-full\">\r\n                            <EmployeeManagementDialog onSave={handleEmployeeSave} departments={departments} companies={companies}>\r\n                                <Button className=\"w-full sm:w-auto\">Add Employee</Button>\r\n                            </EmployeeManagementDialog>\r\n                            <BulkUploadDialog onBulkUploadComplete={handleBulkUploadComplete} users={activeUsers} />\r\n                        </div>\r\n                    )}\r\n                </div>\r\n            </div>\r\n\r\n            <Tabs value={activeTab} onValueChange={onTabChange} className=\"mt-4\">\r\n                <div className=\"flex flex-col md:flex-row items-start md:items-center mb-4 gap-4\">\r\n                    <div className=\"overflow-x-auto w-full pb-2\">\r\n                        <TabsList className=\"w-max\">\r\n                            <TabsTrigger value=\"file-explorer\">File Explorer</TabsTrigger>\r\n                            <TabsTrigger value=\"employee-management\">Employee Management</TabsTrigger>\r\n                            <TabsTrigger value=\"announcements\">Announcements</TabsTrigger>\r\n                            <TabsTrigger value=\"holidays\">Holidays</TabsTrigger>\r\n                            <TabsTrigger value=\"settings\">Settings</TabsTrigger>\r\n                            <TabsTrigger value=\"deleted-items\">Deleted Items</TabsTrigger>\r\n                        </TabsList>\r\n                    </div>\r\n                    <div className=\"flex items-center gap-2 w-full md:w-auto md:ml-auto\">\r\n                        <div className=\"relative flex-1\">\r\n                            <Search className=\"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground\" />\r\n                            <Input\r\n                                type=\"search\"\r\n                                placeholder={\r\n                                    activeTab === 'file-explorer' ? 'Search document types or employees...'\r\n                                        : activeTab === 'employee-management' ? 'Search employees...'\r\n                                            : activeTab === 'holidays' ? 'Search holidays...'\r\n                                                : activeTab === 'announcements' ? 'Search announcements...'\r\n                                                    : activeTab === 'settings' ? 'Search settings...'\r\n                                                        : activeTab === 'deleted-items' ? 'Search deleted items...'\r\n                                                            : 'Search...'\r\n                                }\r\n                                className=\"w-full pl-8\"\r\n                                value={searchTerm}\r\n                                onChange={(e) => setSearchTerm(e.target.value)}\r\n                            />\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                {(activeTab === 'employee-management' || (activeTab === 'file-explorer' && explorerState.view !== 'docTypes')) && (\r\n                    <div className=\"mb-4 flex flex-col sm:flex-row items-center gap-4\">\r\n                        <div className=\"flex items-center gap-2\">\r\n                            <Label className=\"text-sm font-medium\">Department</Label>\r\n                            <Select value={departmentFilter} onValueChange={setDepartmentFilter}>\r\n                                <SelectTrigger className=\"w-full sm:w-[220px]\">\r\n                                    <SelectValue placeholder=\"Select Department\" />\r\n                                </SelectTrigger>\r\n                                <SelectContent>\r\n                                    <SelectItem value=\"all\">All Departments</SelectItem>\r\n                                    {departments.map(dept => (\r\n                                        <SelectItem key={dept} value={dept}>\r\n                                            {dept}\r\n                                        </SelectItem>\r\n                                    ))}\r\n                                    {activeTab === 'file-explorer' && <SelectItem value=\"unassigned\">Unassigned Documents</SelectItem>}\r\n                                </SelectContent>\r\n                            </Select>\r\n                        </div>\r\n                        <div className=\"flex items-center gap-2\">\r\n                            <Label className=\"text-sm font-medium\">Role</Label>\r\n                            <Select value={roleFilter} onValueChange={(value) => setRoleFilter(value as any)}>\r\n                                <SelectTrigger className=\"w-full sm:w-[180px]\">\r\n                                    <SelectValue placeholder=\"Select Role\" />\r\n                                </SelectTrigger>\r\n                                <SelectContent>\r\n                                    <SelectItem value=\"all\">All Roles</SelectItem>\r\n                                    <SelectItem value=\"admin\">Admin</SelectItem>\r\n                                    <SelectItem value=\"employee\">Employee</SelectItem>\r\n                                </SelectContent>\r\n                            </Select>\r\n                        </div>\r\n                    </div>\r\n                )}\r\n\r\n                <TabsContent value=\"file-explorer\">\r\n                    <Card>\r\n                        {departmentFilter === 'unassigned' ? (\r\n                            <CardHeader>\r\n                                <CardTitle>Unassigned Documents</CardTitle>\r\n                                <CardDescription>\r\n                                    These documents could not be automatically assigned. Please assign them to an employee.\r\n                                </CardDescription>\r\n                            </CardHeader>\r\n                        ) : explorerState.view === 'usersInDocType' ? (\r\n                            <CardHeader>\r\n                                <div className=\"flex items-center gap-4\">\r\n                                    <Button variant=\"outline\" size=\"icon\" onClick={() => setExplorerState({ view: 'docTypes' })}>\r\n                                        <ArrowLeft className=\"h-4 w-4\" />\r\n                                    </Button>\r\n                                    <div>\r\n                                        <CardTitle>Employees with \"{explorerState.docType}\"</CardTitle>\r\n                                        <CardDescription>Select an employee to view their documents of this type.</CardDescription>\r\n                                    </div>\r\n                                </div>\r\n                            </CardHeader>\r\n                        ) : null}\r\n\r\n                        <CardContent>\r\n                            {explorerState.view === 'docTypes' && departmentFilter !== 'unassigned' && (\r\n                                <CardHeader>\r\n                                    <CardTitle>Browse Documents</CardTitle>\r\n                                    <CardDescription>Select a document type to see all related employees.</CardDescription>\r\n                                </CardHeader>\r\n                            )}\r\n                            {departmentFilter === 'unassigned' ? (\r\n                                unassignedDocuments.length > 0 ? (\r\n                                    <div className=\"p-4 bg-red-50 dark:bg-red-900/20 rounded-lg\">\r\n                                        <h3 className=\"flex items-center gap-2 font-semibold text-red-800 dark:text-red-300\">\r\n                                            <FileLock2 className=\"h-5 w-5\" />\r\n                                            Action Required\r\n                                        </h3>\r\n                                        <p className=\"text-sm text-red-700 dark:text-red-400 mt-1 mb-4\">\r\n                                            These documents could not be automatically assigned. Please select them and assign them to an employee.\r\n                                        </p>\r\n                                        <DocumentList\r\n                                            documents={unassignedDocuments}\r\n                                            users={users}\r\n                                            onSort={() => { }}\r\n                                            sortConfig={null}\r\n                                            showOwner={true}\r\n                                            onReassign={handleReassignDocument}\r\n                                            onDelete={handleDeleteDocument}\r\n                                            onBulkDelete={handleBulkDeleteDocuments}\r\n                                        />\r\n                                    </div>\r\n                                ) : (\r\n                                    <div className=\"text-center text-muted-foreground py-8\">\r\n                                        <p>No unassigned documents found.</p>\r\n                                    </div>\r\n                                )\r\n                            ) : explorerState.view === 'docTypes' ? (\r\n                                <div className=\"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-4\">\r\n                                    {documentTypes.filter(dt => dt.toLowerCase().includes(searchTerm.toLowerCase())).map(docType => (\r\n                                        <Card\r\n                                            key={docType}\r\n                                            className=\"cursor-pointer hover:border-primary transition-all group\"\r\n                                            onClick={() => setExplorerState({ view: 'usersInDocType', docType })}\r\n                                        >\r\n                                            <CardContent className=\"flex flex-col items-center justify-center p-4 gap-2\">\r\n                                                <Folder className=\"h-16 w-16 text-primary group-hover:scale-105 transition-transform\" />\r\n                                                <p className=\"text-sm font-medium text-center truncate w-full\">{docType}</p>\r\n                                            </CardContent>\r\n                                        </Card>\r\n                                    ))}\r\n                                </div>\r\n                            ) : (\r\n                                <div>\r\n                                    <div className=\"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-4 mb-6\">\r\n                                        {usersByDocType.map(user => (\r\n                                            <Card\r\n                                                key={user.id}\r\n                                                className=\"cursor-pointer hover:border-primary transition-all\"\r\n                                                onClick={() => router.push(`/dashboard/employee/${user.id}?role=admin`)}\r\n                                            >\r\n                                                <CardContent className=\"flex flex-col items-center justify-center p-4 gap-2\">\r\n                                                    <Image src={getAvatarSrc(user)} width={64} height={64} className=\"rounded-full object-cover\" alt={user.name ? user.name : 'Employee'} data-ai-hint=\"person portrait\" />\r\n                                                    <p className=\"text-sm font-medium text-center truncate w-full\">{user.name}</p>\r\n                                                </CardContent>\r\n                                            </Card>\r\n                                        ))}\r\n                                    </div>\r\n                                    {usersByDocType.length === 0 && (\r\n                                        <div className=\"text-center text-muted-foreground py-8\">\r\n                                            <p>No employees found with this document type.</p>\r\n                                        </div>\r\n                                    )}\r\n                                </div>\r\n                            )}\r\n                        </CardContent>\r\n                    </Card>\r\n                </TabsContent>\r\n\r\n                <TabsContent value=\"employee-management\">\r\n                    <Tabs defaultValue=\"overview\" value={activeSubTab} onValueChange={setActiveSubTab}>\r\n                        <TabsList>\r\n                            <TabsTrigger value=\"overview\">Employee Overview</TabsTrigger>\r\n                            <TabsTrigger value=\"manage\">Manage Employees</TabsTrigger>\r\n                        </TabsList>\r\n                        <TabsContent value=\"overview\" className=\"mt-4\">\r\n                            <Card>\r\n                                <CardHeader>\r\n                                    <CardTitle>Employee Overview</CardTitle>\r\n                                    <CardDescription>Select an employee to view their detailed profile and documents.</CardDescription>\r\n                                </CardHeader>\r\n                                <CardContent>\r\n                                    <div className=\"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-4 mb-6\">\r\n                                        {filteredActiveUsersForGrid.map(user => (\r\n                                            <Card\r\n                                                key={user.id}\r\n                                                className=\"cursor-pointer hover:border-primary transition-all\"\r\n                                                onClick={() => router.push(`/dashboard/employee/${user.id}?role=admin`)}\r\n                                            >\r\n                                                <CardContent className=\"flex flex-col items-center justify-center p-4 gap-2\">\r\n                                                    <Image src={getAvatarSrc(user)} width={64} height={64} className=\"rounded-full object-cover\" alt={user.name} data-ai-hint=\"person portrait\" />\r\n                                                    <p className=\"text-sm font-medium text-center truncate w-full\">{user.name}</p>\r\n                                                </CardContent>\r\n                                            </Card>\r\n                                        ))}\r\n                                    </div>\r\n                                    {filteredActiveUsersForGrid.length === 0 && (\r\n                                        <div className=\"text-center text-muted-foreground py-8\">\r\n                                            <p>No employees found.</p>\r\n                                        </div>\r\n                                    )}\r\n                                </CardContent>\r\n                            </Card>\r\n                        </TabsContent>\r\n                        <TabsContent value=\"manage\" className=\"mt-4\">\r\n                            <Card>\r\n                                <CardHeader>\r\n                                    <div className=\"flex flex-col md:flex-row items-start md:items-center justify-between gap-4\">\r\n                                        <div>\r\n                                            <CardTitle>Manage Employees</CardTitle>\r\n                                            <CardDescription>A list of all active employees in the system.</CardDescription>\r\n                                        </div>\r\n                                        <div className=\"flex items-center gap-2 w-full md:w-auto\">\r\n                                            <Button onClick={handleExportUsers} variant=\"outline\" className=\"w-full sm:w-auto\">\r\n                                                <Download className=\"mr-2 h-4 w-4\" />\r\n                                                {numSelected > 0 ? `Export Selected (${numSelected})` : 'Export All Users'}\r\n                                            </Button>\r\n                                            <BulkUserImportDialog onImport={handleBulkUserImport}>\r\n                                                <Button variant=\"outline\" className=\"w-full sm:w-auto\">\r\n                                                    <Upload className=\"mr-2 h-4 w-4\" /> Import Users\r\n                                                </Button>\r\n                                            </BulkUserImportDialog>\r\n                                        </div>\r\n                                    </div>\r\n                                </CardHeader>\r\n                                <CardContent>\r\n                                    <Table>\r\n                                        <TableHeader>\r\n                                            <TableRow>\r\n                                                <TableHead className=\"w-[40px]\">\r\n                                                    <Checkbox\r\n                                                        checked={numSelected === numFiltered && numFiltered > 0 ? true : numSelected > 0 ? 'indeterminate' : false}\r\n                                                        onCheckedChange={handleSelectAll}\r\n                                                        aria-label=\"Select all\"\r\n                                                        disabled={filteredUsersForSelection.length === 0}\r\n                                                    />\r\n                                                </TableHead>\r\n                                                <TableHead className=\"w-[80px] hidden sm:table-cell\"></TableHead>\r\n                                                <TableHead>Name</TableHead>\r\n                                                <TableHead>Email</TableHead>\r\n                                                <TableHead className=\"hidden lg:table-cell\">Department</TableHead>\r\n                                                <TableHead className=\"hidden md:table-cell\">Role</TableHead>\r\n                                                <TableHead>Status</TableHead>\r\n                                                <TableHead className=\"text-right\">Actions</TableHead>\r\n                                            </TableRow>\r\n                                        </TableHeader>\r\n                                        <TableBody>\r\n                                            {filteredActiveUsersForTable.length > 0 ? filteredActiveUsersForTable.map(user => (\r\n                                                <TableRow key={user.id} data-state={selectedUserIds.includes(user.id) && \"selected\"}>\r\n                                                    <TableCell>\r\n                                                        <Checkbox\r\n                                                            checked={selectedUserIds.includes(user.id)}\r\n                                                            onCheckedChange={(checked) => handleSelectUser(user.id, !!checked)}\r\n                                                            aria-label={`Select ${user.name}`}\r\n                                                            disabled={user.id === 'sadmin'}\r\n                                                        />\r\n                                                    </TableCell>\r\n                                                    <TableCell className=\"hidden sm:table-cell\">\r\n                                                        <Image src={getAvatarSrc(user)} width={40} height={40} className=\"rounded-full object-cover\" alt={user.name ? user.name : 'User'} data-ai-hint=\"person portrait\" />\r\n                                                    </TableCell>\r\n                                                    <TableCell className=\"font-medium\">{user.name}</TableCell>\r\n                                                    <TableCell>{user.email}</TableCell>\r\n                                                    <TableCell className=\"hidden lg:table-cell\">{user.department || 'N/A'}</TableCell>\r\n                                                    <TableCell className=\"hidden md:table-cell\">\r\n                                                        <span className={cn('px-2 py-1 rounded-full text-xs font-medium',\r\n                                                            user.role === 'admin' ? 'bg-blue-100 text-blue-800' : 'bg-gray-100 text-gray-800'\r\n                                                        )}>\r\n                                                            {user.role.charAt(0).toUpperCase() + user.role.slice(1)}\r\n                                                        </span>\r\n                                                    </TableCell>\r\n                                                    <TableCell>\r\n                                                        <span className={cn('px-2 py-1 rounded-full text-xs font-medium',\r\n                                                            user.status === 'active' ? 'bg-green-100 text-green-800' :\r\n                                                                user.status === 'inactive' ? 'bg-red-100 text-red-800' :\r\n                                                                    'bg-yellow-100 text-yellow-800'\r\n                                                        )}>\r\n                                                            {user.status.charAt(0).toUpperCase() + user.status.slice(1)}\r\n                                                        </span>\r\n                                                    </TableCell>\r\n                                                    <TableCell className=\"text-right\">\r\n                                                        {user.id === 'sadmin' ? (\r\n                                                            <div className=\"flex items-center justify-end\">\r\n                                                                <EmployeeManagementDialog employee={user} onSave={handleEmployeeSave} departments={departments} companies={companies}>\r\n                                                                    <Button variant=\"ghost\" size=\"sm\">\r\n                                                                        <Edit className=\"mr-2 h-4 w-4\" /> Edit\r\n                                                                    </Button>\r\n                                                                </EmployeeManagementDialog>\r\n                                                            </div>\r\n                                                        ) : (\r\n                                                            <DropdownMenu>\r\n                                                                <DropdownMenuTrigger asChild>\r\n                                                                    <Button variant=\"ghost\" size=\"icon\">\r\n                                                                        <MoreVertical className=\"h-5 w-5\" />\r\n                                                                    </Button>\r\n                                                                </DropdownMenuTrigger>\r\n                                                                <DropdownMenuContent align=\"end\">\r\n                                                                    <EmployeeManagementDialog employee={user} onSave={handleEmployeeSave} departments={departments} companies={companies}>\r\n                                                                        <DropdownMenuItem onSelect={(e) => e.preventDefault()}>\r\n                                                                            <Edit className=\"mr-2 h-4 w-4\" />\r\n                                                                            Edit Employee\r\n                                                                        </DropdownMenuItem>\r\n                                                                    </EmployeeManagementDialog>\r\n                                                                    <DropdownMenuItem onClick={() => handleResetPassword(user.id)}>\r\n                                                                        <KeyRound className=\"mr-2 h-4 w-4\" />\r\n                                                                        Reset Password\r\n                                                                    </DropdownMenuItem>\r\n                                                                    <DropdownMenuSeparator />\r\n                                                                    <DeleteEmployeeDialog employee={user} onDelete={() => handleEmployeeDelete(user.id)}>\r\n                                                                        <DropdownMenuItem onSelect={(e) => e.preventDefault()} className=\"text-destructive focus:text-destructive\">\r\n                                                                            <Trash2 className=\"mr-2 h-4 w-4\" />\r\n                                                                            Delete Employee\r\n                                                                        </DropdownMenuItem>\r\n                                                                    </DeleteEmployeeDialog>\r\n                                                                </DropdownMenuContent>\r\n                                                            </DropdownMenu>\r\n                                                        )}\r\n                                                    </TableCell>\r\n                                                </TableRow>\r\n                                            )) : (\r\n                                                <TableRow>\r\n                                                    <TableCell colSpan={8} className=\"text-center text-muted-foreground\">No active users found.</TableCell>\r\n                                                </TableRow>\r\n                                            )}\r\n                                        </TableBody>\r\n                                    </Table>\r\n                                </CardContent>\r\n                            </Card>\r\n                        </TabsContent>\r\n                    </Tabs>\r\n                </TabsContent>\r\n\r\n                <TabsContent value=\"announcements\">\r\n                    <Card>\r\n                        <CardHeader className=\"flex flex-col md:flex-row items-start md:items-center justify-between gap-4\">\r\n                            <div>\r\n                                <CardTitle>Manage Announcements</CardTitle>\r\n                                <CardDescription>Create and publish announcements for all employees.</CardDescription>\r\n                            </div>\r\n                            <AddAnnouncementDialog onAdd={handleAddAnnouncement}>\r\n                                <Button variant=\"outline\">\r\n                                    <Bell className=\"mr-2 h-4 w-4\" /> New Announcement\r\n                                </Button>\r\n                            </AddAnnouncementDialog>\r\n                        </CardHeader>\r\n                        <CardContent>\r\n                            <Table>\r\n                                <TableHeader>\r\n                                    <TableRow>\r\n                                        <TableHead className=\"hidden sm:table-cell\">Date</TableHead>\r\n                                        <TableHead>Title</TableHead>\r\n                                        <TableHead className=\"hidden md:table-cell\">Message</TableHead>\r\n                                        <TableHead>Event Date</TableHead>\r\n                                        <TableHead className=\"text-right\">Actions</TableHead>\r\n                                    </TableRow>\r\n                                </TableHeader>\r\n                                <TableBody>\r\n                                    {filteredAnnouncements.length > 0 ? filteredAnnouncements.map(announcement => {\r\n                                        const isUpcoming = isEventUpcoming(announcement.eventDate);\r\n                                        return (\r\n                                            <TableRow key={announcement.id} className={cn(isUpcoming && \"bg-blue-500/10 ring-2 ring-destructive animate-pulse\")}>\r\n                                                <TableCell className=\"font-medium hidden sm:table-cell\">\r\n                                                    {new Date(announcement.date).toLocaleDateString(undefined, { year: 'numeric', month: 'long', day: 'numeric' })}\r\n                                                </TableCell>\r\n                                                <TableCell>{announcement.title}</TableCell>\r\n                                                <TableCell className=\"hidden md:table-cell max-w-sm truncate\">{announcement.message}</TableCell>\r\n                                                <TableCell>\r\n                                                    {announcement.eventDate ? (\r\n                                                        <div className=\"flex items-center gap-2\">\r\n                                                            <span className={cn(\r\n                                                                'px-2 py-1 rounded-full text-xs font-medium',\r\n                                                                new Date(announcement.eventDate) > new Date() ? 'bg-blue-100 text-blue-800' : 'bg-gray-100 text-gray-800'\r\n                                                            )}>\r\n                                                                {new Date(announcement.eventDate).toLocaleDateString(undefined, { year: 'numeric', month: 'short', day: 'numeric', timeZone: 'UTC' })}\r\n                                                            </span>\r\n                                                        </div>\r\n                                                    ) : <span className=\"text-muted-foreground\">-</span>}\r\n                                                </TableCell>\r\n                                                <TableCell className=\"text-right\">\r\n                                                    <DeleteAnnouncementDialog announcement={announcement} onDelete={() => handleDeleteAnnouncement(announcement.id)} isPermanent={false}>\r\n                                                        <Button variant=\"ghost\" size=\"icon\" className=\"text-destructive hover:text-destructive\">\r\n                                                            <Trash2 className=\"h-4 w-4\" />\r\n                                                        </Button>\r\n                                                    </DeleteAnnouncementDialog>\r\n                                                </TableCell>\r\n                                            </TableRow>\r\n                                        )\r\n                                    }) : (\r\n                                        <TableRow>\r\n                                            <TableCell colSpan={5} className=\"text-center text-muted-foreground\">No announcements found.</TableCell>\r\n                                        </TableRow>\r\n                                    )}\r\n                                </TableBody>\r\n                            </Table>\r\n                        </CardContent>\r\n                    </Card>\r\n                </TabsContent>\r\n\r\n                <TabsContent value=\"holidays\">\r\n                    <Card>\r\n                        <CardHeader className=\"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4\">\r\n                            <div>\r\n                                <CardTitle>Manage Holidays</CardTitle>\r\n                                <CardDescription>Add or remove holidays for the organization.</CardDescription>\r\n                            </div>\r\n                            <div className=\"flex w-full flex-col sm:flex-row sm:w-auto items-center gap-4\">\r\n                                <div className=\"flex items-center gap-2 w-full\">\r\n                                    <Label className=\"text-sm font-medium\">Location</Label>\r\n                                    <Select value={holidayLocationFilter} onValueChange={(value) => setHolidayLocationFilter(value as any)}>\r\n                                        <SelectTrigger className=\"w-full sm:w-[180px]\">\r\n                                            <SelectValue placeholder=\"Select Location\" />\r\n                                        </SelectTrigger>\r\n                                        <SelectContent>\r\n                                            <SelectItem value=\"all\">All Locations</SelectItem>\r\n                                            {holidayLocations.map(loc => (\r\n                                                <SelectItem key={loc} value={loc}>\r\n                                                    {loc}\r\n                                                </SelectItem>\r\n                                            ))}\r\n                                        </SelectContent>\r\n                                    </Select>\r\n                                </div>\r\n                                <AddHolidayDialog onAdd={handleAddHoliday}>\r\n                                    <Button variant=\"outline\" className=\"w-full sm:w-auto\">\r\n                                        <CalendarPlus className=\"mr-2 h-4 w-4\" /> Add Holiday\r\n                                    </Button>\r\n                                </AddHolidayDialog>\r\n                            </div>\r\n                        </CardHeader>\r\n                        <CardContent>\r\n                            <Table>\r\n                                <TableHeader>\r\n                                    <TableRow>\r\n                                        <TableHead>Date</TableHead>\r\n                                        <TableHead>Name</TableHead>\r\n                                        <TableHead>Location</TableHead>\r\n                                        <TableHead className=\"text-right\">Actions</TableHead>\r\n                                    </TableRow>\r\n                                </TableHeader>\r\n                                <TableBody>\r\n                                    {filteredHolidays.length > 0 ? filteredHolidays.map(holiday => (\r\n                                        <TableRow key={holiday.id}>\r\n                                            <TableCell className=\"font-medium\">{new Date(holiday.date).toLocaleDateString(undefined, { year: 'numeric', month: 'long', day: 'numeric', timeZone: 'UTC' })}</TableCell>\r\n                                            <TableCell>{holiday.name}</TableCell>\r\n                                            <TableCell>\r\n                                                <span className=\"px-2 py-1 rounded-full text-xs font-medium bg-secondary text-secondary-foreground\">\r\n                                                    {holiday.location}\r\n                                                </span>\r\n                                            </TableCell>\r\n                                            <TableCell className=\"text-right\">\r\n                                                <Button variant=\"ghost\" size=\"icon\" className=\"text-destructive hover:text-destructive\" onClick={() => handleDeleteHoliday(holiday.id)}>\r\n                                                    <Trash2 className=\"h-4 w-4\" />\r\n                                                </Button>\r\n                                            </TableCell>\r\n                                        </TableRow>\r\n                                    )) : (\r\n                                        <TableRow>\r\n                                            <TableCell colSpan={4} className=\"text-center text-muted-foreground\">No holidays found.</TableCell>\r\n                                        </TableRow>\r\n                                    )}\r\n                                </TableBody>\r\n                            </Table>\r\n                        </CardContent>\r\n                    </Card>\r\n                </TabsContent>\r\n\r\n                <TabsContent value=\"settings\">\r\n                    <Card>\r\n                        <CardHeader>\r\n                            <CardTitle>Settings</CardTitle>\r\n                            <CardDescription>Manage global application settings and configurations.</CardDescription>\r\n                        </CardHeader>\r\n                        <CardContent>\r\n                            <Tabs defaultValue=\"companies\" className=\"w-full\">\r\n                                <div className=\"overflow-x-auto w-full pb-2\">\r\n                                    <TabsList className=\"w-max\">\r\n                                        <TabsTrigger value=\"companies\">Companies</TabsTrigger>\r\n                                        <TabsTrigger value=\"branding\">Branding</TabsTrigger>\r\n                                        <TabsTrigger value=\"doc-types\">Document Types</TabsTrigger>\r\n                                        <TabsTrigger value=\"departments\">Departments</TabsTrigger>\r\n                                        <TabsTrigger value=\"security\">Security</TabsTrigger>\r\n                                        <TabsTrigger value=\"data-management\">Data Management</TabsTrigger>\r\n                                        <TabsTrigger value=\"integrations\">Integrations</TabsTrigger>\r\n                                    </TabsList>\r\n                                </div>\r\n                                <TabsContent value=\"companies\" className=\"pt-6\">\r\n                                    <Card>\r\n                                        <CardHeader className=\"flex flex-col md:flex-row items-start md:items-center justify-between gap-4\">\r\n                                            <div>\r\n                                                <CardTitle>Manage Companies</CardTitle>\r\n                                                <CardDescription>Add, edit, or delete companies from the organization.</CardDescription>\r\n                                            </div>\r\n                                            <CompanyManagementDialog onSave={handleSaveCompany}>\r\n                                                <Button variant=\"outline\">\r\n                                                    <Home className=\"mr-2 h-4 w-4\" /> Add Company\r\n                                                </Button>\r\n                                            </CompanyManagementDialog>\r\n                                        </CardHeader>\r\n                                        <CardContent>\r\n                                            <Table>\r\n                                                <TableHeader>\r\n                                                    <TableRow>\r\n                                                        <TableHead>Logo</TableHead>\r\n                                                        <TableHead>Name</TableHead>\r\n                                                        <TableHead>Short Name</TableHead>\r\n                                                        <TableHead className=\"hidden sm:table-cell\">Email</TableHead>\r\n                                                        <TableHead className=\"hidden sm:table-cell\">Phone</TableHead>\r\n                                                        <TableHead className=\"text-right\">Actions</TableHead>\r\n                                                    </TableRow>\r\n                                                </TableHeader>\r\n                                                <TableBody>\r\n                                                    {filteredCompanies.length > 0 ? filteredCompanies.map(company => (\r\n                                                        <TableRow key={company.id}>\r\n                                                            <TableCell>\r\n                                                                {company.logo ? (\r\n                                                                    <Image src={company.logo} alt={company.name ? company.name : 'Company Logo'} width={40} height={40} className=\"rounded-md object-cover\" />\r\n                                                                ) : (\r\n                                                                    <div className=\"h-10 w-10 rounded-md bg-muted flex items-center justify-center text-muted-foreground text-xs\">\r\n                                                                        No Logo\r\n                                                                    </div>\r\n                                                                )}\r\n                                                            </TableCell>\r\n                                                            <TableCell className=\"font-medium\">{company.name}</TableCell>\r\n                                                            <TableCell>{company.shortName}</TableCell>\r\n                                                            <TableCell className=\"hidden sm:table-cell\">{company.email}</TableCell>\r\n                                                            <TableCell className=\"hidden sm:table-cell\">{company.phone}</TableCell>\r\n                                                            <TableCell className=\"text-right\">\r\n                                                                <DropdownMenu>\r\n                                                                    <DropdownMenuTrigger asChild>\r\n                                                                        <Button variant=\"ghost\" size=\"icon\">\r\n                                                                            <MoreVertical className=\"h-5 w-5\" />\r\n                                                                        </Button>\r\n                                                                    </DropdownMenuTrigger>\r\n                                                                    <DropdownMenuContent align=\"end\">\r\n                                                                        <CompanyManagementDialog company={company} onSave={handleSaveCompany}>\r\n                                                                            <DropdownMenuItem onSelect={(e) => e.preventDefault()}>\r\n                                                                                <Edit className=\"mr-2 h-4 w-4\" /> Edit\r\n                                                                            </DropdownMenuItem>\r\n                                                                        </CompanyManagementDialog>\r\n                                                                        <DeleteCompanyDialog company={company} onDelete={() => handleDeleteCompany(company.id)}>\r\n                                                                            <DropdownMenuItem onSelect={(e) => e.preventDefault()} className=\"text-destructive focus:text-destructive\">\r\n                                                                                <Trash2 className=\"mr-2 h-4 w-4\" /> Delete\r\n                                                                            </DropdownMenuItem>\r\n                                                                        </DeleteCompanyDialog>\r\n                                                                    </DropdownMenuContent>\r\n                                                                </DropdownMenu>\r\n                                                            </TableCell>\r\n                                                        </TableRow>\r\n                                                    )) : (\r\n                                                        <TableRow>\r\n                                                            <TableCell colSpan={6} className=\"text-center text-muted-foreground\">No companies found.</TableCell>\r\n                                                        </TableRow>\r\n                                                    )}\r\n                                                </TableBody>\r\n                                            </Table>\r\n                                        </CardContent>\r\n                                    </Card>\r\n                                </TabsContent>\r\n                                <TabsContent value=\"branding\" className=\"pt-6\">\r\n                                    <Card>\r\n                                        <CardHeader>\r\n                                            <CardTitle>Application Branding</CardTitle>\r\n                                            <CardDescription>Manage the look and feel of the application.</CardDescription>\r\n                                        </CardHeader>\r\n                                        <CardContent className=\"space-y-8\">\r\n                                            <div className=\"space-y-2\">\r\n                                                <Label>Company Logo</Label>\r\n                                                <div className=\"flex items-center gap-4\">\r\n                                                    <div className=\"w-20 h-20 rounded-full bg-muted flex items-center justify-center\">\r\n                                                        {logoSrc ? (\r\n                                                            <Image src={logoSrc} alt=\"Current Logo\" width={80} height={80} className=\"rounded-full object-cover\" />\r\n                                                        ) : (\r\n                                                            <svg\r\n                                                                width=\"64\"\r\n                                                                height=\"64\"\r\n                                                                viewBox=\"0 0 100 100\"\r\n                                                                fill=\"none\"\r\n                                                                xmlns=\"http://www.w3.org/2000/svg\"\r\n                                                            >\r\n                                                                <path\r\n                                                                    d=\"M50 0L95.5 25.5V74.5L50 100L4.5 74.5V25.5L50 0Z\"\r\n                                                                    fill=\"#004a99\"\r\n                                                                />\r\n                                                                <path\r\n                                                                    d=\"M26 63.5L50 50L74 63.5M50 75V50\"\r\n                                                                    stroke=\"#fecb00\"\r\n                                                                    strokeWidth=\"5\"\r\n                                                                    strokeLinecap=\"round\"\r\n                                                                    strokeLinejoin=\"round\"\r\n                                                                />\r\n                                                                <path\r\n                                                                    d=\"M26 36.5L50 25L74 36.5\"\r\n                                                                    stroke=\"#ffffff\"\r\n                                                                    strokeWidth=\"5\"\r\n                                                                    strokeLinecap=\"round\"\r\n                                                                    strokeLinejoin=\"round\"\r\n                                                                />\r\n                                                            </svg>\r\n                                                        )}\r\n                                                    </div>\r\n                                                    <div className=\"flex items-center gap-2\">\r\n                                                        <Button asChild variant=\"outline\">\r\n                                                            <label htmlFor=\"logo-upload\">\r\n                                                                <UploadCloud className=\"mr-2 h-4 w-4\" />\r\n                                                                Change Logo\r\n                                                                <input\r\n                                                                    type=\"file\"\r\n                                                                    id=\"logo-upload\"\r\n                                                                    className=\"sr-only\"\r\n                                                                    accept=\"image/*\"\r\n                                                                    onChange={handleLogoChange}\r\n                                                                />\r\n                                                            </label>\r\n                                                        </Button>\r\n                                                        {logoSrc && (\r\n                                                            <Button variant=\"ghost\" className=\"text-destructive\" onClick={handleResetLogo}>\r\n                                                                <X className=\"mr-2 h-4 w-4\" />\r\n                                                                Reset\r\n                                                            </Button>\r\n                                                        )}\r\n                                                    </div>\r\n                                                </div>\r\n                                                <p className=\"text-sm text-muted-foreground\">Upload a new logo for the login screen.</p>\r\n                                            </div>\r\n                                            <div className=\"space-y-2\">\r\n                                                <Label htmlFor=\"site-name\">Site Name</Label>\r\n                                                <div className=\"flex items-center gap-2\">\r\n                                                    <Input\r\n                                                        id=\"site-name\"\r\n                                                        value={tempSiteName}\r\n                                                        onChange={(e) => setTempSiteName(e.target.value)}\r\n                                                        className=\"max-w-xs\"\r\n                                                    />\r\n                                                    <Button onClick={handleSiteNameSave}>\r\n                                                        <Save className=\"mr-2 h-4 w-4\" />\r\n                                                        Save Name\r\n                                                    </Button>\r\n                                                </div>\r\n                                                <p className=\"text-sm text-muted-foreground\">This name will appear on the login page and in the header.</p>\r\n                                            </div>\r\n                                        </CardContent>\r\n                                    </Card>\r\n                                </TabsContent>\r\n                                <TabsContent value=\"doc-types\" className=\"pt-6\">\r\n                                    <Card>\r\n                                        <CardHeader className=\"flex flex-col md:flex-row items-start md:items-center justify-between gap-4\">\r\n                                            <div>\r\n                                                <CardTitle>Manage Document Types</CardTitle>\r\n                                                <CardDescription>Add or edit document categories for the whole organization.</CardDescription>\r\n                                            </div>\r\n                                            <AddDocumentTypeDialog onAdd={handleAddDocumentType}>\r\n                                                <Button variant=\"outline\">\r\n                                                    <FolderPlus className=\"mr-2 h-4 w-4\" /> Add Doc Type\r\n                                                </Button>\r\n                                            </AddDocumentTypeDialog>\r\n                                        </CardHeader>\r\n                                        <CardContent>\r\n                                            <Table>\r\n                                                <TableHeader>\r\n                                                    <TableRow>\r\n                                                        <TableHead>Type Name</TableHead>\r\n                                                        <TableHead className=\"text-right\">Actions</TableHead>\r\n                                                    </TableRow>\r\n                                                </TableHeader>\r\n                                                <TableBody>\r\n                                                    {filteredDocTypes.length > 0 ? filteredDocTypes.map(type => (\r\n                                                        <TableRow key={type}>\r\n                                                            <TableCell className=\"font-medium\">\r\n                                                                <div className=\"flex items-center gap-2\">\r\n                                                                    <Tag className=\"h-4 w-4 text-muted-foreground\" />\r\n                                                                    {type}\r\n                                                                </div>\r\n                                                            </TableCell>\r\n                                                            <TableCell className=\"text-right\">\r\n                                                                <EditDocumentTypeDialog\r\n                                                                    documentType={type}\r\n                                                                    onEdit={handleEditDocumentType}\r\n                                                                >\r\n                                                                    <Button variant=\"ghost\" size=\"sm\">\r\n                                                                        <Edit className=\"mr-2 h-4 w-4\" /> Edit\r\n                                                                    </Button>\r\n                                                                </EditDocumentTypeDialog>\r\n                                                                <DeleteDocumentTypeDialog\r\n                                                                    documentType={type}\r\n                                                                    onDelete={() => handleDeleteDocumentType(type)}\r\n                                                                    isTypeInUse={docs.some(d => d.type === type)}\r\n                                                                >\r\n                                                                    <Button variant=\"ghost\" size=\"sm\" className=\"text-destructive hover:text-destructive\">\r\n                                                                        <Trash2 className=\"mr-2 h-4 w-4\" /> Delete\r\n                                                                    </Button>\r\n                                                                </DeleteDocumentTypeDialog>\r\n                                                            </TableCell>\r\n                                                        </TableRow>\r\n                                                    )) : (\r\n                                                        <TableRow>\r\n                                                            <TableCell colSpan={2} className=\"text-center text-muted-foreground\">No document types found.</TableCell>\r\n                                                        </TableRow>\r\n                                                    )}\r\n                                                </TableBody>\r\n                                            </Table>\r\n                                        </CardContent>\r\n                                    </Card>\r\n                                </TabsContent>\r\n                                <TabsContent value=\"departments\" className=\"pt-6\">\r\n                                    <Card>\r\n                                        <CardHeader className=\"flex flex-col md:flex-row items-start md:items-center justify-between gap-4\">\r\n                                            <div>\r\n                                                <CardTitle>Manage Departments</CardTitle>\r\n                                                <CardDescription>Add, edit, or delete departments for the organization.</CardDescription>\r\n                                            </div>\r\n                                            <AddDepartmentDialog onAdd={handleAddDepartment}>\r\n                                                <Button variant=\"outline\">\r\n                                                    <Building className=\"mr-2 h-4 w-4\" /> Add Department\r\n                                                </Button>\r\n                                            </AddDepartmentDialog>\r\n                                        </CardHeader>\r\n                                        <CardContent>\r\n                                            <Table>\r\n                                                <TableHeader>\r\n                                                    <TableRow>\r\n                                                        <TableHead>Department Name</TableHead>\r\n                                                        <TableHead className=\"text-right\">Actions</TableHead>\r\n                                                    </TableRow>\r\n                                                </TableHeader>\r\n                                                <TableBody>\r\n                                                    {filteredDepartments.length > 0 ? filteredDepartments.map(dept => (\r\n                                                        <TableRow key={dept}>\r\n                                                            <TableCell className=\"font-medium\">\r\n                                                                <div className=\"flex items-center gap-2\">\r\n                                                                    <Building className=\"h-4 w-4 text-muted-foreground\" />\r\n                                                                    {dept}\r\n                                                                </div>\r\n                                                            </TableCell>\r\n                                                            <TableCell className=\"text-right\">\r\n                                                                <Button variant=\"ghost\" size=\"sm\" disabled>\r\n                                                                    <Edit className=\"mr-2 h-4 w-4\" /> Edit\r\n                                                                </Button>\r\n                                                                <DeleteDepartmentDialog departmentName={dept} onDelete={() => handleDeleteDepartment(dept)}>\r\n                                                                    <Button variant=\"ghost\" size=\"sm\" className=\"text-destructive hover:text-destructive\">\r\n                                                                        <Trash2 className=\"mr-2 h-4 w-4\" /> Delete\r\n                                                                    </Button>\r\n                                                                </DeleteDepartmentDialog>\r\n                                                            </TableCell>\r\n                                                        </TableRow>\r\n                                                    )) : (\r\n                                                        <TableRow>\r\n                                                            <TableCell colSpan={2} className=\"text-center text-muted-foreground\">No departments found.</TableCell>\r\n                                                        </TableRow>\r\n                                                    )}\r\n                                                </TableBody>\r\n                                            </Table>\r\n                                        </CardContent>\r\n                                    </Card>\r\n                                </TabsContent>\r\n                                <TabsContent value=\"security\" className=\"pt-6\">\r\n                                    <Card>\r\n                                        <CardHeader>\r\n                                            <CardTitle>Authentication Security</CardTitle>\r\n                                            <CardDescription>Manage which email domains are allowed to sign in.</CardDescription>\r\n                                        </CardHeader>\r\n                                        <CardContent className=\"space-y-6\">\r\n                                            <div className=\"space-y-2\">\r\n                                                <Label htmlFor=\"new-domain\">Add New Domain</Label>\r\n                                                <div className=\"flex items-center gap-2\">\r\n                                                    <Input\r\n                                                        id=\"new-domain\"\r\n                                                        value={newDomain}\r\n                                                        onChange={(e) => setNewDomain(e.target.value)}\r\n                                                        placeholder=\"e.g., example.com\"\r\n                                                        className=\"max-w-xs\"\r\n                                                        onKeyDown={(e) => { if (e.key === 'Enter') handleAddDomain(); }}\r\n                                                    />\r\n                                                    <Button onClick={handleAddDomain}>Add Domain</Button>\r\n                                                </div>\r\n                                                <p className=\"text-sm text-muted-foreground\">Enter a domain that is allowed to sign in.</p>\r\n                                            </div>\r\n                                            <div className=\"space-y-2\">\r\n                                                <Label>Allowed Domains</Label>\r\n                                                {allowedDomains.length > 0 ? (\r\n                                                    <div className=\"border rounded-md p-4 space-y-2 max-w-md\">\r\n                                                        {allowedDomains.map(domain => (\r\n                                                            <div key={domain} className=\"flex items-center justify-between\">\r\n                                                                <span className=\"flex items-center gap-2 text-sm\">\r\n                                                                    <Shield className=\"h-4 w-4 text-green-500\" /> {domain}\r\n                                                                </span>\r\n                                                                <Button variant=\"ghost\" size=\"sm\" className=\"text-destructive hover:text-destructive\" onClick={() => handleRemoveDomain(domain)}>\r\n                                                                    <X className=\"mr-2 h-4 w-4\" /> Remove\r\n                                                                </Button>\r\n                                                            </div>\r\n                                                        ))}\r\n                                                    </div>\r\n                                                ) : (\r\n                                                    <p className=\"text-sm text-muted-foreground max-w-md\">\r\n                                                        No domains have been added. The default fallback domain will be used for authentication.\r\n                                                    </p>\r\n                                                )}\r\n                                            </div>\r\n                                        </CardContent>\r\n                                    </Card>\r\n                                </TabsContent>\r\n                                <TabsContent value=\"data-management\" className=\"pt-6\">\r\n                                    <Card>\r\n                                        <CardHeader>\r\n                                            <CardTitle>Data Management</CardTitle>\r\n                                            <CardDescription>Perform sensitive actions like undoing bulk uploads.</CardDescription>\r\n                                        </CardHeader>\r\n                                        <CardContent className=\"space-y-6\">\r\n                                            <div className=\"p-4 border border-destructive/50 bg-destructive/10 rounded-lg\">\r\n                                                <div className=\"flex flex-col md:flex-row items-start md:items-center justify-between gap-4\">\r\n                                                    <div>\r\n                                                        <h3 className=\"font-semibold\">Undo Last Bulk Upload</h3>\r\n                                                        <p className=\"text-sm text-destructive/80\">This will permanently delete the last batch of {lastBulkUploadInfo?.ids.length || 0} uploaded document(s). This action cannot be undone.</p>\r\n                                                    </div>\r\n                                                    <Button\r\n                                                        variant=\"destructive\"\r\n                                                        onClick={() => setIsUndoDialogOpen(true)}\r\n                                                        disabled={!lastBulkUploadInfo || lastBulkUploadInfo.ids.length === 0}\r\n                                                    >\r\n                                                        <Undo className=\"mr-2 h-4 w-4\" />\r\n                                                        Undo Last Upload ({lastBulkUploadInfo?.ids.length || 0})\r\n                                                    </Button>\r\n                                                </div>\r\n                                            </div>\r\n                                        </CardContent>\r\n                                    </Card>\r\n                                </TabsContent>\r\n                                <TabsContent value=\"integrations\" className=\"pt-6\">\r\n                                    <IntegrationsSettings />\r\n                                </TabsContent>\r\n                            </Tabs>\r\n                        </CardContent>\r\n                    </Card>\r\n                </TabsContent>\r\n                <TabsContent value=\"deleted-items\">\r\n                    <Card>\r\n                        <CardHeader>\r\n                            <CardTitle>Deleted Items</CardTitle>\r\n                            <CardDescription>Manage, restore, or permanently delete items.</CardDescription>\r\n                        </CardHeader>\r\n                        <CardContent>\r\n                            <Tabs defaultValue=\"companies\" className=\"w-full\">\r\n                                <div className=\"overflow-x-auto w-full pb-2\">\r\n                                    <TabsList className=\"w-max\">\r\n                                        <TabsTrigger value=\"companies\">Companies</TabsTrigger>\r\n                                        <TabsTrigger value=\"departments\">Departments</TabsTrigger>\r\n                                        <TabsTrigger value=\"doc-types\">Document Types</TabsTrigger>\r\n                                        <TabsTrigger value=\"documents\">Documents</TabsTrigger>\r\n                                        <TabsTrigger value=\"users\">Users</TabsTrigger>\r\n                                        <TabsTrigger value=\"announcements\">Announcements</TabsTrigger>\r\n                                    </TabsList>\r\n                                </div>\r\n                                <TabsContent value=\"companies\" className=\"pt-6\">\r\n                                    <Card>\r\n                                        <CardHeader>\r\n                                            <CardTitle>Deleted Companies</CardTitle>\r\n                                            <CardDescription>A list of all deleted companies. You can restore or permanently delete them.</CardDescription>\r\n                                        </CardHeader>\r\n                                        <CardContent>\r\n                                            <Table>\r\n                                                <TableHeader>\r\n                                                    <TableRow>\r\n                                                        <TableHead>Name</TableHead>\r\n                                                        <TableHead>Email</TableHead>\r\n                                                        <TableHead className=\"text-right\">Actions</TableHead>\r\n                                                    </TableRow>\r\n                                                </TableHeader>\r\n                                                <TableBody>\r\n                                                    {filteredDeletedCompanies.length > 0 ? filteredDeletedCompanies.map(company => (\r\n                                                        <TableRow key={company.id}>\r\n                                                            <TableCell className=\"font-medium\">{company.name}</TableCell>\r\n                                                            <TableCell>{company.email}</TableCell>\r\n                                                            <TableCell className=\"text-right space-x-2\">\r\n                                                                <Button variant=\"outline\" size=\"sm\" onClick={() => handleRestoreCompany(company.id)}>\r\n                                                                    <Undo className=\"mr-2 h-4 w-4\" /> Restore\r\n                                                                </Button>\r\n                                                                <PermanentDeleteDialog\r\n                                                                    itemName={company.name}\r\n                                                                    itemType=\"company\"\r\n                                                                    onDelete={() => handlePermanentDeleteCompany(company.id)}\r\n                                                                >\r\n                                                                    <Button variant=\"destructive\" size=\"sm\">\r\n                                                                        <Trash className=\"mr-2 h-4 w-4\" /> Permanent Delete\r\n                                                                    </Button>\r\n                                                                </PermanentDeleteDialog>\r\n                                                            </TableCell>\r\n                                                        </TableRow>\r\n                                                    )) : (\r\n                                                        <TableRow>\r\n                                                            <TableCell colSpan={3} className=\"text-center text-muted-foreground\">No deleted companies found.</TableCell>\r\n                                                        </TableRow>\r\n                                                    )}\r\n                                                </TableBody>\r\n                                            </Table>\r\n                                        </CardContent>\r\n                                    </Card>\r\n                                </TabsContent>\r\n                                <TabsContent value=\"departments\" className=\"pt-6\">\r\n                                    <Card>\r\n                                        <CardHeader>\r\n                                            <CardTitle>Deleted Departments</CardTitle>\r\n                                            <CardDescription>A list of all deleted departments. You can restore or permanently delete them.</CardDescription>\r\n                                        </CardHeader>\r\n                                        <CardContent>\r\n                                            <Table>\r\n                                                <TableHeader>\r\n                                                    <TableRow>\r\n                                                        <TableHead>Department Name</TableHead>\r\n                                                        <TableHead className=\"text-right\">Actions</TableHead>\r\n                                                    </TableRow>\r\n                                                </TableHeader>\r\n                                                <TableBody>\r\n                                                    {filteredDeletedDepartments.length > 0 ? filteredDeletedDepartments.map(dept => (\r\n                                                        <TableRow key={dept}>\r\n                                                            <TableCell className=\"font-medium\">\r\n                                                                <div className=\"flex items-center gap-2\">\r\n                                                                    <Building className=\"h-4 w-4 text-muted-foreground\" />\r\n                                                                    {dept}\r\n                                                                </div>\r\n                                                            </TableCell>\r\n                                                            <TableCell className=\"text-right space-x-2\">\r\n                                                                <Button variant=\"outline\" size=\"sm\" onClick={() => handleRestoreDepartment(dept)}>\r\n                                                                    <Undo className=\"mr-2 h-4 w-4\" /> Restore\r\n                                                                </Button>\r\n                                                                <PermanentDeleteDialog\r\n                                                                    itemName={dept}\r\n                                                                    itemType=\"department\"\r\n                                                                    onDelete={() => handlePermanentDeleteDepartment(dept)}\r\n                                                                >\r\n                                                                    <Button variant=\"destructive\" size=\"sm\">\r\n                                                                        <Trash className=\"mr-2 h-4 w-4\" /> Permanent Delete\r\n                                                                    </Button>\r\n                                                                </PermanentDeleteDialog>\r\n                                                            </TableCell>\r\n                                                        </TableRow>\r\n                                                    )) : (\r\n                                                        <TableRow>\r\n                                                            <TableCell colSpan={2} className=\"text-center text-muted-foreground\">No deleted departments found.</TableCell>\r\n                                                        </TableRow>\r\n                                                    )}\r\n                                                </TableBody>\r\n                                            </Table>\r\n                                        </CardContent>\r\n                                    </Card>\r\n                                </TabsContent>\r\n                                <TabsContent value=\"doc-types\" className=\"pt-6\">\r\n                                    <Card>\r\n                                        <CardHeader>\r\n                                            <CardTitle>Deleted Document Types</CardTitle>\r\n                                            <CardDescription>A list of all deleted document types. You can restore or permanently delete them.</CardDescription>\r\n                                        </CardHeader>\r\n                                        <CardContent>\r\n                                            <Table>\r\n                                                <TableHeader>\r\n                                                    <TableRow>\r\n                                                        <TableHead>Type Name</TableHead>\r\n                                                        <TableHead className=\"text-right\">Actions</TableHead>\r\n                                                    </TableRow>\r\n                                                </TableHeader>\r\n                                                <TableBody>\r\n                                                    {filteredDeletedDocTypes.length > 0 ? filteredDeletedDocTypes.map(type => (\r\n                                                        <TableRow key={type}>\r\n                                                            <TableCell className=\"font-medium\">\r\n                                                                <div className=\"flex items-center gap-2\">\r\n                                                                    <Tag className=\"h-4 w-4 text-muted-foreground\" />\r\n                                                                    {type}\r\n                                                                </div>\r\n                                                            </TableCell>\r\n                                                            <TableCell className=\"text-right space-x-2\">\r\n                                                                <Button variant=\"outline\" size=\"sm\" onClick={() => handleRestoreDocumentType(type)}>\r\n                                                                    <Undo className=\"mr-2 h-4 w-4\" /> Restore\r\n                                                                </Button>\r\n                                                                <PermanentDeleteDialog\r\n                                                                    itemName={type}\r\n                                                                    itemType=\"document type\"\r\n                                                                    onDelete={() => handlePermanentDeleteDocumentType(type)}\r\n                                                                >\r\n                                                                    <Button variant=\"destructive\" size=\"sm\">\r\n                                                                        <Trash className=\"mr-2 h-4 w-4\" /> Permanent Delete\r\n                                                                    </Button>\r\n                                                                </PermanentDeleteDialog>\r\n                                                            </TableCell>\r\n                                                        </TableRow>\r\n                                                    )) : (\r\n                                                        <TableRow>\r\n                                                            <TableCell colSpan={2} className=\"text-center text-muted-foreground\">No deleted document types found.</TableCell>\r\n                                                        </TableRow>\r\n                                                    )}\r\n                                                </TableBody>\r\n                                            </Table>\r\n                                        </CardContent>\r\n                                    </Card>\r\n                                </TabsContent>\r\n                                <TabsContent value=\"documents\" className=\"pt-6\">\r\n                                    <Card>\r\n                                        <CardHeader>\r\n                                            <CardTitle>Deleted Documents</CardTitle>\r\n                                            <CardDescription>A list of all deleted documents. You can restore or permanently delete them.</CardDescription>\r\n                                        </CardHeader>\r\n                                        <CardContent>\r\n                                            <DocumentList\r\n                                                documents={filteredDeletedDocs}\r\n                                                users={users}\r\n                                                showOwner\r\n                                                onSort={() => { }}\r\n                                                sortConfig={null}\r\n                                                isDeletedList\r\n                                                onRestore={handleRestoreDocument}\r\n                                                onPermanentDelete={handlePermanentDeleteDocument}\r\n                                            />\r\n                                        </CardContent>\r\n                                    </Card>\r\n                                </TabsContent>\r\n                                <TabsContent value=\"users\" className=\"pt-6\">\r\n                                    <Card>\r\n                                        <CardHeader>\r\n                                            <CardTitle>Deleted Users</CardTitle>\r\n                                            <CardDescription>A list of all deleted employees. You can restore or permanently delete them.</CardDescription>\r\n                                        </CardHeader>\r\n                                        <CardContent>\r\n                                            <Table>\r\n                                                <TableHeader>\r\n                                                    <TableRow>\r\n                                                        <TableHead className=\"w-[80px] hidden sm:table-cell\"></TableHead>\r\n                                                        <TableHead>Name</TableHead>\r\n                                                        <TableHead>Email</TableHead>\r\n                                                        <TableHead className=\"text-right\">Actions</TableHead>\r\n                                                    </TableRow>\r\n                                                </TableHeader>\r\n                                                <TableBody>\r\n                                                    {filteredDeletedUsers.length > 0 ? filteredDeletedUsers.map(user => (\r\n                                                        <TableRow key={user.id}>\r\n                                                            <TableCell className=\"hidden sm:table-cell\">\r\n                                                                <Image src={getAvatarSrc(user)} width={40} height={40} className=\"rounded-full object-cover\" alt={user.name ? user.name : 'User'} data-ai-hint=\"person portrait\" />\r\n                                                            </TableCell>\r\n                                                            <TableCell className=\"font-medium\">{user.name}</TableCell>\r\n                                                            <TableCell>{user.email}</TableCell>\r\n                                                            <TableCell className=\"text-right space-x-2\">\r\n                                                                <Button variant=\"outline\" size=\"sm\" onClick={() => router.push(`/dashboard/employee/${user.id}?role=admin`)}>\r\n                                                                    <Eye className=\"mr-2 h-4 w-4\" /> View\r\n                                                                </Button>\r\n                                                                <Button variant=\"outline\" size=\"sm\" onClick={() => handleRestoreUser(user.id)}>\r\n                                                                    <Undo className=\"mr-2 h-4 w-4\" /> Restore\r\n                                                                </Button>\r\n                                                                <PermanentDeleteDialog\r\n                                                                    itemName={user.name}\r\n                                                                    itemType=\"user\"\r\n                                                                    onDelete={() => handlePermanentDeleteUser(user.id)}\r\n                                                                >\r\n                                                                    <Button variant=\"destructive\" size=\"sm\">\r\n                                                                        <Trash className=\"mr-2 h-4 w-4\" /> Permanent Delete\r\n                                                                    </Button>\r\n                                                                </PermanentDeleteDialog>\r\n                                                            </TableCell>\r\n                                                        </TableRow>\r\n                                                    )) : (\r\n                                                        <TableRow>\r\n                                                            <TableCell colSpan={4} className=\"text-center text-muted-foreground\">No deleted users found.</TableCell>\r\n                                                        </TableRow>\r\n                                                    )}\r\n                                                </TableBody>\r\n                                            </Table>\r\n                                        </CardContent>\r\n                                    </Card>\r\n                                </TabsContent>\r\n                                <TabsContent value=\"announcements\" className=\"pt-6\">\r\n                                    <Card>\r\n                                        <CardHeader>\r\n                                            <CardTitle>Deleted Announcements</CardTitle>\r\n                                            <CardDescription>A list of all deleted announcements. You can restore or permanently delete them here.</CardDescription>\r\n                                        </CardHeader>\r\n                                        <CardContent>\r\n                                            <Table>\r\n                                                <TableHeader>\r\n                                                    <TableRow>\r\n                                                        <TableHead>Date</TableHead>\r\n                                                        <TableHead>Title</TableHead>\r\n                                                        <TableHead className=\"hidden md:table-cell\">Message</TableHead>\r\n                                                        <TableHead className=\"text-right\">Actions</TableHead>\r\n                                                    </TableRow>\r\n                                                </TableHeader>\r\n                                                <TableBody>\r\n                                                    {filteredDeletedAnnouncements.length > 0 ? filteredDeletedAnnouncements.map(announcement => (\r\n                                                        <TableRow key={announcement.id}>\r\n                                                            <TableCell className=\"font-medium hidden sm:table-cell\">{new Date(announcement.date).toLocaleDateString(undefined, { year: 'numeric', month: 'long', day: 'numeric' })}</TableCell>\r\n                                                            <TableCell>{announcement.title}</TableCell>\r\n                                                            <TableCell className=\"hidden md:table-cell max-w-sm truncate\">{announcement.message}</TableCell>\r\n                                                            <TableCell className=\"text-right\">\r\n                                                                <div className=\"flex items-center justify-end gap-2\">\r\n                                                                    <Button variant=\"outline\" size=\"sm\" onClick={() => handleRestoreAnnouncement(announcement.id)}>\r\n                                                                        <ArchiveRestore className=\"mr-2 h-4 w-4\" /> Restore\r\n                                                                    </Button>\r\n                                                                    <PermanentDeleteDialog\r\n                                                                        itemName={announcement.title}\r\n                                                                        itemType='announcement'\r\n                                                                        onDelete={() => handlePermanentDeleteAnnouncement(announcement.id)}\r\n                                                                    >\r\n                                                                        <Button variant=\"destructive\" size=\"sm\">\r\n                                                                            <Trash className=\"mr-2 h-4 w-4\" /> Delete Permanently\r\n                                                                        </Button>\r\n                                                                    </PermanentDeleteDialog>\r\n                                                                </div>\r\n                                                            </TableCell>\r\n                                                        </TableRow>\r\n                                                    )) : (\r\n                                                        <TableRow>\r\n                                                            <TableCell colSpan={4} className=\"text-center text-muted-foreground\">No deleted announcements found.</TableCell>\r\n                                                        </TableRow>\r\n                                                    )}\r\n                                                </TableBody>\r\n                                            </Table>\r\n                                        </CardContent>\r\n                                    </Card>\r\n                                </TabsContent>\r\n                            </Tabs>\r\n                        </CardContent>\r\n                    </Card>\r\n                </TabsContent>\r\n            </Tabs>\r\n\r\n            {/* Bulk Delete Confirmation Dialog */}\r\n            <AlertDialog open={isBulkDeleteDialogOpen} onOpenChange={setIsBulkDeleteDialogOpen}>\r\n                <AlertDialogContent>\r\n                    <AlertDialogHeader>\r\n                        <AlertDialogTitle>Are you absolutely sure?</AlertDialogTitle>\r\n                        <AlertDialogDescription>\r\n                            This will move the selected {numSelected} employee(s) to the deleted users list. You can restore them later.\r\n                        </AlertDialogDescription>\r\n                    </AlertDialogHeader>\r\n                    <AlertDialogFooter>\r\n                        <AlertDialogCancel>Cancel</AlertDialogCancel>\r\n                        <AlertDialogAction onClick={handleBulkDelete} className=\"bg-destructive hover:bg-destructive/90\">\r\n                            Delete {numSelected} Employee(s)\r\n                        </AlertDialogAction>\r\n                    </AlertDialogFooter>\r\n                </AlertDialogContent>\r\n            </AlertDialog>\r\n\r\n            {/* Bulk Reset Password Confirmation Dialog */}\r\n            <AlertDialog open={isBulkResetDialogOpen} onOpenChange={setIsBulkResetDialogOpen}>\r\n                <AlertDialogContent>\r\n                    <AlertDialogHeader>\r\n                        <AlertDialogTitle>Confirm Password Reset</AlertDialogTitle>\r\n                        <AlertDialogDescription>\r\n                            Are you sure you want to send password reset links to the {numSelected} selected employee(s)?\r\n                        </AlertDialogDescription>\r\n                    </AlertDialogHeader>\r\n                    <AlertDialogFooter>\r\n                        <AlertDialogCancel>Cancel</AlertDialogCancel>\r\n                        <AlertDialogAction onClick={handleBulkResetPassword}>\r\n                            Send Reset Links\r\n                        </AlertDialogAction>\r\n                    </AlertDialogFooter>\r\n                </AlertDialogContent>\r\n            </AlertDialog>\r\n\r\n            {/* Undo Last Bulk Upload Confirmation Dialog */}\r\n            <AlertDialog open={isUndoDialogOpen} onOpenChange={setIsUndoDialogOpen}>\r\n                <AlertDialogContent>\r\n                    <AlertDialogHeader>\r\n                        <AlertDialogTitle>Undo Last Bulk Upload?</AlertDialogTitle>\r\n                        <AlertDialogDescription>\r\n                            This will permanently delete the last batch of {lastBulkUploadInfo?.ids.length || 0} uploaded document(s). This action cannot be undone.\r\n                        </AlertDialogDescription>\r\n                    </AlertDialogHeader>\r\n                    <AlertDialogFooter>\r\n                        <AlertDialogCancel>Cancel</AlertDialogCancel>\r\n                        <AlertDialogAction onClick={handleUndoLastBulkUpload} className=\"bg-destructive hover:bg-destructive/90\">\r\n                            Yes, Undo Upload\r\n                        </AlertDialogAction>\r\n                    </AlertDialogFooter>\r\n                </AlertDialogContent>\r\n            </AlertDialog>\r\n        </>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\FileSafe\\studio\\src\\components\\dashboard\\bulk-upload\\bulk-upload-dialog.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":14,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":14,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[533,536],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[533,536],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'users' is defined but never used.","line":17,"column":58,"nodeType":null,"messageId":"unusedVar","endLine":17,"endColumn":63}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState } from 'react';\r\nimport { Dialog, DialogContent, DialogTrigger, DialogHeader, DialogTitle, DialogDescription } from '@/components/ui/dialog';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Upload } from 'lucide-react';\r\nimport { StageOne } from './stage-one';\r\nimport { StageTwo } from './stage-two';\r\nimport { StageThree } from './stage-three';\r\nimport { FileRow } from './types';\r\n\r\ninterface BulkUploadDialogProps {\r\n    onBulkUploadComplete?: (count: number) => void;\r\n    users?: any[]; // Allow passing users even if we don't use them strictly in StageTwo yet (it fetches)\r\n}\r\n\r\nexport function BulkUploadDialog({ onBulkUploadComplete, users }: BulkUploadDialogProps) {\r\n    const [open, setOpen] = useState(false);\r\n    const [stage, setStage] = useState<1 | 2 | 3>(1);\r\n\r\n    // Global Config (Stage 1)\r\n    const [globalConfig, setGlobalConfig] = useState({\r\n        docType: 'Salary Slip',\r\n        month: new Date().getMonth().toString(), // 0-11\r\n        year: new Date().getFullYear().toString()\r\n    });\r\n\r\n    // Files Data (Stage 2)\r\n    const [fileRows, setFileRows] = useState<FileRow[]>([]);\r\n\r\n    const handleStageOneComplete = (files: File[], config: typeof globalConfig) => {\r\n        setGlobalConfig(config);\r\n        const initialRows: FileRow[] = files.map((file, index) => ({\r\n            id: `file-${index}-${Date.now()}`,\r\n            file,\r\n            originalName: file.name,\r\n            status: 'pending',\r\n            selected: true,\r\n            detectedName: '',\r\n            employeeId: '',\r\n            docType: config.docType,\r\n            month: config.month,\r\n            year: config.year\r\n        }));\r\n\r\n        setFileRows(initialRows);\r\n        setStage(2);\r\n    };\r\n\r\n    const handleStageTwoComplete = (updatedRows: FileRow[]) => {\r\n        setFileRows(updatedRows);\r\n        setStage(3);\r\n    };\r\n\r\n    const handleRetry = (rows: FileRow[]) => {\r\n        const rowsForRetry = rows.map(r =>\r\n            r.status === 'error'\r\n                ? { ...r, status: 'pending' as const, errorMessage: undefined }\r\n                : r\r\n        );\r\n        setFileRows(rowsForRetry);\r\n        setStage(2);\r\n    };\r\n\r\n    const handleClose = (isOpen: boolean) => {\r\n        if (!isOpen) {\r\n            // If we are in Stage 3 and finished, we assume success for the batch that passed.\r\n            // But actually, onBulkUploadComplete should probably be triggered explicitly when user clicks 'Done'.\r\n            // However, if they close the dialog, we might want to refresh anyway if we are in Stage 3.\r\n            if (stage === 3) {\r\n                const successCount = fileRows.filter(r => r.status === 'success').length;\r\n                if (successCount > 0 && onBulkUploadComplete) {\r\n                    onBulkUploadComplete(successCount);\r\n                }\r\n            }\r\n\r\n            // Reset on close\r\n            setTimeout(() => {\r\n                setStage(1);\r\n                setFileRows([]);\r\n            }, 300);\r\n        }\r\n        setOpen(isOpen);\r\n    }\r\n\r\n    return (\r\n        <Dialog open={open} onOpenChange={handleClose}>\r\n            <DialogTrigger asChild>\r\n                <Button className=\"bg-blue-600 hover:bg-blue-700 text-white\">\r\n                    <Upload className=\"mr-2 h-4 w-4\" />\r\n                    Bulk Upload\r\n                </Button>\r\n            </DialogTrigger>\r\n            <DialogContent className=\"max-w-[95vw] w-full h-[90vh] sm:max-w-6xl flex flex-col p-0 gap-0 overflow-hidden\">\r\n                <DialogHeader className=\"p-6 border-b\">\r\n                    <DialogTitle className=\"text-2xl font-semibold tracking-tight\">Bulk Document Upload</DialogTitle>\r\n                    <DialogDescription className=\"text-muted-foreground text-sm\">\r\n                        Stage {stage} of 3: {stage === 1 ? 'Setup' : stage === 2 ? 'Review & Match' : 'Uploading'}\r\n                    </DialogDescription>\r\n                </DialogHeader>\r\n\r\n                <div className=\"flex-1 overflow-hidden relative\">\r\n                    {stage === 1 && (\r\n                        <StageOne\r\n                            defaultConfig={globalConfig}\r\n                            onNext={handleStageOneComplete}\r\n                        />\r\n                    )}\r\n                    {stage === 2 && (\r\n                        <StageTwo\r\n                            rows={fileRows}\r\n                            onBack={() => setStage(1)}\r\n                            onNext={handleStageTwoComplete}\r\n                            defaultConfig={globalConfig}\r\n                        />\r\n                    )}\r\n                    {stage === 3 && (\r\n                        <StageThree\r\n                            rows={fileRows}\r\n                            onClose={() => handleClose(false)} // This manually triggers close logic above\r\n                            onRetry={handleRetry}\r\n                        />\r\n                    )}\r\n                </div>\r\n            </DialogContent>\r\n        </Dialog>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\FileSafe\\studio\\src\\components\\dashboard\\bulk-upload\\stage-one.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Input' is defined but never used.","line":6,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":15}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useCallback } from 'react';\r\nimport { useDropzone } from 'react-dropzone';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Label } from '@/components/ui/label';\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\r\nimport { UploadCloud, File as FileIcon, X } from 'lucide-react';\r\nimport { GlobalConfig } from './types';\r\nimport { documentTypesList } from '@/lib/mock-data'; // Or fetch from DB\r\n\r\ninterface StageOneProps {\r\n    defaultConfig: GlobalConfig;\r\n    onNext: (files: File[], config: GlobalConfig) => void;\r\n}\r\n\r\nexport function StageOne({ defaultConfig, onNext }: StageOneProps) {\r\n    const [config, setConfig] = useState(defaultConfig);\r\n    const [files, setFiles] = useState<File[]>([]);\r\n\r\n    const onDrop = useCallback((acceptedFiles: File[]) => {\r\n        setFiles(prev => [...prev, ...acceptedFiles]);\r\n    }, []);\r\n\r\n    const { getRootProps, getInputProps, isDragActive } = useDropzone({ onDrop });\r\n\r\n    const removeFile = (index: number) => {\r\n        setFiles(prev => prev.filter((_, i) => i !== index));\r\n    };\r\n\r\n    const months = [\"January\", \"February\", \"March\", \"April\", \"May\", \"June\", \"July\", \"August\", \"September\", \"October\", \"November\", \"December\"];\r\n    const years = Array.from({ length: 5 }, (_, i) => (new Date().getFullYear() - 1 + i).toString());\r\n\r\n    return (\r\n        <div className=\"h-full flex flex-col p-6 gap-6 overflow-y-auto\">\r\n            <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\r\n                <div className=\"space-y-2\">\r\n                    <Label>Document Type</Label>\r\n                    <Select value={config.docType} onValueChange={(v) => setConfig(prev => ({ ...prev, docType: v }))}>\r\n                        <SelectTrigger>\r\n                            <SelectValue placeholder=\"Select type\" />\r\n                        </SelectTrigger>\r\n                        <SelectContent>\r\n                            {documentTypesList.map(t => <SelectItem key={t} value={t}>{t}</SelectItem>)}\r\n                        </SelectContent>\r\n                    </Select>\r\n                </div>\r\n                <div className=\"space-y-2\">\r\n                    <Label>Month</Label>\r\n                    <Select value={config.month} onValueChange={(v) => setConfig(prev => ({ ...prev, month: v }))}>\r\n                        <SelectTrigger>\r\n                            <SelectValue placeholder=\"Select month\" />\r\n                        </SelectTrigger>\r\n                        <SelectContent>\r\n                            {months.map((m, i) => <SelectItem key={i} value={i.toString()}>{m}</SelectItem>)}\r\n                        </SelectContent>\r\n                    </Select>\r\n                </div>\r\n                <div className=\"space-y-2\">\r\n                    <Label>Year</Label>\r\n                    <Select value={config.year} onValueChange={(v) => setConfig(prev => ({ ...prev, year: v }))}>\r\n                        <SelectTrigger>\r\n                            <SelectValue placeholder=\"Select year\" />\r\n                        </SelectTrigger>\r\n                        <SelectContent>\r\n                            {years.map(y => <SelectItem key={y} value={y}>{y}</SelectItem>)}\r\n                        </SelectContent>\r\n                    </Select>\r\n                </div>\r\n            </div>\r\n\r\n            <div\r\n                {...getRootProps()}\r\n                className={`border-2 border-dashed rounded-lg p-12 flex flex-col items-center justify-center text-center cursor-pointer transition-colors\r\n            ${isDragActive ? 'border-primary bg-primary/5' : 'border-muted-foreground/25 hover:border-primary/50'}`}\r\n            >\r\n                <input {...getInputProps()} />\r\n                <div className=\"round-full bg-muted p-4 rounded-full mb-4\">\r\n                    <UploadCloud className=\"h-8 w-8 text-muted-foreground\" />\r\n                </div>\r\n                <h3 className=\"text-lg font-semibold\">Drop files here or click to browse</h3>\r\n                <p className=\"text-sm text-muted-foreground mt-2\">\r\n                    Accepts PDF, Images, ZIP. (ZIP files will be extracted in the next step - <b>Not actually implemented yet!</b>)\r\n                </p>\r\n            </div>\r\n\r\n            {files.length > 0 && (\r\n                <div className=\"space-y-2\">\r\n                    <h4 className=\"text-sm font-medium\">Selected Files ({files.length})</h4>\r\n                    <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-2\">\r\n                        {files.map((file, i) => (\r\n                            <div key={i} className=\"flex items-center justify-between p-2 border rounded bg-background text-sm\">\r\n                                <div className=\"flex items-center gap-2 truncate\">\r\n                                    <FileIcon className=\"h-4 w-4 text-blue-500 shrink-0\" />\r\n                                    <span className=\"truncate\">{file.name}</span>\r\n                                </div>\r\n                                <Button variant=\"ghost\" size=\"icon\" className=\"h-6 w-6 shrink-0\" onClick={() => removeFile(i)}>\r\n                                    <X className=\"h-4 w-4\" />\r\n                                </Button>\r\n                            </div>\r\n                        ))}\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            <div className=\"mt-auto flex justify-end pt-6\">\r\n                <Button size=\"lg\" onClick={() => onNext(files, config)} disabled={files.length === 0}>\r\n                    Proceed to Review\r\n                </Button>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\FileSafe\\studio\\src\\components\\dashboard\\bulk-upload\\stage-three.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'completedCount' is assigned a value but never used.","line":20,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":20,"endColumn":26}],"suppressedMessages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'rows'. Either include it or remove the dependency array.","line":79,"column":8,"nodeType":"ArrayExpression","endLine":79,"endColumn":10,"suggestions":[{"desc":"Update the dependencies array to be: [rows]","fix":{"range":[3328,3330],"text":"[rows]"}}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useEffect } from 'react';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Progress } from '@/components/ui/progress';\r\nimport { ScrollArea } from '@/components/ui/scroll-area';\r\nimport { FileRow } from './types';\r\nimport { CheckCircle2, XCircle, Loader2, Download } from 'lucide-react';\r\nimport { cn } from '@/lib/utils';\r\n\r\ninterface StageThreeProps {\r\n    rows: FileRow[];\r\n    onClose: () => void;\r\n    onRetry: (failedRows: FileRow[]) => void;\r\n}\r\n\r\nexport function StageThree({ rows: initialRows, onClose, onRetry }: StageThreeProps) {\r\n    const [rows, setRows] = useState<FileRow[]>(initialRows);\r\n    const [overallProgress, setOverallProgress] = useState(0);\r\n    const [completedCount, setCompletedCount] = useState(0);\r\n    const [isFinished, setIsFinished] = useState(false);\r\n\r\n    useEffect(() => {\r\n        const uploadFiles = async () => {\r\n            let completed = 0;\r\n\r\n            // Upload one by one\r\n            for (let i = 0; i < rows.length; i++) {\r\n                const row = rows[i];\r\n\r\n                // Skip if already success (in case of re-mount logic, though usually fresh) or not selected?\r\n                // Rows passed here are \"to be processed\".\r\n\r\n                // Client-Side Validation\r\n                if (!row.employeeId) {\r\n                    setRows(prev => prev.map((r, idx) => idx === i ? { ...r, status: 'error', errorMessage: 'No Employee Selected' } : r));\r\n                    completed++;\r\n                    setCompletedCount(completed);\r\n                    setOverallProgress(Math.round((completed / rows.length) * 100));\r\n                    continue;\r\n                }\r\n\r\n                // Update status to uploading\r\n                setRows(prev => prev.map((r, idx) => idx === i ? { ...r, status: 'uploading' } : r));\r\n\r\n                try {\r\n                    const formData = new FormData();\r\n                    formData.append('file', row.file);\r\n                    formData.append('userId', row.employeeId);\r\n                    formData.append('docType', row.docType);\r\n                    formData.append('month', row.month);\r\n                    formData.append('year', row.year);\r\n                    formData.append('detectedName', row.detectedName);\r\n\r\n                    const res = await fetch('/api/admin/bulk-upload', {\r\n                        method: 'POST',\r\n                        body: formData,\r\n                    });\r\n\r\n                    if (!res.ok) throw new Error('Upload failed');\r\n\r\n                    await res.json(); // Consum body\r\n\r\n                    setRows(prev => prev.map((r, idx) => idx === i ? { ...r, status: 'success' } : r));\r\n                } catch (error) {\r\n                    console.error(`Error uploading ${row.originalName}:`, error);\r\n                    setRows(prev => prev.map((r, idx) => idx === i ? { ...r, status: 'error', errorMessage: 'Upload Failed' } : r));\r\n                } finally {\r\n                    completed++;\r\n                    setCompletedCount(completed);\r\n                    setOverallProgress(Math.round((completed / rows.length) * 100));\r\n                }\r\n            }\r\n            setIsFinished(true);\r\n        };\r\n\r\n        uploadFiles();\r\n        // eslint-disable-next-line react-hooks/exhaustive-deps\r\n    }, []); // Run on mount\r\n\r\n    const failedRows = rows.filter(r => r.status === 'error');\r\n    const successCount = rows.filter(r => r.status === 'success').length;\r\n    const failCount = failedRows.length;\r\n\r\n    const handleDownloadReport = () => {\r\n        const csvContent = \"data:text/csv;charset=utf-8,\"\r\n            + \"Original Filename,Employee Match,Status,Error Message\\n\"\r\n            + rows.map(r => `\"${r.originalName}\",\"${r.detectedName}\",\"${r.status}\",\"${r.errorMessage || ''}\"`).join(\"\\n\");\r\n\r\n        const encodedUri = encodeURI(csvContent);\r\n        const link = document.createElement(\"a\");\r\n        link.setAttribute(\"href\", encodedUri);\r\n        link.setAttribute(\"download\", `upload_report_${new Date().getTime()}.csv`);\r\n        document.body.appendChild(link);\r\n        link.click();\r\n        document.body.removeChild(link);\r\n    };\r\n\r\n    return (\r\n        <div className=\"h-full flex flex-col p-6 max-w-3xl mx-auto w-full\">\r\n            <div className=\"mb-6 text-center space-y-4\">\r\n                <h3 className=\"text-xl font-semibold\">\r\n                    {!isFinished ? 'Uploading Documents...' : 'Upload Completed'}\r\n                </h3>\r\n                <Progress value={overallProgress} className=\"h-4\" />\r\n                <div className=\"flex justify-center gap-6 text-sm\">\r\n                    <span className=\"text-muted-foreground\">Total: {rows.length}</span>\r\n                    <span className=\"text-green-600\">Success: {successCount}</span>\r\n                    <span className=\"text-destructive\">Failed: {failCount}</span>\r\n                </div>\r\n            </div>\r\n\r\n            <ScrollArea className=\"flex-1 border rounded-md p-4 mb-6 bg-muted/10\">\r\n                <div className=\"space-y-3\">\r\n                    {rows.map(row => (\r\n                        <div key={row.id} className=\"flex items-center justify-between text-sm p-2 rounded hover:bg-muted/20\">\r\n                            <div className=\"flex items-center gap-3\">\r\n                                {row.status === 'pending' && <div className=\"h-2 w-2 rounded-full bg-muted-foreground/30\" />}\r\n                                {row.status === 'uploading' && <Loader2 className=\"h-4 w-4 animate-spin text-blue-500\" />}\r\n                                {row.status === 'success' && <CheckCircle2 className=\"h-5 w-5 text-green-500\" />}\r\n                                {row.status === 'error' && <XCircle className=\"h-5 w-5 text-destructive\" />}\r\n\r\n                                <div className=\"flex flex-col\">\r\n                                    <span className={cn(\"font-medium\", row.status === 'success' && \"text-muted-foreground\")}>\r\n                                        {row.originalName}\r\n                                    </span>\r\n                                    {row.employeeName && <span className=\"text-xs text-muted-foreground\">User: {row.employeeName}</span>}\r\n                                </div>\r\n                            </div>\r\n                            <div className=\"text-right\">\r\n                                {row.status === 'uploading' && <span className=\"text-xs text-blue-500\">Uploading...</span>}\r\n                                {row.status === 'success' && <span className=\"text-xs text-green-600 font-medium\">Uploaded</span>}\r\n                                {row.status === 'error' && <span className=\"text-xs text-destructive font-medium\">{row.errorMessage || 'Error'}</span>}\r\n                            </div>\r\n                        </div>\r\n                    ))}\r\n                </div>\r\n            </ScrollArea>\r\n\r\n            {isFinished && (\r\n                <div className=\"flex flex-col gap-4\">\r\n                    {failCount > 0 && (\r\n                        <div className=\"flex items-center justify-between bg-destructive/10 p-4 rounded-md border border-destructive/20 text-destructive text-sm\">\r\n                            <span className=\"flex items-center\"><XCircle className=\"w-4 h-4 mr-2\" /> {failCount} items failed to upload.</span>\r\n                            <Button\r\n                                variant=\"destructive\"\r\n                                size=\"sm\"\r\n                                onClick={() => onRetry(rows)}\r\n                            >\r\n                                Review & Retry Failed\r\n                            </Button>\r\n                        </div>\r\n                    )}\r\n\r\n                    <div className=\"flex justify-center gap-4 pt-4 border-t\">\r\n                        <Button variant=\"outline\" onClick={handleDownloadReport}>\r\n                            <Download className=\"mr-2 h-4 w-4\" />\r\n                            Download Report\r\n                        </Button>\r\n                        <Button onClick={onClose} variant={failCount > 0 ? 'secondary' : 'default'} className=\"min-w-[120px]\">\r\n                            {failCount > 0 ? 'Close & Exit' : 'Done'}\r\n                        </Button>\r\n                    </div>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\FileSafe\\studio\\src\\components\\dashboard\\bulk-upload\\stage-two.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'useCallback' is defined but never used.","line":3,"column":31,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":42},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Input' is defined but never used.","line":5,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Search' is defined but never used.","line":24,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":24,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Calculator' is defined but never used.","line":24,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":24,"endColumn":28},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'CalendarIcon' is defined but never used.","line":24,"column":30,"nodeType":null,"messageId":"unusedVar","endLine":24,"endColumn":42},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'cn' is defined but never used.","line":26,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":26,"endColumn":12},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'handleEmployeeSearch' is assigned a value but never used.","line":113,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":113,"endColumn":31},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'rowId' is defined but never used.","line":113,"column":56,"nodeType":null,"messageId":"unusedVar","endLine":113,"endColumn":61},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":135,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":135,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5412,5415],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5412,5415],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'defaultConfig.docType', 'defaultConfig.month', 'defaultConfig.year', and 'rows'. Either include them or remove the dependency array.","line":94,"column":8,"nodeType":"ArrayExpression","endLine":94,"endColumn":10,"suggestions":[{"desc":"Update the dependencies array to be: [defaultConfig.docType, defaultConfig.month, defaultConfig.year, rows]","fix":{"range":[3409,3411],"text":"[defaultConfig.docType, defaultConfig.month, defaultConfig.year, rows]"}}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":9,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useEffect, useCallback } from 'react';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Checkbox } from '@/components/ui/checkbox';\r\nimport {\r\n    Table,\r\n    TableBody,\r\n    TableCell,\r\n    TableHead,\r\n    TableHeader,\r\n    TableRow,\r\n} from '@/components/ui/table';\r\nimport {\r\n    Select,\r\n    SelectContent,\r\n    SelectItem,\r\n    SelectTrigger,\r\n    SelectValue\r\n} from '@/components/ui/select';\r\nimport { FileRow, GlobalConfig } from './types';\r\nimport { parseFilename } from '@/lib/file-parser';\r\nimport { Search, Calculator, CalendarIcon, ArrowLeft, ArrowRight, CheckCircle2, AlertCircle } from 'lucide-react';\r\nimport { documentTypesList } from '@/lib/mock-data';\r\nimport { cn } from '@/lib/utils';\r\nimport { Badge } from '@/components/ui/badge';\r\n\r\ninterface StageTwoProps {\r\n    rows: FileRow[];\r\n    onBack: () => void;\r\n    onNext: (rows: FileRow[]) => void;\r\n    defaultConfig: GlobalConfig;\r\n}\r\n\r\ninterface EmployeeSearchResult {\r\n    id: string;\r\n    name: string;\r\n    email: string;\r\n    department: string;\r\n    employeeCode: string;\r\n}\r\n\r\nexport function StageTwo({ rows: initialRows, onBack, onNext, defaultConfig }: StageTwoProps) {\r\n    const [rows, setRows] = useState<FileRow[]>(initialRows);\r\n    const [isProcessing, setIsProcessing] = useState(true);\r\n\r\n    // Parsing Effect\r\n    useEffect(() => {\r\n        const processRows = async () => {\r\n            const newRows = [...rows];\r\n\r\n            for (const row of newRows) {\r\n                // Skip if already processed (has parsed name)\r\n                if (row.detectedName) continue;\r\n\r\n                const parsed = parseFilename(row.originalName);\r\n                row.detectedName = parsed.detectedName;\r\n\r\n                // Apply parsed metadata or fallback to global config\r\n                // If parsed returns month/year, use it, else use global\r\n                row.month = parsed.detectedMonth ? (parseInt(parsed.detectedMonth) - 1).toString() : defaultConfig.month;\r\n                row.year = parsed.detectedYear || defaultConfig.year;\r\n                row.docType = defaultConfig.docType;\r\n\r\n                // Search for employee\r\n                try {\r\n                    const res = await fetch(`/api/admin/search-employees?q=${encodeURIComponent(parsed.detectedName)}`);\r\n                    const matches: EmployeeSearchResult[] = await res.json();\r\n\r\n                    if (matches && matches.length > 0) {\r\n                        // Exact match heuristic or take first\r\n                        const bestMatch = matches[0];\r\n                        row.employeeId = bestMatch.id;\r\n                        row.employeeName = bestMatch.name;\r\n                        row.employeeCode = bestMatch.employeeCode;\r\n                        row.department = bestMatch.department;\r\n                        row.status = 'pending'; // Ready\r\n                    } else {\r\n                        row.status = 'error'; // No match\r\n                    }\r\n                } catch (e) {\r\n                    console.error(\"Search failed for\", row.originalName, e);\r\n                    row.status = 'error';\r\n                }\r\n            }\r\n\r\n            setRows(newRows);\r\n            setIsProcessing(false);\r\n        };\r\n\r\n        processRows();\r\n        // eslint-disable-next-line react-hooks/exhaustive-deps\r\n    }, []); // Run once on mount (or when rows change if we were adding more)\r\n\r\n    const toggleSelectAll = (checked: boolean) => {\r\n        setRows(prev => prev.map(r => ({ ...r, selected: checked })));\r\n    };\r\n\r\n    const toggleSelectRow = (id: string, checked: boolean) => {\r\n        setRows(prev => prev.map(r => r.id === id ? { ...r, selected: checked } : r));\r\n    };\r\n\r\n    const updateRow = (id: string, updates: Partial<FileRow>) => {\r\n        setRows(prev => prev.map(r => r.id === id ? { ...r, ...updates } : r));\r\n    };\r\n\r\n    // Bulk Actions\r\n    const selectedCount = rows.filter(r => r.selected).length;\r\n    const allSelected = rows.length > 0 && selectedCount === rows.length;\r\n    const someSelected = selectedCount > 0 && selectedCount < rows.length;\r\n\r\n    const handleEmployeeSearch = async (query: string, rowId: string) => {\r\n        // This is for the manual dropdown search\r\n        // Ideally we use a Combobox component here. \r\n        // For simplicity in this vanilla implementation, let's assume direct input or simplified flow.\r\n        // But user asked for \"Dropdown/Searchable select\".\r\n        // We'll simulate a fetch and return promise for a AsyncSelect if we had one.\r\n        return fetch(`/api/admin/search-employees?q=${query}`).then(res => res.json());\r\n    }\r\n\r\n    // Helper to check if we can proceed\r\n    // Relaxed rule: Ensure at least one file is selected. \r\n    // We allow proceeding with missing info, but Stage 3 will mark them as failed.\r\n    const canProceed = rows.some(r => r.selected);\r\n\r\n    return (\r\n        <div className=\"h-full flex flex-col overflow-hidden\">\r\n            {/* Toolbar */}\r\n            <div className=\"p-4 border-b flex flex-wrap items-center gap-4 bg-muted/20\">\r\n                <div className=\"flex items-center gap-2\">\r\n                    <Checkbox\r\n                        checked={allSelected}\r\n                        onCheckedChange={(c) => toggleSelectAll(!!c)}\r\n                        ref={(el) => { if (el) (el as any).indeterminate = someSelected; }}\r\n                    />\r\n                    <span className=\"text-sm font-medium\">{selectedCount} Selected</span>\r\n                </div>\r\n\r\n                <div className=\"h-4 w-px bg-border mx-2\" />\r\n\r\n                <Button variant=\"outline\" size=\"sm\" disabled={selectedCount === 0}>\r\n                    Set Document Type\r\n                </Button>\r\n                <Button variant=\"outline\" size=\"sm\" disabled={selectedCount === 0}>\r\n                    Set Date\r\n                </Button>\r\n            </div>\r\n\r\n            {/* Table Content */}\r\n            <div className=\"flex-1 overflow-auto\">\r\n                <Table>\r\n                    <TableHeader className=\"sticky top-0 bg-background z-10 shadow-sm\">\r\n                        <TableRow>\r\n                            <TableHead className=\"w-[50px]\"></TableHead>\r\n                            <TableHead>File</TableHead>\r\n                            <TableHead>Detected Name</TableHead>\r\n                            <TableHead className=\"w-[300px]\">Employee Match</TableHead>\r\n                            <TableHead>Department</TableHead>\r\n                            <TableHead>Type</TableHead>\r\n                            <TableHead>Date</TableHead>\r\n                            <TableHead>Status</TableHead>\r\n                        </TableRow>\r\n                    </TableHeader>\r\n                    <TableBody>\r\n                        {rows.map(row => (\r\n                            <TableRow key={row.id} className={!row.selected ? 'opacity-50' : ''}>\r\n                                <TableCell>\r\n                                    <Checkbox\r\n                                        checked={row.selected}\r\n                                        onCheckedChange={(c) => toggleSelectRow(row.id, !!c)}\r\n                                        disabled={row.status === 'success'}\r\n                                    />\r\n                                </TableCell>\r\n                                <TableCell className=\"font-medium\">\r\n                                    <div className=\"flex flex-col\">\r\n                                        <span className=\"truncate max-w-[200px]\" title={row.originalName}>{row.originalName}</span>\r\n                                        {/* <span className=\"text-xs text-muted-foreground\">Original</span> */}\r\n                                    </div>\r\n                                </TableCell>\r\n                                <TableCell>{row.detectedName}</TableCell>\r\n                                <TableCell>\r\n                                    {/* Simple Employee Selector / Display */}\r\n                                    {row.employeeId ? (\r\n                                        <div className=\"flex flex-col\">\r\n                                            <span className=\"font-medium text-sm\">{row.employeeName}</span>\r\n                                            <span className=\"text-xs text-muted-foreground\">{row.employeeCode}</span>\r\n                                        </div>\r\n                                        // TODO: Add 'Change' button or make this a dropdown trigger\r\n                                    ) : (\r\n                                        // Only show select for pending/error\r\n                                        row.status !== 'success' ? (\r\n                                            <Button variant=\"outline\" size=\"sm\" className=\"text-red-500 border-red-200 hover:bg-red-50 w-full justify-start\">\r\n                                                Select Employee...\r\n                                            </Button>\r\n                                        ) : <span>Matched</span>\r\n                                    )}\r\n                                </TableCell>\r\n                                <TableCell>{row.department || '-'}</TableCell>\r\n                                <TableCell>\r\n                                    <Select value={row.docType} onValueChange={(v) => updateRow(row.id, { docType: v })} disabled={row.status === 'success'}>\r\n                                        <SelectTrigger className=\"h-8 w-[130px]\">\r\n                                            <SelectValue />\r\n                                        </SelectTrigger>\r\n                                        <SelectContent>\r\n                                            {documentTypesList.map(t => <SelectItem key={t} value={t}>{t}</SelectItem>)}\r\n                                        </SelectContent>\r\n                                    </Select>\r\n                                </TableCell>\r\n                                <TableCell className=\"whitespace-nowrap\">\r\n                                    {monthsShort[parseInt(row.month)]} {row.year}\r\n                                </TableCell>\r\n                                <TableCell>\r\n                                    {row.status === 'success' ? (\r\n                                        <Badge variant=\"outline\" className=\"text-green-600 border-green-200 bg-green-50\">\r\n                                            <CheckCircle2 className=\"w-3 h-3 mr-1\" /> Uploaded\r\n                                        </Badge>\r\n                                    ) : row.employeeId ? (\r\n                                        <Badge variant=\"outline\" className=\"text-blue-600 border-blue-200 bg-blue-50\">\r\n                                            <CheckCircle2 className=\"w-3 h-3 mr-1\" /> Ready\r\n                                        </Badge>\r\n                                    ) : (\r\n                                        <Badge variant=\"outline\" className=\"text-destructive border-destructive/50 bg-destructive/10\">\r\n                                            <AlertCircle className=\"w-3 h-3 mr-1\" /> No Match\r\n                                        </Badge>\r\n                                    )}\r\n                                </TableCell>\r\n                            </TableRow>\r\n                        ))}\r\n                        {rows.length === 0 && (\r\n                            <TableRow>\r\n                                <TableCell colSpan={8} className=\"h-24 text-center\">\r\n                                    No files loaded.\r\n                                </TableCell>\r\n                            </TableRow>\r\n                        )}\r\n                    </TableBody>\r\n                </Table>\r\n            </div>\r\n\r\n            {/* Footer */}\r\n            <div className=\"p-4 border-t bg-muted/20 flex justify-between items-center\">\r\n                <Button variant=\"ghost\" onClick={onBack}>\r\n                    <ArrowLeft className=\"mr-2 h-4 w-4\" /> Back to Setup\r\n                </Button>\r\n\r\n                <div className=\"flex items-center gap-4\">\r\n                    <div className=\"text-sm text-muted-foreground\">\r\n                        {rows.filter(r => r.selected && !r.employeeId).length > 0 &&\r\n                            <span className=\"text-destructive flex items-center\">\r\n                                <AlertCircle className=\"w-4 h-4 mr-1\" />\r\n                                {rows.filter(r => r.selected && !r.employeeId).length} selected rows missing employee match\r\n                            </span>\r\n                        }\r\n                    </div>\r\n                    <Button onClick={() => onNext(rows.filter(r => r.selected))} disabled={!canProceed || isProcessing}>\r\n                        {isProcessing ? 'Processing...' : `Confirm & Upload (${rows.filter(r => r.selected).length})`}\r\n                        <ArrowRight className=\"ml-2 h-4 w-4\" />\r\n                    </Button>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\nconst monthsShort = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\FileSafe\\studio\\src\\components\\dashboard\\bulk-user-import-dialog.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":44,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":44,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1387,1390],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1387,1390],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useCallback has a missing dependency: 'handleFileParse'. Either include it or remove the dependency array.","line":118,"column":6,"nodeType":"ArrayExpression","endLine":118,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [handleFileParse]","fix":{"range":[4376,4378],"text":"[handleFileParse]"}}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_row' is defined but never used.","line":129,"column":17,"nodeType":null,"messageId":"unusedVar","endLine":129,"endColumn":21},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_errors' is defined but never used.","line":129,"column":23,"nodeType":null,"messageId":"unusedVar","endLine":129,"endColumn":30}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\r\n\r\nimport { useState, useCallback } from 'react';\r\nimport { useDropzone } from 'react-dropzone';\r\nimport Papa from 'papaparse';\r\nimport {\r\n  Dialog,\r\n  DialogContent,\r\n  DialogDescription,\r\n  DialogFooter,\r\n  DialogHeader,\r\n  DialogTitle,\r\n  DialogTrigger,\r\n} from '@/components/ui/dialog';\r\nimport { Button } from '@/components/ui/button';\r\nimport { UploadCloud, Users, AlertCircle, CheckCircle, Loader2, Download } from 'lucide-react';\r\nimport { type User } from '@/lib/mock-data';\r\nimport { useToast } from '@/hooks/use-toast';\r\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from '../ui/table';\r\n\r\ninterface BulkUserImportDialogProps {\r\n  onImport: (users: User[]) => void;\r\n  children: React.ReactNode;\r\n}\r\n\r\nconst requiredHeaders = ['id', 'name', 'email', 'role', 'status'];\r\n\r\ntype ParsedUser = Partial<User> & {\r\n    _row: number;\r\n    _errors: string[];\r\n}\r\n\r\nexport function BulkUserImportDialog({ onImport, children }: BulkUserImportDialogProps) {\r\n  const [open, setOpen] = useState(false);\r\n  const [parsedUsers, setParsedUsers] = useState<ParsedUser[]>([]);\r\n  const [fileName, setFileName] = useState<string | null>(null);\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const { toast } = useToast();\r\n\r\n  const handleFileParse = (file: File) => {\r\n    setIsLoading(true);\r\n    setFileName(file.name);\r\n    \r\n    Papa.parse<any>(file, {\r\n      header: true,\r\n      skipEmptyLines: true,\r\n      complete: (results) => {\r\n        if (results.errors.length) {\r\n            toast({\r\n                variant: 'destructive',\r\n                title: 'CSV Parsing Error',\r\n                description: results.errors.map(e => e.message).join(', '),\r\n            });\r\n            setIsLoading(false);\r\n            return;\r\n        }\r\n\r\n        const headers = results.meta.fields || [];\r\n        const missingHeaders = requiredHeaders.filter(h => !headers.includes(h));\r\n        if (missingHeaders.length > 0) {\r\n            toast({\r\n                variant: 'destructive',\r\n                title: 'Invalid CSV Format',\r\n                description: `The following required columns are missing: ${missingHeaders.join(', ')}`,\r\n            });\r\n            setIsLoading(false);\r\n            setFileName(null);\r\n            return;\r\n        }\r\n\r\n        const validatedUsers = results.data.map((row, index) => {\r\n            const user: ParsedUser = { _row: index + 2, _errors: [] };\r\n            \r\n            // Basic validation\r\n            if (!row.id) user._errors.push('ID is missing.');\r\n            if (!row.name) user._errors.push('Name is missing.');\r\n            if (!row.email || !/\\S+@\\S+\\.\\S+/.test(row.email)) user._errors.push('A valid email is required.');\r\n            if (!['admin', 'employee'].includes(row.role)) user._errors.push('Role must be \"admin\" or \"employee\".');\r\n            if (!['active', 'inactive', 'pending', 'deleted'].includes(row.status)) user._errors.push('Status is invalid.');\r\n\r\n            // If no errors, map the data\r\n            if(user._errors.length === 0) {\r\n                Object.assign(user, {\r\n                    id: row.id,\r\n                    name: row.name,\r\n                    email: row.email,\r\n                    personalEmail: row.personalEmail,\r\n                    mobile: row.mobile,\r\n                    password: row.password, // Note: importing passwords might be a security risk.\r\n                    dateOfBirth: row.dateOfBirth,\r\n                    joiningDate: row.joiningDate,\r\n                    resignationDate: row.resignationDate,\r\n                    designation: row.designation,\r\n                    status: row.status as User['status'],\r\n                    department: row.department,\r\n                    bloodGroup: row.bloodGroup,\r\n                    company: row.company,\r\n                    location: row.location,\r\n                    role: row.role as User['role'],\r\n                    avatar: row.avatar || String(Date.now() + index),\r\n                });\r\n            } else {\r\n                Object.assign(user, row);\r\n            }\r\n            return user;\r\n        });\r\n\r\n        setParsedUsers(validatedUsers);\r\n        setIsLoading(false);\r\n      },\r\n    });\r\n  };\r\n\r\n  const onDrop = useCallback((acceptedFiles: File[]) => {\r\n    if (acceptedFiles.length > 0) {\r\n      handleFileParse(acceptedFiles[0]);\r\n    }\r\n  }, []);\r\n\r\n  const { getRootProps, getInputProps, isDragActive } = useDropzone({\r\n    onDrop,\r\n    accept: { 'text/csv': ['.csv'] },\r\n    multiple: false,\r\n  });\r\n  \r\n  const handleImport = () => {\r\n    const validUsers = parsedUsers\r\n        .filter(u => u._errors.length === 0)\r\n        .map(({ _row, _errors, ...user }) => user as User);\r\n    \r\n    if (validUsers.length > 0) {\r\n        onImport(validUsers);\r\n    }\r\n    \r\n    setOpen(false);\r\n    resetState();\r\n  };\r\n\r\n  const resetState = () => {\r\n    setParsedUsers([]);\r\n    setFileName(null);\r\n    setIsLoading(false);\r\n  }\r\n  \r\n  const handleOpenChange = (isOpen: boolean) => {\r\n    if (!isOpen) {\r\n        resetState();\r\n    }\r\n    setOpen(isOpen);\r\n  }\r\n\r\n  const handleDownloadSample = () => {\r\n    const sampleData = [\r\n        {\r\n            id: 'user-sample-1',\r\n            name: 'John Doe',\r\n            email: 'john.doe@example.com',\r\n            personalEmail: 'john.d@personal.com',\r\n            mobile: '123-456-7890',\r\n            password: 'password123',\r\n            dateOfBirth: '1990-01-01',\r\n            joiningDate: '2023-01-01',\r\n            resignationDate: '',\r\n            designation: 'Software Engineer',\r\n            status: 'active',\r\n            department: 'Engineering',\r\n            bloodGroup: 'O+',\r\n            company: 'ASE ENGINEERS PRIVATE LIMITED',\r\n            location: 'AMD',\r\n            role: 'employee',\r\n            avatar: '',\r\n        }\r\n    ];\r\n    const csv = Papa.unparse(sampleData);\r\n    const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });\r\n    const link = document.createElement('a');\r\n    const url = URL.createObjectURL(blob);\r\n    link.setAttribute('href', url);\r\n    link.setAttribute('download', 'user_import_sample.csv');\r\n    document.body.appendChild(link);\r\n    link.click();\r\n    document.body.removeChild(link);\r\n  };\r\n  \r\n  const hasErrors = parsedUsers.some(u => u._errors.length > 0);\r\n\r\n  return (\r\n    <Dialog open={open} onOpenChange={handleOpenChange}>\r\n      <DialogTrigger asChild>{children}</DialogTrigger>\r\n      <DialogContent className=\"sm:max-w-4xl\">\r\n        <DialogHeader>\r\n          <DialogTitle className=\"flex items-center gap-2\"><Users /> Bulk User Import</DialogTitle>\r\n          <DialogDescription className=\"flex justify-between items-center\">\r\n            <span>\r\n                Upload a CSV file to import multiple users at once.\r\n                Required columns: {requiredHeaders.join(', ')}.\r\n            </span>\r\n            <Button variant=\"link\" onClick={handleDownloadSample}>\r\n                <Download className=\"mr-2 h-4 w-4\" />\r\n                Download Sample CSV\r\n            </Button>\r\n          </DialogDescription>\r\n        </DialogHeader>\r\n\r\n        {!fileName ? (\r\n            <div {...getRootProps()} className={`relative border-2 border-dashed rounded-lg p-12 text-center transition-colors ${isDragActive ? 'border-primary bg-primary/10' : 'border-border'}`}>\r\n                <input {...getInputProps()} />\r\n                <div className=\"flex flex-col items-center gap-2 text-muted-foreground\">\r\n                    <UploadCloud className=\"h-12 w-12\" />\r\n                    {isLoading ? <p>Processing...</p> : <p>Drag & drop a CSV file here, or click to browse</p>}\r\n                </div>\r\n            </div>\r\n        ) : (\r\n            <div>\r\n                <h3 className=\"font-semibold mb-2\">Import Preview for: <span className=\"font-normal text-muted-foreground\">{fileName}</span></h3>\r\n                {isLoading ? (\r\n                     <div className=\"flex items-center justify-center h-48 gap-2 text-muted-foreground\">\r\n                        <Loader2 className=\"h-8 w-8 animate-spin\" />\r\n                        <p>Analyzing CSV...</p>\r\n                    </div>\r\n                ) : (\r\n                    <div className=\"max-h-96 overflow-y-auto border rounded-lg\">\r\n                        <Table>\r\n                            <TableHeader>\r\n                                <TableRow>\r\n                                    <TableHead>Status</TableHead>\r\n                                    <TableHead>ID</TableHead>\r\n                                    <TableHead>Name</TableHead>\r\n                                    <TableHead>Email</TableHead>\r\n                                    <TableHead>Role</TableHead>\r\n                                    <TableHead>Errors</TableHead>\r\n                                </TableRow>\r\n                            </TableHeader>\r\n                            <TableBody>\r\n                                {parsedUsers.map((user, index) => (\r\n                                    <TableRow key={index}>\r\n                                        <TableCell>\r\n                                            {user._errors.length > 0 ? \r\n                                                <AlertCircle className=\"h-5 w-5 text-destructive\" /> : \r\n                                                <CheckCircle className=\"h-5 w-5 text-green-500\" />\r\n                                            }\r\n                                        </TableCell>\r\n                                        <TableCell>{user.id}</TableCell>\r\n                                        <TableCell>{user.name}</TableCell>\r\n                                        <TableCell>{user.email}</TableCell>\r\n                                        <TableCell>{user.role}</TableCell>\r\n                                        <TableCell className=\"text-destructive text-xs\">\r\n                                            {user._errors.join(', ')}\r\n                                        </TableCell>\r\n                                    </TableRow>\r\n                                ))}\r\n                            </TableBody>\r\n                        </Table>\r\n                    </div>\r\n                )}\r\n            </div>\r\n        )}\r\n\r\n        <DialogFooter>\r\n          <Button variant=\"outline\" onClick={() => setOpen(false)}>Cancel</Button>\r\n          <Button onClick={handleImport} disabled={isLoading || parsedUsers.length === 0 || hasErrors}>\r\n            Import {parsedUsers.filter(u => u._errors.length === 0).length} Valid User(s)\r\n          </Button>\r\n        </DialogFooter>\r\n      </DialogContent>\r\n    </Dialog>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\FileSafe\\studio\\src\\components\\dashboard\\company-management-dialog.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'useToast' is defined but never used.","line":30,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":30,"endColumn":18}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\r\n'use client'\r\n\r\nimport { useState, useCallback } from 'react';\r\nimport { zodResolver } from '@hookform/resolvers/zod';\r\nimport { useForm } from 'react-hook-form';\r\nimport * as z from 'zod';\r\nimport {\r\n  Dialog,\r\n  DialogContent,\r\n  DialogDescription,\r\n  DialogFooter,\r\n  DialogHeader,\r\n  DialogTitle,\r\n  DialogTrigger,\r\n} from '@/components/ui/dialog';\r\nimport {\r\n    Form,\r\n    FormControl,\r\n    FormField,\r\n    FormItem,\r\n    FormLabel,\r\n    FormMessage,\r\n  } from '@/components/ui/form';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Textarea } from '@/components/ui/textarea';\r\nimport { Loader2, Camera } from 'lucide-react';\r\nimport type { Company } from '@/lib/mock-data';\r\nimport { useToast } from '@/hooks/use-toast';\r\nimport { useDropzone } from 'react-dropzone';\r\nimport Image from 'next/image';\r\n\r\nconst formSchema = z.object({\r\n  name: z.string().min(2, { message: 'Company name is required.' }),\r\n  shortName: z.string().min(1, { message: 'Short name is required.' }),\r\n  email: z.string().email({ message: 'A valid email is required.' }).optional().or(z.literal('')),\r\n  phone: z.string().optional(),\r\n  address: z.string().optional(),\r\n  logo: z.string().optional(),\r\n});\r\n\r\ninterface CompanyManagementDialogProps {\r\n  company?: Company;\r\n  onSave: (company: Company) => void;\r\n  children: React.ReactNode;\r\n}\r\n\r\nexport function CompanyManagementDialog({ company, onSave, children }: CompanyManagementDialogProps) {\r\n  const [open, setOpen] = useState(false);\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const [logoPreview, setLogoPreview] = useState<string | null>(null);\r\n  const isEditing = !!company;\r\n\r\n  const form = useForm<z.infer<typeof formSchema>>({\r\n    resolver: zodResolver(formSchema),\r\n    defaultValues: {\r\n      name: company?.name || '',\r\n      shortName: company?.shortName || '',\r\n      email: company?.email || '',\r\n      phone: company?.phone || '',\r\n      address: company?.address || '',\r\n      logo: company?.logo || '',\r\n    },\r\n  });\r\n\r\n  const onDrop = useCallback((acceptedFiles: File[]) => {\r\n    const file = acceptedFiles[0];\r\n    if (file) {\r\n      const reader = new FileReader();\r\n      reader.onloadend = () => {\r\n        const dataUri = reader.result as string;\r\n        setLogoPreview(dataUri);\r\n        form.setValue('logo', dataUri);\r\n      };\r\n      reader.readAsDataURL(file);\r\n    }\r\n  }, [form]);\r\n\r\n  const { getRootProps, getInputProps } = useDropzone({\r\n    onDrop,\r\n    accept: { 'image/*': [] },\r\n    multiple: false,\r\n  });\r\n\r\n  const onSubmit = (values: z.infer<typeof formSchema>) => {\r\n    setIsLoading(true);\r\n    setTimeout(() => {\r\n      onSave({\r\n        ...values,\r\n        id: company?.id || '', // id is handled by parent\r\n      });\r\n      setIsLoading(false);\r\n      setOpen(false);\r\n      form.reset();\r\n      setLogoPreview(null);\r\n    }, 500);\r\n  };\r\n\r\n  const handleOpenChange = (isOpen: boolean) => {\r\n    if (isOpen) {\r\n      form.reset({\r\n        name: company?.name || '',\r\n        shortName: company?.shortName || '',\r\n        email: company?.email || '',\r\n        phone: company?.phone || '',\r\n        address: company?.address || '',\r\n        logo: company?.logo || '',\r\n      });\r\n      setLogoPreview(null);\r\n    }\r\n    setOpen(isOpen);\r\n  };\r\n\r\n  const currentLogo = logoPreview || company?.logo;\r\n\r\n  return (\r\n    <Dialog open={open} onOpenChange={handleOpenChange}>\r\n      <DialogTrigger asChild>{children}</DialogTrigger>\r\n      <DialogContent className=\"sm:max-w-lg\">\r\n        <DialogHeader>\r\n          <DialogTitle>{isEditing ? 'Edit Company' : 'Add New Company'}</DialogTitle>\r\n          <DialogDescription>\r\n            {isEditing ? `Update details for ${company.name}.` : 'Enter the details for the new company.'}\r\n          </DialogDescription>\r\n        </DialogHeader>\r\n        <Form {...form}>\r\n          <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-4 max-h-[70vh] overflow-y-auto pr-6\">\r\n            <div className=\"flex justify-center\">\r\n              <div {...getRootProps()} className=\"relative cursor-pointer group\">\r\n                <input {...getInputProps()} />\r\n                <div className=\"h-24 w-24 rounded-full bg-muted flex items-center justify-center border\">\r\n                  {currentLogo ? (\r\n                    <Image src={currentLogo} width={96} height={96} alt=\"Company Logo\" className=\"rounded-full object-cover h-full w-full\" />\r\n                  ) : (\r\n                    <span className=\"text-sm text-muted-foreground\">Logo</span>\r\n                  )}\r\n                   <div className=\"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-50 rounded-full flex items-center justify-center transition-opacity\">\r\n                        <Camera className=\"h-8 w-8 text-white opacity-0 group-hover:opacity-100\" />\r\n                    </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n            <FormField\r\n              control={form.control}\r\n              name=\"name\"\r\n              render={({ field }) => (\r\n                <FormItem>\r\n                  <FormLabel>Company Name</FormLabel>\r\n                  <FormControl><Input placeholder=\"Full legal name\" {...field} /></FormControl>\r\n                  <FormMessage />\r\n                </FormItem>\r\n              )}\r\n            />\r\n            <FormField\r\n              control={form.control}\r\n              name=\"shortName\"\r\n              render={({ field }) => (\r\n                <FormItem>\r\n                  <FormLabel>Short Name / Abbreviation</FormLabel>\r\n                  <FormControl><Input placeholder=\"e.g., ACME\" {...field} /></FormControl>\r\n                  <FormMessage />\r\n                </FormItem>\r\n              )}\r\n            />\r\n            <FormField\r\n              control={form.control}\r\n              name=\"email\"\r\n              render={({ field }) => (\r\n                <FormItem>\r\n                  <FormLabel>Email</FormLabel>\r\n                  <FormControl><Input placeholder=\"contact@company.com\" {...field} /></FormControl>\r\n                  <FormMessage />\r\n                </FormItem>\r\n              )}\r\n            />\r\n            <FormField\r\n              control={form.control}\r\n              name=\"phone\"\r\n              render={({ field }) => (\r\n                <FormItem>\r\n                  <FormLabel>Phone Number</FormLabel>\r\n                  <FormControl><Input placeholder=\"+1-123-456-7890\" {...field} /></FormControl>\r\n                  <FormMessage />\r\n                </FormItem>\r\n              )}\r\n            />\r\n             <FormField\r\n              control={form.control}\r\n              name=\"address\"\r\n              render={({ field }) => (\r\n                <FormItem>\r\n                  <FormLabel>Address</FormLabel>\r\n                  <FormControl><Textarea placeholder=\"Company's full address\" {...field} /></FormControl>\r\n                  <FormMessage />\r\n                </FormItem>\r\n              )}\r\n            />\r\n            <DialogFooter className=\"pt-4\">\r\n              <Button type=\"submit\" disabled={isLoading}>\r\n                {isLoading && <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />}\r\n                {isEditing ? 'Save Changes' : 'Add Company'}\r\n              </Button>\r\n            </DialogFooter>\r\n          </form>\r\n        </Form>\r\n      </DialogContent>\r\n    </Dialog>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\FileSafe\\studio\\src\\components\\dashboard\\delete-announcement-dialog.tsx","messages":[{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":42,"column":137,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[1227,1253],"text":" the announcement titled &quot;"},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[1227,1253],"text":" the announcement titled &ldquo;"},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[1227,1253],"text":" the announcement titled &#34;"},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[1227,1253],"text":" the announcement titled &rdquo;"},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":42,"column":143,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[1258,1281],"text":"&quot;\r\n                    "},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[1258,1281],"text":"&ldquo;\r\n                    "},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[1258,1281],"text":"&#34;\r\n                    "},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[1258,1281],"text":"&rdquo;\r\n                    "},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":47,"column":67,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[1447,1516],"text":"\r\n                    This action will move the announcement titled &quot;"},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[1447,1516],"text":"\r\n                    This action will move the announcement titled &ldquo;"},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[1447,1516],"text":"\r\n                    This action will move the announcement titled &#34;"},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[1447,1516],"text":"\r\n                    This action will move the announcement titled &rdquo;"},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":47,"column":73,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[1521,1544],"text":"&quot;\r\n                    "},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[1521,1544],"text":"&ldquo;\r\n                    "},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[1521,1544],"text":"&#34;\r\n                    "},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[1521,1544],"text":"&rdquo;\r\n                    "},"desc":"Replace with `&rdquo;`."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\r\n'use client';\r\n\r\nimport {\r\n  AlertDialog,\r\n  AlertDialogAction,\r\n  AlertDialogCancel,\r\n  AlertDialogContent,\r\n  AlertDialogDescription,\r\n  AlertDialogFooter,\r\n  AlertDialogHeader,\r\n  AlertDialogTitle,\r\n  AlertDialogTrigger,\r\n} from '@/components/ui/alert-dialog';\r\nimport type { Announcement } from '@/lib/mock-data';\r\nimport { useState } from 'react';\r\n\r\ninterface DeleteAnnouncementDialogProps {\r\n  announcement: Announcement;\r\n  onDelete: () => void;\r\n  isPermanent: boolean;\r\n  children: React.ReactNode;\r\n}\r\n\r\nexport function DeleteAnnouncementDialog({ announcement, onDelete, isPermanent, children }: DeleteAnnouncementDialogProps) {\r\n  const [open, setOpen] = useState(false);\r\n\r\n  const handleDelete = () => {\r\n    onDelete();\r\n    setOpen(false);\r\n  };\r\n\r\n  return (\r\n    <AlertDialog open={open} onOpenChange={setOpen}>\r\n      <AlertDialogTrigger asChild>{children}</AlertDialogTrigger>\r\n      <AlertDialogContent>\r\n        <AlertDialogHeader>\r\n          <AlertDialogTitle>Are you absolutely sure?</AlertDialogTitle>\r\n          <AlertDialogDescription>\r\n            {isPermanent ? (\r\n                <>\r\n                    This action will <span className=\"font-semibold text-destructive\">permanently delete</span> the announcement titled \"{' '}\"\r\n                    <span className=\"font-semibold text-foreground\">{announcement.title}</span>. This action cannot be undone.\r\n                </>\r\n            ) : (\r\n                <>\r\n                    This action will move the announcement titled \"{' '}\"\r\n                    <span className=\"font-semibold text-foreground\">{announcement.title}</span> to the deleted announcements list.\r\n                    You can restore it later.\r\n                </>\r\n            )}\r\n          </AlertDialogDescription>\r\n        </AlertDialogHeader>\r\n        <AlertDialogFooter>\r\n          <AlertDialogCancel>Cancel</AlertDialogCancel>\r\n          <AlertDialogAction onClick={handleDelete} className=\"bg-destructive hover:bg-destructive/90\">\r\n            {isPermanent ? 'Delete Permanently' : 'Delete'}\r\n          </AlertDialogAction>\r\n        </AlertDialogFooter>\r\n      </AlertDialogContent>\r\n    </AlertDialog>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\FileSafe\\studio\\src\\components\\dashboard\\employee-management-dialog.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":118,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":118,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4122,4125],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4122,4125],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\r\n\r\n'use client';\r\n\r\nimport { useState } from 'react';\r\nimport { zodResolver } from '@hookform/resolvers/zod';\r\nimport { useForm } from 'react-hook-form';\r\nimport * as z from 'zod';\r\nimport {\r\n  Dialog,\r\n  DialogContent,\r\n  DialogDescription,\r\n  DialogFooter,\r\n  DialogHeader,\r\n  DialogTitle,\r\n  DialogTrigger,\r\n} from '@/components/ui/dialog';\r\nimport {\r\n    Form,\r\n    FormControl,\r\n    FormField,\r\n    FormItem,\r\n    FormLabel,\r\n    FormMessage,\r\n  } from '@/components/ui/form';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Loader2 } from 'lucide-react';\r\nimport type { User, Company } from '@/lib/mock-data';\r\nimport { locations } from '@/lib/mock-data';\r\nimport {\r\n  Select,\r\n  SelectContent,\r\n  SelectItem,\r\n  SelectTrigger,\r\n  SelectValue,\r\n} from '@/components/ui/select';\r\nimport { useToast } from '@/hooks/use-toast';\r\n\r\nconst locationKeys = Object.keys(locations) as [string, ...string[]] | [];\r\n\r\nconst baseFormSchema = z.object({\r\n  id: z.string().min(1, { message: 'Employee ID is required.' }),\r\n  name: z.string().min(2, { message: 'Name must be at least 2 characters.' }),\r\n  email: z.string().email({ message: 'Please enter a valid official email.' }),\r\n  personalEmail: z.string().email({ message: 'Please enter a valid personal email.' }).optional().or(z.literal('')),\r\n  mobile: z.string().optional(),\r\n  emergencyContact: z.string().optional(),\r\n  password: z.string().optional(),\r\n  dateOfBirth: z.string().optional(),\r\n  joiningDate: z.string().optional(),\r\n  resignationDate: z.string().optional(),\r\n  designation: z.string().optional(),\r\n  status: z.enum(['active', 'inactive', 'pending']),\r\n  department: z.string().optional(),\r\n  bloodGroup: z.string().optional(),\r\n  company: z.string().optional(),\r\n  location: z.enum(locationKeys as [string, ...string[]]).optional(),\r\n  role: z.enum(['admin', 'employee']),\r\n});\r\n\r\n\r\ninterface EmployeeManagementDialogProps {\r\n  employee?: User;\r\n  onSave: (employee: Partial<User> & { originalId?: string }) => void;\r\n  children: React.ReactNode;\r\n  departments: string[];\r\n  companies: Company[];\r\n}\r\n\r\nexport function EmployeeManagementDialog({ employee, onSave, children, departments = [], companies = [] }: EmployeeManagementDialogProps) {\r\n  const [open, setOpen] = useState(false);\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const { toast } = useToast();\r\n  const isEditing = !!employee;\r\n\r\n  const companyNames = companies.length > 0 ? companies.map(c => c.name) as [string, ...string[]] : [] as const;\r\n  \r\n  const formSchema = baseFormSchema.extend({\r\n      company: z.enum(companyNames).optional(),\r\n  });\r\n\r\n  const form = useForm<z.infer<typeof formSchema>>({\r\n    resolver: zodResolver(formSchema),\r\n    defaultValues: {\r\n      id: employee?.id || '',\r\n      name: employee?.name || '',\r\n      email: employee?.email || '',\r\n      personalEmail: employee?.personalEmail || '',\r\n      mobile: employee?.mobile || '',\r\n      emergencyContact: employee?.emergencyContact || '',\r\n      password: '',\r\n      dateOfBirth: employee?.dateOfBirth || '',\r\n      joiningDate: employee?.joiningDate || '',\r\n      resignationDate: employee?.resignationDate || '',\r\n      designation: employee?.designation || '',\r\n      status: (employee?.status === 'active' || employee?.status === 'inactive' || employee?.status === 'pending') ? employee.status : 'active',\r\n      department: employee?.department || '',\r\n      bloodGroup: employee?.bloodGroup || '',\r\n      company: employee?.company,\r\n      location: employee?.location,\r\n      role: employee?.role || 'employee',\r\n    },\r\n  });\r\n  \r\n  const finalSchema = isEditing \r\n  ? formSchema \r\n  : formSchema.extend({\r\n      password: z.string().min(8, { message: 'Password must be at least 8 characters.' }),\r\n    });\r\n\r\n\r\n  const onSubmit = (values: z.infer<typeof formSchema>) => {\r\n    const validation = finalSchema.safeParse(values);\r\n    if (!validation.success) {\r\n        Object.entries(validation.error.flatten().fieldErrors).forEach(([name, errors]) => {\r\n            if (errors) {\r\n                 form.setError(name as any, { type: 'manual', message: errors[0] });\r\n            }\r\n        });\r\n        return;\r\n    }\r\n\r\n    setIsLoading(true);\r\n    setTimeout(() => {\r\n      const userData: Partial<User> & { originalId?: string } = {\r\n        ...validation.data,\r\n        originalId: employee?.id,\r\n      };\r\n\r\n      if (!userData.password) {\r\n        delete userData.password;\r\n      }\r\n      \r\n      onSave(userData);\r\n\r\n      if (isEditing) {\r\n        toast({\r\n            title: \"Profile Updated\",\r\n            description: `The profile for ${employee.name} has been successfully updated.`,\r\n        });\r\n      }\r\n      \r\n      setIsLoading(false);\r\n      setOpen(false);\r\n      if (!isEditing) {\r\n        form.reset({ id: '', name: '', email: '', personalEmail: '', mobile: '', password: '', dateOfBirth: '', joiningDate: '', resignationDate: '', designation: '', status: 'active', department: '', bloodGroup: '', role: 'employee' });\r\n      } else {\r\n        form.reset({ ...values, password: '' }); \r\n      }\r\n    }, 1000);\r\n  };\r\n  \r\n  const handleOpenChange = (isOpen: boolean) => {\r\n    if (isOpen) {\r\n        form.reset({\r\n            id: employee?.id || '',\r\n            name: employee?.name || '',\r\n            email: employee?.email || '',\r\n            personalEmail: employee?.personalEmail || '',\r\n            mobile: employee?.mobile || '',\r\n            emergencyContact: employee?.emergencyContact || '',\r\n            password: '',\r\n            dateOfBirth: employee?.dateOfBirth || '',\r\n            joiningDate: employee?.joiningDate || '',\r\n            resignationDate: employee?.resignationDate || '',\r\n            designation: employee?.designation || '',\r\n            status: (employee?.status === 'active' || employee?.status === 'inactive' || employee?.status === 'pending') ? employee.status : 'active',\r\n            department: employee?.department || '',\r\n            bloodGroup: employee?.bloodGroup || '',\r\n            company: employee?.company,\r\n            location: employee?.location,\r\n            role: employee?.role || 'employee',\r\n        });\r\n    }\r\n    setOpen(isOpen);\r\n  }\r\n\r\n  return (\r\n    <Dialog open={open} onOpenChange={handleOpenChange}>\r\n      <DialogTrigger asChild>{children}</DialogTrigger>\r\n      <DialogContent className=\"sm:max-w-2xl\">\r\n        <DialogHeader>\r\n          <DialogTitle>{isEditing ? 'Edit Employee' : 'Add New Employee'}</DialogTitle>\r\n          <DialogDescription>\r\n            {isEditing ? `Update the details for ${employee.name}. Leave password blank to keep it unchanged.` : 'Enter the details for the new employee.'}\r\n          </DialogDescription>\r\n        </DialogHeader>\r\n        <Form {...form}>\r\n          <form onSubmit={form.handleSubmit(onSubmit)} className=\"grid grid-cols-1 sm:grid-cols-2 gap-4 py-4 max-h-[70vh] overflow-y-auto pr-6\">\r\n             <FormField\r\n              control={form.control}\r\n              name=\"id\"\r\n              render={({ field }) => (\r\n                <FormItem className=\"col-span-1\">\r\n                  <FormLabel>Employee ID</FormLabel>\r\n                  <FormControl>\r\n                    <Input placeholder=\"user-id-123\" {...field} />\r\n                  </FormControl>\r\n                  <FormMessage />\r\n                </FormItem>\r\n              )}\r\n            />\r\n            <FormField\r\n              control={form.control}\r\n              name=\"name\"\r\n              render={({ field }) => (\r\n                <FormItem className=\"col-span-1\">\r\n                  <FormLabel>Full Name</FormLabel>\r\n                  <FormControl>\r\n                    <Input placeholder=\"John Doe\" {...field} />\r\n                  </FormControl>\r\n                  <FormMessage />\r\n                </FormItem>\r\n              )}\r\n            />\r\n            <FormField\r\n              control={form.control}\r\n              name=\"email\"\r\n              render={({ field }) => (\r\n                <FormItem className=\"col-span-1\">\r\n                  <FormLabel>Official Email</FormLabel>\r\n                  <FormControl>\r\n                    <Input placeholder=\"john.doe@company.com\" {...field} />\r\n                  </FormControl>\r\n                  <FormMessage />\r\n                </FormItem>\r\n              )}\r\n            />\r\n             <FormField\r\n              control={form.control}\r\n              name=\"personalEmail\"\r\n              render={({ field }) => (\r\n                <FormItem className=\"col-span-1\">\r\n                  <FormLabel>Personal Email</FormLabel>\r\n                  <FormControl>\r\n                    <Input placeholder=\"john.doe@personal.com\" {...field} />\r\n                  </FormControl>\r\n                  <FormMessage />\r\n                </FormItem>\r\n              )}\r\n            />\r\n            <FormField\r\n              control={form.control}\r\n              name=\"mobile\"\r\n              render={({ field }) => (\r\n                <FormItem className=\"col-span-1\">\r\n                  <FormLabel>Mobile No.</FormLabel>\r\n                  <FormControl>\r\n                    <div className=\"relative\">\r\n                        <div className=\"pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3\">\r\n                            <span className=\"text-gray-500 sm:text-sm\">+91</span>\r\n                        </div>\r\n                        <Input placeholder=\"123-456-7890\" {...field} className=\"pl-12\"/>\r\n                    </div>\r\n                  </FormControl>\r\n                  <FormMessage />\r\n                </FormItem>\r\n              )}\r\n            />\r\n            <FormField\r\n              control={form.control}\r\n              name=\"emergencyContact\"\r\n              render={({ field }) => (\r\n                <FormItem className=\"col-span-1\">\r\n                  <FormLabel>Emergency Contact</FormLabel>\r\n                   <FormControl>\r\n                    <div className=\"relative\">\r\n                        <div className=\"pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3\">\r\n                            <span className=\"text-gray-500 sm:text-sm\">+91</span>\r\n                        </div>\r\n                        <Input placeholder=\"987-654-3210\" {...field} className=\"pl-12\" />\r\n                    </div>\r\n                  </FormControl>\r\n                  <FormMessage />\r\n                </FormItem>\r\n              )}\r\n            />\r\n             <FormField\r\n              control={form.control}\r\n              name=\"dateOfBirth\"\r\n              render={({ field }) => (\r\n                <FormItem className=\"col-span-1\">\r\n                  <FormLabel>Date of Birth</FormLabel>\r\n                  <FormControl>\r\n                    <Input type=\"date\" {...field} />\r\n                  </FormControl>\r\n                  <FormMessage />\r\n                </FormItem>\r\n              )}\r\n            />\r\n            <FormField\r\n              control={form.control}\r\n              name=\"joiningDate\"\r\n              render={({ field }) => (\r\n                <FormItem className=\"col-span-1\">\r\n                  <FormLabel>Joining Date</FormLabel>\r\n                  <FormControl>\r\n                    <Input type=\"date\" {...field} />\r\n                  </FormControl>\r\n                  <FormMessage />\r\n                </FormItem>\r\n              )}\r\n            />\r\n             <FormField\r\n              control={form.control}\r\n              name=\"resignationDate\"\r\n              render={({ field }) => (\r\n                <FormItem className=\"col-span-1\">\r\n                  <FormLabel>Resignation Date</FormLabel>\r\n                  <FormControl>\r\n                    <Input type=\"date\" {...field} />\r\n                  </FormControl>\r\n                  <FormMessage />\r\n                </FormItem>\r\n              )}\r\n            />\r\n            <FormField\r\n              control={form.control}\r\n              name=\"password\"\r\n              render={({ field }) => (\r\n                <FormItem className=\"col-span-1\">\r\n                  <FormLabel>Password</FormLabel>\r\n                  <FormControl>\r\n                    <Input type=\"password\" placeholder={isEditing ? \"Leave blank to keep current\" : \"\"} {...field} />\r\n                  </FormControl>\r\n                  <FormMessage />\r\n                </FormItem>\r\n              )}\r\n            />\r\n             <FormField\r\n              control={form.control}\r\n              name=\"company\"\r\n              render={({ field }) => (\r\n                <FormItem className=\"col-span-1\">\r\n                  <FormLabel>Company</FormLabel>\r\n                  <Select onValueChange={field.onChange} defaultValue={field.value}>\r\n                    <FormControl>\r\n                      <SelectTrigger>\r\n                        <SelectValue placeholder=\"Select a company\" />\r\n                      </SelectTrigger>\r\n                    </FormControl>\r\n                    <SelectContent>\r\n                      {companies.map(c => (\r\n                        <SelectItem key={c.id} value={c.name}>{c.shortName}</SelectItem>\r\n                      ))}\r\n                    </SelectContent>\r\n                  </Select>\r\n                  <FormMessage />\r\n                </FormItem>\r\n              )}\r\n            />\r\n            <FormField\r\n              control={form.control}\r\n              name=\"location\"\r\n              render={({ field }) => (\r\n                <FormItem className=\"col-span-1\">\r\n                  <FormLabel>Location</FormLabel>\r\n                  <Select onValueChange={field.onChange} defaultValue={field.value}>\r\n                    <FormControl>\r\n                      <SelectTrigger>\r\n                        <SelectValue placeholder=\"Select a location\" />\r\n                      </SelectTrigger>\r\n                    </FormControl>\r\n                    <SelectContent>\r\n                      {locationKeys.map(loc => (\r\n                        <SelectItem key={loc} value={loc}>{loc}</SelectItem>\r\n                      ))}\r\n                    </SelectContent>\r\n                  </Select>\r\n                  <FormMessage />\r\n                </FormItem>\r\n              )}\r\n            />\r\n             <FormField\r\n              control={form.control}\r\n              name=\"department\"\r\n              render={({ field }) => (\r\n                <FormItem className=\"col-span-1\">\r\n                  <FormLabel>Department</FormLabel>\r\n                  <Select onValueChange={field.onChange} defaultValue={field.value}>\r\n                    <FormControl>\r\n                      <SelectTrigger>\r\n                        <SelectValue placeholder=\"Select a department\" />\r\n                      </SelectTrigger>\r\n                    </FormControl>\r\n                    <SelectContent>\r\n                      {departments.map(dept => (\r\n                        <SelectItem key={dept} value={dept}>{dept}</SelectItem>\r\n                      ))}\r\n                    </SelectContent>\r\n                  </Select>\r\n                  <FormMessage />\r\n                </FormItem>\r\n              )}\r\n            />\r\n            <FormField\r\n              control={form.control}\r\n              name=\"designation\"\r\n              render={({ field }) => (\r\n                <FormItem className=\"col-span-1\">\r\n                  <FormLabel>Designation</FormLabel>\r\n                  <FormControl>\r\n                    <Input placeholder=\"e.g. Software Engineer\" {...field} />\r\n                  </FormControl>\r\n                  <FormMessage />\r\n                </FormItem>\r\n              )}\r\n            />\r\n            <FormField\r\n                control={form.control}\r\n                name=\"bloodGroup\"\r\n                render={({ field }) => (\r\n                    <FormItem className=\"col-span-1\">\r\n                    <FormLabel>Blood Group</FormLabel>\r\n                    <FormControl>\r\n                        <Input placeholder=\"e.g. A+\" {...field} />\r\n                    </FormControl>\r\n                    <FormMessage />\r\n                    </FormItem>\r\n                )}\r\n            />\r\n            <FormField\r\n              control={form.control}\r\n              name=\"status\"\r\n              render={({ field }) => (\r\n                <FormItem className=\"col-span-1\">\r\n                  <FormLabel>Status</FormLabel>\r\n                  <Select onValueChange={field.onChange} defaultValue={field.value}>\r\n                    <FormControl>\r\n                      <SelectTrigger>\r\n                        <SelectValue placeholder=\"Select a status\" />\r\n                      </SelectTrigger>\r\n                    </FormControl>\r\n                    <SelectContent>\r\n                      <SelectItem value=\"active\">Active</SelectItem>\r\n                      <SelectItem value=\"inactive\">Inactive</SelectItem>\r\n                      <SelectItem value=\"pending\">Pending</SelectItem>\r\n                    </SelectContent>\r\n                  </Select>\r\n                  <FormMessage />\r\n                </FormItem>\r\n              )}\r\n            />\r\n            <FormField\r\n              control={form.control}\r\n              name=\"role\"\r\n              render={({ field }) => (\r\n                <FormItem className=\"col-span-1\">\r\n                  <FormLabel>Role</FormLabel>\r\n                  <Select onValueChange={field.onChange} defaultValue={field.value}>\r\n                    <FormControl>\r\n                      <SelectTrigger>\r\n                        <SelectValue placeholder=\"Select a role\" />\r\n                      </SelectTrigger>\r\n                    </FormControl>\r\n                    <SelectContent>\r\n                      <SelectItem value=\"admin\">Admin</SelectItem>\r\n                      <SelectItem value=\"employee\">Employee</SelectItem>\r\n                    </SelectContent>\r\n                  </Select>\r\n                  <FormMessage />\r\n                </FormItem>\r\n              )}\r\n            />\r\n             <DialogFooter className=\"col-span-1 sm:col-span-2 pt-4\">\r\n                <Button type=\"submit\" disabled={isLoading}>\r\n                    {isLoading && <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />}\r\n                    {isEditing ? 'Save Changes' : 'Create Employee'}\r\n                </Button>\r\n            </DialogFooter>\r\n          </form>\r\n        </Form>\r\n      </DialogContent>\r\n    </Dialog>\r\n  );\r\n}\r\n\r\n    ","usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\FileSafe\\studio\\src\\components\\dashboard\\employee-self-edit-dialog.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'useEffect' is defined but never used.","line":5,"column":33,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":42},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'isDragActive' is assigned a value but never used.","line":81,"column":40,"nodeType":null,"messageId":"unusedVar","endLine":81,"endColumn":52}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\r\n\r\n'use client';\r\n\r\nimport { useState, useCallback, useEffect } from 'react';\r\nimport { zodResolver } from '@hookform/resolvers/zod';\r\nimport { useForm } from 'react-hook-form';\r\nimport * as z from 'zod';\r\nimport {\r\n  Dialog,\r\n  DialogContent,\r\n  DialogDescription,\r\n  DialogFooter,\r\n  DialogHeader,\r\n  DialogTitle,\r\n  DialogTrigger,\r\n} from '@/components/ui/dialog';\r\nimport {\r\n  Form,\r\n  FormControl,\r\n  FormField,\r\n  FormItem,\r\n  FormLabel,\r\n  FormMessage,\r\n} from '@/components/ui/form';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Loader2, Camera } from 'lucide-react';\r\nimport type { User } from '@/lib/mock-data';\r\nimport { useToast } from '@/hooks/use-toast';\r\nimport Image from 'next/image';\r\nimport { useDropzone } from 'react-dropzone';\r\nimport { getAvatarSrc } from '@/lib/utils';\r\n\r\nconst formSchema = z.object({\r\n  personalEmail: z.string().email({ message: 'Please enter a valid email.' }).optional().or(z.literal('')),\r\n  mobile: z.string().optional(),\r\n  emergencyContact: z.string().optional(),\r\n  password: z.string().optional(),\r\n  avatar: z.string().optional(),\r\n  bloodGroup: z.string().optional(),\r\n});\r\n\r\ninterface EmployeeSelfEditDialogProps {\r\n  employee: User;\r\n  onSave: (employee: Partial<User> & { originalId?: string }) => void;\r\n  children: React.ReactNode;\r\n}\r\n\r\nexport function EmployeeSelfEditDialog({ employee, onSave, children }: EmployeeSelfEditDialogProps) {\r\n  const [open, setOpen] = useState(false);\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const [avatarPreview, setAvatarPreview] = useState<string | null>(null);\r\n  const { toast } = useToast();\r\n\r\n  const form = useForm<z.infer<typeof formSchema>>({\r\n    resolver: zodResolver(formSchema),\r\n    defaultValues: {\r\n      personalEmail: employee?.personalEmail || '',\r\n      mobile: employee?.mobile || '',\r\n      emergencyContact: employee?.emergencyContact || '',\r\n      password: '',\r\n      avatar: employee?.avatar,\r\n      bloodGroup: employee?.bloodGroup || '',\r\n    },\r\n  });\r\n\r\n  const onDrop = useCallback((acceptedFiles: File[]) => {\r\n    const file = acceptedFiles[0];\r\n    if (file) {\r\n      const reader = new FileReader();\r\n      reader.onloadend = () => {\r\n        const dataUri = reader.result as string;\r\n        setAvatarPreview(dataUri);\r\n        form.setValue('avatar', dataUri);\r\n      };\r\n      reader.readAsDataURL(file);\r\n    }\r\n  }, [form]);\r\n\r\n  const { getRootProps, getInputProps, isDragActive } = useDropzone({\r\n    onDrop,\r\n    accept: { 'image/*': [] },\r\n    multiple: false,\r\n  });\r\n\r\n  const onSubmit = (values: z.infer<typeof formSchema>) => {\r\n    setIsLoading(true);\r\n    setTimeout(() => {\r\n      const { password, ...rest } = values;\r\n      const userData: Partial<User> & { originalId?: string } = {\r\n        ...rest,\r\n        originalId: employee.id,\r\n      };\r\n\r\n      if (password) {\r\n        userData.password = password;\r\n      }\r\n\r\n      onSave(userData);\r\n\r\n      toast({\r\n        title: \"Profile Updated\",\r\n        description: \"Your profile information has been successfully updated.\",\r\n      });\r\n\r\n      setIsLoading(false);\r\n      setOpen(false);\r\n    }, 1000);\r\n  };\r\n\r\n  const handleOpenChange = (isOpen: boolean) => {\r\n    if (isOpen) {\r\n      form.reset({\r\n        personalEmail: employee?.personalEmail || '',\r\n        mobile: employee?.mobile || '',\r\n        emergencyContact: employee?.emergencyContact || '',\r\n        password: '',\r\n        avatar: employee?.avatar,\r\n        bloodGroup: employee?.bloodGroup || '',\r\n      });\r\n      setAvatarPreview(null);\r\n    }\r\n    setOpen(isOpen);\r\n  }\r\n\r\n  const currentAvatarSrc = avatarPreview || getAvatarSrc(employee);\r\n\r\n  return (\r\n    <Dialog open={open} onOpenChange={handleOpenChange}>\r\n      <DialogTrigger asChild>{children}</DialogTrigger>\r\n      <DialogContent className=\"sm:max-w-md\">\r\n        <DialogHeader>\r\n          <DialogTitle>Edit Your Profile</DialogTitle>\r\n          <DialogDescription>\r\n            Update your contact information. Leave password blank to keep it unchanged.\r\n          </DialogDescription>\r\n        </DialogHeader>\r\n        <Form {...form}>\r\n          <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-4 max-h-[70vh] overflow-y-auto pr-6\">\r\n            <div className=\"flex justify-center\">\r\n              <div {...getRootProps()} className=\"relative cursor-pointer group\">\r\n                <input {...getInputProps()} />\r\n                <Image\r\n                  src={currentAvatarSrc}\r\n                  width={128}\r\n                  height={128}\r\n                  className=\"rounded-full object-cover\"\r\n                  alt={employee.name ? employee.name : 'Profile'}\r\n                  data-ai-hint=\"person portrait\"\r\n                />\r\n                <div className=\"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-50 rounded-full flex items-center justify-center transition-opacity\">\r\n                  <Camera className=\"h-8 w-8 text-white opacity-0 group-hover:opacity-100\" />\r\n                </div>\r\n              </div>\r\n            </div>\r\n            <FormItem>\r\n              <FormLabel>Official Email</FormLabel>\r\n              <FormControl>\r\n                <Input value={employee.email} disabled />\r\n              </FormControl>\r\n            </FormItem>\r\n            <FormField\r\n              control={form.control}\r\n              name=\"personalEmail\"\r\n              render={({ field }) => (\r\n                <FormItem>\r\n                  <FormLabel>Personal Email</FormLabel>\r\n                  <FormControl>\r\n                    <Input placeholder=\"your.personal@email.com\" {...field} />\r\n                  </FormControl>\r\n                  <FormMessage />\r\n                </FormItem>\r\n              )}\r\n            />\r\n            <FormField\r\n              control={form.control}\r\n              name=\"mobile\"\r\n              render={({ field }) => (\r\n                <FormItem>\r\n                  <FormLabel>Mobile No.</FormLabel>\r\n                  <FormControl>\r\n                    <div className=\"relative\">\r\n                      <div className=\"pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3\">\r\n                        <span className=\"text-gray-500 sm:text-sm\">+91</span>\r\n                      </div>\r\n                      <Input placeholder=\"123-456-7890\" {...field} className=\"pl-12\" />\r\n                    </div>\r\n                  </FormControl>\r\n                  <FormMessage />\r\n                </FormItem>\r\n              )}\r\n            />\r\n            <FormField\r\n              control={form.control}\r\n              name=\"emergencyContact\"\r\n              render={({ field }) => (\r\n                <FormItem>\r\n                  <FormLabel>Emergency Contact</FormLabel>\r\n                  <FormControl>\r\n                    <div className=\"relative\">\r\n                      <div className=\"pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3\">\r\n                        <span className=\"text-gray-500 sm:text-sm\">+91</span>\r\n                      </div>\r\n                      <Input placeholder=\"987-654-3210\" {...field} className=\"pl-12\" />\r\n                    </div>\r\n                  </FormControl>\r\n                  <FormMessage />\r\n                </FormItem>\r\n              )}\r\n            />\r\n            <FormField\r\n              control={form.control}\r\n              name=\"bloodGroup\"\r\n              render={({ field }) => (\r\n                <FormItem>\r\n                  <FormLabel>Blood Group</FormLabel>\r\n                  <FormControl>\r\n                    <Input placeholder=\"e.g. A+\" {...field} />\r\n                  </FormControl>\r\n                  <FormMessage />\r\n                </FormItem>\r\n              )}\r\n            />\r\n            <FormField\r\n              control={form.control}\r\n              name=\"password\"\r\n              render={({ field }) => (\r\n                <FormItem>\r\n                  <FormLabel>New Password</FormLabel>\r\n                  <FormControl>\r\n                    <Input type=\"password\" placeholder=\"Leave blank to keep current\" {...field} />\r\n                  </FormControl>\r\n                  <FormMessage />\r\n                </FormItem>\r\n              )}\r\n            />\r\n            <DialogFooter className=\"pt-4\">\r\n              <Button type=\"submit\" disabled={isLoading}>\r\n                {isLoading && <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />}\r\n                Save Changes\r\n              </Button>\r\n            </DialogFooter>\r\n          </form>\r\n        </Form>\r\n      </DialogContent>\r\n    </Dialog>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\FileSafe\\studio\\src\\components\\dashboard\\employee-view.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'allDocuments' is defined but never used.","line":10,"column":23,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":35},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'allUsers' is defined but never used.","line":10,"column":46,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":54},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'initialHolidays' is defined but never used.","line":10,"column":87,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":102},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'initialAnnouncements' is defined but never used.","line":10,"column":156,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":176},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'AlertTriangle' is defined but never used.","line":34,"column":42,"nodeType":null,"messageId":"unusedVar","endLine":34,"endColumn":55},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'currentUserId' is assigned a value but never used.","line":39,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":39,"endColumn":20},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'session' is assigned a value but never used.","line":46,"column":19,"nodeType":null,"messageId":"unusedVar","endLine":46,"endColumn":26},{"ruleId":"prefer-const","severity":2,"message":"'sortableItems' is never reassigned. Use 'const' instead.","line":151,"column":13,"nodeType":"Identifier","messageId":"useConst","endLine":151,"endColumn":26,"fix":{"range":[6219,6262],"text":"const sortableItems = [...filteredDocuments];"}},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":173,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":173,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7021,7024],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7021,7024],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":187,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":187,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7632,7635],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7632,7635],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":10,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":1,"fixableWarningCount":0,"source":"\r\n'use client'\r\n\r\nimport { useState, useMemo, useCallback, useEffect } from 'react'\r\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from '@/components/ui/card'\r\nimport { DocumentList } from './document-list'\r\nimport { UploadDialog } from './upload-dialog'\r\nimport { useData } from '@/hooks/use-data'\r\nimport { useSession } from 'next-auth/react'\r\nimport { documents as allDocuments, users as allUsers, documentTypesList, holidays as initialHolidays, HolidayLocation, holidayLocations, announcements as initialAnnouncements, Announcement, User } from '@/lib/mock-data'\r\nimport type { Document } from '@/lib/mock-data'\r\nimport { Button } from '../ui/button'\r\nimport {\r\n    Select,\r\n    SelectContent,\r\n    SelectItem,\r\n    SelectTrigger,\r\n    SelectValue,\r\n} from '@/components/ui/select';\r\nimport {\r\n    Tabs,\r\n    TabsContent,\r\n    TabsList,\r\n    TabsTrigger,\r\n} from \"@/components/ui/tabs\"\r\nimport {\r\n    Table,\r\n    TableBody,\r\n    TableCell,\r\n    TableHead,\r\n    TableHeader,\r\n    TableRow,\r\n} from '@/components/ui/table'\r\nimport { Calendar, Bell, MailOpen, Mail, AlertTriangle } from 'lucide-react'\r\nimport { cn } from '@/lib/utils'\r\nimport { Label } from '../ui/label'\r\n\r\n// Simulate a logged-in employee user\r\nconst currentUserId = 'user-1'\r\ntype SortKey = keyof Document;\r\ntype SortDirection = 'ascending' | 'descending';\r\n\r\nconst monthNames = [\"January\", \"February\", \"March\", \"April\", \"May\", \"June\", \"July\", \"August\", \"September\", \"October\", \"November\", \"December\"];\r\n\r\nexport function EmployeeView() {\r\n    const { data: session } = useSession();\r\n    const { documents: serverDocuments, holidays: serverHolidays, announcements: serverAnnouncements, users: serverUsers, mutateDocuments } = useData();\r\n\r\n    // Local state for documents (though we could just use serverDocuments directly if we filtered them there)\r\n    // The API /api/documents returns filtered list for employees.\r\n    // So 'serverDocuments' IS 'userDocuments'.\r\n\r\n    const [sortConfig, setSortConfig] = useState<{ key: SortKey; direction: SortDirection } | null>({ key: 'uploadDate', direction: 'descending' });\r\n    const [selectedTypes, setSelectedTypes] = useState<string[]>(['All']);\r\n    const [selectedYear, setSelectedYear] = useState<string>('all');\r\n    const [selectedMonth, setSelectedMonth] = useState<string>('all');\r\n    const [holidayLocationFilter, setHolidayLocationFilter] = useState<HolidayLocation | 'all'>('all');\r\n    const [activeTab, setActiveTab] = useState('documents');\r\n\r\n    // Annoucements read status is local only for now unless we add an API for it (we have /api/announcement-reads table in schema? Yes)\r\n    // For now, let's simple-map it.\r\n    const [announcements, setAnnouncements] = useState<Announcement[]>([]);\r\n\r\n    useEffect(() => {\r\n        if (serverAnnouncements) {\r\n            setAnnouncements(serverAnnouncements.map(a => ({\r\n                ...a,\r\n                isRead: false, // Default unread from server unless we fetch read status\r\n                // TODO: fetch status\r\n                status: a.status || 'published'\r\n            } as Announcement)));\r\n        }\r\n    }, [serverAnnouncements]);\r\n\r\n    const hasUnreadAnnouncements = useMemo(() => announcements.some(a => !a.isRead), [announcements]);\r\n\r\n    useEffect(() => {\r\n        const handleViewAnnouncements = () => {\r\n            setActiveTab('announcements');\r\n        };\r\n        window.addEventListener('view-announcements', handleViewAnnouncements);\r\n        return () => {\r\n            window.removeEventListener('view-announcements', handleViewAnnouncements);\r\n        };\r\n    }, []);\r\n\r\n    const handleUploadComplete = useCallback(() => {\r\n        mutateDocuments();\r\n    }, [mutateDocuments])\r\n\r\n    const requestSort = useCallback((key: SortKey) => {\r\n        setSortConfig(currentSortConfig => {\r\n            let direction: SortDirection = 'ascending';\r\n            if (currentSortConfig && currentSortConfig.key === key && currentSortConfig.direction === 'ascending') {\r\n                direction = 'descending';\r\n            }\r\n            return { key, direction };\r\n        });\r\n    }, []);\r\n\r\n    const handleTypeSelection = useCallback((type: string) => {\r\n        setSelectedTypes(prevTypes => {\r\n            if (type === 'All') {\r\n                return ['All'];\r\n            }\r\n\r\n            const newTypes = prevTypes.filter(t => t !== 'All');\r\n\r\n            if (newTypes.includes(type)) {\r\n                const filteredTypes = newTypes.filter(t => t !== type);\r\n                return filteredTypes.length === 0 ? ['All'] : filteredTypes;\r\n            } else {\r\n                return [...newTypes, type];\r\n            }\r\n        });\r\n    }, []);\r\n\r\n    const { docYears, docMonths } = useMemo(() => {\r\n        const years = new Set<string>();\r\n        const months = new Set<number>();\r\n\r\n\r\n\r\n        (serverDocuments as Document[])\r\n            .filter(doc => selectedTypes.includes('All') || selectedTypes.includes(doc.type))\r\n            .forEach(doc => {\r\n                const date = new Date(doc.uploadDate);\r\n                years.add(date.getFullYear().toString());\r\n                if (selectedYear === 'all' || date.getFullYear().toString() === selectedYear) {\r\n                    months.add(date.getMonth());\r\n                }\r\n            });\r\n\r\n        return {\r\n            docYears: Array.from(years).sort((a, b) => Number(b) - Number(a)),\r\n            docMonths: Array.from(months).sort((a, b) => a - b)\r\n        };\r\n    }, [serverDocuments, selectedTypes, selectedYear]);\r\n\r\n    const filteredDocuments = useMemo(() => {\r\n        return (serverDocuments as Document[]).filter(doc => {\r\n            const date = new Date(doc.uploadDate);\r\n            const typeMatch = selectedTypes.includes('All') || selectedTypes.includes(doc.type);\r\n            const yearMatch = selectedYear === 'all' || date.getFullYear().toString() === selectedYear;\r\n            const monthMatch = selectedMonth === 'all' || date.getMonth().toString() === selectedMonth;\r\n            return typeMatch && yearMatch && monthMatch;\r\n        });\r\n    }, [serverDocuments, selectedTypes, selectedYear, selectedMonth]);\r\n\r\n    const sortedAndFilteredDocuments = useMemo(() => {\r\n        let sortableItems = [...filteredDocuments];\r\n        if (sortConfig !== null) {\r\n            sortableItems.sort((a, b) => {\r\n                const aValue = a[sortConfig.key];\r\n                const bValue = b[sortConfig.key];\r\n\r\n                if (aValue < bValue) {\r\n                    return sortConfig.direction === 'ascending' ? -1 : 1;\r\n                }\r\n                if (aValue > bValue) {\r\n                    return sortConfig.direction === 'ascending' ? 1 : -1;\r\n                }\r\n                return 0;\r\n            });\r\n        }\r\n        return sortableItems;\r\n    }, [filteredDocuments, sortConfig]);\r\n\r\n    const { holidayYears, holidayMonths } = useMemo(() => {\r\n        const years = new Set<string>();\r\n        const months = new Set<number>();\r\n\r\n        (serverHolidays as any[]).forEach(holiday => {\r\n            const date = new Date(holiday.date);\r\n            years.add(date.getFullYear().toString());\r\n            if (selectedYear === 'all' || date.getFullYear().toString() === selectedYear) {\r\n                months.add(date.getMonth());\r\n            }\r\n        });\r\n        return {\r\n            holidayYears: Array.from(years).sort((a, b) => Number(b) - Number(a)),\r\n            holidayMonths: Array.from(months).sort((a, b) => a - b)\r\n        };\r\n    }, [serverHolidays, selectedYear]);\r\n\r\n    const filteredHolidays = useMemo(() => {\r\n        return [...(serverHolidays as any[])]\r\n            .filter(holiday => {\r\n                const date = new Date(holiday.date);\r\n                const locationMatch = holidayLocationFilter === 'all' || holiday.location === 'ALL' || holiday.location === holidayLocationFilter;\r\n                const yearMatch = selectedYear === 'all' || date.getFullYear().toString() === selectedYear;\r\n                const monthMatch = selectedMonth === 'all' || date.getMonth().toString() === selectedMonth;\r\n                return locationMatch && yearMatch && monthMatch;\r\n            })\r\n            .sort((a, b) => new Date(a.date).getTime() - new Date(b.date).getTime());\r\n    }, [serverHolidays, holidayLocationFilter, selectedYear, selectedMonth]);\r\n\r\n    const { announcementYears, announcementMonths } = useMemo(() => {\r\n        const years = new Set<string>();\r\n        const months = new Set<number>();\r\n        announcements.forEach(announcement => {\r\n            const date = new Date(announcement.date);\r\n            years.add(date.getFullYear().toString());\r\n            if (selectedYear === 'all' || date.getFullYear().toString() === selectedYear) {\r\n                months.add(date.getMonth());\r\n            }\r\n        });\r\n        return {\r\n            announcementYears: Array.from(years).sort((a, b) => Number(b) - Number(a)),\r\n            announcementMonths: Array.from(months).sort((a, b) => a - b)\r\n        };\r\n    }, [announcements, selectedYear]);\r\n\r\n    const filteredAnnouncements = useMemo(() => {\r\n        return [...announcements]\r\n            .filter(announcement => announcement.status === 'published')\r\n            .filter(announcement => {\r\n                const date = new Date(announcement.date);\r\n                const yearMatch = selectedYear === 'all' || date.getFullYear().toString() === selectedYear;\r\n                const monthMatch = selectedMonth === 'all' || date.getMonth().toString() === selectedMonth;\r\n                return yearMatch && monthMatch;\r\n            })\r\n            .sort((a, b) => new Date(b.date).getTime() - new Date(a.date).getTime())\r\n    }, [announcements, selectedYear, selectedMonth]);\r\n\r\n    const onTabChange = useCallback((value: string) => {\r\n        setActiveTab(value);\r\n        setSelectedYear('all');\r\n        setSelectedMonth('all');\r\n        if (value === 'announcements') {\r\n            setTimeout(() => {\r\n                setAnnouncements(prev => prev.map(a => ({ ...a, isRead: true })));\r\n                localStorage.setItem('announcements_all_read', 'true');\r\n                window.dispatchEvent(new Event('storage'));\r\n            }, 200);\r\n        }\r\n    }, []);\r\n\r\n    const toggleAnnouncementRead = useCallback((id: string) => {\r\n        setAnnouncements(prev => prev.map(a => a.id === id ? { ...a, isRead: !a.isRead } : a));\r\n    }, []);\r\n\r\n    const isEventUpcoming = (eventDate?: string) => {\r\n        if (!eventDate) return false;\r\n        if (typeof window === 'undefined') return false;\r\n        const today = new Date();\r\n        today.setHours(0, 0, 0, 0);\r\n        const eDate = new Date(eventDate);\r\n        eDate.setTime(eDate.getTime() + eDate.getTimezoneOffset() * 60 * 1000); // Adjust for timezone\r\n        return eDate >= today;\r\n    }\r\n\r\n    return (\r\n        <>\r\n            <div className=\"flex items-center justify-between\">\r\n                <div className=\"grid gap-2\">\r\n                    <h1 className=\"text-3xl font-bold tracking-tight\">Employee Dashboard</h1>\r\n                    <p className=\"text-muted-foreground\">Access and manage your personal and company documents.</p>\r\n                </div>\r\n                <UploadDialog onUploadComplete={handleUploadComplete} />\r\n            </div>\r\n\r\n            <Tabs value={activeTab} onValueChange={onTabChange} className=\"pt-4\">\r\n                <TabsList>\r\n                    <TabsTrigger value=\"documents\">My Documents</TabsTrigger>\r\n                    <TabsTrigger value=\"holidays\">Holiday List</TabsTrigger>\r\n                    <TabsTrigger value=\"announcements\" className=\"relative\">\r\n                        Announcements\r\n                        {hasUnreadAnnouncements && <span className=\"relative flex h-3 w-3 ml-2\">\r\n                            <span className=\"animate-ping absolute inline-flex h-full w-full rounded-full bg-red-400 opacity-75\"></span>\r\n                            <span className=\"relative inline-flex rounded-full h-3 w-3 bg-red-500\"></span>\r\n                        </span>}\r\n                    </TabsTrigger>\r\n                </TabsList>\r\n                <TabsContent value=\"documents\">\r\n                    <Card className=\"mb-4\">\r\n                        <CardHeader>\r\n                            <CardTitle>Filter by</CardTitle>\r\n                        </CardHeader>\r\n                        <CardContent className=\"space-y-4\">\r\n                            <div>\r\n                                <Label className=\"text-sm font-medium\">Document Type</Label>\r\n                                <div className=\"flex flex-wrap items-center gap-2 pt-2\">\r\n                                    <Button\r\n                                        variant={selectedTypes.includes('All') ? 'default' : 'outline'}\r\n                                        size=\"sm\"\r\n                                        onClick={() => handleTypeSelection('All')}\r\n                                    >\r\n                                        All\r\n                                    </Button>\r\n                                    {documentTypesList.map(type => (\r\n                                        <Button\r\n                                            key={type}\r\n                                            variant={selectedTypes.includes(type) ? 'default' : 'outline'}\r\n                                            size=\"sm\"\r\n                                            onClick={() => handleTypeSelection(type)}\r\n                                        >\r\n                                            {type}\r\n                                        </Button>\r\n                                    ))}\r\n                                </div>\r\n                            </div>\r\n                            <div className=\"flex flex-wrap items-center gap-4 w-full\">\r\n                                <div className=\"flex items-center gap-2\">\r\n                                    <Label className=\"text-sm font-medium\">Year</Label>\r\n                                    <Select value={selectedYear} onValueChange={setSelectedYear}>\r\n                                        <SelectTrigger className=\"w-[180px]\">\r\n                                            <SelectValue placeholder=\"Select Year\" />\r\n                                        </SelectTrigger>\r\n                                        <SelectContent>\r\n                                            <SelectItem value=\"all\">All Years</SelectItem>\r\n                                            {docYears.map(year => <SelectItem key={year} value={year}>{year}</SelectItem>)}\r\n                                        </SelectContent>\r\n                                    </Select>\r\n                                </div>\r\n                                <div className=\"flex items-center gap-2\">\r\n                                    <Label className=\"text-sm font-medium\">Month</Label>\r\n                                    <Select value={selectedMonth} onValueChange={setSelectedMonth} disabled={selectedYear === 'all'}>\r\n                                        <SelectTrigger className=\"w-[180px]\">\r\n                                            <SelectValue placeholder=\"Select Month\" />\r\n                                        </SelectTrigger>\r\n                                        <SelectContent>\r\n                                            <SelectItem value=\"all\">All Months</SelectItem>\r\n                                            {docMonths.map(month => <SelectItem key={month} value={String(month)}>{monthNames[month]}</SelectItem>)}\r\n                                        </SelectContent>\r\n                                    </Select>\r\n                                </div>\r\n                            </div>\r\n                        </CardContent>\r\n                    </Card>\r\n\r\n                    <Card>\r\n                        <CardHeader>\r\n                            <CardTitle>Your Files</CardTitle>\r\n                            <CardDescription>\r\n                                Here are all documents associated with your account.\r\n                            </CardDescription>\r\n                        </CardHeader>\r\n                        <CardContent>\r\n                            <DocumentList documents={sortedAndFilteredDocuments} users={serverUsers as User[]} onSort={requestSort} sortConfig={sortConfig} />\r\n                        </CardContent>\r\n                    </Card>\r\n                </TabsContent>\r\n                <TabsContent value=\"holidays\">\r\n                    <Card>\r\n                        <CardHeader>\r\n                            <CardTitle>Holiday List</CardTitle>\r\n                            <CardDescription>Upcoming company holidays for the year.</CardDescription>\r\n                        </CardHeader>\r\n                        <CardContent>\r\n                            <div className=\"flex flex-col sm:flex-row gap-4 mb-4\">\r\n                                <div className=\"flex-grow\">\r\n                                    <Label className=\"text-sm font-medium\">Filter by Location</Label>\r\n                                    <div className=\"flex flex-wrap items-center gap-2 pt-2\">\r\n                                        <Button\r\n                                            variant={holidayLocationFilter === 'all' ? 'default' : 'outline'}\r\n                                            size=\"sm\"\r\n                                            onClick={() => setHolidayLocationFilter('all')}\r\n                                        >\r\n                                            All\r\n                                        </Button>\r\n                                        {holidayLocations.filter(l => l !== 'ALL').map(loc => (\r\n                                            <Button\r\n                                                key={loc}\r\n                                                variant={holidayLocationFilter === loc ? 'default' : 'outline'}\r\n                                                size=\"sm\"\r\n                                                onClick={() => setHolidayLocationFilter(loc)}\r\n                                            >\r\n                                                {loc}\r\n                                            </Button>\r\n                                        ))}\r\n                                    </div>\r\n                                </div>\r\n                                <div className=\"flex items-end gap-4\">\r\n                                    <div className=\"flex items-center gap-2\">\r\n                                        <Label className=\"text-sm font-medium\">Year</Label>\r\n                                        <Select value={selectedYear} onValueChange={setSelectedYear}>\r\n                                            <SelectTrigger className=\"w-[180px]\">\r\n                                                <SelectValue placeholder=\"Select Year\" />\r\n                                            </SelectTrigger>\r\n                                            <SelectContent>\r\n                                                <SelectItem value=\"all\">All Years</SelectItem>\r\n                                                {holidayYears.map(year => <SelectItem key={year} value={year}>{year}</SelectItem>)}\r\n                                            </SelectContent>\r\n                                        </Select>\r\n                                    </div>\r\n                                    <div className=\"flex items-center gap-2\">\r\n                                        <Label className=\"text-sm font-medium\">Month</Label>\r\n                                        <Select value={selectedMonth} onValueChange={setSelectedMonth} disabled={selectedYear === 'all'}>\r\n                                            <SelectTrigger className=\"w-[180px]\">\r\n                                                <SelectValue placeholder=\"Select Month\" />\r\n                                            </SelectTrigger>\r\n                                            <SelectContent>\r\n                                                <SelectItem value=\"all\">All Months</SelectItem>\r\n                                                {holidayMonths.map(month => <SelectItem key={month} value={String(month)}>{monthNames[month]}</SelectItem>)}\r\n                                            </SelectContent>\r\n                                        </Select>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                            <Table>\r\n                                <TableHeader>\r\n                                    <TableRow>\r\n                                        <TableHead>Date</TableHead>\r\n                                        <TableHead>Holiday Name</TableHead>\r\n                                        <TableHead>Location</TableHead>\r\n                                    </TableRow>\r\n                                </TableHeader>\r\n                                <TableBody>\r\n                                    {filteredHolidays.length > 0 ? filteredHolidays.map(holiday => (\r\n                                        <TableRow key={holiday.id}>\r\n                                            <TableCell className=\"font-medium\">\r\n                                                <div className=\"flex items-center gap-2\">\r\n                                                    <Calendar className=\"h-4 w-4 text-muted-foreground\" />\r\n                                                    {new Date(holiday.date).toLocaleDateString(undefined, { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric', timeZone: 'UTC' })}\r\n                                                </div>\r\n                                            </TableCell>\r\n                                            <TableCell>{holiday.name}</TableCell>\r\n                                            <TableCell>\r\n                                                <span className={cn('px-2 py-1 rounded-full text-xs font-medium',\r\n                                                    holiday.location === 'ALL' ? 'bg-blue-100 text-blue-800' :\r\n                                                        'bg-secondary text-secondary-foreground'\r\n                                                )}>\r\n                                                    {holiday.location}\r\n                                                </span>\r\n                                            </TableCell>\r\n                                        </TableRow>\r\n                                    )) : (\r\n                                        <TableRow>\r\n                                            <TableCell colSpan={3} className=\"text-center text-muted-foreground\">No holidays found for selected filters.</TableCell>\r\n                                        </TableRow>\r\n                                    )}\r\n                                </TableBody>\r\n                            </Table>\r\n                        </CardContent>\r\n                    </Card>\r\n                </TabsContent>\r\n                <TabsContent value=\"announcements\">\r\n                    <Card>\r\n                        <CardHeader>\r\n                            <CardTitle>Company Announcements</CardTitle>\r\n                            <CardDescription>Stay up to date with the latest news and updates.</CardDescription>\r\n                        </CardHeader>\r\n                        <CardContent>\r\n                            <div className=\"flex items-center gap-4 mb-4\">\r\n                                <div className=\"flex items-center gap-2\">\r\n                                    <Label className=\"text-sm font-medium\">Year</Label>\r\n                                    <Select value={selectedYear} onValueChange={setSelectedYear}>\r\n                                        <SelectTrigger className=\"w-[180px]\">\r\n                                            <SelectValue placeholder=\"Select Year\" />\r\n                                        </SelectTrigger>\r\n                                        <SelectContent>\r\n                                            <SelectItem value=\"all\">All Years</SelectItem>\r\n                                            {announcementYears.map(year => <SelectItem key={year} value={year}>{year}</SelectItem>)}\r\n                                        </SelectContent>\r\n                                    </Select>\r\n                                </div>\r\n                                <div className=\"flex items-center gap-2\">\r\n                                    <Label className=\"text-sm font-medium\">Month</Label>\r\n                                    <Select value={selectedMonth} onValueChange={setSelectedMonth} disabled={selectedYear === 'all'}>\r\n                                        <SelectTrigger className=\"w-[180px]\">\r\n                                            <SelectValue placeholder=\"Select Month\" />\r\n                                        </SelectTrigger>\r\n                                        <SelectContent>\r\n                                            <SelectItem value=\"all\">All Months</SelectItem>\r\n                                            {announcementMonths.map(month => <SelectItem key={month} value={String(month)}>{monthNames[month]}</SelectItem>)}\r\n                                        </SelectContent>\r\n                                    </Select>\r\n                                </div>\r\n                            </div>\r\n                            <div className=\"space-y-4\">\r\n                                {filteredAnnouncements.length > 0 ? filteredAnnouncements.map(announcement => {\r\n                                    const isUpcoming = isEventUpcoming(announcement.eventDate);\r\n                                    return (\r\n                                        <div key={announcement.id} className={cn(\r\n                                            \"p-4 border rounded-lg relative overflow-hidden\",\r\n                                            !announcement.isRead && \"bg-secondary\",\r\n                                            isUpcoming && \"bg-blue-500/10 animate-pulse ring-2 ring-destructive\"\r\n                                        )}>\r\n                                            <div className=\"absolute top-2 right-2\">\r\n                                                <Button variant=\"ghost\" size=\"sm\" onClick={() => toggleAnnouncementRead(announcement.id)}>\r\n                                                    {announcement.isRead ? (\r\n                                                        <>\r\n                                                            <Mail className=\"mr-2 h-4 w-4\" />\r\n                                                            Mark as Unread\r\n                                                        </>\r\n                                                    ) : (\r\n                                                        <>\r\n                                                            <MailOpen className=\"mr-2 h-4 w-4\" />\r\n                                                            Mark as Read\r\n                                                        </>\r\n                                                    )}\r\n                                                </Button>\r\n                                            </div>\r\n                                            <h3 className=\"font-semibold flex items-center gap-2\">\r\n                                                <Bell className=\"h-5 w-5 text-primary\" />\r\n                                                {announcement.title}\r\n                                            </h3>\r\n                                            {announcement.eventDate && (\r\n                                                <div className={cn(\"mt-1 flex items-center gap-2 text-sm\", isUpcoming ? \"text-blue-600 dark:text-blue-400\" : \"text-muted-foreground\")}>\r\n                                                    <Calendar className=\"h-4 w-4\" />\r\n                                                    <span>Event Date: {new Date(announcement.eventDate).toLocaleDateString(undefined, { year: 'numeric', month: 'long', day: 'numeric', timeZone: 'UTC' })}</span>\r\n                                                    {isUpcoming && <span className=\"text-xs font-bold\">(UPCOMING)</span>}\r\n                                                </div>\r\n                                            )}\r\n                                            <p className=\"text-sm text-muted-foreground mt-1\">\r\n                                                Posted on {new Date(announcement.date).toLocaleString()} by {announcement.author}\r\n                                            </p>\r\n                                            <p className=\"mt-2 text-sm pr-32\">{announcement.message}</p>\r\n                                        </div>\r\n                                    )\r\n                                }) : (\r\n                                    <div className=\"text-center text-muted-foreground py-8\">\r\n                                        <p>No announcements found for the selected period.</p>\r\n                                    </div>\r\n                                )}\r\n                            </div>\r\n                        </CardContent>\r\n                    </Card>\r\n                </TabsContent>\r\n            </Tabs>\r\n        </>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\FileSafe\\studio\\src\\components\\dashboard\\id-card.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'logoSrc' is assigned a value but never used.","line":15,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":15,"endColumn":19},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":42,"column":25,"nodeType":"JSXOpeningElement","endLine":42,"endColumn":148}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\r\n'use client';\r\nimport type { User } from \"@/lib/mock-data\";\r\nimport { companies, locations } from \"@/lib/mock-data\";\r\nimport { Droplet } from 'lucide-react';\r\nimport { cn } from \"@/lib/utils\";\r\nimport { AseLogo } from \"./ase-logo\";\r\nimport { useState, useEffect, forwardRef } from \"react\";\r\nimport Image from \"next/image\";\r\nimport { getAvatarSrc } from \"@/lib/utils\";\r\n\r\nexport const IdCard = forwardRef<HTMLDivElement, { employee: User }>(({ employee }, ref) => {\r\n    const company = companies.find(c => c.name === employee.company);\r\n    const companyAddress = employee.location ? locations[employee.location] : 'N/A';\r\n    const [logoSrc, setLogoSrc] = useState<string | null>(null);\r\n\r\n    useEffect(() => {\r\n        const storedLogo = localStorage.getItem('companyLogo');\r\n        if (storedLogo) {\r\n            setLogoSrc(storedLogo);\r\n        }\r\n    }, []);\r\n\r\n    const qrCodeUrl = `https://api.qrserver.com/v1/create-qr-code/?data=${encodeURIComponent(`tel:${employee.emergencyContact || employee.mobile || ''}`)}&size=80x80&bgcolor=ffffff&color=000000&qzone=1`;\r\n\r\n    return (\r\n        <div ref={ref} className=\"bg-white rounded-lg shadow-lg w-[320px] h-[540px] mx-auto font-sans flex flex-col overflow-hidden relative border\">\r\n            {/* Top half: Photo */}\r\n            <div className=\"flex-shrink-0 h-[270px] relative\">\r\n                <Image\r\n                    src={getAvatarSrc(employee, 320)}\r\n                    alt={employee.name ? employee.name : 'Employee Photo'}\r\n                    width={320}\r\n                    height={270}\r\n                    className=\"absolute inset-0 w-full h-full object-cover\"\r\n                    crossOrigin=\"anonymous\"\r\n                    unoptimized\r\n                />\r\n                <div className=\"absolute inset-0 bg-gradient-to-t from-black/20 via-transparent to-transparent\"></div>\r\n                <div className=\"absolute top-4 left-4 h-12 w-12 bg-white/80 backdrop-blur-sm rounded-full p-2 flex items-center justify-center\">\r\n                    {company?.logo ? (\r\n                        <img src={company.logo} alt=\"Company Logo\" className=\"rounded-full object-contain h-full w-full\" crossOrigin=\"anonymous\" />\r\n                    ) : (\r\n                        <AseLogo />\r\n                    )}\r\n                </div>\r\n            </div>\r\n\r\n            {/* Bottom half: Information */}\r\n            <div className=\"p-5 flex flex-col flex-grow bg-white\">\r\n                <div className=\"text-center mb-4\">\r\n                    <h1 className=\"text-2xl font-bold text-gray-800\">{employee.name}</h1>\r\n                    <p className=\"text-md text-gray-500 font-medium\">{employee.designation || 'N/A'}</p>\r\n                </div>\r\n\r\n                <div className=\"grid grid-cols-3 gap-x-2 items-center w-full text-sm flex-grow\">\r\n                    {/* Left Column: Labels */}\r\n                    <div className=\"col-span-1 space-y-3 text-left\">\r\n                        <div className=\"font-medium text-gray-500\">Emp. Code</div>\r\n                        <div className=\"font-medium text-gray-500\">Status</div>\r\n                        <div className=\"font-medium text-gray-500\">Blood Group</div>\r\n                    </div>\r\n\r\n                    {/* Center Column: QR Code */}\r\n                    <div className=\"col-span-1 flex justify-center items-center h-full\">\r\n                        <Image\r\n                            src={qrCodeUrl}\r\n                            alt=\"Emergency Contact QR Code\"\r\n                            width={80}\r\n                            height={80}\r\n                            crossOrigin=\"anonymous\"\r\n                            unoptimized\r\n                        />\r\n                    </div>\r\n\r\n                    {/* Right Column: Values */}\r\n                    <div className=\"col-span-1 space-y-3 text-right\">\r\n                        <div className=\"font-semibold text-gray-800\">{employee.id}</div>\r\n                        <div className={cn(\r\n                            \"font-semibold\",\r\n                            employee.status === 'active' && 'text-green-600',\r\n                            employee.status === 'inactive' && 'text-red-600',\r\n                            employee.status === 'pending' && 'text-yellow-600',\r\n                            employee.status === 'deleted' && 'text-red-600',\r\n                        )}>\r\n                            {(employee.status || 'active').charAt(0).toUpperCase() + (employee.status || 'active').slice(1)}\r\n                        </div>\r\n                        <div className=\"font-semibold text-gray-800 flex items-center gap-1 justify-end\">\r\n                            <Droplet className=\"h-4 w-4 text-red-500\" /> {employee.bloodGroup || 'N/A'}\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Footer */}\r\n            <div className=\"bg-gray-800 text-white text-center p-2 flex flex-col justify-center items-center flex-shrink-0 h-[70px]\">\r\n                <p className=\"font-semibold text-sm\">{company?.name || \"Company Name\"}</p>\r\n                <p className=\"text-xs font-medium\">{companyAddress}</p>\r\n            </div>\r\n        </div>\r\n    );\r\n});\r\n\r\nIdCard.displayName = 'IdCard';\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\FileSafe\\studio\\src\\components\\dashboard\\integrations-settings.tsx","messages":[{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":144,"column":69,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[5121,5225],"text":"\r\n                        Configure the connection to your application&apos;s database.\r\n                    "},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[5121,5225],"text":"\r\n                        Configure the connection to your application&lsquo;s database.\r\n                    "},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[5121,5225],"text":"\r\n                        Configure the connection to your application&#39;s database.\r\n                    "},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[5121,5225],"text":"\r\n                        Configure the connection to your application&rsquo;s database.\r\n                    "},"desc":"Replace with `&rsquo;`."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\r\n'use client'\r\nimport { useState, useEffect } from 'react';\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\r\nimport { Label } from '@/components/ui/label';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Save, Wifi, Server } from 'lucide-react';\r\nimport { useToast } from '@/hooks/use-toast';\r\nimport {\r\n    Select,\r\n    SelectContent,\r\n    SelectItem,\r\n    SelectTrigger,\r\n    SelectValue,\r\n} from '@/components/ui/select';\r\n\r\ntype SSOConfig = {\r\n    tenantId: string;\r\n    clientId: string;\r\n    clientSecret: string;\r\n};\r\n\r\ntype DBConfig = {\r\n    type: 'postgresql' | 'mysql' | 'sqlite';\r\n    host: string;\r\n    port: string;\r\n    username: string;\r\n    password: string;\r\n    database: string;\r\n};\r\n\r\nexport function IntegrationsSettings() {\r\n    const { toast } = useToast();\r\n    const [ssoConfig, setSsoConfig] = useState<SSOConfig>({\r\n        tenantId: '',\r\n        clientId: '',\r\n        clientSecret: '',\r\n    });\r\n    const [dbConfig, setDbConfig] = useState<DBConfig>({\r\n        type: 'postgresql',\r\n        host: 'localhost',\r\n        port: '5432',\r\n        username: '',\r\n        password: '',\r\n        database: '',\r\n    });\r\n\r\n    useEffect(() => {\r\n        const storedSSO = localStorage.getItem('ssoConfig');\r\n        if (storedSSO) {\r\n            setSsoConfig(JSON.parse(storedSSO));\r\n        }\r\n\r\n        const storedDB = localStorage.getItem('dbConfig');\r\n        if (storedDB) {\r\n            setDbConfig(JSON.parse(storedDB));\r\n        }\r\n    }, []);\r\n\r\n    const handleSsoChange = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n        setSsoConfig(prev => ({ ...prev, [e.target.name]: e.target.value }));\r\n    };\r\n\r\n    const handleDbChange = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n        setDbConfig(prev => ({ ...prev, [e.target.name]: e.target.value }));\r\n    };\r\n\r\n    const handleDbSelectChange = (value: DBConfig['type']) => {\r\n        setDbConfig(prev => ({ ...prev, type: value }));\r\n    };\r\n\r\n    const handleSaveSSO = () => {\r\n        localStorage.setItem('ssoConfig', JSON.stringify(ssoConfig));\r\n        toast({\r\n            title: 'SSO Settings Saved',\r\n            description: 'Office 365 SSO configuration has been updated.',\r\n        });\r\n    };\r\n\r\n    const handleSaveDB = () => {\r\n        localStorage.setItem('dbConfig', JSON.stringify(dbConfig));\r\n        toast({\r\n            title: 'Database Settings Saved',\r\n            description: 'Database connection details have been updated.',\r\n        });\r\n    };\r\n\r\n    return (\r\n        <div className=\"space-y-6\">\r\n            <Card>\r\n                <CardHeader>\r\n                    <CardTitle className=\"flex items-center gap-2\">\r\n                        <Wifi className=\"h-5 w-5 text-primary\" /> Office 365 SSO Configuration\r\n                    </CardTitle>\r\n                    <CardDescription>\r\n                        Enter your Azure App Registration details to enable Single Sign-On.\r\n                    </CardDescription>\r\n                </CardHeader>\r\n                <CardContent className=\"space-y-4\">\r\n                    <div className=\"space-y-2\">\r\n                        <Label htmlFor=\"tenantId\">Tenant ID</Label>\r\n                        <Input\r\n                            id=\"tenantId\"\r\n                            name=\"tenantId\"\r\n                            value={ssoConfig.tenantId}\r\n                            onChange={handleSsoChange}\r\n                            placeholder=\"Enter Azure Tenant ID\"\r\n                        />\r\n                    </div>\r\n                    <div className=\"space-y-2\">\r\n                        <Label htmlFor=\"clientId\">Client ID</Label>\r\n                        <Input\r\n                            id=\"clientId\"\r\n                            name=\"clientId\"\r\n                            value={ssoConfig.clientId}\r\n                            onChange={handleSsoChange}\r\n                            placeholder=\"Enter Application (client) ID\"\r\n                        />\r\n                    </div>\r\n                    <div className=\"space-y-2\">\r\n                        <Label htmlFor=\"clientSecret\">Client Secret</Label>\r\n                        <Input\r\n                            id=\"clientSecret\"\r\n                            name=\"clientSecret\"\r\n                            type=\"password\"\r\n                            value={ssoConfig.clientSecret}\r\n                            onChange={handleSsoChange}\r\n                            placeholder=\"Enter Client Secret\"\r\n                        />\r\n                    </div>\r\n                    <Button onClick={handleSaveSSO}>\r\n                        <Save className=\"mr-2 h-4 w-4\" /> Save SSO Configuration\r\n                    </Button>\r\n                </CardContent>\r\n            </Card>\r\n\r\n            <Card>\r\n                <CardHeader>\r\n                    <CardTitle className=\"flex items-center gap-2\">\r\n                        <Server className=\"h-5 w-5 text-primary\" /> Database Configuration\r\n                    </CardTitle>\r\n                    <CardDescription>\r\n                        Configure the connection to your application's database.\r\n                    </CardDescription>\r\n                </CardHeader>\r\n                <CardContent className=\"space-y-4\">\r\n                    <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-4\">\r\n                        <div className=\"space-y-2\">\r\n                            <Label htmlFor=\"dbType\">Database Type</Label>\r\n                            <Select value={dbConfig.type} onValueChange={handleDbSelectChange}>\r\n                                <SelectTrigger id=\"dbType\">\r\n                                    <SelectValue placeholder=\"Select DB Type\" />\r\n                                </SelectTrigger>\r\n                                <SelectContent>\r\n                                    <SelectItem value=\"postgresql\">PostgreSQL</SelectItem>\r\n                                    <SelectItem value=\"mysql\">MySQL</SelectItem>\r\n                                    <SelectItem value=\"sqlite\">SQLite</SelectItem>\r\n                                </SelectContent>\r\n                            </Select>\r\n                        </div>\r\n                         <div className=\"space-y-2\">\r\n                            <Label htmlFor=\"dbHost\">Host</Label>\r\n                            <Input\r\n                                id=\"dbHost\"\r\n                                name=\"host\"\r\n                                value={dbConfig.host}\r\n                                onChange={handleDbChange}\r\n                                placeholder=\"e.g., localhost or an IP address\"\r\n                            />\r\n                        </div>\r\n                    </div>\r\n                     <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-4\">\r\n                        <div className=\"space-y-2\">\r\n                            <Label htmlFor=\"dbPort\">Port</Label>\r\n                            <Input\r\n                                id=\"dbPort\"\r\n                                name=\"port\"\r\n                                value={dbConfig.port}\r\n                                onChange={handleDbChange}\r\n                                placeholder=\"e.g., 5432\"\r\n                            />\r\n                        </div>\r\n                        <div className=\"space-y-2\">\r\n                            <Label htmlFor=\"dbName\">Database Name</Label>\r\n                            <Input\r\n                                id=\"dbName\"\r\n                                name=\"database\"\r\n                                value={dbConfig.database}\r\n                                onChange={handleDbChange}\r\n                                placeholder=\"Name of the database\"\r\n                            />\r\n                        </div>\r\n                    </div>\r\n                     <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-4\">\r\n                        <div className=\"space-y-2\">\r\n                            <Label htmlFor=\"dbUser\">Username</Label>\r\n                            <Input\r\n                                id=\"dbUser\"\r\n                                name=\"username\"\r\n                                value={dbConfig.username}\r\n                                onChange={handleDbChange}\r\n                                placeholder=\"Database user\"\r\n                            />\r\n                        </div>\r\n                        <div className=\"space-y-2\">\r\n                            <Label htmlFor=\"dbPass\">Password</Label>\r\n                            <Input\r\n                                id=\"dbPass\"\r\n                                name=\"password\"\r\n                                type=\"password\"\r\n                                value={dbConfig.password}\r\n                                onChange={handleDbChange}\r\n                                placeholder=\"Database password\"\r\n                            />\r\n                        </div>\r\n                    </div>\r\n                    <Button onClick={handleSaveDB}>\r\n                        <Save className=\"mr-2 h-4 w-4\" /> Save Database Configuration\r\n                    </Button>\r\n                </CardContent>\r\n            </Card>\r\n        </div>\r\n    );\r\n}\r\n    ","usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\FileSafe\\studio\\src\\components\\dashboard\\permanent-delete-dialog.tsx","messages":[{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":40,"column":61,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[1167,1168],"text":"&quot;"},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[1167,1168],"text":"&ldquo;"},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[1167,1168],"text":"&#34;"},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[1167,1168],"text":"&rdquo;"},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":40,"column":72,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[1178,1179],"text":"&quot;"},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[1178,1179],"text":"&ldquo;"},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[1178,1179],"text":"&#34;"},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[1178,1179],"text":"&rdquo;"},"desc":"Replace with `&rdquo;`."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\r\n'use client';\r\n\r\nimport {\r\n  AlertDialog,\r\n  AlertDialogAction,\r\n  AlertDialogCancel,\r\n  AlertDialogContent,\r\n  AlertDialogDescription,\r\n  AlertDialogFooter,\r\n  AlertDialogHeader,\r\n  AlertDialogTitle,\r\n  AlertDialogTrigger,\r\n} from '@/components/ui/alert-dialog';\r\nimport { useState } from 'react';\r\n\r\ninterface PermanentDeleteDialogProps {\r\n  itemName: string;\r\n  itemType: string;\r\n  onDelete: () => void;\r\n  children: React.ReactNode;\r\n}\r\n\r\nexport function PermanentDeleteDialog({ itemName, itemType, onDelete, children }: PermanentDeleteDialogProps) {\r\n  const [open, setOpen] = useState(false);\r\n\r\n  const handleDelete = () => {\r\n    onDelete();\r\n    setOpen(false);\r\n  };\r\n\r\n  return (\r\n    <AlertDialog open={open} onOpenChange={setOpen}>\r\n      <AlertDialogTrigger asChild>{children}</AlertDialogTrigger>\r\n      <AlertDialogContent>\r\n        <AlertDialogHeader>\r\n          <AlertDialogTitle>Are you absolutely sure?</AlertDialogTitle>\r\n          <AlertDialogDescription>\r\n            This action will <span className=\"font-semibold text-destructive\">permanently delete</span> the {itemType}{' '}\r\n            <span className=\"font-semibold text-foreground\">\"{itemName}\"</span>. This action cannot be undone.\r\n          </AlertDialogDescription>\r\n        </AlertDialogHeader>\r\n        <AlertDialogFooter>\r\n          <AlertDialogCancel>Cancel</AlertDialogCancel>\r\n          <AlertDialogAction onClick={handleDelete} className=\"bg-destructive hover:bg-destructive/90\">\r\n            Delete Permanently\r\n          </AlertDialogAction>\r\n        </AlertDialogFooter>\r\n      </AlertDialogContent>\r\n    </AlertDialog>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\FileSafe\\studio\\src\\components\\dashboard\\upload-dialog.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'isPending' is assigned a value but never used.","line":24,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":24,"endColumn":19},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":90,"column":60,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[2585,2678],"text":"\r\n            Choose a file to upload. It will be saved as a &quot;Personal\" document.\r\n          "},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[2585,2678],"text":"\r\n            Choose a file to upload. It will be saved as a &ldquo;Personal\" document.\r\n          "},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[2585,2678],"text":"\r\n            Choose a file to upload. It will be saved as a &#34;Personal\" document.\r\n          "},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[2585,2678],"text":"\r\n            Choose a file to upload. It will be saved as a &rdquo;Personal\" document.\r\n          "},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":90,"column":69,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[2585,2678],"text":"\r\n            Choose a file to upload. It will be saved as a \"Personal&quot; document.\r\n          "},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[2585,2678],"text":"\r\n            Choose a file to upload. It will be saved as a \"Personal&ldquo; document.\r\n          "},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[2585,2678],"text":"\r\n            Choose a file to upload. It will be saved as a \"Personal&#34; document.\r\n          "},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[2585,2678],"text":"\r\n            Choose a file to upload. It will be saved as a \"Personal&rdquo; document.\r\n          "},"desc":"Replace with `&rdquo;`."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\r\n\r\nimport { useState, useTransition } from 'react'\r\nimport {\r\n  Dialog,\r\n  DialogContent,\r\n  DialogDescription,\r\n  DialogFooter,\r\n  DialogHeader,\r\n  DialogTitle,\r\n  DialogTrigger,\r\n} from '@/components/ui/dialog'\r\nimport { Button } from '@/components/ui/button'\r\nimport { Input } from '@/components/ui/input'\r\nimport { Label } from '@/components/ui/label'\r\nimport { Progress } from '@/components/ui/progress'\r\nimport { UploadCloud, FileCheck2, Loader2 } from 'lucide-react'\r\n\r\nexport function UploadDialog({ onUploadComplete }: { onUploadComplete: () => void }) {\r\n  const [open, setOpen] = useState(false)\r\n  const [isUploading, setIsUploading] = useState(false)\r\n  const [uploadProgress, setUploadProgress] = useState(0)\r\n  const [isComplete, setIsComplete] = useState(false)\r\n  const [isPending, startTransition] = useTransition()\r\n  const [fileName, setFileName] = useState('');\r\n\r\n  const handleUpload = async () => {\r\n    if (!fileName) return;\r\n    setIsUploading(true)\r\n    setIsComplete(false)\r\n    setUploadProgress(0)\r\n\r\n    // Simulate upload progress\r\n    const interval = setInterval(() => {\r\n      setUploadProgress((prev) => {\r\n        if (prev >= 95) {\r\n          clearInterval(interval)\r\n          return prev\r\n        }\r\n        return prev + 10\r\n      })\r\n    }, 200)\r\n\r\n    // Simulate network delay\r\n    await new Promise((resolve) => setTimeout(resolve, 2500))\r\n    clearInterval(interval)\r\n    setUploadProgress(100)\r\n    setIsUploading(false)\r\n    setIsComplete(true)\r\n\r\n    // Wait a bit on the success screen\r\n    await new Promise((resolve) => setTimeout(resolve, 1500))\r\n\r\n    startTransition(() => {\r\n      onUploadComplete() // This could be a server action to revalidate data\r\n    })\r\n\r\n    setOpen(false)\r\n    // Reset state for next time\r\n    setTimeout(() => {\r\n        setIsComplete(false)\r\n        setUploadProgress(0)\r\n        setFileName('')\r\n    }, 500)\r\n  }\r\n\r\n  const handleOpenChange = (isOpen: boolean) => {\r\n    if (!isOpen) {\r\n        // Reset state when closing\r\n        setIsUploading(false);\r\n        setIsComplete(false);\r\n        setUploadProgress(0);\r\n        setFileName('');\r\n    }\r\n    setOpen(isOpen);\r\n  }\r\n\r\n  return (\r\n    <Dialog open={open} onOpenChange={handleOpenChange}>\r\n      <DialogTrigger asChild>\r\n        <Button>\r\n          <UploadCloud className=\"mr-2 h-4 w-4\" />\r\n          Upload Document\r\n        </Button>\r\n      </DialogTrigger>\r\n      <DialogContent className=\"sm:max-w-[425px]\">\r\n        <DialogHeader>\r\n          <DialogTitle>Upload a new document</DialogTitle>\r\n          <DialogDescription>\r\n            Choose a file to upload. It will be saved as a \"Personal\" document.\r\n          </DialogDescription>\r\n        </DialogHeader>\r\n        {isUploading || isComplete ? (\r\n          <div className=\"flex flex-col items-center justify-center space-y-4 py-8\">\r\n            {isComplete ? (\r\n              <>\r\n                <FileCheck2 className=\"h-16 w-16 text-green-500\" />\r\n                <p className=\"text-lg font-medium\">Upload Complete!</p>\r\n              </>\r\n            ) : (\r\n              <>\r\n                <Loader2 className=\"h-16 w-16 animate-spin text-primary\" />\r\n                <p className=\"text-lg font-medium\">Uploading...</p>\r\n                <Progress value={uploadProgress} className=\"w-[60%]\" />\r\n              </>\r\n            )}\r\n          </div>\r\n        ) : (\r\n          <>\r\n            <div className=\"grid gap-4 py-4\">\r\n              <div className=\"grid w-full max-w-sm items-center gap-1.5\">\r\n                <Label htmlFor=\"document\">Document</Label>\r\n                <Input id=\"document\" type=\"file\" onChange={(e) => setFileName(e.target.files?.[0]?.name || '')} />\r\n              </div>\r\n              <div className=\"grid w-full max-w-sm items-center gap-1.5\">\r\n                <Label htmlFor=\"doc-type\">Document Type</Label>\r\n                <Input id=\"doc-type\" type=\"text\" value=\"Personal\" disabled readOnly />\r\n              </div>\r\n            </div>\r\n            <DialogFooter>\r\n              <Button type=\"button\" onClick={handleUpload} disabled={!fileName}>\r\n                Upload\r\n              </Button>\r\n            </DialogFooter>\r\n          </>\r\n        )}\r\n      </DialogContent>\r\n    </Dialog>\r\n  )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\FileSafe\\studio\\src\\components\\login-form.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'User' is defined but never used.","line":19,"column":33,"nodeType":null,"messageId":"unusedVar","endLine":19,"endColumn":37},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'users' is assigned a value but never used.","line":34,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":34,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'setUsers' is assigned a value but never used.","line":34,"column":17,"nodeType":null,"messageId":"unusedVar","endLine":34,"endColumn":25},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":75,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":75,"endColumn":19},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":75,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":75,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2409,2412],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2409,2412],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\r\n'use client'\r\n\r\nimport { useRouter } from 'next/navigation'\r\nimport { signIn, useSession } from 'next-auth/react';\r\nimport { Button } from '@/components/ui/button'\r\nimport {\r\n  Card,\r\n  CardContent,\r\n  CardDescription,\r\n  CardHeader,\r\n  CardTitle,\r\n} from '@/components/ui/card'\r\nimport { Input } from '@/components/ui/input'\r\nimport { Label } from '@/components/ui/label'\r\nimport { useState, useEffect } from 'react'\r\nimport { Loader2 } from 'lucide-react'\r\nimport { useToast } from '@/hooks/use-toast'\r\nimport { users as initialUsers, User } from '@/lib/mock-data'\r\n\r\nconst MicrosoftLogo = () => (\r\n  <svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n    <path d=\"M9.19151 9.19151H0V0H9.19151V9.19151Z\" fill=\"#F25022\" />\r\n    <path d=\"M20 9.19151H10.8085V0H20V9.19151Z\" fill=\"#7FBA00\" />\r\n    <path d=\"M9.19151 20H0V10.8085H9.19151V20Z\" fill=\"#00A4EF\" />\r\n    <path d=\"M20 20H10.8085V10.8085H20V20Z\" fill=\"#FFB900\" />\r\n  </svg>\r\n)\r\n\r\nexport function LoginForm() {\r\n  const router = useRouter()\r\n  const { data: session, status } = useSession();\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const [users, setUsers] = useState(initialUsers)\r\n  const { toast } = useToast()\r\n  const [email, setEmail] = useState('');\r\n  const [password, setPassword] = useState('');\r\n\r\n  useEffect(() => {\r\n    if (status === 'authenticated' && session?.user) {\r\n      const targetRole = session.user.role || 'employee';\r\n\r\n      toast({\r\n        title: 'Login Successful',\r\n        description: `Welcome, ${session.user.name}!`,\r\n      });\r\n\r\n      router.push(`/dashboard?role=${targetRole}`);\r\n    }\r\n  }, [status, session, router, toast]);\r\n\r\n  async function handleLocalLogin(e: React.FormEvent) {\r\n    e.preventDefault();\r\n    setIsLoading(true);\r\n\r\n    try {\r\n      const result = await signIn('credentials', {\r\n        redirect: false,\r\n        email,\r\n        password,\r\n      });\r\n\r\n      if (result?.error) {\r\n        toast({\r\n          variant: 'destructive',\r\n          title: 'Login Failed',\r\n          description: 'Invalid email or password.',\r\n        });\r\n      } else {\r\n        // Successful login will trigger session update in useEffect\r\n        // But we can also redirect here if needed, \r\n        // though session affect is cleaner.\r\n        // Wait, the useEffect handles redirection based on session status.\r\n      }\r\n    } catch (error: any) {\r\n      toast({\r\n        variant: 'destructive',\r\n        title: 'Login Failed',\r\n        description: 'An unexpected error occurred.',\r\n      });\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  }\r\n\r\n  async function signInWithMicrosoft() {\r\n    setIsLoading(true);\r\n    // This will redirect the user to the Microsoft login page\r\n    await signIn('azure-ad', { callbackUrl: '/dashboard' });\r\n  }\r\n\r\n  const isPageLoading = status === 'loading' || isLoading;\r\n\r\n  return (\r\n    <>\r\n      <Card className=\"shadow-lg w-full\">\r\n        <CardHeader>\r\n          <CardTitle>Sign in</CardTitle>\r\n          <CardDescription>\r\n            Use your Microsoft account or email to sign in.\r\n          </CardDescription>\r\n        </CardHeader>\r\n        <CardContent>\r\n          <Button onClick={signInWithMicrosoft} variant=\"outline\" className=\"w-full\" disabled={isPageLoading}>\r\n            {isPageLoading ? (\r\n              <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\r\n            ) : (\r\n              <MicrosoftLogo />\r\n            )}\r\n            <span className=\"ml-2\">Sign in with Microsoft</span>\r\n          </Button>\r\n          <div className=\"relative my-6\">\r\n            <div className=\"absolute inset-0 flex items-center\">\r\n              <span className=\"w-full border-t\" />\r\n            </div>\r\n            <div className=\"relative flex justify-center text-xs uppercase\">\r\n              <span className=\"bg-background px-2 text-muted-foreground\">\r\n                Or continue with\r\n              </span>\r\n            </div>\r\n          </div>\r\n          <form onSubmit={handleLocalLogin}>\r\n            <div className=\"grid gap-4\">\r\n              <div className=\"grid gap-2\">\r\n                <Label htmlFor=\"email\">Email</Label>\r\n                <Input\r\n                  id=\"email\"\r\n                  type=\"email\"\r\n                  placeholder=\"Email Address\"\r\n                  required\r\n                  value={email}\r\n                  onChange={(e) => setEmail(e.target.value)}\r\n                  disabled={isPageLoading}\r\n                />\r\n              </div>\r\n              <div className=\"grid gap-2\">\r\n                <Label htmlFor=\"password\">Password</Label>\r\n                <Input\r\n                  id=\"password\"\r\n                  type=\"password\"\r\n                  required\r\n                  value={password}\r\n                  onChange={(e) => setPassword(e.target.value)}\r\n                  disabled={isPageLoading}\r\n                />\r\n              </div>\r\n              <Button type=\"submit\" className=\"w-full\" disabled={isPageLoading}>\r\n                {isPageLoading && <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />}\r\n                Sign in\r\n              </Button>\r\n            </div>\r\n          </form>\r\n        </CardContent>\r\n      </Card>\r\n    </>\r\n  )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\FileSafe\\studio\\src\\firebase\\error-emitter.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":19,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":19,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[613,616],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[613,616],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\nimport { FirestorePermissionError } from '@/firebase/errors';\r\n\r\n/**\r\n * Defines the shape of all possible events and their corresponding payload types.\r\n * This centralizes event definitions for type safety across the application.\r\n */\r\nexport interface AppEvents {\r\n  'permission-error': FirestorePermissionError;\r\n}\r\n\r\n// A generic type for a callback function.\r\ntype Callback<T> = (data: T) => void;\r\n\r\n/**\r\n * A strongly-typed pub/sub event emitter.\r\n * It uses a generic type T that extends a record of event names to payload types.\r\n */\r\nfunction createEventEmitter<T extends Record<string, any>>() {\r\n  // The events object stores arrays of callbacks, keyed by event name.\r\n  // The types ensure that a callback for a specific event matches its payload type.\r\n  const events: { [K in keyof T]?: Array<Callback<T[K]>> } = {};\r\n\r\n  return {\r\n    /**\r\n     * Subscribe to an event.\r\n     * @param eventName The name of the event to subscribe to.\r\n     * @param callback The function to call when the event is emitted.\r\n     */\r\n    on<K extends keyof T>(eventName: K, callback: Callback<T[K]>) {\r\n      if (!events[eventName]) {\r\n        events[eventName] = [];\r\n      }\r\n      events[eventName]?.push(callback);\r\n    },\r\n\r\n    /**\r\n     * Unsubscribe from an event.\r\n     * @param eventName The name of the event to unsubscribe from.\r\n     * @param callback The specific callback to remove.\r\n     */\r\n    off<K extends keyof T>(eventName: K, callback: Callback<T[K]>) {\r\n      if (!events[eventName]) {\r\n        return;\r\n      }\r\n      events[eventName] = events[eventName]?.filter(cb => cb !== callback);\r\n    },\r\n\r\n    /**\r\n     * Publish an event to all subscribers.\r\n     * @param eventName The name of the event to emit.\r\n     * @param data The data payload that corresponds to the event's type.\r\n     */\r\n    emit<K extends keyof T>(eventName: K, data: T[K]) {\r\n      if (!events[eventName]) {\r\n        return;\r\n      }\r\n      events[eventName]?.forEach(callback => callback(data));\r\n    },\r\n  };\r\n}\r\n\r\n// Create and export a singleton instance of the emitter, typed with our AppEvents interface.\r\nexport const errorEmitter = createEventEmitter<AppEvents>();\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\FileSafe\\studio\\src\\firebase\\errors.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":7,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":7,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[214,217],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[214,217],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":33,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":33,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[723,726],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[723,726],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\nimport { getAuth, type User } from 'firebase/auth';\r\n\r\ntype SecurityRuleContext = {\r\n  path: string;\r\n  operation: 'get' | 'list' | 'create' | 'update' | 'delete' | 'write';\r\n  requestResourceData?: any;\r\n};\r\n\r\ninterface FirebaseAuthToken {\r\n  name: string | null;\r\n  email: string | null;\r\n  email_verified: boolean;\r\n  phone_number: string | null;\r\n  sub: string;\r\n  firebase: {\r\n    identities: Record<string, string[]>;\r\n    sign_in_provider: string;\r\n    tenant: string | null;\r\n  };\r\n}\r\n\r\ninterface FirebaseAuthObject {\r\n  uid: string;\r\n  token: FirebaseAuthToken;\r\n}\r\n\r\ninterface SecurityRuleRequest {\r\n  auth: FirebaseAuthObject | null;\r\n  method: string;\r\n  path: string;\r\n  resource?: {\r\n    data: any;\r\n  };\r\n}\r\n\r\n/**\r\n * Builds a security-rule-compliant auth object from the Firebase User.\r\n * @param currentUser The currently authenticated Firebase user.\r\n * @returns An object that mirrors request.auth in security rules, or null.\r\n */\r\nfunction buildAuthObject(currentUser: User | null): FirebaseAuthObject | null {\r\n  if (!currentUser) {\r\n    return null;\r\n  }\r\n\r\n  const token: FirebaseAuthToken = {\r\n    name: currentUser.displayName,\r\n    email: currentUser.email,\r\n    email_verified: currentUser.emailVerified,\r\n    phone_number: currentUser.phoneNumber,\r\n    sub: currentUser.uid,\r\n    firebase: {\r\n      identities: currentUser.providerData.reduce((acc, p) => {\r\n        if (p.providerId) {\r\n          acc[p.providerId] = [p.uid];\r\n        }\r\n        return acc;\r\n      }, {} as Record<string, string[]>),\r\n      sign_in_provider: currentUser.providerData[0]?.providerId || 'custom',\r\n      tenant: currentUser.tenantId,\r\n    },\r\n  };\r\n\r\n  return {\r\n    uid: currentUser.uid,\r\n    token: token,\r\n  };\r\n}\r\n\r\n/**\r\n * Builds the complete, simulated request object for the error message.\r\n * It safely tries to get the current authenticated user.\r\n * @param context The context of the failed Firestore operation.\r\n * @returns A structured request object.\r\n */\r\nfunction buildRequestObject(context: SecurityRuleContext): SecurityRuleRequest {\r\n  let authObject: FirebaseAuthObject | null = null;\r\n  try {\r\n    // Safely attempt to get the current user.\r\n    const firebaseAuth = getAuth();\r\n    const currentUser = firebaseAuth.currentUser;\r\n    if (currentUser) {\r\n      authObject = buildAuthObject(currentUser);\r\n    }\r\n  } catch {\r\n    // This will catch errors if the Firebase app is not yet initialized.\r\n    // In this case, we'll proceed without auth information.\r\n  }\r\n\r\n  return {\r\n    auth: authObject,\r\n    method: context.operation,\r\n    path: `/databases/(default)/documents/${context.path}`,\r\n    resource: context.requestResourceData ? { data: context.requestResourceData } : undefined,\r\n  };\r\n}\r\n\r\n/**\r\n * Builds the final, formatted error message for the LLM.\r\n * @param requestObject The simulated request object.\r\n * @returns A string containing the error message and the JSON payload.\r\n */\r\nfunction buildErrorMessage(requestObject: SecurityRuleRequest): string {\r\n  return `Missing or insufficient permissions: The following request was denied by Firestore Security Rules:\r\n${JSON.stringify(requestObject, null, 2)}`;\r\n}\r\n\r\n/**\r\n * A custom error class designed to be consumed by an LLM for debugging.\r\n * It structures the error information to mimic the request object\r\n * available in Firestore Security Rules.\r\n */\r\nexport class FirestorePermissionError extends Error {\r\n  public readonly request: SecurityRuleRequest;\r\n\r\n  constructor(context: SecurityRuleContext) {\r\n    const requestObject = buildRequestObject(context);\r\n    super(buildErrorMessage(requestObject));\r\n    this.name = 'FirebaseError';\r\n    this.request = requestObject;\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\FileSafe\\studio\\src\\firebase\\firestore\\use-collection.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'where' is defined but never used.","line":4,"column":41,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":46},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":15,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":15,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[573,576],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[573,576],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":41,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":41,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1396,1399],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1396,1399],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'queryConstraints'. Either include it or remove the dependency array.","line":47,"column":6,"nodeType":"ArrayExpression","endLine":47,"endColumn":54,"suggestions":[{"desc":"Update the dependencies array to be: [collectionName, firestore, queryConstraints]","fix":{"range":[1515,1563],"text":"[collectionName, firestore, queryConstraints]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a spread element in its dependency array. This means we can't statically verify whether you've passed the correct dependencies.","line":47,"column":34,"nodeType":"SpreadElement","endLine":47,"endColumn":53}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\r\n'use client';\r\nimport { useState, useEffect } from 'react';\r\nimport { collection, onSnapshot, query, where, type Query, type DocumentData } from 'firebase/firestore';\r\nimport { initializeFirebase } from '@/firebase';\r\n\r\n/**\r\n * Custom hook to get a collection from Firestore in real-time.\r\n * @param collectionName The name of the collection.\r\n * @param queryConstraints Optional query constraints.\r\n * @returns The collection data, loading state, and error state.\r\n */\r\nexport function useCollection<T = DocumentData>(\r\n  collectionName: string,\r\n  ...queryConstraints: any[]\r\n) {\r\n  const [data, setData] = useState<T[] | null>(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState<Error | null>(null);\r\n  const { firestore } = initializeFirebase();\r\n\r\n  useEffect(() => {\r\n    try {\r\n      const collectionRef = collection(firestore, collectionName);\r\n      const q: Query = query(collectionRef, ...queryConstraints.filter(Boolean));\r\n\r\n      const unsubscribe = onSnapshot(q, (querySnapshot) => {\r\n        const documents = querySnapshot.docs.map(doc => ({\r\n          id: doc.id,\r\n          ...doc.data()\r\n        } as T));\r\n        setData(documents);\r\n        setLoading(false);\r\n      }, (err) => {\r\n        console.error(err);\r\n        setError(err);\r\n        setLoading(false);\r\n      });\r\n\r\n      return () => unsubscribe();\r\n    } catch (err: any) {\r\n      console.error(err);\r\n      setError(err);\r\n      setLoading(false);\r\n      return () => {};\r\n    }\r\n  }, [collectionName, firestore, ...queryConstraints]);\r\n\r\n  return { data, loading, error };\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\FileSafe\\studio\\src\\firebase\\firestore\\use-collection.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":54,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":54,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1839,1842],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1839,1842],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":87,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":87,"endColumn":13}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useEffect } from 'react';\r\nimport {\r\n  Query,\r\n  onSnapshot,\r\n  DocumentData,\r\n  FirestoreError,\r\n  QuerySnapshot,\r\n  CollectionReference,\r\n} from 'firebase/firestore';\r\nimport { errorEmitter } from '@/firebase/error-emitter';\r\nimport { FirestorePermissionError } from '@/firebase/errors';\r\n\r\n/** Utility type to add an 'id' field to a given type T. */\r\nexport type WithId<T> = T & { id: string };\r\n\r\n/**\r\n * Interface for the return value of the useCollection hook.\r\n * @template T Type of the document data.\r\n */\r\nexport interface UseCollectionResult<T> {\r\n  data: WithId<T>[] | null; // Document data with ID, or null.\r\n  isLoading: boolean;       // True if loading.\r\n  error: FirestoreError | Error | null; // Error object, or null.\r\n}\r\n\r\n/* Internal implementation of Query:\r\n  https://github.com/firebase/firebase-js-sdk/blob/c5f08a9bc5da0d2b0207802c972d53724ccef055/packages/firestore/src/lite-api/reference.ts#L143\r\n*/\r\nexport interface InternalQuery extends Query<DocumentData> {\r\n  _query: {\r\n    path: {\r\n      canonicalString(): string;\r\n      toString(): string;\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * React hook to subscribe to a Firestore collection or query in real-time.\r\n * Handles nullable references/queries.\r\n * \r\n *\r\n * IMPORTANT! YOU MUST MEMOIZE the inputted memoizedTargetRefOrQuery or BAD THINGS WILL HAPPEN\r\n * use useMemo to memoize it per React guidence.  Also make sure that it's dependencies are stable\r\n * references\r\n *  \r\n * @template T Optional type for document data. Defaults to any.\r\n * @param {CollectionReference<DocumentData> | Query<DocumentData> | null | undefined} targetRefOrQuery -\r\n * The Firestore CollectionReference or Query. Waits if null/undefined.\r\n * @returns {UseCollectionResult<T>} Object with data, isLoading, error.\r\n */\r\nexport function useCollection<T = any>(\r\n    memoizedTargetRefOrQuery: ((CollectionReference<DocumentData> | Query<DocumentData>) & {__memo?: boolean})  | null | undefined,\r\n): UseCollectionResult<T> {\r\n  type ResultItemType = WithId<T>;\r\n  type StateDataType = ResultItemType[] | null;\r\n\r\n  const [data, setData] = useState<StateDataType>(null);\r\n  const [isLoading, setIsLoading] = useState<boolean>(false);\r\n  const [error, setError] = useState<FirestoreError | Error | null>(null);\r\n\r\n  useEffect(() => {\r\n    if (!memoizedTargetRefOrQuery) {\r\n      setData(null);\r\n      setIsLoading(false);\r\n      setError(null);\r\n      return;\r\n    }\r\n\r\n    setIsLoading(true);\r\n    setError(null);\r\n\r\n    // Directly use memoizedTargetRefOrQuery as it's assumed to be the final query\r\n    const unsubscribe = onSnapshot(\r\n      memoizedTargetRefOrQuery,\r\n      (snapshot: QuerySnapshot<DocumentData>) => {\r\n        const results: ResultItemType[] = [];\r\n        for (const doc of snapshot.docs) {\r\n          results.push({ ...(doc.data() as T), id: doc.id });\r\n        }\r\n        setData(results);\r\n        setError(null);\r\n        setIsLoading(false);\r\n      },\r\n      (error: FirestoreError) => {\r\n        // This logic extracts the path from either a ref or a query\r\n        const path: string =\r\n          memoizedTargetRefOrQuery.type === 'collection'\r\n            ? (memoizedTargetRefOrQuery as CollectionReference).path\r\n            : (memoizedTargetRefOrQuery as unknown as InternalQuery)._query.path.canonicalString()\r\n\r\n        const contextualError = new FirestorePermissionError({\r\n          operation: 'list',\r\n          path,\r\n        })\r\n\r\n        setError(contextualError)\r\n        setData(null)\r\n        setIsLoading(false)\r\n\r\n        // trigger global error propagation\r\n        errorEmitter.emit('permission-error', contextualError);\r\n      }\r\n    );\r\n\r\n    return () => unsubscribe();\r\n  }, [memoizedTargetRefOrQuery]); // Re-run if the target query/reference changes.\r\n  if(memoizedTargetRefOrQuery && !memoizedTargetRefOrQuery.__memo) {\r\n    throw new Error(memoizedTargetRefOrQuery + ' was not properly memoized using useMemoFirebase');\r\n  }\r\n  return { data, isLoading, error };\r\n}","usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\FileSafe\\studio\\src\\firebase\\firestore\\use-doc.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":41,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":41,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1387,1390],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1387,1390],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":74,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":74,"endColumn":13}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n    \r\nimport { useState, useEffect } from 'react';\r\nimport {\r\n  DocumentReference,\r\n  onSnapshot,\r\n  DocumentData,\r\n  FirestoreError,\r\n  DocumentSnapshot,\r\n} from 'firebase/firestore';\r\nimport { errorEmitter } from '@/firebase/error-emitter';\r\nimport { FirestorePermissionError } from '@/firebase/errors';\r\n\r\n/** Utility type to add an 'id' field to a given type T. */\r\ntype WithId<T> = T & { id: string };\r\n\r\n/**\r\n * Interface for the return value of the useDoc hook.\r\n * @template T Type of the document data.\r\n */\r\nexport interface UseDocResult<T> {\r\n  data: WithId<T> | null; // Document data with ID, or null.\r\n  isLoading: boolean;       // True if loading.\r\n  error: FirestoreError | Error | null; // Error object, or null.\r\n}\r\n\r\n/**\r\n * React hook to subscribe to a single Firestore document in real-time.\r\n * Handles nullable references.\r\n * \r\n * IMPORTANT! YOU MUST MEMOIZE the inputted memoizedTargetRefOrQuery or BAD THINGS WILL HAPPEN\r\n * use useMemo to memoize it per React guidence.  Also make sure that it's dependencies are stable\r\n * references\r\n *\r\n *\r\n * @template T Optional type for document data. Defaults to any.\r\n * @param {DocumentReference<DocumentData> | null | undefined} docRef -\r\n * The Firestore DocumentReference. Waits if null/undefined.\r\n * @returns {UseDocResult<T>} Object with data, isLoading, error.\r\n */\r\nexport function useDoc<T = any>(\r\n  memoizedDocRef: DocumentReference<DocumentData> | null | undefined,\r\n): UseDocResult<T> {\r\n  type StateDataType = WithId<T> | null;\r\n\r\n  const [data, setData] = useState<StateDataType>(null);\r\n  const [isLoading, setIsLoading] = useState<boolean>(false);\r\n  const [error, setError] = useState<FirestoreError | Error | null>(null);\r\n\r\n  useEffect(() => {\r\n    if (!memoizedDocRef) {\r\n      setData(null);\r\n      setIsLoading(false);\r\n      setError(null);\r\n      return;\r\n    }\r\n\r\n    setIsLoading(true);\r\n    setError(null);\r\n    // Optional: setData(null); // Clear previous data instantly\r\n\r\n    const unsubscribe = onSnapshot(\r\n      memoizedDocRef,\r\n      (snapshot: DocumentSnapshot<DocumentData>) => {\r\n        if (snapshot.exists()) {\r\n          setData({ ...(snapshot.data() as T), id: snapshot.id });\r\n        } else {\r\n          // Document does not exist\r\n          setData(null);\r\n        }\r\n        setError(null); // Clear any previous error on successful snapshot (even if doc doesn't exist)\r\n        setIsLoading(false);\r\n      },\r\n      (error: FirestoreError) => {\r\n        const contextualError = new FirestorePermissionError({\r\n          operation: 'get',\r\n          path: memoizedDocRef.path,\r\n        })\r\n\r\n        setError(contextualError)\r\n        setData(null)\r\n        setIsLoading(false)\r\n\r\n        // trigger global error propagation\r\n        errorEmitter.emit('permission-error', contextualError);\r\n      }\r\n    );\r\n\r\n    return () => unsubscribe();\r\n  }, [memoizedDocRef]); // Re-run if the memoizedDocRef changes.\r\n\r\n  return { data, isLoading, error };\r\n}","usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\FileSafe\\studio\\src\\firebase\\non-blocking-updates.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":19,"column":73,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":19,"endColumn":76,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[485,488],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[485,488],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":20,"column":39,"nodeType":null,"messageId":"unusedVar","endLine":20,"endColumn":44},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":39,"column":75,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":39,"endColumn":78,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1134,1137],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1134,1137],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":41,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":41,"endColumn":17},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":59,"column":76,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":59,"endColumn":79,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1655,1658],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1655,1658],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":61,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":61,"endColumn":17},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":80,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":80,"endColumn":17}],"suppressedMessages":[],"errorCount":7,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n    \r\nimport {\r\n  setDoc,\r\n  addDoc,\r\n  updateDoc,\r\n  deleteDoc,\r\n  CollectionReference,\r\n  DocumentReference,\r\n  SetOptions,\r\n} from 'firebase/firestore';\r\nimport { errorEmitter } from '@/firebase/error-emitter';\r\nimport {FirestorePermissionError} from '@/firebase/errors';\r\n\r\n/**\r\n * Initiates a setDoc operation for a document reference.\r\n * Does NOT await the write operation internally.\r\n */\r\nexport function setDocumentNonBlocking(docRef: DocumentReference, data: any, options: SetOptions) {\r\n  setDoc(docRef, data, options).catch(error => {\r\n    errorEmitter.emit(\r\n      'permission-error',\r\n      new FirestorePermissionError({\r\n        path: docRef.path,\r\n        operation: 'write', // or 'create'/'update' based on options\r\n        requestResourceData: data,\r\n      })\r\n    )\r\n  })\r\n  // Execution continues immediately\r\n}\r\n\r\n\r\n/**\r\n * Initiates an addDoc operation for a collection reference.\r\n * Does NOT await the write operation internally.\r\n * Returns the Promise for the new doc ref, but typically not awaited by caller.\r\n */\r\nexport function addDocumentNonBlocking(colRef: CollectionReference, data: any) {\r\n  const promise = addDoc(colRef, data)\r\n    .catch(error => {\r\n      errorEmitter.emit(\r\n        'permission-error',\r\n        new FirestorePermissionError({\r\n          path: colRef.path,\r\n          operation: 'create',\r\n          requestResourceData: data,\r\n        })\r\n      )\r\n    });\r\n  return promise;\r\n}\r\n\r\n\r\n/**\r\n * Initiates an updateDoc operation for a document reference.\r\n * Does NOT await the write operation internally.\r\n */\r\nexport function updateDocumentNonBlocking(docRef: DocumentReference, data: any) {\r\n  updateDoc(docRef, data)\r\n    .catch(error => {\r\n      errorEmitter.emit(\r\n        'permission-error',\r\n        new FirestorePermissionError({\r\n          path: docRef.path,\r\n          operation: 'update',\r\n          requestResourceData: data,\r\n        })\r\n      )\r\n    });\r\n}\r\n\r\n\r\n/**\r\n * Initiates a deleteDoc operation for a document reference.\r\n * Does NOT await the write operation internally.\r\n */\r\nexport function deleteDocumentNonBlocking(docRef: DocumentReference) {\r\n  deleteDoc(docRef)\r\n    .catch(error => {\r\n      errorEmitter.emit(\r\n        'permission-error',\r\n        new FirestorePermissionError({\r\n          path: docRef.path,\r\n          operation: 'delete',\r\n        })\r\n      )\r\n    });\r\n}","usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\FileSafe\\studio\\src\\firebase\\provider.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useMemo received a function whose dependencies are unknown. Pass an inline function instead.","line":160,"column":20,"nodeType":"Identifier","endLine":160,"endColumn":27}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React, { DependencyList, createContext, useContext, ReactNode, useMemo, useState, useEffect } from 'react';\r\nimport { FirebaseApp } from 'firebase/app';\r\nimport { Firestore } from 'firebase/firestore';\r\nimport { Auth, User, onAuthStateChanged } from 'firebase/auth';\r\nimport { FirebaseErrorListener } from '@/components/FirebaseErrorListener'\r\n\r\ninterface FirebaseProviderProps {\r\n  children: ReactNode;\r\n  firebaseApp: FirebaseApp;\r\n  firestore: Firestore;\r\n  auth: Auth;\r\n}\r\n\r\n// Internal state for user authentication\r\ninterface UserAuthState {\r\n  user: User | null;\r\n  isUserLoading: boolean;\r\n  userError: Error | null;\r\n}\r\n\r\n// Combined state for the Firebase context\r\nexport interface FirebaseContextState {\r\n  areServicesAvailable: boolean; // True if core services (app, firestore, auth instance) are provided\r\n  firebaseApp: FirebaseApp | null;\r\n  firestore: Firestore | null;\r\n  auth: Auth | null; // The Auth service instance\r\n  // User authentication state\r\n  user: User | null;\r\n  isUserLoading: boolean; // True during initial auth check\r\n  userError: Error | null; // Error from auth listener\r\n}\r\n\r\n// Return type for useFirebase()\r\nexport interface FirebaseServicesAndUser {\r\n  firebaseApp: FirebaseApp;\r\n  firestore: Firestore;\r\n  auth: Auth;\r\n  user: User | null;\r\n  isUserLoading: boolean;\r\n  userError: Error | null;\r\n}\r\n\r\n// Return type for useUser() - specific to user auth state\r\nexport interface UserHookResult { // Renamed from UserAuthHookResult for consistency if desired, or keep as UserAuthHookResult\r\n  user: User | null;\r\n  isUserLoading: boolean;\r\n  userError: Error | null;\r\n}\r\n\r\n// React Context\r\nexport const FirebaseContext = createContext<FirebaseContextState | undefined>(undefined);\r\n\r\n/**\r\n * FirebaseProvider manages and provides Firebase services and user authentication state.\r\n */\r\nexport const FirebaseProvider: React.FC<FirebaseProviderProps> = ({\r\n  children,\r\n  firebaseApp,\r\n  firestore,\r\n  auth,\r\n}) => {\r\n  const [userAuthState, setUserAuthState] = useState<UserAuthState>({\r\n    user: null,\r\n    isUserLoading: true, // Start loading until first auth event\r\n    userError: null,\r\n  });\r\n\r\n  // Effect to subscribe to Firebase auth state changes\r\n  useEffect(() => {\r\n    if (!auth) { // If no Auth service instance, cannot determine user state\r\n      setUserAuthState({ user: null, isUserLoading: false, userError: new Error(\"Auth service not provided.\") });\r\n      return;\r\n    }\r\n\r\n    setUserAuthState({ user: null, isUserLoading: true, userError: null }); // Reset on auth instance change\r\n\r\n    const unsubscribe = onAuthStateChanged(\r\n      auth,\r\n      (firebaseUser) => { // Auth state determined\r\n        setUserAuthState({ user: firebaseUser, isUserLoading: false, userError: null });\r\n      },\r\n      (error) => { // Auth listener error\r\n        console.error(\"FirebaseProvider: onAuthStateChanged error:\", error);\r\n        setUserAuthState({ user: null, isUserLoading: false, userError: error });\r\n      }\r\n    );\r\n    return () => unsubscribe(); // Cleanup\r\n  }, [auth]); // Depends on the auth instance\r\n\r\n  // Memoize the context value\r\n  const contextValue = useMemo((): FirebaseContextState => {\r\n    const servicesAvailable = !!(firebaseApp && firestore && auth);\r\n    return {\r\n      areServicesAvailable: servicesAvailable,\r\n      firebaseApp: servicesAvailable ? firebaseApp : null,\r\n      firestore: servicesAvailable ? firestore : null,\r\n      auth: servicesAvailable ? auth : null,\r\n      user: userAuthState.user,\r\n      isUserLoading: userAuthState.isUserLoading,\r\n      userError: userAuthState.userError,\r\n    };\r\n  }, [firebaseApp, firestore, auth, userAuthState]);\r\n\r\n  return (\r\n    <FirebaseContext.Provider value={contextValue}>\r\n      <FirebaseErrorListener />\r\n      {children}\r\n    </FirebaseContext.Provider>\r\n  );\r\n};\r\n\r\n/**\r\n * Hook to access core Firebase services and user authentication state.\r\n * Throws error if core services are not available or used outside provider.\r\n */\r\nexport const useFirebase = (): FirebaseServicesAndUser => {\r\n  const context = useContext(FirebaseContext);\r\n\r\n  if (context === undefined) {\r\n    throw new Error('useFirebase must be used within a FirebaseProvider.');\r\n  }\r\n\r\n  if (!context.areServicesAvailable || !context.firebaseApp || !context.firestore || !context.auth) {\r\n    throw new Error('Firebase core services not available. Check FirebaseProvider props.');\r\n  }\r\n\r\n  return {\r\n    firebaseApp: context.firebaseApp,\r\n    firestore: context.firestore,\r\n    auth: context.auth,\r\n    user: context.user,\r\n    isUserLoading: context.isUserLoading,\r\n    userError: context.userError,\r\n  };\r\n};\r\n\r\n/** Hook to access Firebase Auth instance. */\r\nexport const useAuth = (): Auth => {\r\n  const { auth } = useFirebase();\r\n  return auth;\r\n};\r\n\r\n/** Hook to access Firestore instance. */\r\nexport const useFirestore = (): Firestore => {\r\n  const { firestore } = useFirebase();\r\n  return firestore;\r\n};\r\n\r\n/** Hook to access Firebase App instance. */\r\nexport const useFirebaseApp = (): FirebaseApp => {\r\n  const { firebaseApp } = useFirebase();\r\n  return firebaseApp;\r\n};\r\n\r\ntype MemoFirebase <T> = T & {__memo?: boolean};\r\n\r\nexport function useMemoFirebase<T>(factory: () => T, deps: DependencyList): T | (MemoFirebase<T>) {\r\n  const memoized = useMemo(factory, deps);\r\n  \r\n  if(typeof memoized !== 'object' || memoized === null) return memoized;\r\n  (memoized as MemoFirebase<T>).__memo = true;\r\n  \r\n  return memoized;\r\n}\r\n\r\n/**\r\n * Hook specifically for accessing the authenticated user's state.\r\n * This provides the User object, loading status, and any auth errors.\r\n * @returns {UserHookResult} Object with user, isUserLoading, userError.\r\n */\r\nexport const useUser = (): UserHookResult => { // Renamed from useAuthUser\r\n  const { user, isUserLoading, userError } = useFirebase(); // Leverages the main hook\r\n  return { user, isUserLoading, userError };\r\n};","usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\FileSafe\\studio\\src\\hooks\\use-data.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":5,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":5,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[120,123],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[120,123],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import useSWR from 'swr';\r\n\r\nconst fetcher = (url: string) => fetch(url).then(res => res.json());\r\n\r\nconst EMPTY_ARRAY: any[] = [];\r\n\r\nexport function useData() {\r\n    const { data: users, mutate: mutateUsers } = useSWR('/api/users', fetcher);\r\n    const { data: documents, mutate: mutateDocuments } = useSWR('/api/documents', fetcher);\r\n    const { data: holidays, mutate: mutateHolidays } = useSWR('/api/holidays', fetcher);\r\n    const { data: announcements, mutate: mutateAnnouncements } = useSWR('/api/announcements', fetcher);\r\n    const { data: companies, mutate: mutateCompanies } = useSWR('/api/companies', fetcher);\r\n\r\n    return {\r\n        users: users || EMPTY_ARRAY,\r\n        documents: documents || EMPTY_ARRAY,\r\n        holidays: holidays || EMPTY_ARRAY,\r\n        announcements: announcements || EMPTY_ARRAY,\r\n        companies: companies || EMPTY_ARRAY,\r\n        loading: !users || !documents,\r\n        mutateUsers,\r\n        mutateDocuments,\r\n        mutateHolidays,\r\n        mutateAnnouncements,\r\n        mutateCompanies\r\n    };\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\FileSafe\\studio\\src\\hooks\\use-toast.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'actionTypes' is assigned a value but only used as a type.","line":21,"column":7,"nodeType":null,"messageId":"usedOnlyAsType","endLine":21,"endColumn":18}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\r\n\r\n// Inspired by react-hot-toast library\r\nimport * as React from \"react\"\r\n\r\nimport type {\r\n  ToastActionElement,\r\n  ToastProps,\r\n} from \"@/components/ui/toast\"\r\n\r\nconst TOAST_LIMIT = 1\r\nconst TOAST_REMOVE_DELAY = 1000000\r\n\r\ntype ToasterToast = ToastProps & {\r\n  id: string\r\n  title?: React.ReactNode\r\n  description?: React.ReactNode\r\n  action?: ToastActionElement\r\n}\r\n\r\nconst actionTypes = {\r\n  ADD_TOAST: \"ADD_TOAST\",\r\n  UPDATE_TOAST: \"UPDATE_TOAST\",\r\n  DISMISS_TOAST: \"DISMISS_TOAST\",\r\n  REMOVE_TOAST: \"REMOVE_TOAST\",\r\n} as const\r\n\r\nlet count = 0\r\n\r\nfunction genId() {\r\n  count = (count + 1) % Number.MAX_SAFE_INTEGER\r\n  return count.toString()\r\n}\r\n\r\ntype ActionType = typeof actionTypes\r\n\r\ntype Action =\r\n  | {\r\n      type: ActionType[\"ADD_TOAST\"]\r\n      toast: ToasterToast\r\n    }\r\n  | {\r\n      type: ActionType[\"UPDATE_TOAST\"]\r\n      toast: Partial<ToasterToast>\r\n    }\r\n  | {\r\n      type: ActionType[\"DISMISS_TOAST\"]\r\n      toastId?: ToasterToast[\"id\"]\r\n    }\r\n  | {\r\n      type: ActionType[\"REMOVE_TOAST\"]\r\n      toastId?: ToasterToast[\"id\"]\r\n    }\r\n\r\ninterface State {\r\n  toasts: ToasterToast[]\r\n}\r\n\r\nconst toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()\r\n\r\nconst addToRemoveQueue = (toastId: string) => {\r\n  if (toastTimeouts.has(toastId)) {\r\n    return\r\n  }\r\n\r\n  const timeout = setTimeout(() => {\r\n    toastTimeouts.delete(toastId)\r\n    dispatch({\r\n      type: \"REMOVE_TOAST\",\r\n      toastId: toastId,\r\n    })\r\n  }, TOAST_REMOVE_DELAY)\r\n\r\n  toastTimeouts.set(toastId, timeout)\r\n}\r\n\r\nexport const reducer = (state: State, action: Action): State => {\r\n  switch (action.type) {\r\n    case \"ADD_TOAST\":\r\n      return {\r\n        ...state,\r\n        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),\r\n      }\r\n\r\n    case \"UPDATE_TOAST\":\r\n      return {\r\n        ...state,\r\n        toasts: state.toasts.map((t) =>\r\n          t.id === action.toast.id ? { ...t, ...action.toast } : t\r\n        ),\r\n      }\r\n\r\n    case \"DISMISS_TOAST\": {\r\n      const { toastId } = action\r\n\r\n      // ! Side effects ! - This could be extracted into a dismissToast() action,\r\n      // but I'll keep it here for simplicity\r\n      if (toastId) {\r\n        addToRemoveQueue(toastId)\r\n      } else {\r\n        state.toasts.forEach((toast) => {\r\n          addToRemoveQueue(toast.id)\r\n        })\r\n      }\r\n\r\n      return {\r\n        ...state,\r\n        toasts: state.toasts.map((t) =>\r\n          t.id === toastId || toastId === undefined\r\n            ? {\r\n                ...t,\r\n                open: false,\r\n              }\r\n            : t\r\n        ),\r\n      }\r\n    }\r\n    case \"REMOVE_TOAST\":\r\n      if (action.toastId === undefined) {\r\n        return {\r\n          ...state,\r\n          toasts: [],\r\n        }\r\n      }\r\n      return {\r\n        ...state,\r\n        toasts: state.toasts.filter((t) => t.id !== action.toastId),\r\n      }\r\n  }\r\n}\r\n\r\nconst listeners: Array<(state: State) => void> = []\r\n\r\nlet memoryState: State = { toasts: [] }\r\n\r\nfunction dispatch(action: Action) {\r\n  memoryState = reducer(memoryState, action)\r\n  listeners.forEach((listener) => {\r\n    listener(memoryState)\r\n  })\r\n}\r\n\r\ntype Toast = Omit<ToasterToast, \"id\">\r\n\r\nfunction toast({ ...props }: Toast) {\r\n  const id = genId()\r\n\r\n  const update = (props: ToasterToast) =>\r\n    dispatch({\r\n      type: \"UPDATE_TOAST\",\r\n      toast: { ...props, id },\r\n    })\r\n  const dismiss = () => dispatch({ type: \"DISMISS_TOAST\", toastId: id })\r\n\r\n  dispatch({\r\n    type: \"ADD_TOAST\",\r\n    toast: {\r\n      ...props,\r\n      id,\r\n      open: true,\r\n      onOpenChange: (open) => {\r\n        if (!open) dismiss()\r\n      },\r\n    },\r\n  })\r\n\r\n  return {\r\n    id: id,\r\n    dismiss,\r\n    update,\r\n  }\r\n}\r\n\r\nfunction useToast() {\r\n  const [state, setState] = React.useState<State>(memoryState)\r\n\r\n  React.useEffect(() => {\r\n    listeners.push(setState)\r\n    return () => {\r\n      const index = listeners.indexOf(setState)\r\n      if (index > -1) {\r\n        listeners.splice(index, 1)\r\n      }\r\n    }\r\n  }, [state])\r\n\r\n  return {\r\n    ...state,\r\n    toast,\r\n    dismiss: (toastId?: string) => dispatch({ type: \"DISMISS_TOAST\", toastId }),\r\n  }\r\n}\r\n\r\nexport { useToast, toast }\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\FileSafe\\studio\\src\\lib\\auth.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'NextAuth' is defined but never used.","line":1,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":16}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import NextAuth, { NextAuthOptions } from \"next-auth\";\r\nimport CredentialsProvider from \"next-auth/providers/credentials\";\r\nimport pool from \"@/lib/db\";\r\nimport { RowDataPacket } from \"mysql2\";\r\nimport bcrypt from \"bcryptjs\";\r\n\r\nexport const authOptions: NextAuthOptions = {\r\n    providers: [\r\n        CredentialsProvider({\r\n            name: 'Credentials',\r\n            credentials: {\r\n                email: { label: \"Email\", type: \"email\" },\r\n                password: { label: \"Password\", type: \"password\" }\r\n            },\r\n            async authorize(credentials) {\r\n                if (!credentials?.email || !credentials?.password) return null;\r\n\r\n                try {\r\n                    const [rows] = await pool.execute<RowDataPacket[]>(\r\n                        'SELECT * FROM users WHERE email = ?',\r\n                        [credentials.email]\r\n                    );\r\n                    const user = rows[0];\r\n\r\n                    if (user && await bcrypt.compare(credentials.password, user.password_hash)) {\r\n                        return {\r\n                            id: user.id,\r\n                            name: `${user.first_name} ${user.last_name}`,\r\n                            email: user.email,\r\n                            image: user.avatar,\r\n                            role: user.is_admin ? 'admin' : 'employee'\r\n                        };\r\n                    }\r\n                } catch (error) {\r\n                    console.error(\"Auth error:\", error);\r\n                }\r\n                return null;\r\n            }\r\n        })\r\n    ],\r\n    callbacks: {\r\n        async jwt({ token, user }) {\r\n            if (user) {\r\n                token.role = user.role;\r\n                token.id = user.id;\r\n            }\r\n            return token;\r\n        },\r\n        async session({ session, token }) {\r\n            if (session.user) {\r\n                session.user.role = token.role;\r\n                session.user.id = token.id as string;\r\n            }\r\n            return session;\r\n        }\r\n    },\r\n    pages: {\r\n        signIn: '/login',\r\n    },\r\n    secret: process.env.NEXTAUTH_SECRET,\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\FileSafe\\studio\\src\\lib\\db.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":18,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":18,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[603,606],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[603,606],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":18,"column":59,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":18,"endColumn":62,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[629,632],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[629,632],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import mysql from 'mysql2/promise';\r\n\r\nconst pool = mysql.createPool({\r\n  host: process.env.DB_HOST,\r\n  port: parseInt(process.env.DB_PORT || '3306'),\r\n  user: process.env.DB_USER,\r\n  password: process.env.DB_PASSWORD,\r\n  database: process.env.DB_NAME,\r\n  waitForConnections: true,\r\n  connectionLimit: 10,\r\n  maxIdle: 10, // max idle connections, the default value is the same as `connectionLimit`\r\n  idleTimeout: 60000, // idle connections timeout, in milliseconds, the default value 60000\r\n  queueLimit: 0,\r\n  enableKeepAlive: true,\r\n  keepAliveInitialDelay: 0\r\n});\r\n\r\nexport async function query<T = any>(sql: string, params: any[] = []): Promise<T> {\r\n  const [results] = await pool.execute(sql, params);\r\n  return results as T;\r\n}\r\n\r\nexport default pool;\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\FileSafe\\studio\\src\\lib\\file-parser.ts","messages":[{"ruleId":"prefer-const","severity":2,"message":"'nameParts' is never reassigned. Use 'const' instead.","line":23,"column":9,"nodeType":"Identifier","messageId":"useConst","endLine":23,"endColumn":18,"fix":{"range":[828,855],"text":"const nameParts = [...parts];"}}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":1,"fixableWarningCount":0,"source":"export interface ParsedFileInfo {\r\n    originalName: string;\r\n    detectedName: string;\r\n    detectedMonth?: string;\r\n    detectedYear?: string;\r\n    cleanName: string;\r\n}\r\n\r\nconst monthsShort = ['jan', 'feb', 'mar', 'apr', 'may', 'jun', 'jul', 'aug', 'sep', 'oct', 'nov', 'dec'];\r\nconst monthsLong = ['january', 'february', 'march', 'april', 'may', 'june', 'july', 'august', 'september', 'october', 'november', 'december'];\r\n\r\nexport function parseFilename(filename: string): ParsedFileInfo {\r\n    // Remove extension\r\n    const nameWithoutExt = filename.substring(0, filename.lastIndexOf('.')) || filename;\r\n\r\n    // Split by underscore or spaces\r\n    const parts = nameWithoutExt.split(/[_\\s]+/);\r\n\r\n    // Basic heuristic: \r\n    // Last part is likely date (e.g. Jan2025, 2024, etc)\r\n    // Everything before is name\r\n\r\n    let nameParts = [...parts];\r\n    let datePart = '';\r\n\r\n    // Check if last part looks like a date\r\n    const lastPart = parts[parts.length - 1];\r\n    if (/\\d{4}/.test(lastPart)) { // Contains year\r\n        datePart = lastPart;\r\n        nameParts.pop(); // Remove it from name\r\n    }\r\n\r\n    const cleanName = nameParts.map(p => p.charAt(0).toUpperCase() + p.slice(1).toLowerCase()).join(' ');\r\n\r\n    // Try to extract Month/Year from datePart\r\n    let detectedMonth: string | undefined;\r\n    let detectedYear: string | undefined;\r\n\r\n    if (datePart) {\r\n        const yearMatch = datePart.match(/\\d{4}/);\r\n        if (yearMatch) detectedYear = yearMatch[0];\r\n\r\n        const lowerDate = datePart.toLowerCase();\r\n        // Check full months first\r\n        let monthIndex = monthsLong.findIndex(m => lowerDate.includes(m));\r\n        if (monthIndex === -1) {\r\n            // Check short months\r\n            monthIndex = monthsShort.findIndex(m => lowerDate.includes(m));\r\n        }\r\n\r\n        if (monthIndex !== -1) {\r\n            detectedMonth = (monthIndex + 1).toString(); // Return 1-12\r\n        }\r\n    }\r\n\r\n    return {\r\n        originalName: filename,\r\n        detectedName: cleanName,\r\n        detectedMonth,\r\n        detectedYear,\r\n        cleanName: cleanName // Start search with this\r\n    };\r\n}\r\n","usedDeprecatedRules":[]}]